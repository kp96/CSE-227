324
{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basbd9182d\""},"diff":[{"chunks":[{"content":"@@ -333,9 +333,11 @@","changes":[{"type":"normal","normal":true,"ln1":333,"ln2":333,"content":" "},{"type":"normal","normal":true,"ln1":334,"ln2":334,"content":"       <method name=\"showHistoryPopup\">"},{"type":"normal","normal":true,"ln1":335,"ln2":335,"content":"         <body><![CDATA["},{"type":"add","add":true,"ln":336,"content":"+#ifndef MOZILLA_1_8_BRANCH"},{"type":"normal","normal":true,"ln1":336,"ln2":337,"content":"           // This is an autocomplete widget, but we want the rollup event"},{"type":"normal","normal":true,"ln1":337,"ln2":338,"content":"           // to be consumed, as if we were a menulist."},{"type":"normal","normal":true,"ln1":338,"ln2":339,"content":"           this.popup.popupBoxObject.setConsumeRollupEvent(Components.interfaces.nsIPopupBoxObject.ROLLUP_CONSUME);"},{"type":"add","add":true,"ln":340,"content":"+#endif"},{"type":"normal","normal":true,"ln1":339,"ln2":341,"content":" "},{"type":"normal","normal":true,"ln1":340,"ln2":342,"content":"           this.maxRows = 14;"},{"type":"normal","normal":true,"ln1":341,"ln2":343,"content":"           this.attachController();"}],"oldStart":333,"oldLines":9,"newStart":333,"newLines":11},{"content":"@@ -726,7 +728,16 @@","changes":[{"type":"normal","normal":true,"ln1":726,"ln2":728,"content":"           controller.handleEnter();"},{"type":"normal","normal":true,"ln1":727,"ln2":729,"content":"         ]]></body>"},{"type":"normal","normal":true,"ln1":728,"ln2":730,"content":"       </method>"},{"type":"del","del":true,"ln":729,"content":"-      "},{"type":"add","add":true,"ln":731,"content":"+#ifdef MOZILLA_1_8_BRANCH"},{"type":"add","add":true,"ln":732,"content":"+"},{"type":"add","add":true,"ln":733,"content":"+      <method name=\"clearOpenProperty\">"},{"type":"add","add":true,"ln":734,"content":"+        <parameter name=\"aPopupNode\"/>"},{"type":"add","add":true,"ln":735,"content":"+        <body><![CDATA["},{"type":"add","add":true,"ln":736,"content":"+          aPopupNode.mPopupOpen = false;"},{"type":"add","add":true,"ln":737,"content":"+        ]]></body>"},{"type":"add","add":true,"ln":738,"content":"+      </method>"},{"type":"add","add":true,"ln":739,"content":"+#endif"},{"type":"add","add":true,"ln":740,"content":"+"},{"type":"normal","normal":true,"ln1":730,"ln2":741,"content":"     </implementation>"},{"type":"normal","normal":true,"ln1":731,"ln2":742,"content":" "},{"type":"normal","normal":true,"ln1":732,"ln2":743,"content":"     <handlers>"}],"oldStart":726,"oldLines":7,"newStart":728,"newLines":16},{"content":"@@ -735,7 +746,11 @@","changes":[{"type":"normal","normal":true,"ln1":735,"ln2":746,"content":"       </handler>"},{"type":"normal","normal":true,"ln1":736,"ln2":747,"content":" "},{"type":"normal","normal":true,"ln1":737,"ln2":748,"content":"       <handler event=\"popuphiding\">"},{"type":"add","add":true,"ln":749,"content":"+#ifdef MOZILLA_1_8_BRANCH"},{"type":"add","add":true,"ln":750,"content":"+        setTimeout(this.clearOpenProperty, 0, this);"},{"type":"add","add":true,"ln":751,"content":"+#else"},{"type":"normal","normal":true,"ln1":738,"ln2":752,"content":"         this.mPopupOpen = false;"},{"type":"add","add":true,"ln":753,"content":"+#endif"},{"type":"normal","normal":true,"ln1":739,"ln2":754,"content":"         this.mInput.maxRows = 6;"},{"type":"normal","normal":true,"ln1":740,"ln2":755,"content":"       </handler>"},{"type":"normal","normal":true,"ln1":741,"ln2":756,"content":"     </handlers>"}],"oldStart":735,"oldLines":7,"newStart":746,"newLines":11},{"content":"@@ -819,7 +834,13 @@","changes":[{"type":"normal","normal":true,"ln1":819,"ln2":834,"content":"       <method name=\"showPopup\">"},{"type":"normal","normal":true,"ln1":820,"ln2":835,"content":"         <body><![CDATA["},{"type":"normal","normal":true,"ln1":821,"ln2":836,"content":"           var textbox = document.getBindingParent(this);"},{"type":"add","add":true,"ln":837,"content":"+#ifdef MOZILLA_1_8_BRANCH"},{"type":"add","add":true,"ln":838,"content":"+          if (!textbox.popup.mPopupOpen) { "},{"type":"add","add":true,"ln":839,"content":"+            textbox.showHistoryPopup();"},{"type":"add","add":true,"ln":840,"content":"+          }"},{"type":"add","add":true,"ln":841,"content":"+#else"},{"type":"normal","normal":true,"ln1":822,"ln2":842,"content":"           textbox.showHistoryPopup();"},{"type":"add","add":true,"ln":843,"content":"+#endif"},{"type":"normal","normal":true,"ln1":823,"ln2":844,"content":"         ]]></body>"},{"type":"normal","normal":true,"ln1":824,"ln2":845,"content":"       </method>"},{"type":"normal","normal":true,"ln1":825,"ln2":846,"content":"     </implementation>"}],"oldStart":819,"oldLines":7,"newStart":834,"newLines":13}],"deletions":1,"additions":22,"from":"toolkit/content/widgets/autocomplete.xml","to":"toolkit/content/widgets/autocomplete.xml","index":["39d7fcf..81bf0ef","100644"]},{"chunks":[{"content":"@@ -291,44 +291,66 @@","changes":[{"type":"normal","normal":true,"ln1":291,"ln2":291,"content":"       </property>"},{"type":"normal","normal":true,"ln1":292,"ln2":292,"content":"       <property name=\"href\" onget=\"return this.getAttribute('href');\""},{"type":"normal","normal":true,"ln1":293,"ln2":293,"content":"                             onset=\"this.setAttribute('href', val); return val;\" />"},{"type":"del","del":true,"ln":294,"content":"-      <method name=\"open\">    "},{"type":"add","add":true,"ln":294,"content":"+      <method name=\"open\">"},{"type":"normal","normal":true,"ln1":295,"ln2":295,"content":"         <parameter name=\"aEvent\"/>"},{"type":"normal","normal":true,"ln1":296,"ln2":296,"content":"         <body>"},{"type":"normal","normal":true,"ln1":297,"ln2":297,"content":"         <![CDATA["},{"type":"del","del":true,"ln":298,"content":"-          if (this.disabled || aEvent.getPreventDefault())"},{"type":"add","add":true,"ln":298,"content":"+          var href = this.href;"},{"type":"add","add":true,"ln":299,"content":"+          if (!href || this.disabled || aEvent.getPreventDefault())"},{"type":"normal","normal":true,"ln1":299,"ln2":300,"content":"             return;"},{"type":"del","del":true,"ln":300,"content":"-          var href = this.getAttribute('href');"},{"type":"del","del":true,"ln":301,"content":"-\r"},{"type":"del","del":true,"ln":302,"content":"-          if (href)"},{"type":"del","del":true,"ln":303,"content":"-          {"},{"type":"add","add":true,"ln":301,"content":"+"},{"type":"add","add":true,"ln":302,"content":"+          var uri = null;"},{"type":"add","add":true,"ln":303,"content":"+          try {"},{"type":"add","add":true,"ln":304,"content":"+            const nsISSM = Components.interfaces.nsIScriptSecurityManager;"},{"type":"add","add":true,"ln":305,"content":"+            const secMan ="},{"type":"add","add":true,"ln":306,"content":"+                     Components.classes[\"@mozilla.org/scriptsecuritymanager;1\"]"},{"type":"add","add":true,"ln":307,"content":"+                               .getService(nsISSM);"},{"type":"add","add":true,"ln":308,"content":"+"},{"type":"add","add":true,"ln":309,"content":"+            const ioService ="},{"type":"add","add":true,"ln":310,"content":"+                     Components.classes[\"@mozilla.org/network/io-service;1\"]"},{"type":"add","add":true,"ln":311,"content":"+                               .getService(Components.interfaces.nsIIOService);"},{"type":"add","add":true,"ln":312,"content":"+"},{"type":"add","add":true,"ln":313,"content":"+            uri = ioService.newURI(href, null, null);"},{"type":"add","add":true,"ln":314,"content":"+            var safeURI = ioService.newURI(\"about:blank\", null, null);"},{"type":"add","add":true,"ln":315,"content":"+"},{"type":"normal","normal":true,"ln1":304,"ln2":316,"content":"             try {"},{"type":"del","del":true,"ln":305,"content":"-              var uri = Components.classes[\"@mozilla.org/network/io-service;1\"]"},{"type":"del","del":true,"ln":306,"content":"-                                  .getService(Components.interfaces.nsIIOService)"},{"type":"del","del":true,"ln":307,"content":"-                                  .newURI(href, null, null);"},{"type":"del","del":true,"ln":308,"content":"-"},{"type":"del","del":true,"ln":309,"content":"-              var protocolSvc = Components.classes[\"@mozilla.org/uriloader/external-protocol-service;1\"]"},{"type":"del","del":true,"ln":310,"content":"-                                          .getService(Components.interfaces.nsIExternalProtocolService);"},{"type":"del","del":true,"ln":311,"content":"-              // if the scheme is not an exposed protocol, then opening this link should "},{"type":"del","del":true,"ln":312,"content":"-              // be deferred to the system's external protocol handler"},{"type":"del","del":true,"ln":313,"content":"-              if (!protocolSvc.isExposedProtocol(uri.scheme))"},{"type":"del","del":true,"ln":314,"content":"-              {"},{"type":"del","del":true,"ln":315,"content":"-                protocolSvc.loadUrl(uri);"},{"type":"del","del":true,"ln":316,"content":"-                aEvent.preventDefault()"},{"type":"del","del":true,"ln":317,"content":"-                return;"},{"type":"del","del":true,"ln":318,"content":"-              }"},{"type":"add","add":true,"ln":317,"content":"+              secMan.checkLoadURI(safeURI, uri, nsISSM.DISALLOW_SCRIPT_OR_DATA)"},{"type":"add","add":true,"ln":318,"content":"+            } catch (ex) {"},{"type":"add","add":true,"ln":319,"content":"+              var msg = \"Error: Cannot open a \" + uri.scheme + \": link using \\"},{"type":"add","add":true,"ln":320,"content":"+                         the text-link binding.\";"},{"type":"add","add":true,"ln":321,"content":"+              Components.utils.reportError(msg);"},{"type":"add","add":true,"ln":322,"content":"+              return;"},{"type":"normal","normal":true,"ln1":319,"ln2":323,"content":"             }"},{"type":"del","del":true,"ln":320,"content":"-            catch (ex) {}"},{"type":"del","del":true,"ln":321,"content":"-          "},{"type":"del","del":true,"ln":322,"content":"-            // otherwise, fall back to opening the anchor directly"},{"type":"del","del":true,"ln":323,"content":"-            var win = window;"},{"type":"del","del":true,"ln":324,"content":"-            if (window instanceof Components.interfaces.nsIDOMChromeWindow) {"},{"type":"del","del":true,"ln":325,"content":"-              while (win.opener && !win.opener.closed) "},{"type":"del","del":true,"ln":326,"content":"-                win = win.opener;"},{"type":"add","add":true,"ln":324,"content":"+"},{"type":"add","add":true,"ln":325,"content":"+            const cID = \"@mozilla.org/uriloader/external-protocol-service;1\";"},{"type":"add","add":true,"ln":326,"content":"+            const nsIEPS = Components.interfaces.nsIExternalProtocolService;"},{"type":"add","add":true,"ln":327,"content":"+            var protocolSvc = Components.classes[contractID]"},{"type":"add","add":true,"ln":328,"content":"+                                        .getService(nsIEPS);"},{"type":"add","add":true,"ln":329,"content":"+"},{"type":"add","add":true,"ln":330,"content":"+            // if the scheme is not an exposed protocol, then opening this link"},{"type":"add","add":true,"ln":331,"content":"+            // should be deferred to the system's external protocol handler"},{"type":"add","add":true,"ln":332,"content":"+            if (!protocolSvc.isExposedProtocol(uri.scheme)) {"},{"type":"add","add":true,"ln":333,"content":"+              protocolSvc.loadUrl(uri);"},{"type":"add","add":true,"ln":334,"content":"+              aEvent.preventDefault()"},{"type":"add","add":true,"ln":335,"content":"+              return;"},{"type":"normal","normal":true,"ln1":327,"ln2":336,"content":"             }"},{"type":"del","del":true,"ln":328,"content":"-            win.open(href);"},{"type":"normal","normal":true,"ln1":329,"ln2":337,"content":" "},{"type":"del","del":true,"ln":330,"content":"-            aEvent.preventDefault();"},{"type":"add","add":true,"ln":338,"content":"+          } catch (ex) {}"},{"type":"add","add":true,"ln":339,"content":"+"},{"type":"add","add":true,"ln":340,"content":"+          // otherwise, fall back to opening the anchor directly"},{"type":"add","add":true,"ln":341,"content":"+          var win = window;"},{"type":"add","add":true,"ln":342,"content":"+          if (window instanceof Components.interfaces.nsIDOMChromeWindow) {"},{"type":"add","add":true,"ln":343,"content":"+            while (win.opener && !win.opener.closed)"},{"type":"add","add":true,"ln":344,"content":"+              win = win.opener;"},{"type":"normal","normal":true,"ln1":331,"ln2":345,"content":"           }"},{"type":"add","add":true,"ln":346,"content":"+"},{"type":"add","add":true,"ln":347,"content":"+          if (uri)"},{"type":"add","add":true,"ln":348,"content":"+            win.open(uri.spec);"},{"type":"add","add":true,"ln":349,"content":"+          else"},{"type":"add","add":true,"ln":350,"content":"+            win.open(href);"},{"type":"add","add":true,"ln":351,"content":"+"},{"type":"add","add":true,"ln":352,"content":"+          aEvent.preventDefault();"},{"type":"add","add":true,"ln":353,"content":"+"},{"type":"normal","normal":true,"ln1":332,"ln2":354,"content":"         ]]>"},{"type":"normal","normal":true,"ln1":333,"ln2":355,"content":"         </body>"},{"type":"normal","normal":true,"ln1":334,"ln2":356,"content":"       </method>"}],"oldStart":291,"oldLines":44,"newStart":291,"newLines":66},{"content":"@@ -336,7 +358,7 @@","changes":[{"type":"normal","normal":true,"ln1":336,"ln2":358,"content":" "},{"type":"normal","normal":true,"ln1":337,"ln2":359,"content":"     <handlers>"},{"type":"normal","normal":true,"ln1":338,"ln2":360,"content":"       <handler event=\"click\" phase=\"capturing\" button=\"0\" action=\"this.open(event)\"/>"},{"type":"del","del":true,"ln":339,"content":"-      <handler event=\"keypress\" preventdefault=\"true\" keycode=\"VK_ENTER\" action=\"this.click()\" />"},{"type":"add","add":true,"ln":361,"content":"+      <handler event=\"keypress\" preventdefault=\"true\" keycode=\"VK_ENTER\"  action=\"this.click()\" />"},{"type":"normal","normal":true,"ln1":340,"ln2":362,"content":"       <handler event=\"keypress\" preventdefault=\"true\" keycode=\"VK_RETURN\" action=\"this.click()\" />"},{"type":"normal","normal":true,"ln1":341,"ln2":363,"content":"     </handlers>"},{"type":"normal","normal":true,"ln1":342,"ln2":364,"content":"   </binding>"}],"oldStart":336,"oldLines":7,"newStart":358,"newLines":7}],"deletions":30,"additions":52,"from":"toolkit/content/widgets/text.xml","to":"toolkit/content/widgets/text.xml","index":["b1d2189..653970b","100644"]}]}
