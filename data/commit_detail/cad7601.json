{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bascad7601\""},"diff":"\"cad7601 Backing out previous attempts to fixe non newref tinderboxes and part of the patch for bug 392303\\ndiff --git a/toolkit/mozapps/installer/windows/nsis/common.nsh b/toolkit/mozapps/installer/windows/nsis/common.nsh\\nindex 4b6b14b..1a6a372 100755\\n--- a/toolkit/mozapps/installer/windows/nsis/common.nsh\\n+++ b/toolkit/mozapps/installer/windows/nsis/common.nsh\\n@@ -67,8 +67,11 @@ Exch 1   ; exchange the top of the stack with 2 below the top of the stack\\n Exch $R9 ; exchange the new $R9 value with the top of the stack\\n */\\n \\n-!include TextFunc.nsh\\n-!include FileFunc.nsh\\n+# Commented out until the Thunderbird, Seamonkey, and Calendar Tinderboxes\\n+# have been updated to MozillaBuild which includes an updated version of\\n+# NSIS\\n+# !include TextFunc.nsh\\n+# !include FileFunc.nsh\\n \\n ; NSIS provided macros that we have overridden.\\n !include overrides.nsh\\n@@ -394,6 +397,60 @@ Exch $R9 ; exchange the new $R9 value with the top of the stack\\n   WriteINIStr \\\"$PLUGINSDIR\\\\options.ini\\\" \\\"Field 7\\\" Bottom \\\"117\\\"\\n !macroend\\n \\n+!macro createSummaryINI\\n+  WriteINIStr \\\"$PLUGINSDIR\\\\summary.ini\\\" \\\"Settings\\\" NumFields \\\"5\\\"\\n+\\n+  WriteINIStr \\\"$PLUGINSDIR\\\\summary.ini\\\" \\\"Field 1\\\" Type   \\\"label\\\"\\n+  WriteINIStr \\\"$PLUGINSDIR\\\\summary.ini\\\" \\\"Field 1\\\" Text   \\\"$(OPTIONAL_COMPONENTS_LABEL)\\\"\\n+  WriteINIStr \\\"$PLUGINSDIR\\\\summary.ini\\\" \\\"Field 1\\\" Left   \\\"0\\\"\\n+  WriteINIStr \\\"$PLUGINSDIR\\\\summary.ini\\\" \\\"Field 1\\\" Right  \\\"-1\\\"\\n+  WriteINIStr \\\"$PLUGINSDIR\\\\summary.ini\\\" \\\"Field 1\\\" Top    \\\"5\\\"\\n+  WriteINIStr \\\"$PLUGINSDIR\\\\summary.ini\\\" \\\"Field 1\\\" Bottom \\\"15\\\"\\n+\\n+  StrCpy $R1 2\\n+  ${If} ${FileExists} \\\"$EXEDIR\\\\optional\\\\extensions\\\\inspector@mozilla.org\\\"\\n+    WriteINIStr \\\"$PLUGINSDIR\\\\summary.ini\\\" \\\"Field $R1\\\" Type   \\\"checkbox\\\"\\n+    WriteINIStr \\\"$PLUGINSDIR\\\\summary.ini\\\" \\\"Field $R1\\\" Text   \\\"$(DOMI_TITLE)\\\"\\n+    WriteINIStr \\\"$PLUGINSDIR\\\\summary.ini\\\" \\\"Field $R1\\\" Left   \\\"15\\\"\\n+    WriteINIStr \\\"$PLUGINSDIR\\\\summary.ini\\\" \\\"Field $R1\\\" Right  \\\"-1\\\"\\n+    WriteINIStr \\\"$PLUGINSDIR\\\\summary.ini\\\" \\\"Field $R1\\\" Top    \\\"20\\\"\\n+    WriteINIStr \\\"$PLUGINSDIR\\\\summary.ini\\\" \\\"Field $R1\\\" Bottom \\\"30\\\"\\n+    WriteINIStr \\\"$PLUGINSDIR\\\\summary.ini\\\" \\\"Field $R1\\\" State  \\\"1\\\"\\n+    WriteINIStr \\\"$PLUGINSDIR\\\\summary.ini\\\" \\\"Field $R1\\\" Flags  \\\"GROUP\\\"\\n+    IntOp $R1 $R1 + 1\\n+  ${EndIf}\\n+\\n+  ${If} ${FileExists} \\\"$EXEDIR\\\\optional\\\\extensions\\\\talkback@mozilla.org\\\"\\n+    WriteINIStr \\\"$PLUGINSDIR\\\\summary.ini\\\" \\\"Field $R1\\\" Type   \\\"checkbox\\\"\\n+    WriteINIStr \\\"$PLUGINSDIR\\\\summary.ini\\\" \\\"Field $R1\\\" Text   \\\"$(QFA_TITLE)\\\"\\n+    WriteINIStr \\\"$PLUGINSDIR\\\\summary.ini\\\" \\\"Field $R1\\\" Left   \\\"15\\\"\\n+    WriteINIStr \\\"$PLUGINSDIR\\\\summary.ini\\\" \\\"Field $R1\\\" Right  \\\"-1\\\"\\n+    WriteINIStr \\\"$PLUGINSDIR\\\\summary.ini\\\" \\\"Field $R1\\\" Top    \\\"55\\\"\\n+    WriteINIStr \\\"$PLUGINSDIR\\\\summary.ini\\\" \\\"Field $R1\\\" Bottom \\\"65\\\"\\n+    WriteINIStr \\\"$PLUGINSDIR\\\\summary.ini\\\" \\\"Field $R1\\\" State  \\\"1\\\"\\n+    IntOp $R1 $R1 + 1\\n+  ${EndIf}\\n+\\n+  ${If} ${FileExists} \\\"$EXEDIR\\\\optional\\\\extensions\\\\inspector@mozilla.org\\\"\\n+    WriteINIStr \\\"$PLUGINSDIR\\\\summary.ini\\\" \\\"Field $R1\\\" Type   \\\"label\\\"\\n+    WriteINIStr \\\"$PLUGINSDIR\\\\summary.ini\\\" \\\"Field $R1\\\" Text   \\\"$(DOMI_TEXT)\\\"\\n+    WriteINIStr \\\"$PLUGINSDIR\\\\summary.ini\\\" \\\"Field $R1\\\" Left   \\\"30\\\"\\n+    WriteINIStr \\\"$PLUGINSDIR\\\\summary.ini\\\" \\\"Field $R1\\\" Right  \\\"-1\\\"\\n+    WriteINIStr \\\"$PLUGINSDIR\\\\summary.ini\\\" \\\"Field $R1\\\" Top    \\\"32\\\"\\n+    WriteINIStr \\\"$PLUGINSDIR\\\\summary.ini\\\" \\\"Field $R1\\\" Bottom \\\"52\\\"\\n+    IntOp $R1 $R1 + 1\\n+  ${EndIf}\\n+\\n+  ${If} ${FileExists} \\\"$EXEDIR\\\\optional\\\\extensions\\\\talkback@mozilla.org\\\"\\n+    WriteINIStr \\\"$PLUGINSDIR\\\\summary.ini\\\" \\\"Field $R1\\\" Type   \\\"label\\\"\\n+    WriteINIStr \\\"$PLUGINSDIR\\\\summary.ini\\\" \\\"Field $R1\\\" Text   \\\"$(QFA_TEXT)\\\"\\n+    WriteINIStr \\\"$PLUGINSDIR\\\\summary.ini\\\" \\\"Field $R1\\\" Left   \\\"30\\\"\\n+    WriteINIStr \\\"$PLUGINSDIR\\\\summary.ini\\\" \\\"Field $R1\\\" Right  \\\"-1\\\"\\n+    WriteINIStr \\\"$PLUGINSDIR\\\\summary.ini\\\" \\\"Field $R1\\\" Top    \\\"67\\\"\\n+    WriteINIStr \\\"$PLUGINSDIR\\\\summary.ini\\\" \\\"Field $R1\\\" Bottom \\\"87\\\"\\n+  ${EndIf}\\n+!macroend\\n+\\n !macro GetParentDir\\n   Exch $R0\\n   Push $R1\\n@@ -746,6 +803,7 @@ Exch $R9 ; exchange the new $R9 value with the top of the stack\\n  * Removes registry keys that reference this install location and for paths that\\n  * no longer exist. This uses SHCTX to determine the registry hive so you must\\n  * call SetShellVarContext first.\\n+ *\\n  * @param   _KEY\\n  *          The registry subkey (typically this will be Software\\\\Mozilla).\\n  *\\n@@ -756,18 +814,20 @@ Exch $R9 ; exchange the new $R9 value with the top of the stack\\n  * longer installed on the system.\\n  *\\n  * $R1 = stores the long path to $INSTDIR\\n- * $R2 = _KEY\\n+ * $R2 = value returned from the stack from the GetParent and GetLongPath macros\\n  * $R3 = value returned from the outer loop's EnumRegKey\\n  * $R4 = value returned from the inner loop's EnumRegKey\\n  * $R5 = value returned from ReadRegStr\\n  * $R6 = counter for the outer loop's EnumRegKey\\n  * $R7 = counter for the inner loop's EnumRegKey\\n- * $R8 = value returned popped from the stack for GetPathFromRegStr macro\\n- * $R9 = value returned popped from the stack for GetParentDir macro\\n+ * $R8 = value returned from the stack from the RemoveQuotesFromPath macro\\n+ * $R9 = _KEY\\n  */\\n !macro RegCleanMain\\n \\n   !insertmacro ${_MOZFUNC_UN}GetLongPath\\n+  !insertmacro ${_MOZFUNC_UN}GetParent\\n+  !insertmacro ${_MOZFUNC_UN}RemoveQuotesFromPath\\n \\n   !ifndef ${_MOZFUNC_UN}RegCleanMain\\n     !verbose push\\n@@ -775,68 +835,61 @@ Exch $R9 ; exchange the new $R9 value with the top of the stack\\n     !define ${_MOZFUNC_UN}RegCleanMain \\\"!insertmacro ${_MOZFUNC_UN}RegCleanMainCall\\\"\\n \\n     Function ${_MOZFUNC_UN}RegCleanMain\\n-      Exch $R2\\n-      Push $R3\\n-      Push $R4\\n-      Push $R5\\n-      Push $R6\\n+      Exch $R9\\n+      Push $R8\\n       Push $R7\\n+      Push $R6\\n+      Push $R5\\n+      Push $R4\\n+      Push $R3\\n+      Push $R2\\n       Push $R1\\n-      Push $R8\\n-      Push $R9\\n \\n       ${${_MOZFUNC_UN}GetLongPath} \\\"$INSTDIR\\\" $R1\\n       StrCpy $R6 0  ; set the counter for the outer loop to 0\\n \\n       outerloop:\\n-      EnumRegKey $R3 SHCTX $R2 $R6\\n+      EnumRegKey $R3 SHCTX $R9 $R6\\n       StrCmp $R3 \\\"\\\" end  ; if empty there are no more keys to enumerate\\n       IntOp $R6 $R6 + 1  ; increment the outer loop's counter\\n       ClearErrors\\n-      ReadRegStr $R5 SHCTX \\\"$R2\\\\$R3\\\\bin\\\" \\\"PathToExe\\\"\\n+      ReadRegStr $R5 SHCTX \\\"$R9\\\\$R3\\\\bin\\\" \\\"PathToExe\\\"\\n       IfErrors 0 outercontinue\\n       StrCpy $R7 0  ; set the counter for the inner loop to 0\\n \\n       innerloop:\\n-      EnumRegKey $R4 SHCTX \\\"$R2\\\\$R3\\\" $R7\\n+      EnumRegKey $R4 SHCTX \\\"$R9\\\\$R3\\\" $R7\\n       StrCmp $R4 \\\"\\\" outerloop  ; if empty there are no more keys to enumerate\\n       IntOp $R7 $R7 + 1  ; increment the inner loop's counter\\n       ClearErrors\\n-      ReadRegStr $R5 SHCTX \\\"$R2\\\\$R3\\\\$R4\\\\Main\\\" \\\"PathToExe\\\"\\n+      ReadRegStr $R5 SHCTX \\\"$R9\\\\$R3\\\\$R4\\\\Main\\\" \\\"PathToExe\\\"\\n       IfErrors innerloop\\n \\n-      Push $R5\\n-      ${GetPathFromRegStr}\\n-      Pop $R8\\n+      ${${_MOZFUNC_UN}RemoveQuotesFromPath} \\\"$R5\\\" $R8\\n \\n-      Push $R5\\n-      ${GetParentDir}\\n-      Pop $R9\\n+      IfFileExists \\\"$R8\\\" +1 +4\\n+      ${${_MOZFUNC_UN}GetParent} \\\"$R8\\\" $R2\\n+      ${${_MOZFUNC_UN}GetLongPath} \\\"$R2\\\" $R2\\n+      StrCmp \\\"$R2\\\" \\\"$R1\\\" +1 innerloop\\n \\n-      IfFileExists \\\"$R8\\\" 0 +3\\n-      ${${_MOZFUNC_UN}GetLongPath} \\\"$R9\\\" $R9\\n-      StrCmp \\\"$R9\\\" \\\"$R1\\\" 0 innerloop\\n       ClearErrors\\n-      DeleteRegKey SHCTX \\\"$R2\\\\$R3\\\\$R4\\\"\\n+      DeleteRegKey SHCTX \\\"$R9\\\\$R3\\\\$R4\\\"\\n       IfErrors innerloop\\n       IntOp $R7 $R7 - 1 ; decrement the inner loop's counter when the key is deleted successfully.\\n       ClearErrors\\n-      DeleteRegKey /ifempty SHCTX \\\"$R2\\\\$R3\\\"\\n+      DeleteRegKey /ifempty SHCTX \\\"$R9\\\\$R3\\\"\\n       IfErrors innerloop outerdecrement\\n \\n       outercontinue:\\n-      Push $R5\\n-      ${GetPathFromRegStr}\\n-      Pop $R8\\n-      Push $R5\\n-      ${GetParentDir}\\n-      Pop $R9\\n+      ${${_MOZFUNC_UN}RemoveQuotesFromPath} \\\"$R5\\\" $R8\\n+\\n+      IfFileExists \\\"$R8\\\" 0 +4\\n+      ${${_MOZFUNC_UN}GetParent} \\\"$R8\\\" $R2\\n+      ${${_MOZFUNC_UN}GetLongPath} \\\"$R2\\\" $R2\\n+      StrCmp \\\"$R2\\\" \\\"$R1\\\" 0 outerloop\\n \\n-      IfFileExists \\\"$R8\\\" 0 +3\\n-      ${${_MOZFUNC_UN}GetLongPath} \\\"$R9\\\" $R9\\n-      StrCmp \\\"$R9\\\" \\\"$R1\\\" 0 outerloop\\n       ClearErrors\\n-      DeleteRegKey SHCTX \\\"$R2\\\\$R3\\\"\\n+      DeleteRegKey SHCTX \\\"$R9\\\\$R3\\\"\\n       IfErrors outerloop\\n \\n       outerdecrement:\\n@@ -846,15 +899,15 @@ Exch $R9 ; exchange the new $R9 value with the top of the stack\\n       end:\\n       ClearErrors\\n \\n-      Pop $R9\\n-      Pop $R8\\n       Pop $R1\\n-      Pop $R7\\n-      Pop $R6\\n-      Pop $R5\\n-      Pop $R4\\n+      Pop $R2\\n       Pop $R3\\n-      Exch $R2\\n+      Pop $R4\\n+      Pop $R5\\n+      Pop $R6\\n+      Pop $R7\\n+      Pop $R8\\n+      Exch $R9\\n     FunctionEnd\\n \\n     !verbose pop\\n@@ -885,6 +938,8 @@ Exch $R9 ; exchange the new $R9 value with the top of the stack\\n     !define _MOZFUNC_UN \\\"un.\\\"\\n \\n     !insertmacro GetLongPath\\n+    !insertmacro GetParent\\n+    !insertmacro RemoveQuotesFromPath\\n     !insertmacro RegCleanMain\\n \\n     !undef _MOZFUNC_UN\\n@@ -902,11 +957,12 @@ Exch $R9 ; exchange the new $R9 value with the top of the stack\\n  * $R6 = string for the base reg key (e.g. Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Uninstall)\\n  * $R7 = value returned from the EnumRegKey\\n  * $R8 = counter for the EnumRegKey\\n- * $R9 = value returned from the stack from the GetPathFromRegStr macro\\n+ * $R9 = value returned from the stack from the RemoveQuotesFromPath and GetLongPath macros\\n  */\\n !macro RegCleanUninstall\\n \\n   !insertmacro ${_MOZFUNC_UN}GetLongPath\\n+  !insertmacro ${_MOZFUNC_UN}RemoveQuotesFromPath\\n \\n   !ifndef ${_MOZFUNC_UN}RegCleanUninstall\\n     !verbose push\\n@@ -923,8 +979,8 @@ Exch $R9 ; exchange the new $R9 value with the top of the stack\\n \\n       ${${_MOZFUNC_UN}GetLongPath} \\\"$INSTDIR\\\" $R4\\n       StrCpy $R6 \\\"Software\\\\Microsoft\\\\Windows\\\\CurrentVersion\\\\Uninstall\\\"\\n-      StrCpy $R8 0\\n       StrCpy $R7 \\\"\\\"\\n+      StrCpy $R8 0\\n \\n       loop:\\n       EnumRegKey $R7 HKLM $R6 $R8\\n@@ -933,9 +989,7 @@ Exch $R9 ; exchange the new $R9 value with the top of the stack\\n       ClearErrors\\n       ReadRegStr $R5 HKLM \\\"$R6\\\\$R7\\\" \\\"InstallLocation\\\"\\n       IfErrors loop\\n-      Push $R5\\n-      ${GetPathFromRegStr}\\n-      Pop $R9\\n+      ${${_MOZFUNC_UN}RemoveQuotesFromPath} \\\"$R5\\\" $R9\\n       ${${_MOZFUNC_UN}GetLongPath} \\\"$R9\\\" $R9\\n       StrCmp \\\"$R9\\\" \\\"$R4\\\" 0 loop\\n       ClearErrors\\n@@ -947,6 +1001,7 @@ Exch $R9 ; exchange the new $R9 value with the top of the stack\\n       end:\\n       ClearErrors\\n \\n+      Pop $R4\\n       Pop $R5\\n       Pop $R6\\n       Pop $R7\\n@@ -980,6 +1035,7 @@ Exch $R9 ; exchange the new $R9 value with the top of the stack\\n     !define _MOZFUNC_UN \\\"un.\\\"\\n \\n     !insertmacro GetLongPath\\n+    !insertmacro RemoveQuotesFromPath\\n     !insertmacro RegCleanUninstall\\n \\n     !undef _MOZFUNC_UN\\n@@ -1564,6 +1620,9 @@ Exch $R9 ; exchange the new $R9 value with the top of the stack\\n  */\\n !macro GetSecondInstallPath\\n \\n+  !insertmacro ${_MOZFUNC_UN}GetLongPath\\n+  !insertmacro ${_MOZFUNC_UN}GetParent\\n+\\n   !ifndef ${_MOZFUNC_UN}GetSecondInstallPath\\n     !verbose push\\n     !verbose ${_MOZFUNC_VERBOSE}\\n@@ -1587,16 +1646,13 @@ Exch $R9 ; exchange the new $R9 value with the top of the stack\\n       ClearErrors\\n       ReadRegStr $R5 SHCTX \\\"$R3\\\\$R4\\\\bin\\\" \\\"PathToExe\\\"\\n       IfErrors loop\\n-      Push $R5\\n-      ${GetPathFromRegStr}\\n-      Pop $R7\\n-      Push $R5\\n-      ${GetParentDir}\\n-      Pop $R8\\n \\n-      IfFileExists \\\"$R7\\\" 0 +5\\n-      StrCmp $R8 $INSTDIR +4 0\\n-      StrCmp \\\"$R8\\\\${FileMainEXE}\\\" \\\"$R7\\\" 0 +3\\n+      ${${_MOZFUNC_UN}RemoveQuotesFromPath} \\\"$R5\\\" $R7\\n+\\n+      IfFileExists \\\"$R7\\\" +1 +6\\n+      ${${_MOZFUNC_UN}GetParent} \\\"$R7\\\" $R8\\n+      StrCmp $R8 $INSTDIR +4 +1\\n+      StrCmp \\\"$R8\\\\${FileMainEXE}\\\" \\\"$R7\\\" +1 +3\\n       StrCpy $R9 \\\"$R7\\\"\\n       GoTo end\\n \\n@@ -1643,6 +1699,8 @@ Exch $R9 ; exchange the new $R9 value with the top of the stack\\n     !undef _MOZFUNC_UN\\n     !define _MOZFUNC_UN \\\"un.\\\"\\n \\n+    !insertmacro GetLongPath\\n+    !insertmacro GetParent\\n     !insertmacro GetSecondInstallPath\\n \\n     !undef _MOZFUNC_UN\\n@@ -1675,6 +1733,7 @@ Exch $R9 ; exchange the new $R9 value with the top of the stack\\n  */\\n !macro GetSingleInstallPath\\n \\n+  !insertmacro ${_MOZFUNC_UN}GetLongPath\\n   !insertmacro ${_MOZFUNC_UN}GetParent\\n \\n   !ifndef ${_MOZFUNC_UN}GetSingleInstallPath\\n@@ -1756,6 +1815,7 @@ Exch $R9 ; exchange the new $R9 value with the top of the stack\\n     !undef _MOZFUNC_UN\\n     !define _MOZFUNC_UN \\\"un.\\\"\\n \\n+    !insertmacro GetLongPath\\n     !insertmacro GetParent\\n     !insertmacro GetSingleInstallPath\\n \\n@@ -1913,9 +1973,6 @@ Exch $R9 ; exchange the new $R9 value with the top of the stack\\n * exist. It is up to the caller to pass in a string of one of the forms noted\\n * above and to verify existence if necessary.\\n *\\n-* IMPORTANT! $R9 will be overwritten by this macro with the return value so\\n-*            protect yourself!\\n-*\\n * Examples:\\n * In:  C:\\\\PROGRA~1\\\\MOZILL~1\\\\FIREFOX.EXE -url \\\"%1\\\" -requestPending\\n * In:  C:\\\\PROGRA~1\\\\MOZILL~1\\\\FIREFOX.EXE,0\\n@@ -1929,15 +1986,15 @@ Exch $R9 ; exchange the new $R9 value with the top of the stack\\n * In:  \\\"C:\\\\Program Files\\\\Mozilla Firefox\\\\firefox.exe\\\"\\n * Out: C:\\\\Program Files\\\\Mozilla Firefox\\\\firefox.exe\\n *\\n-* @param   _STRING\\n-*          The string containing the path\\n-* @param   _RESULT\\n+* @param   _IN_PATH\\n+*          The string containing the path.\\n+* @param   _OUT_PATH\\n *          The register to store the path to.\\n *\\n * $R6 = counter for the outer loop's EnumRegKey\\n * $R7 = value returned from ReadRegStr\\n-* $R8 = _STRING\\n-* $R9 = _RESULT\\n+* $R8 = _IN_PATH\\n+* $R9 = _OUT_PATH\\n */\\n !macro GetPathFromString\\n \\n@@ -1947,6 +2004,8 @@ Exch $R9 ; exchange the new $R9 value with the top of the stack\\n     !define ${_MOZFUNC_UN}GetPathFromString \\\"!insertmacro ${_MOZFUNC_UN}GetPathFromStringCall\\\"\\n \\n     Function ${_MOZFUNC_UN}GetPathFromString\\n+      Exch $R9\\n+      Exch 1\\n       Exch $R8\\n       Push $R7\\n       Push $R6\\n@@ -1992,28 +2051,31 @@ Exch $R9 ; exchange the new $R9 value with the top of the stack\\n       Pop $R6\\n       Pop $R7\\n       Exch $R8\\n-      Push $R9\\n+      Exch 1\\n+      Exch $R9\\n     FunctionEnd\\n \\n     !verbose pop\\n   !endif\\n !macroend\\n \\n-!macro GetPathFromStringCall _STRING _RESULT\\n+!macro GetPathFromStringCall _IN_PATH _OUT_PATH\\n   !verbose push\\n   !verbose ${_MOZFUNC_VERBOSE}\\n-  Push \\\"${_STRING}\\\"\\n+  Push \\\"${_IN_PATH}\\\"\\n+  Push \\\"${_OUT_PATH}\\\"\\n   Call GetPathFromString\\n-  Pop ${_RESULT}\\n+  Pop ${_OUT_PATH}\\n   !verbose pop\\n !macroend\\n \\n-!macro un.GetPathFromStringCall _STRING _RESULT\\n+!macro un.GetPathFromStringCall _IN_PATH _OUT_PATH\\n   !verbose push\\n   !verbose ${_MOZFUNC_VERBOSE}\\n-  Push \\\"${_STRING}\\\"\\n+  Push \\\"${_IN_PATH}\\\"\\n+  Push \\\"${_OUT_PATH}\\\"\\n   Call un.GetPathFromString\\n-  Pop ${_RESULT}\\n+  Pop ${_OUT_PATH}\\n   !verbose pop\\n !macroend\\n \\n@@ -2033,6 +2095,86 @@ Exch $R9 ; exchange the new $R9 value with the top of the stack\\n !macroend\\n \\n /**\\n+ * Removes the quotes from each end of a string if present.\\n+ *\\n+ * @param   _IN_PATH\\n+ *          The string containing the path.\\n+ * @param   _OUT_PATH\\n+ *          The register to store the long path.\\n+ *\\n+ * $R7 = \\n+ * $R8 = _IN_PATH\\n+ * $R9 = _OUT_PATH\\n+ */\\n+!macro RemoveQuotesFromPath\\n+\\n+  !ifndef ${_MOZFUNC_UN}RemoveQuotesFromPath\\n+    !verbose push\\n+    !verbose ${_MOZFUNC_VERBOSE}\\n+    !define ${_MOZFUNC_UN}RemoveQuotesFromPath \\\"!insertmacro ${_MOZFUNC_UN}RemoveQuotesFromPathCall\\\"\\n+\\n+    Function ${_MOZFUNC_UN}RemoveQuotesFromPath\\n+      Exch $R9\\n+      Exch 1\\n+      Exch $R8\\n+      Push $R7\\n+\\n+      StrCpy $R9 \\\"$R8\\\"\\n+\\n+      StrCpy $R7 \\\"$R9\\\" 1\\n+      StrCmp $R7 \\\"$\\\\\\\"\\\" +1 +2\\n+      StrCpy $R9 \\\"$R9\\\" \\\"\\\" 1\\n+\\n+      StrCpy $R7 \\\"$R9\\\" \\\"\\\" -1\\n+      StrCmp $R7 \\\"$\\\\\\\"\\\" +1 +2\\n+      StrCpy $R9 \\\"$R9\\\" -1\\n+\\n+      Pop $R7\\n+      Exch $R8\\n+      Exch 1\\n+      Exch $R9\\n+    FunctionEnd\\n+\\n+    !verbose pop\\n+  !endif\\n+!macroend\\n+\\n+!macro RemoveQuotesFromPathCall _IN_PATH _OUT_PATH\\n+  !verbose push\\n+  !verbose ${_MOZFUNC_VERBOSE}\\n+  Push \\\"${_IN_PATH}\\\"\\n+  Push \\\"${_OUT_PATH}\\\"\\n+  Call RemoveQuotesFromPath\\n+  Pop ${_OUT_PATH}\\n+  !verbose pop\\n+!macroend\\n+\\n+!macro un.RemoveQuotesFromPathCall _IN_PATH _OUT_PATH\\n+  !verbose push\\n+  !verbose ${_MOZFUNC_VERBOSE}\\n+  Push \\\"${_IN_PATH}\\\"\\n+  Push \\\"${_OUT_PATH}\\\"\\n+  Call un.RemoveQuotesFromPath\\n+  Pop ${_OUT_PATH}\\n+  !verbose pop\\n+!macroend\\n+\\n+!macro un.RemoveQuotesFromPath\\n+  !ifndef un.RemoveQuotesFromPath\\n+    !verbose push\\n+    !verbose ${_MOZFUNC_VERBOSE}\\n+    !undef _MOZFUNC_UN\\n+    !define _MOZFUNC_UN \\\"un.\\\"\\n+\\n+    !insertmacro RemoveQuotesFromPath\\n+\\n+    !undef _MOZFUNC_UN\\n+    !define _MOZFUNC_UN\\n+    !verbose pop\\n+  !endif\\n+!macroend\\n+\\n+/**\\n  * If present removes the VirtualStore directory for this installation. Uses the\\n  * program files directory path and the current install location to determine\\n  * the sub-directory in the VirtualStore directory.\\ndiff --git a/toolkit/mozapps/installer/windows/nsis/overrides.nsh b/toolkit/mozapps/installer/windows/nsis/overrides.nsh\\nindex fd76e5b..a3bf090 100755\\n--- a/toolkit/mozapps/installer/windows/nsis/overrides.nsh\\n+++ b/toolkit/mozapps/installer/windows/nsis/overrides.nsh\\n@@ -4,36 +4,22 @@\\n !ifndef OVERRIDES_INCLUDED\\n !define OVERRIDES_INCLUDED\\n \\n+# Commented out until the Thunderbird, Seamonkey, and Calendar Tinderboxes\\n+# have been updated to MozillaBuild which includes an updated version of\\n+# NSIS\\n+# !include TextFunc.nsh\\n+# !include FileFunc.nsh\\n+\\n ; Modified version of Locate from the NSIS File Functions Header v3.2\\n ; This version has the calls to SetDetailsPrint and DetailsPrint commented out.\\n ; See <NSIS App Dir>/include/FileFunc.nsh for more information\\n-\\n-!verbose push\\n-!verbose 3\\n-!ifndef _OVERRIDEFUNC_VERBOSE\\n-  !define _OVERRIDEFUNC_VERBOSE 3\\n-!endif\\n-!verbose ${_OVERRIDEFUNC_VERBOSE}\\n-!define OVERRIDEFUNC_VERBOSE \\\"!insertmacro OVERRIDEFUNC_VERBOSE\\\"\\n-!define _OVERRIDEFUNC_UN\\n-!define _OVERRIDEFUNC_S\\n-!verbose pop\\n-\\n-!macro OVERRIDEFUNC_VERBOSE _VERBOSE\\n-  !verbose push\\n-  !verbose 3\\n-  !undef _OVERRIDEFUNC_VERBOSE\\n-  !define _OVERRIDEFUNC_VERBOSE ${_VERBOSE}\\n-  !verbose pop\\n-!macroend\\n-\\n !macro LocateNoDetails\\n-  !ifndef ${_OVERRIDEFUNC_UN}LocateNoDetails\\n+  !ifndef ${_FILEFUNC_UN}LocateNoDetails\\n     !verbose push\\n-    !verbose ${_OVERRIDEFUNC_VERBOSE}\\n-    !define ${_OVERRIDEFUNC_UN}LocateNoDetails `!insertmacro ${_OVERRIDEFUNC_UN}LocateNoDetailsCall`\\n+    !verbose ${_FILEFUNC_VERBOSE}\\n+    !define ${_FILEFUNC_UN}LocateNoDetails `!insertmacro ${_FILEFUNC_UN}LocateNoDetailsCall`\\n \\n-    Function ${_OVERRIDEFUNC_UN}LocateNoDetails\\n+    Function ${_FILEFUNC_UN}LocateNoDetails\\n       Exch $2\\n       Exch\\n       Exch $1\\n@@ -315,7 +301,7 @@\\n \\n !macro LocateNoDetailsCall _PATH _OPTIONS _FUNC\\n   !verbose push\\n-  !verbose ${_OVERRIDEFUNC_VERBOSE}\\n+  !verbose ${_FILEFUNC_VERBOSE}\\n   Push $0\\n   Push `${_PATH}`\\n   Push `${_OPTIONS}`\\n@@ -328,7 +314,7 @@\\n \\n !macro un.LocateNoDetailsCall _PATH _OPTIONS _FUNC\\n   !verbose push\\n-  !verbose ${_OVERRIDEFUNC_VERBOSE}\\n+  !verbose ${_FILEFUNC_VERBOSE}\\n   Push $0\\n   Push `${_PATH}`\\n   Push `${_OPTIONS}`\\n@@ -342,14 +328,14 @@\\n !macro un.LocateNoDetails\\n   !ifndef un.LocateNoDetails\\n     !verbose push\\n-    !verbose ${_OVERRIDEFUNC_VERBOSE}\\n-    !undef _OVERRIDEFUNC_UN\\n-    !define _OVERRIDEFUNC_UN `un.`\\n+    !verbose ${_FILEFUNC_VERBOSE}\\n+    !undef _FILEFUNC_UN\\n+    !define _FILEFUNC_UN `un.`\\n \\n     !insertmacro LocateNoDetails\\n \\n-    !undef _OVERRIDEFUNC_UN\\n-    !define _OVERRIDEFUNC_UN\\n+    !undef _FILEFUNC_UN\\n+    !define _FILEFUNC_UN\\n     !verbose pop\\n   !endif\\n !macroend\\n@@ -358,12 +344,12 @@\\n ; This version has the calls to SetDetailsPrint and DetailsPrint commented out.\\n ; See <NSIS App Dir>/include/TextFunc.nsh for more information\\n !macro TextCompareNoDetails\\n-  !ifndef ${_OVERRIDEFUNC_UN}TextCompareNoDetails${_OVERRIDEFUNC_S}\\n+  !ifndef ${_TEXTFUNC_UN}TextCompareNoDetails${_TEXTFUNC_S}\\n     !verbose push\\n-    !verbose ${_OVERRIDEFUNC_VERBOSE}\\n-    !define ${_OVERRIDEFUNC_UN}TextCompareNoDetails${_OVERRIDEFUNC_S} `!insertmacro ${_OVERRIDEFUNC_UN}TextCompareNoDetails${_OVERRIDEFUNC_S}Call`\\n+    !verbose ${_TEXTFUNC_VERBOSE}\\n+    !define ${_TEXTFUNC_UN}TextCompareNoDetails${_TEXTFUNC_S} `!insertmacro ${_TEXTFUNC_UN}TextCompareNoDetails${_TEXTFUNC_S}Call`\\n \\n-    Function ${_OVERRIDEFUNC_UN}TextCompareNoDetails${_OVERRIDEFUNC_S}\\n+    Function ${_TEXTFUNC_UN}TextCompareNoDetails${_TEXTFUNC_S}\\n       Exch $3\\n       Exch\\n       Exch $2\\n@@ -400,31 +386,31 @@\\n       StrCpy $8 0\\n \\n       nextline:\\n-      StrCmp${_OVERRIDEFUNC_S} $4 '' fast\\n+      StrCmp${_TEXTFUNC_S} $4 '' fast\\n       IntOp $8 $8 + 1\\n       FileRead $4 $9\\n       IfErrors 0 +4\\n       FileClose $4\\n       StrCpy $4 ''\\n-      StrCmp${_OVERRIDEFUNC_S} $5 '' end\\n+      StrCmp${_TEXTFUNC_S} $5 '' end\\n       StrCmp $2 'FastDiff' fast\\n       StrCmp $2 'FastEqual' fast slow\\n \\n       fast:\\n-      StrCmp${_OVERRIDEFUNC_S} $5 '' call\\n+      StrCmp${_TEXTFUNC_S} $5 '' call\\n       IntOp $6 $6 + 1\\n       FileRead $5 $7\\n       IfErrors 0 +5\\n       FileClose $5\\n       StrCpy $5 ''\\n-      StrCmp${_OVERRIDEFUNC_S} $4 '' end\\n+      StrCmp${_TEXTFUNC_S} $4 '' end\\n       StrCmp $2 'FastDiff' call close\\n       StrCmp $2 'FastDiff' 0 +2\\n-      StrCmp${_OVERRIDEFUNC_S} $7 $9 nextline call\\n-      StrCmp${_OVERRIDEFUNC_S} $7 $9 call nextline\\n+      StrCmp${_TEXTFUNC_S} $7 $9 nextline call\\n+      StrCmp${_TEXTFUNC_S} $7 $9 call nextline\\n \\n       slow:\\n-      StrCmp${_OVERRIDEFUNC_S} $4 '' close\\n+      StrCmp${_TEXTFUNC_S} $4 '' close\\n       StrCpy $6 ''\\n ;      DetailPrint '$8. $9'\\n       FileSeek $5 0\\n@@ -434,9 +420,9 @@\\n       IfErrors 0 +2\\n       StrCmp $2 'SlowDiff' call nextline\\n       StrCmp $2 'SlowDiff' 0 +2\\n-      StrCmp${_OVERRIDEFUNC_S} $7 $9 nextline slownext\\n+      StrCmp${_TEXTFUNC_S} $7 $9 nextline slownext\\n       IntOp $6 $6 + 1\\n-      StrCmp${_OVERRIDEFUNC_S} $7 $9 0 slownext\\n+      StrCmp${_TEXTFUNC_S} $7 $9 0 slownext\\n \\n       call:\\n       Push $2\\n@@ -488,21 +474,21 @@\\n !macro TextCompareNoDetailsS\\n   !ifndef TextCompareNoDetailsS\\n     !verbose push\\n-    !verbose ${_OVERRIDEFUNC_VERBOSE}\\n-    !undef _OVERRIDEFUNC_S\\n-    !define _OVERRIDEFUNC_S `S`\\n+    !verbose ${_TEXTFUNC_VERBOSE}\\n+    !undef _TEXTFUNC_S\\n+    !define _TEXTFUNC_S `S`\\n \\n     !insertmacro TextCompareNoDetails\\n \\n-    !undef _OVERRIDEFUNC_S\\n-    !define _OVERRIDEFUNC_S\\n+    !undef _TEXTFUNC_S\\n+    !define _TEXTFUNC_S\\n     !verbose pop\\n   !endif\\n !macroend\\n \\n !macro TextCompareNoDetailsCall _FILE1 _FILE2 _OPTION _FUNC\\n   !verbose push\\n-  !verbose ${_OVERRIDEFUNC_VERBOSE}\\n+  !verbose ${_TEXTFUNC_VERBOSE}\\n   Push $0\\n   Push `${_FILE1}`\\n   Push `${_FILE2}`\\n@@ -516,7 +502,7 @@\\n \\n !macro TextCompareNoDetailsSCall _FILE1 _FILE2 _OPTION _FUNC\\n   !verbose push\\n-  !verbose ${_OVERRIDEFUNC_VERBOSE}\\n+  !verbose ${_TEXTFUNC_VERBOSE}\\n   Push $0\\n   Push `${_FILE1}`\\n   Push `${_FILE2}`\\n@@ -530,7 +516,7 @@\\n \\n !macro un.TextCompareNoDetailsCall _FILE1 _FILE2 _OPTION _FUNC\\n   !verbose push\\n-  !verbose ${_OVERRIDEFUNC_VERBOSE}\\n+  !verbose ${_TEXTFUNC_VERBOSE}\\n   Push $0\\n   Push `${_FILE1}`\\n   Push `${_FILE2}`\\n@@ -544,7 +530,7 @@\\n \\n !macro un.TextCompareNoDetailsSCall _FILE1 _FILE2 _OPTION _FUNC\\n   !verbose push\\n-  !verbose ${_OVERRIDEFUNC_VERBOSE}\\n+  !verbose ${_TEXTFUNC_VERBOSE}\\n   Push $0\\n   Push `${_FILE1}`\\n   Push `${_FILE2}`\\n@@ -559,14 +545,14 @@\\n !macro un.TextCompareNoDetails\\n   !ifndef un.TextCompareNoDetails\\n     !verbose push\\n-    !verbose ${_OVERRIDEFUNC_VERBOSE}\\n-    !undef _OVERRIDEFUNC_UN\\n-    !define _OVERRIDEFUNC_UN `un.`\\n+    !verbose ${_TEXTFUNC_VERBOSE}\\n+    !undef _TEXTFUNC_UN\\n+    !define _TEXTFUNC_UN `un.`\\n \\n     !insertmacro TextCompareNoDetails\\n \\n-    !undef _OVERRIDEFUNC_UN\\n-    !define _OVERRIDEFUNC_UN\\n+    !undef _TEXTFUNC_UN\\n+    !define _TEXTFUNC_UN\\n     !verbose pop\\n   !endif\\n !macroend\\n@@ -574,18 +560,18 @@\\n !macro un.TextCompareNoDetailsS\\n   !ifndef un.TextCompareNoDetailsS\\n     !verbose push\\n-    !verbose ${_OVERRIDEFUNC_VERBOSE}\\n-    !undef _OVERRIDEFUNC_UN\\n-    !define _OVERRIDEFUNC_UN `un.`\\n-    !undef _OVERRIDEFUNC_S\\n-    !define _OVERRIDEFUNC_S `S`\\n+    !verbose ${_TEXTFUNC_VERBOSE}\\n+    !undef _TEXTFUNC_UN\\n+    !define _TEXTFUNC_UN `un.`\\n+    !undef _TEXTFUNC_S\\n+    !define _TEXTFUNC_S `S`\\n \\n     !insertmacro TextCompareNoDetails\\n \\n-    !undef _OVERRIDEFUNC_UN\\n-    !define _OVERRIDEFUNC_UN\\n-    !undef _OVERRIDEFUNC_S\\n-    !define _OVERRIDEFUNC_S\\n+    !undef _TEXTFUNC_UN\\n+    !define _TEXTFUNC_UN\\n+    !undef _TEXTFUNC_S\\n+    !define _TEXTFUNC_S\\n     !verbose pop\\n   !endif\\n !macroend\\n\""}