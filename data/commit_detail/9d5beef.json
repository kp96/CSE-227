{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas9d5beef\""},"diff":"\"9d5beef Bug 369821 all get (x,y) call which has aCoordType from atk side should consider coor type r=aaronleventhal a=mconnor\\ndiff --git a/accessible/src/atk/nsMaiInterfaceComponent.cpp b/accessible/src/atk/nsMaiInterfaceComponent.cpp\\nindex c75dd1c..1ab1c59 100644\\n--- a/accessible/src/atk/nsMaiInterfaceComponent.cpp\\n+++ b/accessible/src/atk/nsMaiInterfaceComponent.cpp\\n@@ -72,9 +72,13 @@ refAccessibleAtPointCB(AtkComponent *aComponent,\\n     if (!accWrap || nsAccessibleWrap::MustPrune(accWrap))\\n         return nsnull;\\n \\n-    // or ATK_XY_SCREEN  what is definition this in nsIAccessible ???\\n+    // nsIAccessible getChildAtPoint (x,y) is in screen pixels.\\n     if (aCoordType == ATK_XY_WINDOW) {\\n-        /* deal with the coord type */\\n+        nsCOMPtr<nsIDOMNode> domNode;\\n+        accWrap->GetDOMNode(getter_AddRefs(domNode));\\n+        nsIntPoint winCoords = nsAccUtils::GetScreenCoordsForWindow(domNode);\\n+        aAccX += winCoords.x;\\n+        aAccY += winCoords.y;\\n     }\\n \\n     nsCOMPtr<nsIAccessible> pointAcc;\\ndiff --git a/accessible/src/atk/nsMaiInterfaceImage.cpp b/accessible/src/atk/nsMaiInterfaceImage.cpp\\nindex 5e06671..75a0a9f 100644\\n--- a/accessible/src/atk/nsMaiInterfaceImage.cpp\\n+++ b/accessible/src/atk/nsMaiInterfaceImage.cpp\\n@@ -69,8 +69,18 @@ getImagePositionCB(AtkImage *aImage, gint *aAccX, gint *aAccY,\\n       return;\\n \\n     PRInt32 width, height; // dummy\\n-    image->GetImageBounds(aAccX, aAccY, &width, &height);\\n-    // TODO: translate (x,y) accroding aCoordType. see bug 369821\\n+    // Returned in screen coordinates\\n+    nsresult rv = image->GetImageBounds(aAccX, aAccY, &width, &height);\\n+    if (NS_FAILED(rv))\\n+      return;\\n+    \\n+    if (aCoordType == ATK_XY_WINDOW) {\\n+        nsCOMPtr<nsIDOMNode> domNode;\\n+        accWrap->GetDOMNode(getter_AddRefs(domNode));\\n+        nsIntPoint winCoords = nsAccUtils::GetScreenCoordsForWindow(domNode);\\n+        *aAccX -= winCoords.x;\\n+        *aAccY -= winCoords.y;\\n+    }\\n }\\n \\n const gchar *\\n\""}