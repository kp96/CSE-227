{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basfb49422\""},"diff":"\"fb49422 Bug 396412, crash setting left/top attributes on a popup that hasn't been opened, r+sr=bz,a=dbaron\\ndiff --git a/layout/xul/base/src/nsMenuPopupFrame.cpp b/layout/xul/base/src/nsMenuPopupFrame.cpp\\nindex 04537301..9f239b9 100644\\n--- a/layout/xul/base/src/nsMenuPopupFrame.cpp\\n+++ b/layout/xul/base/src/nsMenuPopupFrame.cpp\\n@@ -1622,9 +1622,12 @@ nsMenuPopupFrame::MoveToInternal(PRInt32 aLeft, PRInt32 aTop)\\n   aLeft = context->AppUnitsToDevPixels(nsPresContext::CSSPixelsToAppUnits(aLeft));\\n   aTop = context->AppUnitsToDevPixels(nsPresContext::CSSPixelsToAppUnits(aTop));\\n \\n-  // Move the widget\\n+  // Move the widget. The widget will be null if it hasn't been created yet,\\n+  // but that's OK as the popup won't be open in this case.\\n   // XXXbz don't we want screenPos to be the parent _widget_'s position, then?\\n-  view->GetWidget()->Move(aLeft - screenPos.x, aTop - screenPos.y);\\n+  nsIWidget* widget = view->GetWidget();\\n+  if (widget) \\n+    widget->Move(aLeft - screenPos.x, aTop - screenPos.y);\\n }\\n \\n void \\ndiff --git a/layout/xul/base/src/nsXULPopupManager.cpp b/layout/xul/base/src/nsXULPopupManager.cpp\\nindex a0ca114..d9a1ac2 100644\\n--- a/layout/xul/base/src/nsXULPopupManager.cpp\\n+++ b/layout/xul/base/src/nsXULPopupManager.cpp\\n@@ -194,6 +194,7 @@ nsXULPopupManager::GetSubmenuWidgetChain(nsISupportsArray **_retval)\\n   while (item) {\\n     nsCOMPtr<nsIWidget> widget;\\n     item->Frame()->GetWidget(getter_AddRefs(widget));\\n+    NS_ASSERTION(widget, \\\"open popup has no widget\\\");\\n     nsCOMPtr<nsISupports> genericWidget(do_QueryInterface(widget));\\n     (*_retval)->AppendElement(genericWidget);\\n     // In the case when a menulist inside a panel is open, clicking in the\\n\""}