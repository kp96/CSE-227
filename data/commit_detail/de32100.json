{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basde32100\""},"diff":"\"de32100 Bug 393525 - XPCOMUtilify nsBlocklistService. r=robert.bugzilla\\ndiff --git a/toolkit/mozapps/extensions/src/nsBlocklistService.js b/toolkit/mozapps/extensions/src/nsBlocklistService.js\\nindex 0cab263..b74aa0a 100644\\n--- a/toolkit/mozapps/extensions/src/nsBlocklistService.js\\n+++ b/toolkit/mozapps/extensions/src/nsBlocklistService.js\\n@@ -43,6 +43,8 @@ const Cc = Components.classes;\\n const Ci = Components.interfaces;\\n const Cr = Components.results;\\n \\n+Components.utils.import(\\\"resource://gre/modules/XPCOMUtils.jsm\\\");\\n+\\n const kELEMENT_NODE                   = Ci.nsIDOMNode.ELEMENT_NODE;\\n const TOOLKIT_ID                      = \\\"toolkit@mozilla.org\\\"\\n const KEY_PROFILEDIR                  = \\\"ProfD\\\";\\n@@ -63,10 +65,6 @@ const MODE_TRUNCATE = 0x20;\\n const PERMS_FILE      = 0644;\\n const PERMS_DIRECTORY = 0755;\\n \\n-const CID = Components.ID(\\\"{66354bc9-7ed1-4692-ae1d-8da97d6b205e}\\\");\\n-const CONTRACT_ID = \\\"@mozilla.org/extensions/blocklist;1\\\"\\n-const CLASS_NAME = \\\"Blocklist Service\\\";\\n-\\n var gApp = null;\\n var gPref = null;\\n var gOS = null;\\n@@ -558,14 +556,16 @@ Blocklist.prototype = {\\n     phs.getPluginTags({ }).forEach(this._checkPlugin, this);\\n   },\\n \\n-  QueryInterface: function(aIID) {\\n-    if (!aIID.equals(Ci.nsIObserver) &&\\n-        !aIID.equals(Ci.nsIBlocklistService) &&\\n-        !aIID.equals(Ci.nsITimerCallback) &&\\n-        !aIID.equals(Ci.nsISupports))\\n-      throw Cr.NS_ERROR_NO_INTERFACE;\\n-    return this;\\n-  }\\n+  classDescription: \\\"Blocklist Service\\\",\\n+  contractID: \\\"@mozilla.org/extensions/blocklist;1\\\",\\n+  classID: Components.ID(\\\"{66354bc9-7ed1-4692-ae1d-8da97d6b205e}\\\"),\\n+  QueryInterface: XPCOMUtils.generateQI([Ci.nsIObserver,\\n+                                         Ci.nsIBlocklistService,\\n+                                         Ci.nsITimerCallback]),\\n+  _xpcom_categories: [{\\n+    category: \\\"app-startup\\\",\\n+    service: true\\n+  }]\\n };\\n \\n /**\\n@@ -650,47 +650,6 @@ BlocklistItemData.prototype = {\\n   }\\n };\\n \\n-const BlocklistFactory = {\\n-  createInstance: function(aOuter, aIID) {\\n-    if (aOuter != null)\\n-      throw Cr.NS_ERROR_NO_AGGREGATION;\\n-\\n-    return (new Blocklist()).QueryInterface(aIID);\\n-  }\\n-};\\n-\\n-const gModule = {\\n-  registerSelf: function(aCompMgr, aFileSpec, aLocation, aType) {\\n-    aCompMgr.QueryInterface(Ci.nsIComponentRegistrar);\\n-    aCompMgr.registerFactoryLocation(CID, CLASS_NAME, CONTRACT_ID,\\n-                                     aFileSpec, aLocation, aType);\\n-\\n-    var catMan = Cc[\\\"@mozilla.org/categorymanager;1\\\"].\\n-                 getService(Ci.nsICategoryManager);\\n-    catMan.addCategoryEntry(\\\"app-startup\\\", CLASS_NAME, \\\"service,\\\" + CONTRACT_ID, true, true);\\n-  },\\n-\\n-  unregisterSelf: function(aCompMgr, aLocation, aType) {\\n-    aCompMgr.QueryInterface(Ci.nsIComponentRegistrar);\\n-    aCompMgr.unregisterFactoryLocation(CID, aLocation);\\n-\\n-    var catMan = Cc[\\\"@mozilla.org/categorymanager;1\\\"].\\n-                 getService(Ci.nsICategoryManager);\\n-    catMan.deleteCategoryEntry(\\\"app-startup\\\", \\\"service,\\\" + CONTRACT_ID, true);\\n-  },\\n-\\n-  getClassObject: function(aCompMgr, aCID, aIID) {\\n-    if (aCID.equals(CID))\\n-      return BlocklistFactory;\\n-\\n-    throw Cr.NS_ERROR_NOT_REGISTERED;\\n-  },\\n-\\n-  canUnload: function(aCompMgr) {\\n-    return true;\\n-  }\\n-};\\n-\\n function NSGetModule(aCompMgr, aFileSpec) {\\n-  return gModule;\\n+  return XPCOMUtils.generateModule([Blocklist]);\\n }\\n\""}