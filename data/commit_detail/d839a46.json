{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basd839a46\""},"diff":"\"d839a46 Avoid problem with bogus events. b=397039 r=joshmoz sr=roc a=roc\\ndiff --git a/widget/src/cocoa/nsAppShell.mm b/widget/src/cocoa/nsAppShell.mm\\nindex 478a6ab..b39da53 100644\\n--- a/widget/src/cocoa/nsAppShell.mm\\n+++ b/widget/src/cocoa/nsAppShell.mm\\n@@ -245,11 +245,19 @@ nsAppShell::ProcessGeckoEvents(void* aInfo)\\n     // won't return until it's given a reason to wake up.  Awaken it by\\n     // posting a bogus event.  There's no need to make the event\\n     // presentable.\\n+    //\\n+    // But _don't_ set windowNumber to '-1' -- that can lead to nasty\\n+    // wierdness like bmo bug 397039 (a crash in [NSApp sendEvent:] on one of\\n+    // these fake events, because the -1 has gotten changed into the number\\n+    // of an actual NSWindow object, and that NSWindow object has just been\\n+    // destroyed).  Setting windowNumber to '0' seems to work fine -- this\\n+    // seems to prevent the OS from ever trying to associate our bogus event\\n+    // with a particular NSWindow object.\\n     [NSApp postEvent:[NSEvent otherEventWithType:NSApplicationDefined\\n                                         location:NSMakePoint(0,0)\\n                                    modifierFlags:0\\n                                        timestamp:0\\n-                                    windowNumber:-1\\n+                                    windowNumber:0\\n                                          context:NULL\\n                                          subtype:0\\n                                            data1:0\\n@@ -269,7 +277,7 @@ nsAppShell::ProcessGeckoEvents(void* aInfo)\\n                                       location:NSMakePoint(0,0)\\n                                  modifierFlags:0\\n                                      timestamp:0\\n-                                  windowNumber:-1\\n+                                  windowNumber:0\\n                                        context:NULL\\n                                        subtype:0\\n                                          data1:0\\n\""}