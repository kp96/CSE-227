{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas6ce65bf\""},"diff":"\"6ce65bf Fix for bug 261074: OnFocus fires twice when window restored r=neil sr=roc a=auto-approved\\ndiff --git a/content/events/src/nsEventStateManager.cpp b/content/events/src/nsEventStateManager.cpp\\nindex 5d04ceb..ad77e36 100644\\n--- a/content/events/src/nsEventStateManager.cpp\\n+++ b/content/events/src/nsEventStateManager.cpp\\n@@ -840,6 +840,7 @@ nsEventStateManager::PreHandleEvent(nsPresContext* aPresContext,\\n         break;\\n \\n       if (mDocument) {\\n+        PRBool isAlreadySuppressed = PR_FALSE;\\n         if (gLastFocusedDocument && gLastFocusedPresContext) {\\n           nsCOMPtr<nsPIDOMWindow> ourWindow =\\n             gLastFocusedDocument->GetWindow();\\n@@ -853,7 +854,6 @@ nsEventStateManager::PreHandleEvent(nsPresContext* aPresContext,\\n           // Hold a strong ref to the focus controller, since we need\\n           // it after event dispatch.\\n           nsCOMPtr<nsIFocusController> focusController;\\n-          PRBool isAlreadySuppressed = PR_FALSE;\\n \\n           if (ourWindow) {\\n             focusController = ourWindow->GetRootFocusController();\\n@@ -922,7 +922,7 @@ nsEventStateManager::PreHandleEvent(nsPresContext* aPresContext,\\n \\n         nsCOMPtr<nsPIDOMWindow> window(mDocument->GetWindow());\\n \\n-        if (window) {\\n+        if (window && !isAlreadySuppressed) {\\n           // We don't want there to be a focused content node while we're\\n           // dispatching the focus event.\\n \\n\""}