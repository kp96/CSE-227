{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas706e58d\""},"diff":"\"706e58d Work around crash bug in NSMenu performKeyEquivalent: triggered by new appshell (bug 395397). b=396860 r=joshmoz sr=roc a=roc\\ndiff --git a/widget/src/cocoa/nsChildView.mm b/widget/src/cocoa/nsChildView.mm\\nindex f1ca3d9..023bd3f 100644\\n--- a/widget/src/cocoa/nsChildView.mm\\n+++ b/widget/src/cocoa/nsChildView.mm\\n@@ -3969,8 +3969,16 @@ static PRBool IsSpecialGeckoKey(UInt32 macKeyCode)\\n   if (!mGeckoChild || nsTSMManager::IsComposing())\\n     return NO;\\n \\n+  // Retain and release our native window to avoid crashes when it's closed\\n+  // as a result of processing a key equivalent (e.g. Command+w or Command+q).\\n+  NSWindow *ourNativeWindow = [self nativeWindow];\\n+  if (ourNativeWindow)\\n+    ourNativeWindow = [ourNativeWindow retain];\\n   // see if the menu system will handle the event\\n-  if ([[NSApp mainMenu] performKeyEquivalent:theEvent])\\n+  BOOL menuRetval = [[NSApp mainMenu] performKeyEquivalent:theEvent];\\n+  if (ourNativeWindow)\\n+    [ourNativeWindow release];\\n+  if (menuRetval)\\n     return YES;\\n \\n   // don't handle this if certain modifiers are down - those should\\n\""}