{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basbbcdc1d\""},"diff":"\"bbcdc1d Bug 281012: Closing the last tab loads an untitled page (about:blank) instead; doesn't clear session history, patch by Simon BÃ¼nzli <zeniko@gmail.com>, r=mconnor\\ndiff --git a/browser/base/content/tabbrowser.xml b/browser/base/content/tabbrowser.xml\\nindex 36fb44bb..8e4c924 100644\\n--- a/browser/base/content/tabbrowser.xml\\n+++ b/browser/base/content/tabbrowser.xml\\n@@ -1280,12 +1280,7 @@\\n               aTab = this.mCurrentTab;\\n \\n             var l = this.mTabContainer.childNodes.length;\\n-            if (l == 1) {\\n-              if (!this.mPrefs.getBoolPref(\\\"browser.tabs.autoHide\\\")) {\\n-                // blank the tab\\n-                this.loadURI(\\\"about:blank\\\");\\n-                return;\\n-              }\\n+            if (l == 1 && this.mPrefs.getBoolPref(\\\"browser.tabs.autoHide\\\")) {\\n               // hide the tab bar\\n               this.mPrefs.setBoolPref(\\\"browser.tabs.forceHide\\\", true);\\n               this.setStripVisibilityTo(false);\\n@@ -1293,11 +1288,16 @@\\n             }\\n \\n             var ds = this.getBrowserForTab(aTab).docShell;\\n-\\n             if (ds.contentViewer && !ds.contentViewer.permitUnload())\\n               return;\\n \\n-            if (l == 2) {\\n+            if (l == 1) {\\n+              // add a new blank tab to replace the one being closed\\n+              // (this ensures that the remaining tab is as good as new)\\n+              this.addTab(\\\"about:blank\\\");\\n+              l++;\\n+            }\\n+            else if (l == 2) {\\n               var autohide = this.mPrefs.getBoolPref(\\\"browser.tabs.autoHide\\\");\\n               var tabStripHide = !window.toolbar.visible;\\n               if (autohide || tabStripHide)\\n\""}