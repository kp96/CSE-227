{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas48b32c7\""},"diff":"\"48b32c7 [OS/2] Creation of a minimal 1x1 surface is good enough, and we always own the PS in the gfxOS2Surface(HWND) constructor. Part of work in bug 371505.\\ndiff --git a/gfx/thebes/src/gfxOS2Surface.cpp b/gfx/thebes/src/gfxOS2Surface.cpp\\nindex a5d8b55..64c72f6 100644\\n--- a/gfx/thebes/src/gfxOS2Surface.cpp\\n+++ b/gfx/thebes/src/gfxOS2Surface.cpp\\n@@ -62,26 +62,21 @@ gfxOS2Surface::gfxOS2Surface(HPS aPS, const gfxIntSize& aSize)\\n }\\n \\n gfxOS2Surface::gfxOS2Surface(HWND aWnd)\\n+    : mOwnsPS(PR_TRUE)\\n {\\n #ifdef DEBUG_thebes_2\\n     printf(\\\"gfxOS2Surface[%#x]::gfxOS2Surface(HWND=%#x)\\\\n\\\",\\n            (unsigned int)this, (unsigned int)aWnd);\\n #endif\\n \\n-    if (!mPS) {\\n-        // it must have been passed to us from somwhere else\\n-        mOwnsPS = PR_TRUE;\\n-        mPS = WinGetPS(aWnd);\\n-    } else {\\n-        mOwnsPS = PR_FALSE;\\n-    }\\n+    mPS = WinGetPS(aWnd);\\n \\n     RECTL rectl;\\n     WinQueryWindowRect(aWnd, &rectl);\\n     mSize.width = rectl.xRight - rectl.xLeft;\\n     mSize.height = rectl.yTop - rectl.yBottom;\\n-    if (mSize.width == 0) mSize.width = 10;   // XXX fake some surface area to make\\n-    if (mSize.height == 0) mSize.height = 10; // cairo_os2_surface_create() return something sensible\\n+    if (mSize.width == 0) mSize.width = 1;   // fake a minimal surface area to let\\n+    if (mSize.height == 0) mSize.height = 1; // cairo_os2_surface_create() return something\\n     cairo_surface_t *surf = cairo_os2_surface_create(mPS, mSize.width, mSize.height);\\n #ifdef DEBUG_thebes_2\\n     printf(\\\"  type(%#x)=%d (own=%d, ID=%#x, h/w=%d/%d)\\\\n\\\", (unsigned int)surf,\\n\""}