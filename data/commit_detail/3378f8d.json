{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas3378f8d\""},"diff":"\"3378f8d Bug 306243: When browser.tabs.autohide is enabled, toolbar customisation settings are ignored after restarting Firefox; extensions' icons are missing from the palette, patch by moz_bug_r_a4@yahoo.com, r=vlad\\ndiff --git a/browser/base/content/tabbrowser.xml b/browser/base/content/tabbrowser.xml\\nindex 73ac7b5..b8d3756 100644\\n--- a/browser/base/content/tabbrowser.xml\\n+++ b/browser/base/content/tabbrowser.xml\\n@@ -185,6 +185,9 @@\\n         false\\n #endif\\n       </field> \\n+      <field name=\\\"mAddProgressListenerWasCalled\\\">\\n+        false\\n+      </field>\\n \\n       <method name=\\\"getBrowserAtIndex\\\">\\n         <parameter name=\\\"aIndex\\\"/>\\n@@ -1331,6 +1334,18 @@\\n         <parameter name=\\\"aMask\\\"/>\\n         <body>\\n           <![CDATA[\\n+            if (!this.mAddProgressListenerWasCalled) {\\n+              this.mAddProgressListenerWasCalled = true;\\n+              var autoHide = this.mPrefs.getBoolPref(\\\"browser.tabs.autoHide\\\");\\n+              var forceHide = this.mPrefs.getBoolPref(\\\"browser.tabs.forceHide\\\");\\n+              var tabStripHide = !window.toolbar.visible;\\n+              if (!autoHide && !forceHide && !tabStripHide)\\n+                this.setStripVisibilityTo(true);\\n+\\n+              // Hook up a listener for <link>s.\\n+              this.mPanelContainer.addEventListener(\\\"DOMLinkAdded\\\", this.onLinkAdded, false);\\n+            }\\n+\\n             if (!this.mTabbedMode && this.mProgressListeners.length == 1) {\\n               // If we are adding a 2nd progress listener, we need to enter tabbed mode\\n               // because the browser status filter can only handle one progress listener.\\n@@ -2014,15 +2029,6 @@\\n           this.mTabContainer.childNodes[0].linkedPanel = uniqueId;\\n           this.mTabContainer.childNodes[0]._tPos = 0;\\n           this.mTabContainer.childNodes[0].linkedBrowser = this.mPanelContainer.childNodes[0].firstChild.nextSibling;\\n-\\n-          var autoHide = this.mPrefs.getBoolPref(\\\"browser.tabs.autoHide\\\");\\n-          var forceHide = this.mPrefs.getBoolPref(\\\"browser.tabs.forceHide\\\");\\n-          var tabStripHide = !window.toolbar.visible;\\n-          if (!autoHide && !forceHide && !tabStripHide)\\n-            this.setStripVisibilityTo(true);\\n-\\n-          // Hook up a listener for <link>s.\\n-          this.mPanelContainer.addEventListener(\\\"DOMLinkAdded\\\", this.onLinkAdded, false);\\n         ]]>\\n       </constructor>\\n \\n\""}