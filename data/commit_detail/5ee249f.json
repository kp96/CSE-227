{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas5ee249f\""},"diff":"\"5ee249f Bug 384112 - \\\"-moz-appearance: menulist-button broken in GTK\\\" [p=ventnor.bugzilla@yahoo.com.au (Michael Ventnor) r+sr+a1.9=roc]\\ndiff --git a/widget/src/gtk2/gtk2drawing.c b/widget/src/gtk2/gtk2drawing.c\\nindex a471898..c02aef6 100644\\n--- a/widget/src/gtk2/gtk2drawing.c\\n+++ b/widget/src/gtk2/gtk2drawing.c\\n@@ -201,7 +201,7 @@ ensure_option_menu_widget()\\n {\\n     if (!gOptionMenuWidget) {\\n         gOptionMenuWidget = gtk_option_menu_new();\\n-        setup_widget_prototype(gOptionMenuWidget);        \\n+        setup_widget_prototype(gOptionMenuWidget);\\n     }\\n     return MOZ_GTK_SUCCESS;\\n }\\n@@ -210,7 +210,7 @@ static gint\\n ensure_arrow_widget()\\n {\\n     if (!gArrowWidget) {\\n-        gDropdownButtonWidget = gtk_button_new();\\n+        gDropdownButtonWidget = gtk_combo_box_entry_new();\\n         setup_widget_prototype(gDropdownButtonWidget);\\n         gArrowWidget = gtk_arrow_new(GTK_ARROW_DOWN, GTK_SHADOW_OUT);\\n         gtk_container_add(GTK_CONTAINER(gDropdownButtonWidget), gArrowWidget);\\n@@ -1091,13 +1091,13 @@ moz_gtk_dropdown_arrow_paint(GdkDrawable* drawable, GdkRectangle* rect,\\n     GtkStyle* style;\\n \\n     ensure_arrow_widget();\\n-    moz_gtk_button_paint(drawable, rect, cliprect, state, GTK_RELIEF_NORMAL,\\n-                         gDropdownButtonWidget);\\n+    style = gDropdownButtonWidget->style;\\n+    gtk_paint_box(style, drawable, state_type, shadow_type, cliprect, gDropdownButtonWidget,\\n+                  \\\"combo_entry_button\\\", rect->x, rect->y, rect->width, rect->height);\\n \\n     /* This mirrors gtkbutton's child positioning */\\n-    style = gDropdownButtonWidget->style;\\n-    arrow_rect.x = rect->x + 1 + XTHICKNESS(gDropdownButtonWidget->style);\\n-    arrow_rect.y = rect->y + 1 + YTHICKNESS(gDropdownButtonWidget->style);\\n+    arrow_rect.x = rect->x + 1 + XTHICKNESS(style);\\n+    arrow_rect.y = rect->y + 1 + YTHICKNESS(style);\\n     arrow_rect.width = MAX(1, rect->width - (arrow_rect.x - rect->x) * 2);\\n     arrow_rect.height = MAX(1, rect->height - (arrow_rect.y - rect->y) * 2);\\n \\n@@ -1112,7 +1112,7 @@ moz_gtk_dropdown_arrow_paint(GdkDrawable* drawable, GdkRectangle* rect,\\n     real_arrow_rect.y = floor (arrow_rect.y + ((arrow_rect.height - real_arrow_rect.height) / 2) + 0.5);\\n \\n     gtk_paint_arrow(style, drawable, state_type, shadow_type, cliprect,\\n-                    gHorizScrollbarWidget, \\\"arrow\\\",  GTK_ARROW_DOWN, TRUE,\\n+                    gDropdownButtonWidget, \\\"arrow\\\",  GTK_ARROW_DOWN, TRUE,\\n                     real_arrow_rect.x, real_arrow_rect.y,\\n                     real_arrow_rect.width, real_arrow_rect.height);\\n \\ndiff --git a/widget/src/gtk2/nsNativeThemeGTK.cpp b/widget/src/gtk2/nsNativeThemeGTK.cpp\\nindex 79c82e2..f0452d4 100644\\n--- a/widget/src/gtk2/nsNativeThemeGTK.cpp\\n+++ b/widget/src/gtk2/nsNativeThemeGTK.cpp\\n@@ -174,10 +174,6 @@ nsNativeThemeGTK::GetGtkWidgetAndState(PRUint8 aWidgetType, nsIFrame* aFrame,\\n       memset(aState, 0, sizeof(GtkWidgetState));\\n     } else {\\n \\n-      // for dropdown textfields, look at the parent frame (textbox or menulist)\\n-      if (aWidgetType == NS_THEME_DROPDOWN_TEXTFIELD)\\n-        aFrame = aFrame->GetParent();\\n-\\n       // For XUL checkboxes and radio buttons, the state of the parent\\n       // determines our state.\\n       nsIFrame *stateFrame = aFrame;\\n@@ -975,7 +971,7 @@ nsNativeThemeGTK::ThemeSupportsWidget(nsPresContext* aPresContext,\\n   case NS_THEME_TEXTFIELD:\\n   case NS_THEME_TEXTFIELD_MULTILINE:\\n     // case NS_THEME_TEXTFIELD_CARET:\\n-    // case NS_THEME_DROPDOWN_BUTTON:\\n+  case NS_THEME_DROPDOWN_BUTTON:\\n   case NS_THEME_DROPDOWN_TEXTFIELD:\\n   case NS_THEME_SCALE_HORIZONTAL:\\n   case NS_THEME_SCALE_THUMB_HORIZONTAL:\\n\""}