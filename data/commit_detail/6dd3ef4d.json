{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas6dd3ef4d\""},"diff":"\"6dd3ef4d Don't save sidebar elements in tab focus memory (bug 254056).  r=neil, sr=ben.\\ndiff --git a/browser/base/content/tabbrowser.xml b/browser/base/content/tabbrowser.xml\\nindex 4015e85..ac6e42e 100644\\n--- a/browser/base/content/tabbrowser.xml\\n+++ b/browser/base/content/tabbrowser.xml\\n@@ -539,8 +539,38 @@\\n               return;\\n \\n             if (this.mCurrentBrowser) {\\n-              this.mCurrentBrowser.focusedWindow = document.commandDispatcher.focusedWindow;\\n-              this.mCurrentBrowser.focusedElement = document.commandDispatcher.focusedElement;\\n+              // Only save the focused element if it is in our content window\\n+              // or in an ancestor window.\\n+              var focusedWindow = document.commandDispatcher.focusedWindow;\\n+              var saveFocus = false;\\n+\\n+              if (focusedWindow.top == window.content) {\\n+                saveFocus = true;\\n+              } else {\\n+                var contentWindow = window;\\n+\\n+                while (contentWindow) {\\n+                  if (contentWindow == focusedWindow) {\\n+                    saveFocus = true;\\n+                    break;\\n+                  }\\n+\\n+                  if (contentWindow.parent == contentWindow) {\\n+                    break;\\n+                  }\\n+\\n+                  contentWindow = contentWindow.parent;\\n+                }\\n+              }\\n+\\n+              if (saveFocus) {\\n+                // Preserve the currently-focused element or DOM window for\\n+                // this tab.\\n+\\n+                this.mCurrentBrowser.focusedWindow = focusedWindow;\\n+                this.mCurrentBrowser.focusedElement = document.commandDispatcher.focusedElement;\\n+              }\\n+\\n               if (this.mCurrentBrowser.focusedElement) {\\n                 // Clear focus outline before we draw on top of it\\n                 this.mCurrentBrowser.focusedElement.blur();\\n\""}