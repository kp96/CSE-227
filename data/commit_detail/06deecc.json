{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas06deecc\""},"diff":"\"06deecc Bug 393206: fix JSON tests, patch by Simon Bünzli <zeniko@gmail.com>, r=me\\ndiff --git a/js/src/xpconnect/tests/unit/test_json.js b/js/src/xpconnect/tests/unit/test_json.js\\nindex f06e105..9b94a32 100644\\n--- a/js/src/xpconnect/tests/unit/test_json.js\\n+++ b/js/src/xpconnect/tests/unit/test_json.js\\n@@ -45,24 +45,20 @@ function run_test() {\\n   \\n   // ensures that an object can't be converted to a JSON string\\n   function isInvalidType(a) {\\n-    // FIXME: bug 393206\\n-    return true;\\n     try {\\n       JSON.toString(a);\\n       return false;\\n     } catch (ex) {\\n-      return ex instanceof TypeError;\\n+      return ex.name == \\\"TypeError\\\";\\n     }\\n   }\\n   // ensures that a string can't be converted back to a JavaScript object\\n   function isInvalidSyntax(a) {\\n-    // FIXME: bug 393206\\n-    return true;\\n     try {\\n       JSON.fromString(a);\\n       return false;\\n     } catch (ex) {\\n-      return ex instanceof SyntaxError;\\n+      return ex.name == \\\"SyntaxError\\\";\\n     }\\n   }\\n   \\n@@ -80,9 +76,9 @@ function run_test() {\\n   do_check_true(isInvalidType(Infinity));\\n   do_check_true(isInvalidType(NaN));\\n   \\n-  // FIXME: bug 393206\\n-  //do_check_eq(toJSONString(\\\"Foo-Bar \\\\b\\\\t\\\\n\\\\f\\\\r\\\\\\\"\\\\\\\\ \\\\x01€\\\"),\\n-  //            '\\\"Foo-Bar \\\\\\\\b\\\\\\\\t\\\\\\\\n\\\\\\\\f\\\\\\\\r\\\\\\\\\\\"\\\\\\\\\\\\\\\\ \\\\\\\\u0001\\\\\\\\u20ac\\\"');\\n+  //XXXzeniko: using € instead of \\\\u20ac fails because of encoding issues\\n+  do_check_eq(toJSONString(\\\"Foo-Bar \\\\b\\\\t\\\\n\\\\f\\\\r\\\\\\\"\\\\\\\\ \\\\x01\\\\u20ac\\\"),\\n+              '\\\"Foo-Bar \\\\\\\\b\\\\\\\\t\\\\\\\\n\\\\\\\\f\\\\\\\\r\\\\\\\\\\\"\\\\\\\\\\\\\\\\ \\\\\\\\u0001\\\\\\\\u20ac\\\"');\\n   \\n   do_check_eq(toJSONString(null), \\\"null\\\");\\n   do_check_true(isInvalidType(undefined));\\n@@ -107,9 +103,8 @@ function run_test() {\\n   do_check_eq(JSON.fromString(\\\"1.23e-45\\\"), 1.23e-45);\\n   do_check_true(isInvalidSyntax(\\\"NaN\\\"));\\n   \\n-  // FIXME: bug 393206\\n-  //do_check_eq(JSON.fromString('\\\"Foo-Bar \\\\\\\\b\\\\\\\\t\\\\\\\\n\\\\\\\\f\\\\\\\\r\\\\\\\\\\\"\\\\\\\\\\\\\\\\ \\\\\\\\u0001\\\\\\\\u20ac\\\"'),\\n-  //                            \\\"Foo-Bar \\\\b\\\\t\\\\n\\\\f\\\\r\\\\\\\"\\\\\\\\ \\\\x01€\\\");\\n+  do_check_eq(JSON.fromString('\\\"Foo-Bar \\\\\\\\b\\\\\\\\t\\\\\\\\n\\\\\\\\f\\\\\\\\r\\\\\\\\\\\"\\\\\\\\\\\\\\\\ \\\\\\\\u0001\\\\\\\\u20ac\\\"'),\\n+                              \\\"Foo-Bar \\\\b\\\\t\\\\n\\\\f\\\\r\\\\\\\"\\\\\\\\ \\\\x01\\\\u20ac\\\");\\n   do_check_true(isInvalidSyntax('\\\"multi\\\\nline\\\"'));\\n   do_check_eq(JSON.fromString(\\\"null\\\"), null);\\n   do_check_true(isInvalidSyntax(\\\".\\\"));\\n\""}