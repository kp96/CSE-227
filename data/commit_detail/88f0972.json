{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas88f0972\""},"diff":"\"88f0972 Bug 323805, tab switching not working when for non-html and non-xul elements are focused, r=neil,sr=bz\\ndiff --git a/browser/base/content/tabbrowser.xml b/browser/base/content/tabbrowser.xml\\nindex 4117f1f..77b4912 100644\\n--- a/browser/base/content/tabbrowser.xml\\n+++ b/browser/base/content/tabbrowser.xml\\n@@ -695,7 +695,15 @@\\n                 // Clear focus outline before we draw on top of it.\\n                 // Only blur the focused element if it isn't a tab, \\n                 // to avoid breaking keyboard tab navigation\\n-                this.mCurrentBrowser.focusedElement.blur();\\n+                var elem = this.mCurrentBrowser.focusedElement;\\n+                if (elem instanceof HTMLElement || elem instanceof XULElement) {\\n+                  elem.blur();\\n+                }\\n+                else {\\n+                  var content = elem.ownerDocument.defaultView;\\n+                  if (content instanceof Components.interfaces.nsIInterfaceRequestor)\\n+                    content.getInterface(Components.interfaces.nsIDOMWindowUtils).focus(null);\\n+                }\\n               }\\n               this.mCurrentBrowser.setAttribute(\\\"type\\\", \\\"content-targetable\\\");\\n             }\\n@@ -801,7 +809,16 @@\\n                         .getService(Components.interfaces.nsIWindowWatcher);\\n             if (ww.activeWindow == window) {\\n               cmdDispatcher.suppressFocusScroll = true;\\n-              whatToFocus.focus();\\n+              if (whatToFocus instanceof HTMLElement ||\\n+                  whatToFocus instanceof XULElement ||\\n+                  whatToFocus instanceof Window) {\\n+                whatToFocus.focus();\\n+              }\\n+              else if (whatToFocus instanceof Node) {\\n+                var content = window.content;\\n+                if (content instanceof Components.interfaces.nsIInterfaceRequestor)\\n+                  content.getInterface(Components.interfaces.nsIDOMWindowUtils).focus(whatToFocus);\\n+              }\\n               cmdDispatcher.suppressFocusScroll = false;\\n             }\\n             else {\\n\""}