{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basf6e992a\""},"diff":"\"f6e992a Bug 395122 - Toolbar customization sheet is broken. r+a=mconnor.\\ndiff --git a/browser/base/content/browser.js b/browser/base/content/browser.js\\nindex 32927ae..3fbe20b 100644\\n--- a/browser/base/content/browser.js\\n+++ b/browser/base/content/browser.js\\n@@ -3024,23 +3024,13 @@ function BrowserCustomizeToolbar()\\n   cmd.setAttribute(\\\"disabled\\\", \\\"true\\\");\\n \\n #ifdef TOOLBAR_CUSTOMIZATION_SHEET\\n-  document.getElementById(\\\"customizeToolbarSheetBox\\\").hidden = false;\\n-\\n-  /**\\n-   * XXXmano hack: when a new tab is added while the sheet is visible,\\n-   * the new tabpanel is overlaying the sheet. We workaround this issue by\\n-   * hiding and reopening the sheet when a new tab is added.\\n-   */\\n-  function TabOpenSheetHandler(aEvent) {\\n-    getBrowser().removeEventListener(\\\"TabOpen\\\", TabOpenSheetHandler, false);\\n-\\n-    document.getElementById(\\\"customizeToolbarSheetIFrame\\\")\\n-            .contentWindow.gCustomizeToolbarSheet.done();\\n-    document.getElementById(\\\"customizeToolbarSheetBox\\\").hidden = true;\\n-    BrowserCustomizeToolbar();\\n-    \\n-  }\\n-  getBrowser().addEventListener(\\\"TabOpen\\\", TabOpenSheetHandler, false);\\n+  var sheetFrame = document.getElementById(\\\"customizeToolbarSheetIFrame\\\");\\n+  sheetFrame.hidden = false;\\n+  // XXXmano: there's apparently no better way to get this when the iframe is\\n+  // hidden\\n+  var sheetWidth = sheetFrame.style.width.match(/([0-9]+)px/)[1];\\n+  document.getElementById(\\\"customizeToolbarSheetPopup\\\")\\n+          .openPopup(getNavToolbox(), \\\"after_start\\\", (window.innerWidth - sheetWidth) / 2, 0);\\n #else\\n   window.openDialog(\\\"chrome://global/content/customizeToolbar.xul\\\",\\n                     \\\"CustomizeToolbar\\\",\\n@@ -3052,7 +3042,8 @@ function BrowserCustomizeToolbar()\\n function BrowserToolboxCustomizeDone(aToolboxChanged)\\n {\\n #ifdef TOOLBAR_CUSTOMIZATION_SHEET\\n-  document.getElementById(\\\"customizeToolbarSheetBox\\\").hidden = true;\\n+  document.getElementById(\\\"customizeToolbarSheetIFrame\\\").hidden = true;\\n+  document.getElementById(\\\"customizeToolbarSheetPopup\\\").hidePopup();\\n #endif\\n \\n   // Update global UI elements that may have been added or removed\\ndiff --git a/browser/base/content/browser.xul b/browser/base/content/browser.xul\\nindex 066844c..7977cf5 100644\\n--- a/browser/base/content/browser.xul\\n+++ b/browser/base/content/browser.xul\\n@@ -448,42 +448,36 @@\\n              customizable=\\\"true\\\"/>\\n   </toolbox>\\n   \\n-  <stack id=\\\"browser-stack\\\" flex=\\\"1\\\">\\n-    <hbox flex=\\\"1\\\" id=\\\"browser\\\">\\n-      <vbox id=\\\"sidebar-box\\\" hidden=\\\"true\\\" class=\\\"chromeclass-extrachrome\\\">\\n-        <sidebarheader align=\\\"center\\\">\\n-          <label id=\\\"sidebar-title\\\" persist=\\\"value\\\" flex=\\\"1\\\" crop=\\\"end\\\" control=\\\"sidebar\\\"/>\\n-          <image id=\\\"sidebar-throbber\\\"/>\\n-          <toolbarbutton class=\\\"tabs-closebutton\\\" tooltiptext=\\\"&sidebarCloseButton.tooltip;\\\" oncommand=\\\"toggleSidebar();\\\"/>\\n-        </sidebarheader>        \\n-        <browser id=\\\"sidebar\\\" flex=\\\"1\\\" autoscroll=\\\"false\\\"\\n-                 style=\\\"min-width: 14em; width: 18em; max-width: 36em;\\\"/>\\n-      </vbox>    \\n+  <hbox flex=\\\"1\\\" id=\\\"browser\\\">\\n+    <vbox id=\\\"sidebar-box\\\" hidden=\\\"true\\\" class=\\\"chromeclass-extrachrome\\\">\\n+      <sidebarheader align=\\\"center\\\">\\n+        <label id=\\\"sidebar-title\\\" persist=\\\"value\\\" flex=\\\"1\\\" crop=\\\"end\\\" control=\\\"sidebar\\\"/>\\n+        <image id=\\\"sidebar-throbber\\\"/>\\n+        <toolbarbutton class=\\\"tabs-closebutton\\\" tooltiptext=\\\"&sidebarCloseButton.tooltip;\\\" oncommand=\\\"toggleSidebar();\\\"/>\\n+      </sidebarheader>        \\n+      <browser id=\\\"sidebar\\\" flex=\\\"1\\\" autoscroll=\\\"false\\\"\\n+                style=\\\"min-width: 14em; width: 18em; max-width: 36em;\\\"/>\\n+    </vbox>    \\n     \\n-      <splitter id=\\\"sidebar-splitter\\\" class=\\\"chromeclass-extrachrome\\\" hidden=\\\"true\\\"/>\\n-      <vbox id=\\\"appcontent\\\" flex=\\\"1\\\">\\n-        <tabbrowser id=\\\"content\\\" disablehistory=\\\"true\\\"\\n-                    flex=\\\"1\\\" contenttooltip=\\\"aHTMLTooltip\\\"\\n-                    contentcontextmenu=\\\"contentAreaContextMenu\\\"\\n-                    onnewtab=\\\"BrowserOpenTab();\\\"\\n-                    autocompletepopup=\\\"PopupAutoComplete\\\"\\n-                    ondragdrop=\\\"nsDragAndDrop.drop(event, contentAreaDNDObserver);\\\"\\n-                    onclick=\\\"return contentAreaClick(event, false);\\\"/>\\n-      </vbox>\\n-    </hbox>\\n+    <splitter id=\\\"sidebar-splitter\\\" class=\\\"chromeclass-extrachrome\\\" hidden=\\\"true\\\"/>\\n+    <vbox id=\\\"appcontent\\\" flex=\\\"1\\\">\\n+      <tabbrowser id=\\\"content\\\" disablehistory=\\\"true\\\"\\n+                  flex=\\\"1\\\" contenttooltip=\\\"aHTMLTooltip\\\"\\n+                  contentcontextmenu=\\\"contentAreaContextMenu\\\"\\n+                  onnewtab=\\\"BrowserOpenTab();\\\"\\n+                  autocompletepopup=\\\"PopupAutoComplete\\\"\\n+                  ondragdrop=\\\"nsDragAndDrop.drop(event, contentAreaDNDObserver);\\\"\\n+                  onclick=\\\"return contentAreaClick(event, false);\\\"/>\\n+    </vbox>\\n+  </hbox>\\n #ifdef TOOLBAR_CUSTOMIZATION_SHEET\\n-    <hbox flex=\\\"1\\\" hidden=\\\"true\\\" id=\\\"customizeToolbarSheetBox\\\">\\n-      <hbox flex=\\\"1\\\"/>\\n-      <vbox flex=\\\"1\\\">\\n-        <iframe id=\\\"customizeToolbarSheetIFrame\\\"\\n-                style=\\\"&dialog.style;\\\"\\n-                src=\\\"chrome://global/content/customizeToolbar.xul\\\"/>\\n-        <vbox flex=\\\"1\\\"/>\\n-      </vbox>\\n-      <hbox flex=\\\"1\\\"/>\\n-    </hbox>\\n+  <panel id=\\\"customizeToolbarSheetPopup\\\" noautohide=\\\"true\\\">\\n+    <iframe id=\\\"customizeToolbarSheetIFrame\\\"\\n+            style=\\\"&dialog.style;\\\"\\n+            src=\\\"chrome://global/content/customizeToolbar.xul\\\"\\n+            hidden=\\\"true\\\"/>\\n+  </panel>\\n #endif\\n-  </stack>\\n \\n   <findbar browserid=\\\"content\\\" id=\\\"FindToolbar\\\"/>\\n   \\n\""}