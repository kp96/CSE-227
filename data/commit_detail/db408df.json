{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basdb408df\""},"diff":"\"db408df Add \\\"create account\\\" functionality to settings, bug 391425. p=ben_h, r=zach\\ndiff --git a/testing/extensions/community/chrome/content/accountcreate.js b/testing/extensions/community/chrome/content/accountcreate.js\\nnew file mode 100644\\nindex 0000000..126036e\\n--- /dev/null\\n+++ b/testing/extensions/community/chrome/content/accountcreate.js\\n@@ -0,0 +1,108 @@\\n+<!-- -*- Mode: HTML -*- \\r\\n+# ***** BEGIN LICENSE BLOCK *****\\r\\n+# Version: MPL 1.1/GPL 2.0/LGPL 2.1\\r\\n+#\\r\\n+# The contents of this file are subject to the Mozilla Public License Version\\r\\n+# 1.1 (the \\\"License\\\"); you may not use this file except in compliance with\\r\\n+# the License. You may obtain a copy of the License at\\r\\n+# http://www.mozilla.org/MPL/\\r\\n+#\\r\\n+# Software distributed under the License is distributed on an \\\"AS IS\\\" basis,\\r\\n+# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License\\r\\n+# for the specific language governing rights and limitations under the\\r\\n+# License.\\r\\n+#\\r\\n+# The Original Code is the Mozilla Community QA Extension\\r\\n+#\\r\\n+# The Initial Developer of the Original Code is Zach Lipton.\\r\\n+# Portions created by the Initial Developer are Copyright (C) 2006\\r\\n+# the Initial Developer. All Rights Reserved.\\r\\n+#\\r\\n+# Contributor(s):\\r\\n+#   Ben Hsieh <ben.hsieh@gmail.com>\\r\\n+#\\r\\n+# Alternatively, the contents of this file may be used under the terms of\\r\\n+# either the GNU General Public License Version 2 or later (the \\\"GPL\\\"), or\\r\\n+# the GNU Lesser General Public License Version 2.1 or later (the \\\"LGPL\\\"),\\r\\n+# in which case the provisions of the GPL or the LGPL are applicable instead\\r\\n+# of those above. If you wish to allow use of your version of this file only\\r\\n+# under the terms of either the GPL or the LGPL, and not to allow others to\\r\\n+# use your version of this file under the terms of the MPL, indicate your\\r\\n+# decision by deleting the provisions above and replace them with the notice\\r\\n+# and other provisions required by the LGPL or the GPL. If you do not delete\\r\\n+# the provisions above, a recipient may use your version of this file under\\r\\n+# the terms of any one of the MPL, the GPL or the LGPL.\\r\\n+#\\r\\n+# ***** END LICENSE BLOCK ***** -->\\r\\n+\\r\\n+var accountCreate = {\\r\\n+    oldPassword: null,    //TODO: is this secure?\\r\\n+    oldUsername: null,\\r\\n+    updateFunction : null,\\r\\n+\\tloadSetup : function() {\\r\\n+\\t\\tdocument.getElementById('qa-setup-createaccount-iframe').src = \\r\\n+\\t\\tlitmus.baseURL+'extension.cgi?createAccount=1';\\r\\n+        accountCreate.updateFunction = window.arguments[0];\\r\\n+        \\r\\n+        accountCreate.oldPassword = qaPref.litmus.getPassword();\\r\\n+        accountCreate.oldUsername = qaPref.litmus.getUsername();\\r\\n+\\t},\\r\\n+    validateAccount : function() {\\r\\n+\\t\\t\\t// we're creating a new account, so get the uname and passwd \\r\\n+\\t\\t\\t// from the account created page:\\r\\n+\\t\\t\\tvar page = document.getElementById('qa-setup-createaccount-iframe').\\r\\n+\\t\\t\\t\\t\\t\\tcontentDocument;\\r\\n+\\t\\t\\tif (!page) {\\r\\n+\\t\\t\\t\\talert(\\\"create account page is missing\\\");\\r\\n+\\t\\t\\t\\treturn false;\\r\\n+\\t\\t\\t}\\r\\n+\\t\\t\\tif (page.wrappedJSObject == null)\\r\\n+\\t\\t\\t\\tpage.wrappedJSObject = page;\\r\\n+\\t\\t\\tif (page.forms[0] && page.forms[0].wrappedJSObject == null)\\r\\n+\\t\\t\\t\\tpage.forms[0].wrappedJSObject = page.forms[0];\\r\\n+\\t\\t\\t\\r\\n+\\t\\t\\tif (page.location == litmus.baseURL+'extension.cgi?createAccount=1'\\r\\n+\\t\\t\\t    && qaSetup.didSubmitForm==0) {\\r\\n+\\t\\t\\t\\tpage.forms[0].wrappedJSObject.submit();\\r\\n+\\t\\t\\t\\tqaSetup.didSubmitForm = 1;\\r\\n+\\t\\t\\t\\tsetTimeout(\\\"qaSetup.validateAccount()\\\", 5000);\\r\\n+\\t\\t\\t\\treturn false;\\r\\n+\\t\\t\\t}\\r\\n+\\t\\t\\tif (qaSetup.didSubmitForm == 1 && ! page.forms || \\r\\n+\\t\\t\\t   ! page.forms[0].wrappedJSObject || \\r\\n+\\t\\t\\t   ! page.forms[0].wrappedJSObject.email && \\r\\n+\\t\\t\\t   ! page.forms[0].wrappedJSObject.email.value)  \\r\\n+\\t\\t\\t   \\t\\t{qaSetup.didSubmitForm = 2;\\r\\n+\\t\\t\\t   \\t\\tsetTimeout(\\\"qaSetup.validateAccount()\\\", 4000);\\r\\n+\\t\\t\\t   \\t\\treturn false;}\\r\\n+\\t\\t\\tvar e = '';\\r\\n+\\t\\t\\tvar p = '';\\r\\n+\\t\\t\\tif (page.forms && page.forms[0].wrappedJSObject && \\r\\n+\\t\\t\\t    page.forms[0].wrappedJSObject.email && \\r\\n+\\t\\t\\t\\tpage.forms[0].wrappedJSObject.email.value) \\r\\n+\\t\\t\\t\\t{ e=page.forms[0].wrappedJSObject.email.value }\\r\\n+\\t\\t\\tif (page.forms && page.forms[0].wrappedJSObject && \\r\\n+\\t\\t\\t    page.forms[0].wrappedJSObject.password && \\r\\n+\\t\\t\\t\\tpage.forms[0].wrappedJSObject.password.value) \\r\\n+\\t\\t\\t\\t{ p=page.forms[0].wrappedJSObject.password.value }\\r\\n+        // e is account, p is password\\r\\n+\\t\\t\\r\\n+\\t\\tvar uname = e;\\r\\n+\\t\\tvar passwd = p;\\r\\n+\\t\\t\\r\\n+\\r\\n+        if (e == '' || p == '') {\\r\\n+            alert(\\\"No username or password has been registered.\\\");\\r\\n+            return false;    //we need better error handling.\\r\\n+        }\\r\\n+        qaPref.litmus.setPassword(uname, passwd);\\r\\n+        accountCreate.updateFunction();\\r\\n+                \\r\\n+        // TODO: ideally we would validate against litmus, but...\\r\\n+\\t\\treturn true;\\r\\n+\\t},\\r\\n+    \\r\\n+    handleCancel : function() {\\r\\n+        qaPref.litmus.setPassword(oldUsername, oldPassword);\\r\\n+    }\\r\\n+}\\r\\ndiff --git a/testing/extensions/community/chrome/content/accountcreate.xul b/testing/extensions/community/chrome/content/accountcreate.xul\\nnew file mode 100644\\nindex 0000000..abfe41c\\n--- /dev/null\\n+++ b/testing/extensions/community/chrome/content/accountcreate.xul\\n@@ -0,0 +1,69 @@\\n+<?xml version=\\\"1.0\\\"?><!-- -*- Mode: HTML -*- \\r\\n+# ***** BEGIN LICENSE BLOCK *****\\r\\n+# Version: MPL 1.1/GPL 2.0/LGPL 2.1\\r\\n+#\\r\\n+# The contents of this file are subject to the Mozilla Public License Version\\r\\n+# 1.1 (the \\\"License\\\"); you may not use this file except in compliance with\\r\\n+# the License. You may obtain a copy of the License at\\r\\n+# http://www.mozilla.org/MPL/\\r\\n+#\\r\\n+# Software distributed under the License is distributed on an \\\"AS IS\\\" basis,\\r\\n+# WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License\\r\\n+# for the specific language governing rights and limitations under the\\r\\n+# License.\\r\\n+#\\r\\n+# The Original Code is the Mozilla Community QA Extension\\r\\n+#\\r\\n+# The Initial Developer of the Original Code is Zach Lipton.\\r\\n+# Portions created by the Initial Developer are Copyright (C) 2006\\r\\n+# the Initial Developer. All Rights Reserved.\\r\\n+#\\r\\n+# Contributor(s):\\r\\n+#   Ben Hsieh <ben.hsieh@gmail.com>\\r\\n+#\\r\\n+# Alternatively, the contents of this file may be used under the terms of\\r\\n+# either the GNU General Public License Version 2 or later (the \\\"GPL\\\"), or\\r\\n+# the GNU Lesser General Public License Version 2.1 or later (the \\\"LGPL\\\"),\\r\\n+# in which case the provisions of the GPL or the LGPL are applicable instead\\r\\n+# of those above. If you wish to allow use of your version of this file only\\r\\n+# under the terms of either the GPL or the LGPL, and not to allow others to\\r\\n+# use your version of this file under the terms of the MPL, indicate your\\r\\n+# decision by deleting the provisions above and replace them with the notice\\r\\n+# and other provisions required by the LGPL or the GPL. If you do not delete\\r\\n+# the provisions above, a recipient may use your version of this file under\\r\\n+# the terms of any one of the MPL, the GPL or the LGPL.\\r\\n+#\\r\\n+# ***** END LICENSE BLOCK ***** -->\\r\\n+<!DOCTYPE wizard PUBLIC \\\"-//MOZILLA//DTD XUL V1.0//EN\\\" \\\"http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul\\\">\\r\\n+\\r\\n+<?xml-stylesheet href=\\\"chrome://global/skin/\\\" type=\\\"text/css\\\"?>\\r\\n+<?xml-stylesheet href=\\\"chrome://qa/skin/\\\" type=\\\"text/css\\\"?>\\r\\n+\\r\\n+<dialog id=\\\"account-setup\\\"\\r\\n+        title=\\\"Account Creation\\\"\\r\\n+        class=\\\"color-dialog\\\"\\r\\n+        xmlns=\\\"http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul\\\"\\r\\n+        xmlns:html=\\\"http://www.w3.org/1999/xhtml\\\"\\r\\n+        xmlns:rdf=\\\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\\\"\\r\\n+        width=\\\"800px\\\"\\r\\n+        height=\\\"400px\\\"\\r\\n+        onload=\\\"accountCreate.loadSetup();\\\"\\r\\n+        ondialogaccept=\\\"return accountCreate.validateAccount();\\\"\\r\\n+        ondialogcancel=\\\"\\\"\\r\\n+        >\\r\\n+<script type=\\\"application/x-javascript\\\" src=\\\"chrome://qa/content/MochiKit/MochiKit.js\\\" />\\r\\n+<script type=\\\"application/x-javascript\\\" src=\\\"chrome://qa/content/prefs.js\\\" />\\r\\n+<script type=\\\"application/x-javascript\\\" src=\\\"chrome://qa/content/common.js\\\" />\\r\\n+<script type=\\\"application/x-javascript\\\" src=\\\"chrome://qa/content/litmus.js\\\" />\\r\\n+<script type=\\\"application/x-javascript\\\" src=\\\"chrome://qa/content/settings.js\\\" />\\r\\n+<script type=\\\"application/x-javascript\\\" src=\\\"chrome://qa/content/accountcreate.js\\\" />\\r\\n+\\r\\n+<stringbundleset id=\\\"stringbundleset\\\">\\r\\n+  <stringbundle id=\\\"bundle_qa\\\" src=\\\"chrome://qa/locale/qa.properties\\\" />\\r\\n+</stringbundleset>\\r\\n+\\r\\n+    <vbox id=\\\"qa-setup-accountno\\\" style=\\\"display: none\\\" width=\\\"0px\\\" height=\\\"0px\\\" />\\r\\n+    <html:iframe id=\\\"qa-setup-createaccount-iframe\\\"\\r\\n+        height=\\\"280\\\"/>\\r\\n+    \\r\\n+</dialog>\\r\\ndiff --git a/testing/extensions/community/chrome/content/litmus.js b/testing/extensions/community/chrome/content/litmus.js\\nindex 2227f2c..56bc19b 100755\\n--- a/testing/extensions/community/chrome/content/litmus.js\\n+++ b/testing/extensions/community/chrome/content/litmus.js\\n@@ -149,9 +149,6 @@\\n \\t    });\\n \\t    qaTools.httpPostRequest(litmus.baseURL+'json.cgi', qs, callback);\\n \\t},\\n-\\tcreateAccount : function() {\\n-\\t    alert(\\\"XXX: not implemented\\\");\\n-\\t},\\n \\tpostResultXML : function(xml, callback, errback) {\\n \\t\\tvar qs = queryString({ data: xml});\\n \\t\\tvar fake_callback = function(resp) {\\ndiff --git a/testing/extensions/community/chrome/content/settings.js b/testing/extensions/community/chrome/content/settings.js\\nindex ee546a8..7699e02 100755\\n--- a/testing/extensions/community/chrome/content/settings.js\\n+++ b/testing/extensions/community/chrome/content/settings.js\\n@@ -43,7 +43,7 @@ var qaPrefsWindow = {\\n \\t\\t\\n \\t\\t// user is switching to the prefs tab:\\n \\t\\tif ($('qa_tabrow').selectedItem == $('qa-tabbar-prefs')) {\\n-\\t\\t\\tqaPrefsWindow.loadPrefsWindow();\\n+            qaPrefsWindow.loadPrefsWindow();\\n \\t\\t}\\n \\t\\t\\n \\t\\t// user is switching away from the prefs tab:\\n@@ -116,8 +116,15 @@ var qaPrefsWindow = {\\n \\t\\tlitmus.validateLogin(uname, passwd, callback);\\n \\t\\treturn false; // not ready to close yet\\n \\t},\\n+\\tloadUsernameAndPassword : function() {\\n+\\t\\tvar uname = document.getElementById('qa-preferences-litmus-username');\\n+\\t\\tvar passwd = document.getElementById('qa-preferences-litmus-password');\\n+\\t\\t\\n+\\t\\tuname.value = qaPref.litmus.getUsername();\\n+\\t\\tpasswd.value = qaPref.litmus.getPassword();\\n+\\t},\\n \\tcreateAccount : function() {\\n-\\t\\tlitmus.createAccount();\\n+\\t\\twindow.openDialog(\\\"chrome://qa/content/accountcreate.xul\\\", \\\"_blank\\\", \\\"chrome,all,dialog=yes\\\", qaPrefsWindow.loadUsernameAndPassword);\\n \\t},\\n };\\n \\n@@ -143,6 +150,7 @@ var qaSetup = {\\n \\t\\tdocument.getElementById('qa-setup-createaccount-iframe').src = \\n \\t\\t\\tlitmus.baseURL+'extension.cgi?createAccount=1';\\n \\t},\\n+\\t\\n \\taccountSetting : function(yesno) {\\n \\t\\tvar accountyes = document.getElementById('qa-setup-accountyes');\\n \\t\\tvar accountno = document.getElementById('qa-setup-accountno');\\n@@ -262,7 +270,6 @@ document.getElementById(\\\"bundle_qa\\\").getString(\\\"qa.extension.prefs.loadingMsg\\\");\\n \\t\\t\\t\\t\\t\\t$('qa-setup-platform').selectedItem.label, 'char');\\n \\t\\t}\\n \\t\\tif (! sysconfig.opsys == $('qa-setup-opsys').selectedItem.label) {\\n-\\t\\t\\talert(\\\"setting pref\\\");\\n \\t\\t\\tqaPref.setPref(qaPref.prefBase+'.sysconfig.opsys', \\n \\t\\t\\t\\t\\t\\t$('qa-setup-opsys').selectedItem.label, 'char');\\n \\t\\t}\\n\""}