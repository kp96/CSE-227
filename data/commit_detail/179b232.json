{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas179b232\""},"diff":"\"179b232 Bug 357081: tab bar doesn't resume scrolling when moving off button and back on while holding mouse button. p=Dao Gottwald <dao@design-noir.de> r=enndeakin\\ndiff --git a/browser/base/content/tabbrowser.xml b/browser/base/content/tabbrowser.xml\\nindex 04d7aec..e88df93 100644\\n--- a/browser/base/content/tabbrowser.xml\\n+++ b/browser/base/content/tabbrowser.xml\\n@@ -2501,8 +2501,9 @@\\n                          xbl:inherits=\\\"orient\\\"\\n                          anonid=\\\"scrollbutton-up\\\"\\n                          onmousedown=\\\"_startScroll(-1);\\\"\\n+                         onmouseover=\\\"_continueScroll(-1);\\\"\\n                          onmouseup=\\\"_stopScroll();\\\"\\n-                         onmouseout=\\\"_stopScroll();\\\"\\n+                         onmouseout=\\\"_pauseScroll();\\\"\\n                          chromedir=\\\"&locale.dir;\\\"/>\\n       <xul:scrollbox xbl:inherits=\\\"orient,align,pack,dir\\\" flex=\\\"1\\\" anonid=\\\"scrollbox\\\">\\n         <children/>\\n@@ -2516,8 +2517,9 @@\\n                            xbl:inherits=\\\"orient\\\"\\n                            anonid=\\\"scrollbutton-down\\\"\\n                            onmousedown=\\\"_startScroll(1);\\\"\\n+                           onmouseover=\\\"_continueScroll(1);\\\"\\n                            onmouseup=\\\"_stopScroll();\\\"\\n-                           onmouseout=\\\"_stopScroll();\\\"\\n+                           onmouseout=\\\"_pauseScroll();\\\"\\n                            chromedir=\\\"&locale.dir;\\\"/>\\n       </xul:stack>\\n     </content>\\ndiff --git a/toolkit/content/widgets/scrollbox.xml b/toolkit/content/widgets/scrollbox.xml\\nindex d18a16e..adc497fd 100644\\n--- a/toolkit/content/widgets/scrollbox.xml\\n+++ b/toolkit/content/widgets/scrollbox.xml\\n@@ -414,8 +414,9 @@\\n                          xbl:inherits=\\\"orient\\\"\\n                          anonid=\\\"scrollbutton-up\\\"\\n                          onmousedown=\\\"_startScroll(-1);\\\"\\n+                         onmouseover=\\\"_continueScroll(-1);\\\"\\n                          onmouseup=\\\"_stopScroll();\\\"\\n-                         onmouseout=\\\"_stopScroll();\\\"\\n+                         onmouseout=\\\"_pauseScroll();\\\"\\n                          chromedir=\\\"&locale.dir;\\\"/>\\n       <xul:scrollbox xbl:inherits=\\\"orient,align,pack,dir\\\" flex=\\\"1\\\" anonid=\\\"scrollbox\\\">\\n         <children/>\\n@@ -424,11 +425,12 @@\\n                          xbl:inherits=\\\"orient\\\"\\n                          anonid=\\\"scrollbutton-down\\\"\\n                          onmousedown=\\\"_startScroll(1);\\\"\\n+                         onmouseover=\\\"_continueScroll(1);\\\"\\n                          onmouseup=\\\"_stopScroll();\\\"\\n-                         onmouseout=\\\"_stopScroll();\\\"\\n+                         onmouseout=\\\"_pauseScroll();\\\"\\n                          chromedir=\\\"&locale.dir;\\\"/>\\n     </content>\\n-    <implementation implements=\\\"nsITimerCallback\\\">\\n+    <implementation implements=\\\"nsITimerCallback, nsIDOMEventListener\\\">\\n       <constructor><![CDATA[\\n         try {\\n           this._scrollDelay = this._prefBranch\\n@@ -446,7 +448,6 @@\\n         }\\n       ]]></destructor>\\n \\n-      <field name=\\\"_scrollTimer\\\">null</field>\\n       <field name=\\\"_scrollIndex\\\">0</field>\\n       <field name=\\\"_scrollDelay\\\">150</field>\\n \\n@@ -481,6 +482,7 @@\\n                           Components.interfaces.nsITimer.TYPE_REPEATING_SLACK);\\n           }\\n           this.scrollByIndex(index);\\n+          this._mousedown = true;\\n         ]]>\\n         </body>\\n       </method>\\n@@ -490,6 +492,38 @@\\n           if (this._scrollTimer) \\n             this._scrollTimer.cancel();\\n           this._autorepeatSmoothScroll = false;\\n+          this._mousedown = false;\\n+        ]]></body>\\n+      </method>\\n+\\n+      <method name=\\\"_pauseScroll\\\">\\n+        <body><![CDATA[\\n+          if (this._mousedown) {\\n+            this._stopScroll();\\n+            this._mousedown = true;\\n+            document.addEventListener(\\\"mouseup\\\", this, false);\\n+            document.addEventListener(\\\"blur\\\", this, true);\\n+          }\\n+        ]]></body>\\n+      </method>\\n+\\n+      <method name=\\\"_continueScroll\\\">\\n+        <parameter name=\\\"index\\\"/>\\n+        <body><![CDATA[\\n+          if (this._mousedown)\\n+            this._startScroll(index);\\n+        ]]></body>\\n+      </method>\\n+\\n+      <method name=\\\"handleEvent\\\">\\n+        <parameter name=\\\"aEvent\\\"/>\\n+        <body><![CDATA[\\n+          if (aEvent.type == \\\"mouseup\\\" ||\\n+              aEvent.type == \\\"blur\\\" && aEvent.target == document) {\\n+            this._mousedown = false;\\n+            document.removeEventListener(\\\"mouseup\\\", this, false);\\n+            document.removeEventListener(\\\"blur\\\", this, true);\\n+          }\\n         ]]></body>\\n       </method>\\n \\n\""}