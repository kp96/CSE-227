{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basfa47741\""},"diff":"\"fa47741 fix for bug #343019, tab scrolling does not handle window resize well fix for bug #342890, make tab min width 125 px by default (down from 140 px)   and heed the hidden browser.tabs.tabMinWidth pref. fix for bug #342385, get the hidden browser.tabs.tabClipWidth pref working.   It was actually working, but I've changed the default to 115 px to match   the 125 px default value for the browser.tabs.tabMinWidth pref. also, some code cleanup and whitespace fixes. r=mano, ui-r=beltzner\\ndiff --git a/browser/base/content/tabbrowser.xml b/browser/base/content/tabbrowser.xml\\nindex a4876e2..56aee8e 100644\\n--- a/browser/base/content/tabbrowser.xml\\n+++ b/browser/base/content/tabbrowser.xml\\n@@ -106,7 +106,7 @@\\n             <xul:tab selected=\\\"true\\\" validate=\\\"never\\\"\\n                      onerror=\\\"this.parentNode.parentNode.parentNode.parentNode.addToMissedIconCache(this.getAttribute('image'));\\n                               this.removeAttribute('image');\\\"\\n-                     maxwidth=\\\"250\\\" width=\\\"0\\\" minwidth=\\\"140\\\" flex=\\\"100\\\"\\n+                     maxwidth=\\\"250\\\" width=\\\"0\\\" minwidth=\\\"125\\\" flex=\\\"100\\\"\\n                      class=\\\"tabbrowser-tab\\\" label=\\\"&untitledTab;\\\" crop=\\\"end\\\"/>\\n           </xul:tabs>\\n         </xul:hbox>\\n@@ -1099,7 +1099,7 @@\\n \\n             t.setAttribute(\\\"crop\\\", \\\"end\\\");\\n             t.maxWidth = 250;\\n-            t.minWidth = 140;\\n+            t.minWidth = this.mTabContainer.mTabMinWidth;\\n             t.width = 0;\\n             t.setAttribute(\\\"flex\\\", \\\"100\\\");\\n             t.setAttribute(\\\"validate\\\", \\\"never\\\");\\n@@ -2393,27 +2393,33 @@\\n     </content>\\n     <implementation>\\n       <constructor>\\n-        var pb2 =\\n-            Components.classes['@mozilla.org/preferences-service;1'].\\n-            getService(Components.interfaces.nsIPrefBranch2);\\n-        try {\\n-          this.mTabClipWidth = pb2.getIntPref(\\\"browser.tabs.tabClipWidth\\\");\\n-          this.mCloseButtons = pb2.getIntPref(\\\"browser.tabs.closeButtons\\\");\\n-        }\\n-        catch (e) {\\n-        }\\n+        <![CDATA[\\n+          var pb2 =\\n+              Components.classes['@mozilla.org/preferences-service;1'].\\n+              getService(Components.interfaces.nsIPrefBranch2);\\n+          try {\\n+            this.mTabMinWidth = pb2.getIntPref(\\\"browser.tabs.tabMinWidth\\\");\\n+            this.mTabClipWidth = pb2.getIntPref(\\\"browser.tabs.tabClipWidth\\\");\\n+            this.mCloseButtons = pb2.getIntPref(\\\"browser.tabs.closeButtons\\\");\\n+          }\\n+          catch (e) {\\n+          }\\n \\n-        this._updateDisableBackgroundClose();\\n-        this.adjustTabstrip(false);\\n+          this.firstChild.minWidth = this.mTabMinWidth;\\n+          this._updateDisableBackgroundClose();\\n+          this.adjustTabstrip(false);\\n \\n-        pb2.addObserver(\\\"browser.tabs.disableBackgroundClose\\\", this._prefObserver, true);\\n-        pb2.addObserver(\\\"browser.tabs.closeButtons\\\", this._prefObserver, true);\\n+          pb2.addObserver(\\\"browser.tabs.disableBackgroundClose\\\", this._prefObserver, true);\\n+          pb2.addObserver(\\\"browser.tabs.closeButtons\\\", this._prefObserver, true);\\n \\n-        var self = this;\\n-        function onResize() {\\n-          self.adjustTabstrip(false);\\n-        }\\n-        window.addEventListener(\\\"resize\\\", onResize, false);\\n+          var self = this;\\n+          function onResize() {\\n+            self.adjustTabstrip(false);\\n+            self.mTabstrip.scrollBoxObject\\n+                          .ensureElementIsVisible(self.selectedItem);\\n+          }\\n+          window.addEventListener(\\\"resize\\\", onResize, false);\\n+        ]]>\\n       </constructor>\\n \\n       <field name=\\\"mTabstrip\\\">\\n@@ -2472,7 +2478,8 @@\\n         }\\n         });\\n       </field>\\n-      <field name=\\\"mTabClipWidth\\\">130</field>\\n+      <field name=\\\"mTabMinWidth\\\">125</field>\\n+      <field name=\\\"mTabClipWidth\\\">115</field>\\n       <field name=\\\"mCloseButtons\\\">1</field>\\n \\n       <method name=\\\"adjustTabstrip\\\">\\n@@ -2500,17 +2507,17 @@\\n                   this.childNodes.length == 1)\\n                 this.setAttribute(\\\"closebuttons\\\", \\\"noclose\\\");\\n               else {\\n-            var width = this.firstChild.boxObject.width;\\n-            // 0 width is an invalid value and indicates an item without display,\\n-            // so ignore.\\n-            if (width > this.mTabClipWidth || width == 0)\\n+                var width = this.firstChild.boxObject.width;\\n+                // 0 width is an invalid value and indicates \\n+                // an item without display, so ignore.\\n+                if (width > this.mTabClipWidth || width == 0)\\n                   this.setAttribute(\\\"closebuttons\\\", \\\"alltabs\\\");\\n-            else\\n+                else\\n                   this.setAttribute(\\\"closebuttons\\\", \\\"activetab\\\");\\n               }\\n-          }\\n-          catch (e) {\\n-          }\\n+            }\\n+            catch (e) {\\n+            }\\n             break;\\n           case 2:\\n           case 3:\\n@@ -2551,18 +2558,12 @@\\n         ]]></body>\\n       </method>\\n         \\n-      <method name=\\\"_handleUnderflow\\\">\\n-        <body><![CDATA[\\n-          this.mTabstrip.scrollBoxObject.scrollBy(-2400, 0);\\n-        ]]></body>\\n-      </method>\\n     </implementation>\\n \\n     <handlers>\\n       <handler event=\\\"TabOpen\\\"   action=\\\"this.adjustTabstrip(false);\\\"/>\\n       <handler event=\\\"TabClose\\\"  action=\\\"this.adjustTabstrip(true);\\\"/>\\n       <handler event=\\\"TabSelect\\\" action=\\\"this._handleTabSelect()\\\"/>\\n-      <handler event=\\\"underflow\\\" action=\\\"this._handleUnderflow()\\\"/>\\n     </handlers>\\n   </binding>\\n \\n\""}