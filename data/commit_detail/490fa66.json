{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas490fa66\""},"diff":"\"490fa66 Bug 394741  Searching in history sidebar doesn't work / returns nothing. (r=sspitzer)\\ndiff --git a/toolkit/components/places/src/nsNavHistory.cpp b/toolkit/components/places/src/nsNavHistory.cpp\\nindex 1d8c074..93c9da1 100644\\n--- a/toolkit/components/places/src/nsNavHistory.cpp\\n+++ b/toolkit/components/places/src/nsNavHistory.cpp\\n@@ -4128,9 +4128,10 @@ nsNavHistory::FilterResultSet(nsNavHistoryQueryResultNode* aParentNode,\\n   */\\n \\n   for (PRInt32 nodeIndex = 0; nodeIndex < aSet.Count(); nodeIndex ++) {\\n-    if (aParentNode) {\\n-      if (aParentNode->mItemId == aSet[nodeIndex]->mItemId)\\n-        continue; // filter out nodes that are the same as the parent\\n+    if (aParentNode && aParentNode->mItemId != -1) {\\n+      if (aParentNode->mItemId == aSet[nodeIndex]->mItemId) {\\n+        continue; // filter out bookmark nodes that are the same as the parent\\n+      }\\n     }\\n \\n     if (excludeQueries && IsQueryURI(aSet[nodeIndex]->mURI))\\ndiff --git a/toolkit/components/places/tests/unit/test_history.js b/toolkit/components/places/tests/unit/test_history.js\\nindex 82e51a5..856cef0 100644\\n--- a/toolkit/components/places/tests/unit/test_history.js\\n+++ b/toolkit/components/places/tests/unit/test_history.js\\n@@ -188,4 +188,15 @@ function run_test() {\\n   } catch(ex) {\\n     do_throw(\\\"bookmarks table does not have id field, schema is too old!\\\");\\n   }\\n+\\n+  // bug 394741 - regressed history text searches\\n+  add_visit(uri(\\\"http://mozilla.com\\\"));\\n+  var options = histsvc.getNewQueryOptions();\\n+  //options.resultType = options.RESULTS_AS_VISIT;\\n+  var query = histsvc.getNewQuery();\\n+  query.searchTerms = \\\"moz\\\";\\n+  var result = histsvc.executeQuery(query, options);\\n+  var root = result.root;\\n+  root.containerOpen = true;\\n+  do_check_true(root.childCount > 0);\\n }\\n\""}