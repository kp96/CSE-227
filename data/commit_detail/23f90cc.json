{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas23f90cc\""},"diff":"\"23f90cc Bug 393006: Use a constant tab scrolling speed when holding down the scroll arrows. p=Michael Ventnor <ventnor.bugzilla@yahoo.com.au> r=enndeakin\\ndiff --git a/toolkit/content/widgets/scrollbox.xml b/toolkit/content/widgets/scrollbox.xml\\nindex adc497fd..805626d 100644\\n--- a/toolkit/content/widgets/scrollbox.xml\\n+++ b/toolkit/content/widgets/scrollbox.xml\\n@@ -120,7 +120,6 @@\\n         document.defaultView.getComputedStyle(this._scrollbox, \\\"\\\").direction == \\\"ltr\\\";\\n       </field>\\n \\n-      <field name=\\\"_autorepeatSmoothScroll\\\">false</field>\\n       <method name=\\\"ensureElementIsVisible\\\">\\n         <parameter name=\\\"element\\\"/>\\n         <body><![CDATA[\\n@@ -166,14 +165,8 @@\\n \\n           function processFrame(self) {\\n             self.scrollBoxObject.scrollBy(scrollAmounts.shift(), 0);\\n-            if (!scrollAmounts.length) {\\n-              if (self._autorepeatSmoothScroll) {\\n-                var direction = self._isLTRScrollbox ? self._isScrolling : -self._isScrolling;\\n-                self._stopSmoothScroll();\\n-                self.scrollByIndex(direction);\\n-              } else\\n-                self._stopSmoothScroll();\\n-            }\\n+            if (!scrollAmounts.length)\\n+              self._stopSmoothScroll();\\n           }\\n \\n           // amountToScroll: total distance to scroll\\n@@ -458,7 +451,10 @@\\n           if (!document)\\n             aTimer.cancel();\\n \\n-          this.scrollByIndex(this._scrollIndex);\\n+          if (this.smoothScroll)\\n+            this.scrollByPixels(25 * this._scrollIndex);\\n+          else\\n+            this.scrollBoxObject.scrollByIndex(this._scrollIndex);\\n         ]]>\\n         </body>\\n       </method>\\n@@ -466,22 +462,19 @@\\n       <method name=\\\"_startScroll\\\">\\n         <parameter name=\\\"index\\\"/>\\n         <body><![CDATA[\\n-          if (this.smoothScroll)\\n-            this._autorepeatSmoothScroll = true;\\n-          else {\\n-            this._scrollIndex = index;\\n-            if (!this._scrollTimer) \\n-              this._scrollTimer = \\n-                Components.classes[\\\"@mozilla.org/timer;1\\\"]\\n-                          .createInstance(Components.interfaces.nsITimer);\\n-            else\\n-               this._scrollTimer.cancel();\\n+          this._scrollIndex = index;\\n+          var scrollDelay = this.smoothScroll ? 60 : this._scrollDelay;\\n+          if (!this._scrollTimer)\\n+            this._scrollTimer =\\n+              Components.classes[\\\"@mozilla.org/timer;1\\\"]\\n+                        .createInstance(Components.interfaces.nsITimer);\\n+          else\\n+             this._scrollTimer.cancel();\\n \\n-            this._scrollTimer.initWithCallback(this, \\n-                          this._scrollDelay,\\n-                          Components.interfaces.nsITimer.TYPE_REPEATING_SLACK);\\n-          }\\n-          this.scrollByIndex(index);\\n+          this._scrollTimer.initWithCallback(this,\\n+                        scrollDelay,\\n+                        Components.interfaces.nsITimer.TYPE_REPEATING_SLACK);\\n+          this.notify(this._scrollTimer);\\n           this._mousedown = true;\\n         ]]>\\n         </body>\\n@@ -489,10 +482,14 @@\\n \\n       <method name=\\\"_stopScroll\\\">\\n         <body><![CDATA[\\n-          if (this._scrollTimer) \\n+          if (this._scrollTimer)\\n             this._scrollTimer.cancel();\\n-          this._autorepeatSmoothScroll = false;\\n           this._mousedown = false;\\n+          if (!this._scrollIndex || !this.smoothScroll)\\n+            return;\\n+\\n+          this.scrollByIndex(this._scrollIndex);\\n+          this._scrollIndex = 0;\\n         ]]></body>\\n       </method>\\n \\n\""}