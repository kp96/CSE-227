{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basfbfe8a4\""},"diff":"\"fbfe8a4 Not part of build Continuing OS/2 wizard work It's pretty much working now\\ndiff --git a/widget/src/os2/nsGfxDefs.h b/widget/src/os2/nsGfxDefs.h\\nindex 09837d7..54eaeb6 100644\\n--- a/widget/src/os2/nsGfxDefs.h\\n+++ b/widget/src/os2/nsGfxDefs.h\\n@@ -32,6 +32,7 @@\\n #define INCL_DEV\\n #include <os2.h>\\n #include \\\"prlog.h\\\"\\n+#include \\\"nsHashtable.h\\\"\\n \\n #include <uconv.h> // XXX hack XXX\\n \\n@@ -72,17 +73,7 @@ void PMERROR(const char *str);\\n class nsString;\\n class nsIDeviceContext;\\n \\n-struct nsUconvInfo\\n-{\\n-  PRUint16 mCodePage;\\n-  UconvObject  mConverter;\\n-  nsUconvInfo* pNext;\\n-};\\n-\\n-static nsUconvInfo* gUconvInfoList = NULL;\\n \\n-int WideCharToMultiByte( int CodePage, const PRUnichar *pText, ULONG ulLength, char* szBuffer, ULONG ulSize );\\n-int MultiByteToWideChar( int CodePage, const char*pText, ULONG ulLength, PRUnichar *szBuffer, ULONG ulSize );\\n BOOL GetTextExtentPoint32(HPS aPS, const char* aString, int aLength, PSIZEL aSizeL);\\n BOOL ExtTextOut(HPS aPS, int X, int Y, UINT fuOptions, const RECTL* lprc,\\n                 const char* aString, unsigned int aLength, const int* pDx);\\n@@ -99,4 +90,15 @@ BOOL IsDBCS();\\n extern PRLogModuleInfo *gGFXOS2LogModule;\\n #endif\\n \\n+class OS2Uni {\\n+public:\\n+  static UconvObject GetUconvObject(int CodePage);\\n+  static FreeUconvObjects();\\n+private:\\n+  static nsHashtable gUconvObjects;\\n+};\\n+\\n+int WideCharToMultiByte( int CodePage, const PRUnichar *pText, ULONG ulLength, char* szBuffer, ULONG ulSize );\\n+int MultiByteToWideChar( int CodePage, const char*pText, ULONG ulLength, PRUnichar *szBuffer, ULONG ulSize );\\n+\\n #endif\\n\""}