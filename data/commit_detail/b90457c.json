{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basb90457c\""},"diff":"\"b90457c Bug 392084 - Add a get plugins link to the add-ons mgr. r=dtownsend\\ndiff --git a/browser/app/profile/firefox.js b/browser/app/profile/firefox.js\\nindex 41e2530..bde7132 100644\\n--- a/browser/app/profile/firefox.js\\n+++ b/browser/app/profile/firefox.js\\n@@ -150,6 +150,7 @@ pref(\\\"extensions.update.interval\\\", 86400);  // Check for updates to Extensions a\\n // Non-symmetric (not shared by extensions) extension-specific [update] preferences\\n pref(\\\"extensions.getMoreExtensionsURL\\\", \\\"https://%LOCALE%.add-ons.mozilla.com/%LOCALE%/%APP%/%VERSION%/extensions/\\\");\\n pref(\\\"extensions.getMoreThemesURL\\\", \\\"https://%LOCALE%.add-ons.mozilla.com/%LOCALE%/%APP%/%VERSION%/themes/\\\");\\n+pref(\\\"extensions.getMorePluginsURL\\\", \\\"https://%LOCALE%.add-ons.mozilla.com/%LOCALE%/%APP%/%VERSION%/plugins/\\\");\\n pref(\\\"extensions.dss.enabled\\\", false);          // Dynamic Skin Switching                                               \\n pref(\\\"extensions.dss.switchPending\\\", false);    // Non-dynamic switch pending after next\\n                                                 // restart.\\ndiff --git a/toolkit/locales/en-US/chrome/mozapps/extensions/extensions.dtd b/toolkit/locales/en-US/chrome/mozapps/extensions/extensions.dtd\\nindex 706421f..5ecf47c 100644\\n--- a/toolkit/locales/en-US/chrome/mozapps/extensions/extensions.dtd\\n+++ b/toolkit/locales/en-US/chrome/mozapps/extensions/extensions.dtd\\n@@ -109,9 +109,8 @@\\n <!ENTITY toBeUpdated.label                \\\"This add-on will be updated when &brandShortName; is restarted.\\\">\\n \\n <!ENTITY getExtensions.label              \\\"Get Extensions\\\">\\n-<!ENTITY getExtensions.tooltip            \\\"Get Extensions from addons.mozilla.org\\\">\\n <!ENTITY getThemes.label                  \\\"Get Themes\\\">\\n-<!ENTITY getThemes.tooltip                \\\"Get Themes from addons.mozilla.org\\\">\\n+<!ENTITY getPlugins.label                 \\\"Get Plugins\\\">\\n <!ENTITY previewNoThemeSelected.label     \\\"No Theme Selected\\\">\\n <!ENTITY previewNoPreviewImage.label      \\\"This Theme does not have a Preview Image\\\">\\n <!ENTITY moreInfo.label                   \\\"More Information\\\">\\ndiff --git a/toolkit/locales/en-US/chrome/mozapps/extensions/extensions.properties b/toolkit/locales/en-US/chrome/mozapps/extensions/extensions.properties\\nindex 7a4f9bd..c65b679 100644\\n--- a/toolkit/locales/en-US/chrome/mozapps/extensions/extensions.properties\\n+++ b/toolkit/locales/en-US/chrome/mozapps/extensions/extensions.properties\\n@@ -42,6 +42,7 @@ disableQueryMessage=Do you want to disable %S?\\n extensions.update.url=https://addons.mozilla.org/update/VersionCheck.php?reqVersion=%REQ_VERSION%&id=%ITEM_ID%&version=%ITEM_VERSION%&maxAppVersion=%ITEM_MAXAPPVERSION%&status=%ITEM_STATUS%&appID=%APP_ID%&appVersion=%APP_VERSION%&appOS=%APP_OS%&appABI=%APP_ABI%\\n extensions.getMoreExtensionsURL=https://%LOCALE%.add-ons.mozilla.com/%LOCALE%/%APP%/%VERSION%/extensions/\\n extensions.getMoreThemesURL=https://%LOCALE%.add-ons.mozilla.com/%LOCALE%/%APP%/%VERSION%/themes/\\n+extensions.getMorePluginsURL=https://%LOCALE%.add-ons.mozilla.com/%LOCALE%/%APP%/%VERSION%/plugins/\\n \\n themesTitle=Themes\\n extensionsTitle=Extensions\\ndiff --git a/toolkit/mozapps/extensions/content/extensions.js b/toolkit/mozapps/extensions/content/extensions.js\\nindex cff71a0..f9ed35a 100644\\n--- a/toolkit/mozapps/extensions/content/extensions.js\\n+++ b/toolkit/mozapps/extensions/content/extensions.js\\n@@ -70,6 +70,7 @@ const PREF_EM_CHECK_COMPATIBILITY           = \\\"extensions.checkCompatibility\\\";\\n const PREF_EM_CHECK_UPDATE_SECURITY         = \\\"extensions.checkUpdateSecurity\\\";\\n const PREF_EXTENSIONS_GETMORETHEMESURL      = \\\"extensions.getMoreThemesURL\\\";\\n const PREF_EXTENSIONS_GETMOREEXTENSIONSURL  = \\\"extensions.getMoreExtensionsURL\\\";\\n+const PREF_EXTENSIONS_GETMOREPLUGINSURL     = \\\"extensions.getMorePluginsURL\\\";\\n const PREF_EXTENSIONS_DSS_ENABLED           = \\\"extensions.dss.enabled\\\";\\n const PREF_EXTENSIONS_DSS_SWITCHPENDING     = \\\"extensions.dss.switchPending\\\";\\n const PREF_EXTENSIONS_HIDE_INSTALL_BTN      = \\\"extensions.hideInstallButton\\\";\\n@@ -275,6 +276,7 @@ function showView(aView) {\\n                       [\\\"updateURL\\\", \\\"?updateURL\\\"],\\n                       [\\\"version\\\", \\\"?version\\\"] ];\\n \\n+  var prefURL;\\n   var showInstallFile = true;\\n   try {\\n     showInstallFile = !gPref.getBoolPref(PREF_EXTENSIONS_HIDE_INSTALL_BTN);\\n@@ -287,15 +289,18 @@ function showView(aView) {\\n   var showContinue = false;\\n   switch (aView) {\\n     case \\\"extensions\\\":\\n+      prefURL = PREF_EXTENSIONS_GETMOREEXTENSIONSURL;\\n       var types = [ [ [\\\"type\\\", nsIUpdateItem.TYPE_EXTENSION, \\\"Integer\\\"] ] ];\\n       break;\\n     case \\\"themes\\\":\\n+      prefURL = PREF_EXTENSIONS_GETMORETHEMESURL;\\n       types = [ [ [\\\"type\\\", nsIUpdateItem.TYPE_THEME, \\\"Integer\\\"] ] ];\\n       break;\\n     case \\\"locales\\\":\\n       types = [ [ [\\\"type\\\", nsIUpdateItem.TYPE_LOCALE, \\\"Integer\\\"] ] ];\\n       break;\\n     case \\\"plugins\\\":\\n+      prefURL = PREF_EXTENSIONS_GETMOREPLUGINSURL;\\n       types = [ [ [\\\"plugin\\\", \\\"true\\\", null] ] ];\\n       break;\\n     case \\\"updates\\\":\\n@@ -367,33 +372,30 @@ function showView(aView) {\\n       break;\\n   }\\n \\n-  var isThemes = aView == \\\"themes\\\";\\n-\\n+  var showGetMore = false;\\n   var getMore = document.getElementById(\\\"getMore\\\");\\n-  if (aView == \\\"themes\\\" || aView == \\\"extensions\\\") {\\n+  if (prefURL) {\\n     try {\\n-      var el = document.getElementById(\\\"installFileButton\\\");\\n-      el.setAttribute(\\\"tooltiptext\\\", el.getAttribute(isThemes ? \\\"tooltiptextthemes\\\" :\\n-                                                                  \\\"tooltiptextaddons\\\"));\\n-      el = document.getElementById(\\\"checkUpdatesAllButton\\\");\\n-      el.setAttribute(\\\"tooltiptext\\\", el.getAttribute(isThemes ? \\\"tooltiptextthemes\\\" :\\n-                                                                  \\\"tooltiptextaddons\\\"));\\n-      getMore.setAttribute(\\\"value\\\", getMore.getAttribute(isThemes ? \\\"valuethemes\\\" :\\n-                                                                    \\\"valueextensions\\\"));\\n-      var getMorePref = isThemes ? PREF_EXTENSIONS_GETMORETHEMESURL : PREF_EXTENSIONS_GETMOREEXTENSIONSURL;\\n-      var formatter = Components.classes[\\\"@mozilla.org/toolkit/URLFormatterService;1\\\"]\\n-                                .getService(Components.interfaces.nsIURLFormatter);\\n-      var getMoreURL = formatter.formatURLPref(getMorePref);\\n+      getMore.setAttribute(\\\"value\\\", getMore.getAttribute(\\\"value\\\" + aView));\\n+      var getMoreURL = Components.classes[\\\"@mozilla.org/toolkit/URLFormatterService;1\\\"]\\n+                                 .getService(Components.interfaces.nsIURLFormatter)\\n+                                 .formatURLPref(prefURL);\\n       getMore.setAttribute(\\\"getMoreURL\\\", getMoreURL);\\n-      if (getMore.hidden)\\n-        getMore.hidden = false;\\n-    }\\n-    catch (e) {\\n-      getMore.hidden = true;\\n+      showGetMore = getMoreURL == \\\"about:blank\\\" ? false : true;\\n     }\\n+    catch (e) { }\\n   }\\n-  else if (!getMore.hidden) {\\n-    getMore.hidden = true;\\n+  getMore.hidden = !showGetMore;\\n+\\n+  var isThemes = aView == \\\"themes\\\";\\n+\\n+  if (aView == \\\"themes\\\" || aView == \\\"extensions\\\") {\\n+    var el = document.getElementById(\\\"installFileButton\\\");\\n+    el.setAttribute(\\\"tooltiptext\\\", el.getAttribute(isThemes ? \\\"tooltiptextthemes\\\" :\\n+                                                              \\\"tooltiptextaddons\\\"));\\n+    el = document.getElementById(\\\"checkUpdatesAllButton\\\");\\n+    el.setAttribute(\\\"tooltiptext\\\", el.getAttribute(isThemes ? \\\"tooltiptextthemes\\\" :\\n+                                                              \\\"tooltiptextaddons\\\"));\\n   }\\n \\n   document.getElementById(\\\"installFileButton\\\").hidden = !showInstallFile;\\ndiff --git a/toolkit/mozapps/extensions/content/extensions.xul b/toolkit/mozapps/extensions/content/extensions.xul\\nindex b8f290a..4fac28d 100644\\n--- a/toolkit/mozapps/extensions/content/extensions.xul\\n+++ b/toolkit/mozapps/extensions/content/extensions.xul\\n@@ -218,6 +218,7 @@\\n       <label id=\\\"getMore\\\" class=\\\"text-link\\\"\\n              onclick=\\\"openURL(this.getAttribute('getMoreURL'));\\\"\\n              valuethemes=\\\"&getThemes.label;\\\"\\n+             valueplugins=\\\"&getPlugins.label;\\\"\\n              valueextensions=\\\"&getExtensions.label;\\\"/>\\n       <spacer flex=\\\"1\\\"/>\\n       <button id=\\\"restartAppButton\\\" label=\\\"&cmd.restartApp2.label;\\\"\\n\""}