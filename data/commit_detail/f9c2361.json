{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basf9c2361\""},"diff":"\"f9c2361 Fixing bug 391777. Make window.close() work on a modal content dialogs. r+sr+a=jonas@sicking.cc\\ndiff --git a/content/html/document/test/Makefile.in b/content/html/document/test/Makefile.in\\nindex 810588b..9e670c4 100644\\n--- a/content/html/document/test/Makefile.in\\n+++ b/content/html/document/test/Makefile.in\\n@@ -61,6 +61,7 @@ _TEST_FILES = \\ttest_bug1682.html \\\\\\n \\t\\ttest_bug359657.html \\\\\\n \\t\\ttest_bug380383.html \\\\\\n \\t\\ttest_bug386495.html \\\\\\n+\\t\\ttest_bug391777.html \\\\\\n \\t\\t$(NULL)\\n \\n libs:: $(_TEST_FILES)\\ndiff --git a/content/html/document/test/test_bug391777.html b/content/html/document/test/test_bug391777.html\\nnew file mode 100644\\nindex 0000000..fcfe9d7\\n--- /dev/null\\n+++ b/content/html/document/test/test_bug391777.html\\n@@ -0,0 +1,25 @@\\n+<!DOCTYPE HTML>\\n+<html>\\n+<!--\\n+https://bugzilla.mozilla.org/show_bug.cgi?id=391777\\n+-->\\n+<head>\\n+  <title>Test for Bug 391777</title>\\n+  <script type=\\\"text/javascript\\\" src=\\\"/MochiKit/MochiKit.js\\\"></script>\\n+  <script type=\\\"text/javascript\\\" src=\\\"/tests/SimpleTest/SimpleTest.js\\\"></script>        \\n+  <link rel=\\\"stylesheet\\\" type=\\\"text/css\\\" href=\\\"/tests/SimpleTest/test.css\\\" />\\n+</head>\\n+<body>\\n+<a target=\\\"_blank\\\" href=\\\"https://bugzilla.mozilla.org/show_bug.cgi?id=391777\\\">Mozilla Bug 391777</a>\\n+<p id=\\\"display\\\"></p>\\n+<script class=\\\"testbody\\\" type=\\\"text/javascript\\\">\\n+\\n+/** Test for Bug 391777 **/\\n+var arg = {};\\n+arg.testVal = \\\"foo\\\";\\n+var result = window.showModalDialog(\\\"javascript:window.returnValue = window.dialogArguments.testVal; window.close(); 'This window should close on its own.';\\\", arg);\\n+ok(true, \\\"We should get here without user interaction\\\");\\n+is(result, \\\"foo\\\", \\\"Unexpected result from showModalDialog\\\");\\n+</script>\\n+</body>\\n+</html>\\ndiff --git a/embedding/components/windowwatcher/src/nsWindowWatcher.cpp b/embedding/components/windowwatcher/src/nsWindowWatcher.cpp\\nindex af62108..e5634a8 100644\\n--- a/embedding/components/windowwatcher/src/nsWindowWatcher.cpp\\n+++ b/embedding/components/windowwatcher/src/nsWindowWatcher.cpp\\n@@ -927,7 +927,7 @@ nsWindowWatcher::OpenWindowJSInternal(nsIDOMWindow *aParent,\\n       modalContentWindow = do_QueryInterface(*_retval);\\n     }\\n \\n-    nsAutoWindowStateHelper windowStateHelper(modalContentWindow);\\n+    nsAutoWindowStateHelper windowStateHelper(aParent);\\n \\n     if (!windowStateHelper.DefaultEnabled()) {\\n       // Default to cancel not opening the modal window.\\n\""}