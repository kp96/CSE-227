{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas2ed324a\""},"diff":"\"2ed324a Bug 393080: Make count and offset in nsCSSScanner unsigned. r+sr=bzbarsky, a=dbaron\\ndiff --git a/layout/style/nsCSSScanner.cpp b/layout/style/nsCSSScanner.cpp\\nindex d0dec73..51317ec5 100644\\n--- a/layout/style/nsCSSScanner.cpp\\n+++ b/layout/style/nsCSSScanner.cpp\\n@@ -250,7 +250,7 @@ PR_STATIC_CALLBACK(int) CSSErrorsPrefChanged(const char *aPref, void *aClosure)\\n }\\n \\n void nsCSSScanner::Init(nsIUnicharInputStream* aInput, \\n-                        const PRUnichar * aBuffer, PRInt32 aCount, \\n+                        const PRUnichar * aBuffer, PRUint32 aCount, \\n                         nsIURI* aURI, PRUint32 aLineNumber)\\n {\\n   NS_PRECONDITION(!mInputStream, \\\"Should not have an existing input stream!\\\");\\n@@ -473,16 +473,13 @@ PRInt32 nsCSSScanner::Read(nsresult& aErrorCode)\\n   if (0 < mPushbackCount) {\\n     rv = PRInt32(mPushback[--mPushbackCount]);\\n   } else {\\n-    if (mCount < 0) {\\n-      return -1;\\n-    }\\n     if (mOffset == mCount) {\\n       mOffset = 0;\\n       if (!mInputStream) {\\n         mCount = 0;\\n         return -1;\\n       }\\n-      aErrorCode = mInputStream->Read(mBuffer, CSS_BUFFER_SIZE, (PRUint32*)&mCount);\\n+      aErrorCode = mInputStream->Read(mBuffer, CSS_BUFFER_SIZE, &mCount);\\n       if (NS_FAILED(aErrorCode) || mCount == 0) {\\n         mCount = 0;\\n         return -1;\\ndiff --git a/layout/style/nsCSSScanner.h b/layout/style/nsCSSScanner.h\\nindex 12fb1b7..c053e27 100644\\n--- a/layout/style/nsCSSScanner.h\\n+++ b/layout/style/nsCSSScanner.h\\n@@ -139,7 +139,7 @@ class nsCSSScanner {\\n   // when the line number is unknown.\\n   // Either aInput or (aBuffer and aCount) must be set.\\n   void Init(nsIUnicharInputStream* aInput, \\n-            const PRUnichar *aBuffer, PRInt32 aCount, \\n+            const PRUnichar *aBuffer, PRUint32 aCount,\\n             nsIURI* aURI, PRUint32 aLineNumber);\\n   void Close();\\n \\n@@ -225,8 +225,8 @@ protected:\\n   PRUnichar mBuffer[CSS_BUFFER_SIZE];\\n \\n   const PRUnichar *mReadPointer;\\n-  PRInt32 mOffset;\\n-  PRInt32 mCount;\\n+  PRUint32 mOffset;\\n+  PRUint32 mCount;\\n   PRUnichar* mPushback;\\n   PRInt32 mPushbackCount;\\n   PRInt32 mPushbackSize;\\n\""}