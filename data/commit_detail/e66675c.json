{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Base66675c\""},"diff":"\"e66675c Bug 396241 - \\\"nsIIOService.newURI exception in makeURI in contentAreaUtils.js when doing open Frame in New Tab with data url\\\" [p=f.qu@queze.net (Florian Qu√®ze) r=Mano a1.9=mconnor]\\ndiff --git a/browser/base/content/nsContextMenu.js b/browser/base/content/nsContextMenu.js\\nindex 4cd11b7..116c66c 100644\\n--- a/browser/base/content/nsContextMenu.js\\n+++ b/browser/base/content/nsContextMenu.js\\n@@ -641,8 +641,10 @@ nsContextMenu.prototype = {\\n   openFrameInTab: function() {\\n     var doc = this.target.ownerDocument;\\n     var frameURL = doc.documentURIObject.spec;\\n+    var referrer = doc.referrer;\\n \\n-    openNewTabWith(frameURL, null, null, null, false, makeURI(doc.referrer));\\n+    openNewTabWith(frameURL, null, null, null, false,\\n+                   referrer ? makeURI(referrer) : null);\\n   },\\n \\n   // Reload clicked-in frame.\\n@@ -654,8 +656,10 @@ nsContextMenu.prototype = {\\n   openFrame: function() {\\n     var doc = this.target.ownerDocument;\\n     var frameURL = doc.documentURIObject.spec;\\n+    var referrer = doc.referrer;\\n \\n-    openNewWindowWith(frameURL, null, null, false, makeURI(doc.referrer));\\n+    openNewWindowWith(frameURL, null, null, false,\\n+                      referrer ? makeURI(referrer) : null);\\n   },\\n \\n   // Open clicked-in frame in the same window.\\n@@ -665,7 +669,8 @@ nsContextMenu.prototype = {\\n \\n     urlSecurityCheck(frameURL, this.browser.contentPrincipal,\\n                      Ci.nsIScriptSecurityManager.DISALLOW_SCRIPT);\\n-    this.browser.loadURI(frameURL, makeURI(doc.referrer));\\n+    var referrer = doc.referrer;\\n+    this.browser.loadURI(frameURL, referrer ? makeURI(referrer) : null);\\n   },\\n \\n   // View Partial Source\\n\""}