{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basb6bdb49\""},"diff":"\"b6bdb49 Bug 395849. XPCVariant::VariantDataToJS leaks strings with sizes. r/sr=jst\\ndiff --git a/js/src/xpconnect/src/xpcvariant.cpp b/js/src/xpconnect/src/xpcvariant.cpp\\nindex 9cc6016..185f01b 100644\\n--- a/js/src/xpconnect/src/xpcvariant.cpp\\n+++ b/js/src/xpconnect/src/xpcvariant.cpp\\n@@ -493,6 +493,7 @@ XPCVariant::VariantDataToJS(XPCCallContext& ccx,\\n                                                       (char**)&xpctvar.val.p)))\\n                 return JS_FALSE;\\n             xpctvar.type = (uint8)(TD_PSTRING_SIZE_IS | XPT_TDP_POINTER);\\n+            xpctvar.SetValIsAllocated();\\n             break;\\n         case nsIDataType::VTYPE_WCHAR_STR:        \\n             if(NS_FAILED(variant->GetAsWString((PRUnichar**)&xpctvar.val.p)))\\n@@ -505,6 +506,7 @@ XPCVariant::VariantDataToJS(XPCCallContext& ccx,\\n                                                       (PRUnichar**)&xpctvar.val.p)))\\n                 return JS_FALSE;\\n             xpctvar.type = (uint8)(TD_PWSTRING_SIZE_IS | XPT_TDP_POINTER);\\n+            xpctvar.SetValIsAllocated();\\n             break;\\n         case nsIDataType::VTYPE_INTERFACE:        \\n         case nsIDataType::VTYPE_INTERFACE_IS:        \\n\""}