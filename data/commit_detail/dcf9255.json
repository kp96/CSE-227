{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basdcf9255\""},"diff":"\"dcf9255 Bug 375596: Didn't update extension over installed disabled previous version. r=robstrong\\ndiff --git a/toolkit/locales/en-US/chrome/mozapps/extensions/extensions.dtd b/toolkit/locales/en-US/chrome/mozapps/extensions/extensions.dtd\\nindex 6ca3a82..d8f6db2 100644\\n--- a/toolkit/locales/en-US/chrome/mozapps/extensions/extensions.dtd\\n+++ b/toolkit/locales/en-US/chrome/mozapps/extensions/extensions.dtd\\n@@ -67,12 +67,22 @@\\n <!ENTITY cmd.cancelUninstall.label        \\\"Cancel Uninstall\\\">\\n <!ENTITY cmd.cancelUninstall.accesskey    \\\"C\\\">\\n <!ENTITY cmd.cancelUninstall.tooltip      \\\"Cancel the uninstall of this Add-on\\\">\\n+<!ENTITY cmd.cancelInstall.label          \\\"Cancel Install\\\">\\n+<!ENTITY cmd.cancelInstall.accesskey      \\\"C\\\">\\n+<!ENTITY cmd.cancelInstall.tooltip        \\\"Cancel the install of this Add-on\\\">\\n+<!ENTITY cmd.cancelUpgrade.label          \\\"Cancel Upgrade\\\">\\n+<!ENTITY cmd.cancelUpgrade.accesskey      \\\"C\\\">\\n+<!ENTITY cmd.cancelUpgrade.tooltip        \\\"Cancel the upgrade of this Add-on\\\">\\n <!ENTITY cmd.installUpdate.label          \\\"Install Update\\\">\\n <!ENTITY cmd.installUpdate.accesskey      \\\"I\\\">\\n <!ENTITY cmd.installUpdate.tooltip        \\\"Install an update for this Add-on\\\">\\n <!-- The selected add-on's cancel action button label -->\\n <!ENTITY cancel.label                     \\\"Cancel\\\">\\n <!ENTITY cancel.accesskey                 \\\"C\\\">\\n+<!ENTITY cancelInstall.label              \\\"Cancel\\\">\\n+<!ENTITY cancelInstall.accesskey          \\\"C\\\">\\n+<!ENTITY cancelUpgrade.label              \\\"Cancel\\\">\\n+<!ENTITY cancelUpgrade.accesskey          \\\"C\\\">\\n \\n <!-- Only displayed in the selected Add-on's context menu -->\\n <!ENTITY cmd.homepage.label               \\\"Visit Home Page\\\">\\ndiff --git a/toolkit/locales/en-US/chrome/mozapps/extensions/extensions.properties b/toolkit/locales/en-US/chrome/mozapps/extensions/extensions.properties\\nindex de5a892..73a380f 100644\\n--- a/toolkit/locales/en-US/chrome/mozapps/extensions/extensions.properties\\n+++ b/toolkit/locales/en-US/chrome/mozapps/extensions/extensions.properties\\n@@ -27,6 +27,14 @@ moreInfoText=More information\\n uninstallTitle=Uninstall %S\\n uninstallWarnDependMsg=%S is required by one or more add-ons. If you continue, the following items will be disabled:\\n uninstallQueryMessage=Do you want to uninstall %S?\\n+cancelInstallTitle=Cancel Install of %S\\n+cancelInstallQueryMessage=Are you sure you want to cancel the install of %S?\\n+cancelInstallButton=Yes\\n+cancelCancelInstallButton=No\\n+cancelUpgradeTitle=Cancel Upgrade of %S\\n+cancelUpgradeQueryMessage=Are you sure you want to cancel the upgrade of %S?\\n+cancelUpgradeButton=Yes\\n+cancelCancelUpgradeButton=No\\n disableTitle=Disable %S\\n disableWarningDependMessage=If you disable %S, the following items that require this extension will also be disabled:\\n disableQueryMessage=Do you want to disable %S?\\ndiff --git a/toolkit/mozapps/extensions/content/extensions.js b/toolkit/mozapps/extensions/content/extensions.js\\nindex 6a3d7e0..75c276a 100644\\n--- a/toolkit/mozapps/extensions/content/extensions.js\\n+++ b/toolkit/mozapps/extensions/content/extensions.js\\n@@ -1130,7 +1130,8 @@ function onAddonSelect(aEvent)\\n // View Context Menus\\n var gAddonContextMenus = [\\\"menuitem_useTheme\\\", \\\"menuitem_options\\\", \\\"menuitem_homepage\\\",\\n                           \\\"menuitem_about\\\",  \\\"menuseparator_1\\\", \\\"menuitem_uninstall\\\",\\n-                          \\\"menuitem_cancelUninstall\\\", \\\"menuitem_checkUpdate\\\",\\n+                          \\\"menuitem_cancelUninstall\\\", \\\"menuitem_cancelInstall\\\",\\n+                          \\\"menuitem_cancelUpgrade\\\", \\\"menuitem_checkUpdate\\\",\\n                           \\\"menuitem_enable\\\", \\\"menuitem_disable\\\"];\\n var gUpdateContextMenus = [\\\"menuitem_homepage\\\", \\\"menuitem_about\\\", \\\"menuseparator_1\\\",\\n                            \\\"menuitem_installUpdate\\\", \\\"menuitem_includeUpdate\\\"];\\n@@ -1174,11 +1175,17 @@ function buildContextMenu(aEvent)\\n   var name = selectedItem ? selectedItem.getAttribute(\\\"name\\\") : \\\"\\\";\\n   menuitem_about.setAttribute(\\\"label\\\", getExtensionString(\\\"aboutAddon\\\", [name]));\\n \\n-  // When performing update or install tasks we don't support uninstall\\n+  /* When an update or install is pending allow canceling the update or install\\n+     and don't allow uninstall. When an uninstall is pending allow canceling the\\n+     uninstall.*/\\n   if (gView != \\\"updates\\\" && gView != \\\"installs\\\") {\\n     var canEnable = gExtensionsViewController.isCommandEnabled(\\\"cmd_cancelUninstall\\\");\\n     document.getElementById(\\\"menuitem_cancelUninstall_clone\\\").hidden = !canEnable;\\n-    document.getElementById(\\\"menuitem_uninstall_clone\\\").hidden = canEnable;\\n+    var canCancelInstall = gExtensionsViewController.isCommandEnabled(\\\"cmd_cancelInstall\\\");\\n+    document.getElementById(\\\"menuitem_cancelInstall_clone\\\").hidden = !canCancelInstall;\\n+    var canCancelUpgrade = gExtensionsViewController.isCommandEnabled(\\\"cmd_cancelUpgrade\\\");\\n+    document.getElementById(\\\"menuitem_cancelUpgrade_clone\\\").hidden = !canCancelUpgrade;\\n+    document.getElementById(\\\"menuitem_uninstall_clone\\\").hidden = canEnable || canCancelInstall || canCancelUpgrade;\\n   }\\n \\n   switch (gView) {\\n@@ -1200,16 +1207,16 @@ function buildContextMenu(aEvent)\\n     document.getElementById(\\\"menuitem_options_clone\\\").hidden = true;\\n     document.getElementById(\\\"menuitem_disable_clone\\\").hidden = true;\\n     break;\\n-  case \\\"locales\\\":\\n   case \\\"plugins\\\":\\n+    document.getElementById(\\\"menuitem_about_clone\\\").hidden = true;\\n+    document.getElementById(\\\"menuitem_uninstall_clone\\\").hidden = true;\\n+    document.getElementById(\\\"menuitem_checkUpdate_clone\\\").hidden = true;\\n+  case \\\"locales\\\":\\n     canEnable = gExtensionsViewController.isCommandEnabled(\\\"cmd_reallyEnable\\\");\\n     document.getElementById(\\\"menuitem_enable_clone\\\").hidden = !canEnable;\\n     document.getElementById(\\\"menuitem_disable_clone\\\").hidden = canEnable;\\n     document.getElementById(\\\"menuitem_useTheme_clone\\\").hidden = true;\\n     document.getElementById(\\\"menuitem_options_clone\\\").hidden = true;\\n-    document.getElementById(\\\"menuitem_about_clone\\\").hidden = true;\\n-    document.getElementById(\\\"menuitem_uninstall_clone\\\").hidden = true;\\n-    document.getElementById(\\\"menuitem_checkUpdate_clone\\\").hidden = true;\\n     break;\\n   case \\\"updates\\\":\\n     var includeUpdate = document.getAnonymousElementByAttribute(selectedItem, \\\"anonid\\\", \\\"includeUpdate\\\");\\n@@ -1597,6 +1604,27 @@ function closeEM() {\\n   closeWindow(true);\\n }\\n \\n+function confirmOperation(aName, aTitle, aQueryMsg, aAcceptBtn, aCancelBtn,\\n+                          aWarnMsg, aDependantItems) {\\n+  var params = {\\n+    message2: getExtensionString(aQueryMsg, [aName]),\\n+    title: getExtensionString(aTitle, [aName]),\\n+    buttons: {\\n+      accept: { label: getExtensionString(aAcceptBtn) },\\n+      cancel: { label: getExtensionString(aCancelBtn), focused: true }\\n+    }\\n+  }\\n+  if (aDependantItems.length > 0)\\n+    params.message1 = getExtensionString(aWarnMsg, [aName]);\\n+  var names = [];\\n+  for (var i = 0; i < aDependantItems.length; ++i)\\n+    names.push(aDependantItems[i].name + \\\" \\\" + aDependantItems[i].version);\\n+\\n+  window.openDialog(\\\"chrome://mozapps/content/extensions/list.xul\\\", \\\"\\\", \\n+                    \\\"titlebar,modal,centerscreen\\\", names, params);\\n+  return params.result == \\\"accept\\\";\\n+}\\n+\\n var gExtensionsViewController = {\\n   supportsCommand: function (aCommand)\\n   {\\n@@ -1643,6 +1671,10 @@ var gExtensionsViewController = {\\n              !gExtensionsView.hasAttribute(\\\"update-operation\\\");\\n     case \\\"cmd_cancelUninstall\\\":\\n       return selectedItem.opType == OP_NEEDS_UNINSTALL;\\n+    case \\\"cmd_cancelInstall\\\":\\n+      return selectedItem.opType == OP_NEEDS_INSTALL;\\n+    case \\\"cmd_cancelUpgrade\\\":\\n+      return selectedItem.opType == OP_NEEDS_UPGRADE;\\n     case \\\"cmd_checkUpdate\\\":\\n       return selectedItem.getAttribute(\\\"updateable\\\") != \\\"false\\\" &&\\n              !gExtensionsView.hasAttribute(\\\"update-operation\\\");\\n@@ -1829,24 +1861,10 @@ var gExtensionsViewController = {\\n       var name = aSelectedItem.getAttribute(\\\"name\\\");\\n       var id = getIDFromResourceURI(aSelectedItem.id);\\n       var dependentItems = gExtensionManager.getDependentItemListForID(id, true, { });\\n-      var params = {\\n-        message2: getExtensionString(\\\"uninstallQueryMessage\\\", [name]),\\n-        title: getExtensionString(\\\"uninstallTitle\\\", [name]),\\n-        buttons: {\\n-          accept: { label: getExtensionString(\\\"uninstallButton\\\"),\\n-                    focused: true },\\n-          cancel: { label: getExtensionString(\\\"cancelButton\\\") }\\n-        }\\n-      }\\n-      if (dependentItems.length > 0)\\n-        params.message1 = getExtensionString(\\\"uninstallWarnDependMsg\\\", [name]);\\n-      var names = [];\\n-      for (var i = 0; i < dependentItems.length; ++i)\\n-        names.push(dependentItems[i].name + \\\" \\\" + dependentItems[i].version);\\n-\\n-      window.openDialog(\\\"chrome://mozapps/content/extensions/list.xul\\\", \\\"\\\", \\n-                        \\\"titlebar,modal,centerscreen\\\", names, params);\\n-      if (params.result != \\\"accept\\\") \\n+      var result = confirmOperation(name, \\\"uninstallTitle\\\", \\\"uninstallQueryMessage\\\",\\n+                                    \\\"uninstallButton\\\", \\\"cancelButton\\\",\\n+                                    \\\"uninstallWarnDependMsg\\\", dependentItems);\\n+      if (!result)\\n         return;\\n \\n       if (aSelectedItem.type == nsIUpdateItem.TYPE_THEME) {\\n@@ -1876,6 +1894,39 @@ var gExtensionsViewController = {\\n       updateOptionalViews();\\n     },\\n \\n+    cmd_cancelInstall: function (aSelectedItem)\\n+    {\\n+      var name = aSelectedItem.getAttribute(\\\"name\\\");\\n+      var result = false;\\n+      // Confirm cancelling the operation\\n+      switch (aSelectedItem.opType)\\n+      {\\n+        case OP_NEEDS_INSTALL:\\n+          result = confirmOperation(name, \\\"cancelInstallTitle\\\", \\\"cancelInstallQueryMessage\\\",\\n+                                    \\\"cancelInstallButton\\\", \\\"cancelCancelInstallButton\\\",\\n+                                    null, []);\\n+          break;\\n+        case OP_NEEDS_UPGRADE:\\n+          result = confirmOperation(name, \\\"cancelUpgradeTitle\\\", \\\"cancelUpgradeQueryMessage\\\",\\n+                                    \\\"cancelUpgradeButton\\\", \\\"cancelCancelUpgradeButton\\\",\\n+                                    null, []);\\n+          break;\\n+      }\\n+      if (!result)\\n+        return;\\n+\\n+      gExtensionManager.cancelInstallItem(getIDFromResourceURI(aSelectedItem.id));\\n+      gExtensionsViewController.onCommandUpdate();\\n+      updateGlobalCommands();\\n+      gExtensionsView.selectedItem.focus();\\n+      updateOptionalViews();\\n+    },\\n+\\n+    cmd_cancelUpgrade: function (aSelectedItem)\\n+    {\\n+      this.cmd_cancelInstall(aSelectedItem);\\n+    },\\n+\\n     cmd_disable: function (aSelectedItem)\\n     {\\n       if (aSelectedItem.getAttribute(\\\"plugin\\\") == \\\"true\\\") {\\n@@ -1888,24 +1939,10 @@ var gExtensionsViewController = {\\n \\n       if (dependentItems.length > 0) {\\n         var name = aSelectedItem.getAttribute(\\\"name\\\");\\n-        var message = getExtensionString(\\\"disableWarningDependMessage\\\", [name]);\\n-        var params = {\\n-          message1: message,\\n-          message2: getExtensionString(\\\"disableQueryMessage\\\", [name]),\\n-          title: getExtensionString(\\\"disableTitle\\\", [name]),\\n-          buttons: {\\n-            accept: { label: getExtensionString(\\\"disableButton\\\"),\\n-                      focused: true },\\n-            cancel: { label: getExtensionString(\\\"cancelButton\\\") }\\n-          }\\n-        }\\n-        var names = [];\\n-        for (var i = 0; i < dependentItems.length; ++i)\\n-          names.push(dependentItems[i].name + \\\" \\\" + dependentItems[i].version);\\n-\\n-        window.openDialog(\\\"chrome://mozapps/content/extensions/list.xul\\\", \\\"\\\", \\n-                          \\\"titlebar,modal,centerscreen\\\", names, params);\\n-        if (params.result != \\\"accept\\\") \\n+        var result = confirmOperation(name, \\\"disableTitle\\\", \\\"disableQueryMessage\\\",\\n+                                      \\\"disableButton\\\", \\\"cancelButton\\\",\\n+                                      \\\"disableWarningDependMessage\\\", dependentItems);\\n+        if (!result)\\n           return;\\n       }\\n       gExtensionManager.disableItem(id);\\ndiff --git a/toolkit/mozapps/extensions/content/extensions.xml b/toolkit/mozapps/extensions/content/extensions.xml\\nindex 8bf4b5d..2682e39 100644\\n--- a/toolkit/mozapps/extensions/content/extensions.xml\\n+++ b/toolkit/mozapps/extensions/content/extensions.xml\\n@@ -274,6 +274,12 @@\\n             <xul:button class=\\\"uninstallShow cancelUninstallButton\\\" label=\\\"&cancel.label;\\\"\\n                         accesskey=\\\"&cancel.accesskey;\\\" tooltiptext=\\\"&cmd.cancelUninstall.tooltip;\\\"\\n                         command=\\\"cmd_cancelUninstall\\\"/>\\n+            <xul:button class=\\\"installShow cancelInstallButton\\\" label=\\\"&cancelInstall.label;\\\"\\n+                        accesskey=\\\"&cancelInstall.accesskey;\\\" tooltiptext=\\\"&cmd.cancelInstall.tooltip;\\\"\\n+                        command=\\\"cmd_cancelInstall\\\"/>\\n+            <xul:button class=\\\"upgradeShow cancelUpgradeButton\\\" label=\\\"&cancelUpgrade.label;\\\"\\n+                        accesskey=\\\"&cancelUpgrade.accesskey;\\\" tooltiptext=\\\"&cmd.cancelUpgrade.tooltip;\\\"\\n+                        command=\\\"cmd_cancelUpgrade\\\"/>\\n           </xul:hbox>\\n         </xul:vbox>\\n       </xul:hbox>\\ndiff --git a/toolkit/mozapps/extensions/content/extensions.xul b/toolkit/mozapps/extensions/content/extensions.xul\\nindex eeaca24..b8f290a 100644\\n--- a/toolkit/mozapps/extensions/content/extensions.xul\\n+++ b/toolkit/mozapps/extensions/content/extensions.xul\\n@@ -93,6 +93,8 @@\\n     <command id=\\\"cmd_homepage\\\"/>\\n     <command id=\\\"cmd_uninstall\\\"/>\\n     <command id=\\\"cmd_cancelUninstall\\\"/>\\n+    <command id=\\\"cmd_cancelInstall\\\"/>\\n+    <command id=\\\"cmd_cancelUpgrade\\\"/>\\n     <command id=\\\"cmd_checkUpdate\\\"/>\\n     <command id=\\\"cmd_includeUpdate\\\"/>\\n     <command id=\\\"cmd_installUpdate\\\"/>\\n@@ -128,6 +130,10 @@\\n               label=\\\"&cmd.uninstall.label;\\\" accesskey=\\\"&cmd.uninstall2.accesskey;\\\"/>\\n     <menuitem id=\\\"menuitem_cancelUninstall\\\" command=\\\"cmd_cancelUninstall\\\"\\n               label=\\\"&cmd.cancelUninstall.label;\\\" accesskey=\\\"&cmd.cancelUninstall.accesskey;\\\"/>\\n+    <menuitem id=\\\"menuitem_cancelInstall\\\" command=\\\"cmd_cancelInstall\\\"\\n+              label=\\\"&cmd.cancelInstall.label;\\\" accesskey=\\\"&cmd.cancelInstall.accesskey;\\\"/>\\n+    <menuitem id=\\\"menuitem_cancelUpgrade\\\" command=\\\"cmd_cancelUpgrade\\\"\\n+              label=\\\"&cmd.cancelUpgrade.label;\\\" accesskey=\\\"&cmd.cancelUpgrade.accesskey;\\\"/>\\n     <menuitem id=\\\"menuitem_checkUpdate\\\" command=\\\"cmd_checkUpdate\\\"\\n               label=\\\"&cmd.checkUpdate.label;\\\" accesskey=\\\"&cmd.checkUpdate.accesskey;\\\"/>\\n     <menuitem id=\\\"menuitem_enable\\\" command=\\\"cmd_enable\\\"\\ndiff --git a/toolkit/mozapps/extensions/public/nsIExtensionManager.idl b/toolkit/mozapps/extensions/public/nsIExtensionManager.idl\\nindex 9e5a9c9..2d89b07 100644\\n--- a/toolkit/mozapps/extensions/public/nsIExtensionManager.idl\\n+++ b/toolkit/mozapps/extensions/public/nsIExtensionManager.idl\\n@@ -197,7 +197,7 @@ interface nsIInstallLocation : nsISupports\\n  * XXXben - Some of this stuff should go into a management-ey interface, \\n  *          some into an app-startup-ey interface.\\n  */\\n-[scriptable, uuid(c2aef3c3-8ce1-4470-94e4-1167e5ca8928)]\\n+[scriptable, uuid(f5c34a77-3487-4b70-a65a-6727fa066324)]\\n interface nsIExtensionManager : nsISupports\\n {\\n   /**\\n@@ -407,6 +407,14 @@ interface nsIExtensionManager : nsISupports\\n   void moveToIndexOf(in AString movingID, in AString destinationID);\\n \\n   /**\\n+   * Cancels a pending install or upgrade of an item. If the item does\\n+   * not have a pending install or upgrade then this will do nothing.\\n+   * @param   id\\n+   *          The ID of the item.\\n+   */\\n+  void cancelInstallItem(in AString id);\\n+\\n+  /**\\n    * Cancels a pending uninstall of an item\\n    * @param   id\\n    *          The ID of the item.\\ndiff --git a/toolkit/mozapps/extensions/src/nsExtensionManager.js.in b/toolkit/mozapps/extensions/src/nsExtensionManager.js.in\\nindex c2dccf0..da91c175 100644\\n--- a/toolkit/mozapps/extensions/src/nsExtensionManager.js.in\\n+++ b/toolkit/mozapps/extensions/src/nsExtensionManager.js.in\\n@@ -4663,6 +4663,8 @@ ExtensionManager.prototype = {\\n         this._updateManifests(false);\\n       }\\n       else {\\n+        if (opType == OP_NEEDS_UPGRADE)\\n+          ds.setItemProperty(id, \\\"newVersion\\\", null);\\n         this._setOp(id, OP_NEEDS_UNINSTALL);\\n         var type = ds.getItemProperty(id, \\\"type\\\");\\n         var restartRequired = this.installRequiresRestart(id, type);\\n@@ -4681,6 +4683,53 @@ ExtensionManager.prototype = {\\n     this._notifyAction(id, EM_ITEM_UNINSTALLED);\\n   },\\n \\n+  /* See nsIExtensionManager.idl */\\n+  cancelInstallItem: function(id) {\\n+    var ds = this.datasource;\\n+    var opType = ds.getItemProperty(id, \\\"opType\\\");\\n+    if (opType != OP_NEEDS_UPGRADE && opType != OP_NEEDS_INSTALL)\\n+      return;\\n+\\n+    ds.updateDownloadState(PREFIX_ITEM_URI + id, null);\\n+    var installLocation = this.getInstallLocation(id);\\n+    // Removes any staged xpis for this item.\\n+    var stageFile = installLocation.getStageFile(id);\\n+    if (stageFile)\\n+      installLocation.removeFile(stageFile);\\n+    // Addons with an opType of OP_NEEDS_INSTALL only have a staged xpi file\\n+    // and just need to be removed completely from the ds.\\n+    if (opType == OP_NEEDS_INSTALL) {\\n+      ds.removeItemMetadata(id);\\n+      ds.removeItemFromContainer(id);\\n+      ds.updateVisibleList(id, null, true);\\n+      StartupCache.clearEntry(installLocation, id);\\n+      this._updateManifests(false);\\n+      this._notifyAction(id, EM_ITEM_CANCEL);\\n+    }\\n+    else {\\n+      // Clear upgrade information and reset any request to enable/disable.\\n+      ds.setItemProperty(id, EM_R(\\\"newVersion\\\"), null);\\n+      var appDisabled = ds.getItemProperty(id, \\\"appDisabled\\\");\\n+      var userDisabled = ds.getItemProperty(id, \\\"userDisabled\\\");\\n+      if (appDisabled == \\\"true\\\" || appDisabled == OP_NONE && userDisabled == OP_NONE) {\\n+        this._setOp(id, OP_NONE);\\n+        this._notifyAction(id, EM_ITEM_CANCEL);\\n+      }\\n+      else if (appDisabled == OP_NEEDS_DISABLE || userDisabled == OP_NEEDS_DISABLE) {\\n+        this._setOp(id, OP_NEEDS_DISABLE);\\n+        this._notifyAction(id, EM_ITEM_DISABLED);\\n+      }\\n+      else if (appDisabled == OP_NEEDS_ENABLE || userDisabled == OP_NEEDS_ENABLE) {\\n+        this._setOp(id, OP_NEEDS_ENABLE);\\n+        this._notifyAction(id, EM_ITEM_ENABLED);\\n+      }\\n+      else {\\n+        this._setOp(id, OP_NONE);\\n+        this._notifyAction(id, EM_ITEM_CANCEL);\\n+      }\\n+    }\\n+  },\\n+  \\n   /**\\n    * Cancels a pending uninstall of an item\\n    * @param   id\\ndiff --git a/toolkit/themes/pinstripe/mozapps/extensions/extensions.css b/toolkit/themes/pinstripe/mozapps/extensions/extensions.css\\nindex 50d76d4..940f104 100644\\n--- a/toolkit/themes/pinstripe/mozapps/extensions/extensions.css\\n+++ b/toolkit/themes/pinstripe/mozapps/extensions/extensions.css\\n@@ -168,11 +168,15 @@ richlistitem[satisfiesDependencies=\\\"false\\\"] .notifyBadge {\\n \\n .enableHide,\\n .uninstallShow,\\n+.installShow,\\n+.upgradeShow,\\n richlistitem[isDisabled=\\\"true\\\"] .disableHide {\\n   display: none;\\n }\\n \\n richlistitem[opType=\\\"needs-uninstall\\\"] .uninstallShow,\\n+richlistitem[opType=\\\"needs-install\\\"] .installShow,\\n+richlistitem[opType=\\\"needs-upgrade\\\"] .upgradeShow,\\n richlistitem[opType=\\\"needs-enable\\\"] .enableShow,\\n richlistitem[opType=\\\"needs-disable\\\"] .disableShow,\\n richlistitem[isDisabled=\\\"true\\\"] .disableShow {\\n@@ -180,6 +184,8 @@ richlistitem[isDisabled=\\\"true\\\"] .disableShow {\\n }\\n \\n richlistitem[opType=\\\"needs-uninstall\\\"] .uninstallHide,\\n+richlistitem[opType=\\\"needs-install\\\"] .uninstallHide,\\n+richlistitem[opType=\\\"needs-upgrade\\\"] .uninstallHide,\\n richlistitem[opType=\\\"needs-enable\\\"] .enableHide,\\n richlistitem[opType=\\\"needs-disable\\\"] .disableHide {\\n   display: none;\\ndiff --git a/toolkit/themes/winstripe/mozapps/extensions/extensions.css b/toolkit/themes/winstripe/mozapps/extensions/extensions.css\\nindex 2818655..df98c00 100644\\n--- a/toolkit/themes/winstripe/mozapps/extensions/extensions.css\\n+++ b/toolkit/themes/winstripe/mozapps/extensions/extensions.css\\n@@ -237,11 +237,15 @@ richlistitem[satisfiesDependencies=\\\"false\\\"] .notifyBadge {\\n \\n .enableHide,\\n .uninstallShow,\\n+.installShow,\\n+.upgradeShow,\\n richlistitem[isDisabled=\\\"true\\\"] .disableHide {\\n   display: none;\\n }\\n \\n richlistitem[opType=\\\"needs-uninstall\\\"] .uninstallShow,\\n+richlistitem[opType=\\\"needs-install\\\"] .installShow,\\n+richlistitem[opType=\\\"needs-upgrade\\\"] .upgradeShow,\\n richlistitem[opType=\\\"needs-enable\\\"] .enableShow,\\n richlistitem[opType=\\\"needs-disable\\\"] .disableShow,\\n richlistitem[isDisabled=\\\"true\\\"] .disableShow {\\n@@ -249,6 +253,8 @@ richlistitem[isDisabled=\\\"true\\\"] .disableShow {\\n }\\n \\n richlistitem[opType=\\\"needs-uninstall\\\"] .uninstallHide,\\n+richlistitem[opType=\\\"needs-install\\\"] .uninstallHide,\\n+richlistitem[opType=\\\"needs-upgrade\\\"] .uninstallHide,\\n richlistitem[opType=\\\"needs-enable\\\"] .enableHide,\\n richlistitem[opType=\\\"needs-disable\\\"] .disableHide {\\n   display: none;\\n\""}