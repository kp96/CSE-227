{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas1232ee3\""},"diff":"\"1232ee3 Bug 397319 - \\\"Add JSAutoRequest to other users of GetArgvPtr\\\". r+sr+a=jst.\\ndiff --git a/content/canvas/src/nsCanvasRenderingContext2D.cpp b/content/canvas/src/nsCanvasRenderingContext2D.cpp\\nindex 46321bb..e4cbdc1 100644\\n--- a/content/canvas/src/nsCanvasRenderingContext2D.cpp\\n+++ b/content/canvas/src/nsCanvasRenderingContext2D.cpp\\n@@ -2379,6 +2379,8 @@ nsCanvasRenderingContext2D::GetImageData()\\n     ncc->GetArgc(&argc);\\n     ncc->GetArgvPtr(&argv);\\n \\n+    JSAutoRequest ar(ctx);\\n+\\n     int32 x, y, w, h;\\n     if (!JS_ConvertArguments (ctx, argc, argv, \\\"jjjj\\\", &x, &y, &w, &h))\\n         return NS_ERROR_DOM_SYNTAX_ERR;\\n@@ -2495,6 +2497,8 @@ nsCanvasRenderingContext2D::PutImageData()\\n     ncc->GetArgc(&argc);\\n     ncc->GetArgvPtr(&argv);\\n \\n+    JSAutoRequest ar(ctx);\\n+\\n     JSObject *dataObject;\\n     int32 x, y;\\n \\ndiff --git a/content/html/content/src/nsHTMLCanvasElement.cpp b/content/html/content/src/nsHTMLCanvasElement.cpp\\nindex 0dd827f..ef55ba4 100644\\n--- a/content/html/content/src/nsHTMLCanvasElement.cpp\\n+++ b/content/html/content/src/nsHTMLCanvasElement.cpp\\n@@ -317,6 +317,8 @@ nsHTMLCanvasElement::ToDataURL(nsAString& aDataURL)\\n     return ToDataURLImpl(NS_LITERAL_STRING(\\\"image/png\\\"), EmptyString(), aDataURL);\\n   }\\n \\n+  JSAutoRequest ar(ctx);\\n+\\n   // 1-arg case; convert to given mime type\\n   if (argc == 1) {\\n     if (!JSVAL_IS_STRING(argv[0]))\\ndiff --git a/security/manager/ssl/src/nsCrypto.cpp b/security/manager/ssl/src/nsCrypto.cpp\\nindex 4f1cc44..2632c52 100644\\n--- a/security/manager/ssl/src/nsCrypto.cpp\\n+++ b/security/manager/ssl/src/nsCrypto.cpp\\n@@ -1950,6 +1950,7 @@ nsCrypto::GenerateCRMFRequest(nsIDOMCRMFObject** aReturn)\\n   JSObject* script_obj = nsnull;\\n   nsCOMPtr<nsIXPConnectJSObjectHolder> holder;\\n \\n+  JSAutoRequest ar(cx);\\n \\n   /*\\n    * Get all of the parameters.\\n@@ -2663,6 +2664,8 @@ nsCrypto::SignText(const nsAString& aStringToSign, const nsAString& aCaOption,\\n     jsval *argv = nsnull;\\n     ncc->GetArgvPtr(&argv);\\n \\n+    JSAutoRequest ar(cx);\\n+\\n     PRUint32 i;\\n     for (i = 2; i < argc; ++i) {\\n       JSString *caName = JS_ValueToString(cx, argv[i]);\\n\""}