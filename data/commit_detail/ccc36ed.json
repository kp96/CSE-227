{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basccc36ed\""},"diff":"\"ccc36ed Add shutdown code for the macBrowserOverlay so that we remove gSanitizeListener as a pref observer.  b=342600  r=mano\\ndiff --git a/browser/base/content/browser.js b/browser/base/content/browser.js\\nindex acbe220..3445899 100644\\n--- a/browser/base/content/browser.js\\n+++ b/browser/base/content/browser.js\\n@@ -1223,8 +1223,9 @@ function BrowserShutdown()\\n }\\n \\n #ifdef XP_MACOSX\\n-// nonBrowserWindowStartup() and nonBrowserWindowDelayedStartup() are used for\\n-// non-browser windows in macBrowserOverlay\\n+// nonBrowserWindowStartup(), nonBrowserWindowDelayedStartup(), and\\n+// nonBrowserWindowShutdown() are used for non-browser windows in\\n+// macBrowserOverlay\\n function nonBrowserWindowStartup()\\n {\\n   // Disable inappropriate commands / submenus\\n@@ -1273,6 +1274,12 @@ function nonBrowserWindowDelayedStartup()\\n   // Set up Sanitize Item\\n   gSanitizeListener = new SanitizeListener();\\n }\\n+\\n+function nonBrowserWindowShutdown()\\n+{\\n+  if (gSanitizeListener)\\n+    gSanitizeListener.shutdown();\\n+}\\n #endif\\n \\n function AutoHideTabbarPrefListener()\\ndiff --git a/browser/base/content/macBrowserOverlay.xul b/browser/base/content/macBrowserOverlay.xul\\nindex 3d87730..aa80ee0 100644\\n--- a/browser/base/content/macBrowserOverlay.xul\\n+++ b/browser/base/content/macBrowserOverlay.xul\\n@@ -62,6 +62,7 @@\\n \\n <script type=\\\"application/x-javascript\\\">\\n   addEventListener(\\\"load\\\", nonBrowserWindowStartup, false);\\n+  addEventListener(\\\"unload\\\", nonBrowserWindowShutdown, false);\\n </script>\\n \\n # All sets except for popupsets (commands, keys, stringbundles and broadcasters) *must* go into the \\n\""}