{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas1b90d22\""},"diff":"\"1b90d22 Fix old bug where we wouldn't close ts after a compilation error. bug 397136, r+a=brendan\\ndiff --git a/js/src/jsfun.c b/js/src/jsfun.c\\nindex ade1ef4..8f02424 100644\\n--- a/js/src/jsfun.c\\n+++ b/js/src/jsfun.c\\n@@ -2045,8 +2045,9 @@ Function(JSContext *cx, JSObject *obj, uintN argc, jsval *argv, jsval *rval)\\n     if (!ts) {\\n         ok = JS_FALSE;\\n     } else {\\n-        ok = js_CompileFunctionBody(cx, ts, fun) &&\\n-             js_CloseTokenStream(cx, ts);\\n+        /* Note: We must *always* close ts. */\\n+        ok = js_CompileFunctionBody(cx, ts, fun);\\n+        ok &= js_CloseTokenStream(cx, ts);\\n     }\\n     JS_ARENA_RELEASE(&cx->tempPool, mark);\\n     return ok;\\n\""}