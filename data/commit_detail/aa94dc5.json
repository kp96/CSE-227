{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basaa94dc5\""},"diff":"\"aa94dc5 Bug 375805 - ExtensionManager.prototype._shutdown shouldn' t call gOS.removeObserver(this, 'profile-after-change') unless ExtensionManager.prototype.observe(subject, 'app-startup', data) has been called. r=sspitzer\\ndiff --git a/toolkit/mozapps/extensions/src/nsBlocklistService.js b/toolkit/mozapps/extensions/src/nsBlocklistService.js\\nindex 431e8eb..68d7dcb 100644\\n--- a/toolkit/mozapps/extensions/src/nsBlocklistService.js\\n+++ b/toolkit/mozapps/extensions/src/nsBlocklistService.js\\n@@ -83,7 +83,8 @@ var gLoggingEnabled = null;\\n function LOG(string) {\\n   if (gLoggingEnabled) {\\n     dump(\\\"*** \\\" + string + \\\"\\\\n\\\");\\n-    gConsole.logStringMessage(string);\\n+    if (gConsole)\\n+      gConsole.logStringMessage(string);\\n   }\\n }\\n \\n@@ -223,6 +224,7 @@ Blocklist.prototype = {\\n     case \\\"app-startup\\\":\\n       gOS.addObserver(this, \\\"plugins-list-updated\\\", false);\\n       gOS.addObserver(this, \\\"profile-after-change\\\", false);\\n+      gOS.addObserver(this, \\\"quit-application\\\", false);\\n       break;\\n     case \\\"profile-after-change\\\":\\n       gLoggingEnabled = getPref(\\\"getBoolPref\\\", PREF_EM_LOGGING_ENABLED, false);\\n@@ -234,10 +236,12 @@ Blocklist.prototype = {\\n     case \\\"plugins-list-updated\\\":\\n       this._checkPluginsList();\\n       break;\\n+    case \\\"quit-application\\\":\\n+      gOS.removeObserver(this, \\\"plugins-list-updated\\\");\\n+      gOS.removeObserver(this, \\\"profile-after-change\\\");\\n+      gOS.removeObserver(this, \\\"quit-application\\\");\\n     case \\\"xpcom-shutdown\\\":\\n       gOS.removeObserver(this, \\\"xpcom-shutdown\\\");\\n-      gOS.removeObserver(this, \\\"profile-after-change\\\");\\n-      gOS.removeObserver(this, \\\"plugins-list-updated\\\");\\n       gOS = null;\\n       gPref = null;\\n       gConsole = null;\\ndiff --git a/toolkit/mozapps/extensions/src/nsExtensionManager.js.in b/toolkit/mozapps/extensions/src/nsExtensionManager.js.in\\nindex 023a036..eb56a74 100644\\n--- a/toolkit/mozapps/extensions/src/nsExtensionManager.js.in\\n+++ b/toolkit/mozapps/extensions/src/nsExtensionManager.js.in\\n@@ -533,7 +533,8 @@ function removeDirRecursive(dir) {\\n function LOG(string) {\\n   if (gLoggingEnabled) {\\n     dump(\\\"*** \\\" + string + \\\"\\\\n\\\");\\n-    gConsole.logStringMessage(string);\\n+    if (gConsole)\\n+      gConsole.logStringMessage(string);\\n   }\\n }\\n \\n@@ -2409,6 +2410,7 @@ ExtensionManager.prototype = {\\n     switch (topic) {\\n     case \\\"app-startup\\\":\\n       gOS.addObserver(this, \\\"profile-after-change\\\", false);\\n+      gOS.addObserver(this, \\\"quit-application\\\", false);\\n       break;\\n     case \\\"profile-after-change\\\":\\n       this._profileSelected();\\n@@ -2419,6 +2421,9 @@ ExtensionManager.prototype = {\\n     case \\\"offline-requested\\\":\\n       this._confirmCancelDownloadsOnOffline(subject);\\n       break;\\n+    case \\\"quit-application\\\":\\n+      gOS.removeObserver(this, \\\"profile-after-change\\\");\\n+      gOS.removeObserver(this, \\\"quit-application\\\");\\n     case \\\"xpcom-shutdown\\\":\\n       this._shutdown();\\n       break;\\n@@ -2532,7 +2537,6 @@ ExtensionManager.prototype = {\\n    */\\n   _shutdown: function() {\\n     gOS.removeObserver(this, \\\"xpcom-shutdown\\\");\\n-    gOS.removeObserver(this, \\\"profile-after-change\\\");\\n \\n     // Release strongly held services.\\n     gOS = null;\\n\""}