{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basd6e8ce6\""},"diff":"\"d6e8ce6 Fix a few scriptable helpers to correctly communicate NS_SUCCESS_I_DID_SOMETHING.  Bug 396843, r+sr+a=jst\\ndiff --git a/dom/src/base/nsDOMClassInfo.cpp b/dom/src/base/nsDOMClassInfo.cpp\\nindex 0ff7b6a..85f9950 100644\\n--- a/dom/src/base/nsDOMClassInfo.cpp\\n+++ b/dom/src/base/nsDOMClassInfo.cpp\\n@@ -8154,35 +8154,27 @@ nsHTMLDocumentSH::GetProperty(nsIXPConnectWrappedNative *wrapper,\\n                               JSContext *cx, JSObject *obj, jsval id,\\n                               jsval *vp, PRBool *_retval)\\n {\\n-  // nsDocumentSH::GetProperty() does a security check for us, call\\n-  // that first...\\n-  nsresult rv = nsDocumentSH::GetProperty(wrapper, cx, obj, id, vp, _retval);\\n-  if (!*_retval) {\\n-    return rv;\\n-  }\\n-\\n   // For native wrappers, do not get random names on document\\n-  if (ObjectIsNativeWrapper(cx, obj)) {\\n-    return rv;\\n-  }\\n-  \\n-  nsCOMPtr<nsISupports> result;\\n+  if (!ObjectIsNativeWrapper(cx, obj)) {\\n+    nsCOMPtr<nsISupports> result;\\n \\n-  JSAutoRequest ar(cx);\\n+    JSAutoRequest ar(cx);\\n \\n-  rv = ResolveImpl(cx, wrapper, id, getter_AddRefs(result));\\n-  NS_ENSURE_SUCCESS(rv, rv);\\n+    nsresult rv = ResolveImpl(cx, wrapper, id, getter_AddRefs(result));\\n+    NS_ENSURE_SUCCESS(rv, rv);\\n \\n-  if (result) {\\n-    nsCOMPtr<nsIXPConnectJSObjectHolder> holder;\\n-    rv = WrapNative(cx, obj, result, NS_GET_IID(nsISupports), vp,\\n-                    getter_AddRefs(holder));\\n-    if (NS_SUCCEEDED(rv)) {\\n-      rv = NS_SUCCESS_I_DID_SOMETHING;\\n+    if (result) {\\n+      nsCOMPtr<nsIXPConnectJSObjectHolder> holder;\\n+      rv = WrapNative(cx, obj, result, NS_GET_IID(nsISupports), vp,\\n+                      getter_AddRefs(holder));\\n+      if (NS_SUCCEEDED(rv)) {\\n+        rv = NS_SUCCESS_I_DID_SOMETHING;\\n+      }\\n+      return rv;\\n     }\\n   }\\n \\n-  return rv;\\n+  return nsDocumentSH::GetProperty(wrapper, cx, obj, id, vp, _retval);\\n }\\n \\n // HTMLElement helper\\n@@ -8322,25 +8314,23 @@ nsHTMLFormElementSH::GetProperty(nsIXPConnectWrappedNative *wrapper,\\n         return NS_FAILED(rv) ? rv : NS_SUCCESS_I_DID_SOMETHING;\\n       }\\n     }\\n+  } else {\\n+    PRInt32 n = GetArrayIndexFromId(cx, id);\\n \\n-    return NS_OK; // Don't fall through\\n-  }\\n-\\n-  PRInt32 n = GetArrayIndexFromId(cx, id);\\n-\\n-  if (n >= 0) {\\n-    nsCOMPtr<nsIFormControl> control;\\n-    form->GetElementAt(n, getter_AddRefs(control));\\n+    if (n >= 0) {\\n+      nsCOMPtr<nsIFormControl> control;\\n+      form->GetElementAt(n, getter_AddRefs(control));\\n \\n-    if (control) {\\n-      nsCOMPtr<nsIXPConnectJSObjectHolder> holder;\\n-      nsresult rv = WrapNative(cx, obj, control, NS_GET_IID(nsISupports), vp,\\n-                               getter_AddRefs(holder));\\n-      return NS_FAILED(rv) ? rv : NS_SUCCESS_I_DID_SOMETHING;\\n+      if (control) {\\n+        nsCOMPtr<nsIXPConnectJSObjectHolder> holder;\\n+        nsresult rv = WrapNative(cx, obj, control, NS_GET_IID(nsISupports), vp,\\n+                                 getter_AddRefs(holder));\\n+        return NS_FAILED(rv) ? rv : NS_SUCCESS_I_DID_SOMETHING;\\n+      }\\n     }\\n   }\\n \\n-  return NS_OK;\\n+  return nsHTMLElementSH::GetProperty(wrapper, cx, obj, id, vp, _retval);;\\n }\\n \\n NS_IMETHODIMP\\n@@ -8449,10 +8439,11 @@ nsHTMLSelectElementSH::GetProperty(nsIXPConnectWrappedNative *wrapper,\\n       if (NS_SUCCEEDED(rv)) {\\n         rv = NS_SUCCESS_I_DID_SOMETHING;\\n       }\\n+      return rv;\\n     }\\n   }\\n \\n-  return rv;\\n+  return nsHTMLElementSH::GetProperty(wrapper, cx, obj, id, vp, _retval);;\\n }\\n \\n // static\\n@@ -8734,7 +8725,7 @@ nsHTMLPluginObjElementSH::GetProperty(nsIXPConnectWrappedNative *wrapper,\\n     return *_retval ? NS_SUCCESS_I_DID_SOMETHING : NS_ERROR_FAILURE;\\n   }\\n \\n-  return NS_OK;\\n+  return nsHTMLElementSH::GetProperty(wrapper, cx, obj, id, vp, _retval);;\\n }\\n \\n NS_IMETHODIMP\\ndiff --git a/dom/tests/mochitest/bugs/Makefile.in b/dom/tests/mochitest/bugs/Makefile.in\\nindex e70aca2..ae72002 100644\\n--- a/dom/tests/mochitest/bugs/Makefile.in\\n+++ b/dom/tests/mochitest/bugs/Makefile.in\\n@@ -57,6 +57,7 @@ _TEST_FILES\\t= \\\\\\n \\t\\ttest_bug377539.html \\\\\\n \\t\\ttest_bug384122.html \\\\\\n \\t\\ttest_bug393974.html \\\\\\n+\\t\\ttest_bug396843.html \\\\\\n \\t\\t$(NULL)\\n \\n libs:: \\t$(_TEST_FILES)\\ndiff --git a/dom/tests/mochitest/bugs/test_bug396843.html b/dom/tests/mochitest/bugs/test_bug396843.html\\nnew file mode 100644\\nindex 0000000..98301c6\\n--- /dev/null\\n+++ b/dom/tests/mochitest/bugs/test_bug396843.html\\n@@ -0,0 +1,302 @@\\n+<!DOCTYPE HTML>\\n+<html>\\n+<!--\\n+https://bugzilla.mozilla.org/show_bug.cgi?id=396843\\n+-->\\n+<head>\\n+  <title>Test for Bug 396843</title>\\n+  <script type=\\\"text/javascript\\\" src=\\\"/MochiKit/MochiKit.js\\\"></script>\\n+  <script type=\\\"text/javascript\\\" src=\\\"/tests/SimpleTest/SimpleTest.js\\\"></script>\\n+  <link rel=\\\"stylesheet\\\" type=\\\"text/css\\\" href=\\\"/tests/SimpleTest/test.css\\\" />\\n+</head>\\n+<body>\\n+<a target=\\\"_blank\\\" href=\\\"https://bugzilla.mozilla.org/show_bug.cgi?id=396843\\\">Mozilla Bug 396843</a>\\n+<p id=\\\"display\\\">\\n+  <iframe src=\\\"http://example.org:80/\\\" id=\\\"t\\\"></iframe>\\n+</p>\\n+<div id=\\\"content\\\" style=\\\"display: none\\\">\\n+  \\n+</div>\\n+<pre id=\\\"test\\\">\\n+<script class=\\\"testbody\\\" type=\\\"text/javascript\\\">\\n+\\n+/** Test for Bug 396843 **/\\n+SimpleTest.waitForExplicitFinish();\\n+\\n+var allNodes = [];\\n+var XMLNodes = [];\\n+var failNodes = [];\\n+\\n+// HTML\\n+function HTML_TAG(name) {\\n+  allNodes.push(document.createElement(name));\\n+}\\n+\\n+/* List copy/pasted from nsHTMLTagList.h */\\n+HTML_TAG(\\\"a\\\", \\\"Anchor\\\")\\n+HTML_TAG(\\\"abbr\\\", \\\"Span\\\")\\n+HTML_TAG(\\\"acronym\\\", \\\"Span\\\")\\n+HTML_TAG(\\\"address\\\", \\\"Span\\\")\\n+HTML_TAG(\\\"applet\\\", \\\"SharedObject\\\")\\n+HTML_TAG(\\\"area\\\", \\\"Area\\\")\\n+HTML_TAG(\\\"b\\\", \\\"Span\\\")\\n+HTML_TAG(\\\"base\\\", \\\"Shared\\\")\\n+HTML_TAG(\\\"basefont\\\", \\\"Shared\\\")\\n+HTML_TAG(\\\"bdo\\\", \\\"Span\\\")\\n+HTML_TAG(\\\"bgsound\\\", \\\"Span\\\")\\n+HTML_TAG(\\\"big\\\", \\\"Span\\\")\\n+HTML_TAG(\\\"blink\\\", \\\"Span\\\")\\n+HTML_TAG(\\\"blockquote\\\", \\\"Shared\\\")\\n+HTML_TAG(\\\"body\\\", \\\"Body\\\")\\n+HTML_TAG(\\\"br\\\", \\\"BR\\\")\\n+HTML_TAG(\\\"button\\\", \\\"Button\\\")\\n+HTML_TAG(\\\"canvas\\\", \\\"Canvas\\\")\\n+HTML_TAG(\\\"caption\\\", \\\"TableCaption\\\")\\n+HTML_TAG(\\\"center\\\", \\\"Span\\\")\\n+HTML_TAG(\\\"cite\\\", \\\"Span\\\")\\n+HTML_TAG(\\\"code\\\", \\\"Span\\\")\\n+HTML_TAG(\\\"col\\\", \\\"TableCol\\\")\\n+HTML_TAG(\\\"colgroup\\\", \\\"TableCol\\\")\\n+HTML_TAG(\\\"dd\\\", \\\"Span\\\")\\n+HTML_TAG(\\\"del\\\", \\\"Mod\\\")\\n+HTML_TAG(\\\"dfn\\\", \\\"Span\\\")\\n+HTML_TAG(\\\"dir\\\", \\\"Shared\\\")\\n+HTML_TAG(\\\"div\\\", \\\"Div\\\")\\n+HTML_TAG(\\\"dl\\\", \\\"SharedList\\\")\\n+HTML_TAG(\\\"dt\\\", \\\"Span\\\")\\n+HTML_TAG(\\\"em\\\", \\\"Span\\\")\\n+HTML_TAG(\\\"embed\\\", \\\"SharedObject\\\")\\n+HTML_TAG(\\\"fieldset\\\", \\\"FieldSet\\\")\\n+HTML_TAG(\\\"font\\\", \\\"Font\\\")\\n+HTML_TAG(\\\"form\\\", \\\"Form\\\")\\n+HTML_TAG(\\\"frame\\\", \\\"Frame\\\")\\n+HTML_TAG(\\\"frameset\\\", \\\"FrameSet\\\")\\n+HTML_TAG(\\\"h1\\\", \\\"Heading\\\")\\n+HTML_TAG(\\\"h2\\\", \\\"Heading\\\")\\n+HTML_TAG(\\\"h3\\\", \\\"Heading\\\")\\n+HTML_TAG(\\\"h4\\\", \\\"Heading\\\")\\n+HTML_TAG(\\\"h5\\\", \\\"Heading\\\")\\n+HTML_TAG(\\\"h6\\\", \\\"Heading\\\")\\n+HTML_TAG(\\\"head\\\", \\\"Head\\\")\\n+HTML_TAG(\\\"hr\\\", \\\"HR\\\")\\n+HTML_TAG(\\\"html\\\", \\\"Html\\\")\\n+HTML_TAG(\\\"i\\\", \\\"Span\\\")\\n+HTML_TAG(\\\"iframe\\\", \\\"IFrame\\\")\\n+HTML_TAG(\\\"image\\\", \\\"Span\\\")\\n+HTML_TAG(\\\"img\\\", \\\"Image\\\")\\n+HTML_TAG(\\\"input\\\", \\\"Input\\\")\\n+HTML_TAG(\\\"ins\\\", \\\"Mod\\\")\\n+HTML_TAG(\\\"isindex\\\", \\\"Shared\\\")\\n+HTML_TAG(\\\"kbd\\\", \\\"Span\\\")\\n+HTML_TAG(\\\"keygen\\\", \\\"Span\\\")\\n+HTML_TAG(\\\"label\\\", \\\"Label\\\")\\n+HTML_TAG(\\\"legend\\\", \\\"Legend\\\")\\n+HTML_TAG(\\\"li\\\", \\\"LI\\\")\\n+HTML_TAG(\\\"link\\\", \\\"Link\\\")\\n+HTML_TAG(\\\"listing\\\", \\\"Span\\\")\\n+HTML_TAG(\\\"map\\\", \\\"Map\\\")\\n+HTML_TAG(\\\"marquee\\\", \\\"Div\\\")\\n+HTML_TAG(\\\"menu\\\", \\\"Shared\\\")\\n+HTML_TAG(\\\"meta\\\", \\\"Meta\\\")\\n+HTML_TAG(\\\"multicol\\\", \\\"Span\\\")\\n+HTML_TAG(\\\"nobr\\\", \\\"Span\\\")\\n+HTML_TAG(\\\"noembed\\\", \\\"Div\\\")\\n+HTML_TAG(\\\"noframes\\\", \\\"Div\\\")\\n+HTML_TAG(\\\"noscript\\\", \\\"Div\\\")\\n+HTML_TAG(\\\"object\\\", \\\"Object\\\")\\n+HTML_TAG(\\\"ol\\\", \\\"SharedList\\\")\\n+HTML_TAG(\\\"optgroup\\\", \\\"OptGroup\\\")\\n+HTML_TAG(\\\"option\\\", \\\"Option\\\")\\n+HTML_TAG(\\\"p\\\", \\\"Paragraph\\\")\\n+HTML_TAG(\\\"param\\\", \\\"Shared\\\")\\n+HTML_TAG(\\\"plaintext\\\", \\\"Span\\\")\\n+HTML_TAG(\\\"pre\\\", \\\"Pre\\\")\\n+HTML_TAG(\\\"q\\\", \\\"Shared\\\")\\n+HTML_TAG(\\\"s\\\", \\\"Span\\\")\\n+HTML_TAG(\\\"samp\\\", \\\"Span\\\")\\n+HTML_TAG(\\\"script\\\", \\\"Script\\\")\\n+HTML_TAG(\\\"select\\\", \\\"Select\\\")\\n+HTML_TAG(\\\"small\\\", \\\"Span\\\")\\n+HTML_TAG(\\\"spacer\\\", \\\"Shared\\\")\\n+HTML_TAG(\\\"span\\\", \\\"Span\\\")\\n+HTML_TAG(\\\"strike\\\", \\\"Span\\\")\\n+HTML_TAG(\\\"strong\\\", \\\"Span\\\")\\n+HTML_TAG(\\\"style\\\", \\\"Style\\\")\\n+HTML_TAG(\\\"sub\\\", \\\"Span\\\")\\n+HTML_TAG(\\\"sup\\\", \\\"Span\\\")\\n+HTML_TAG(\\\"table\\\", \\\"Table\\\")\\n+HTML_TAG(\\\"tbody\\\", \\\"TableSection\\\")\\n+HTML_TAG(\\\"td\\\", \\\"TableCell\\\")\\n+HTML_TAG(\\\"textarea\\\", \\\"TextArea\\\")\\n+HTML_TAG(\\\"tfoot\\\", \\\"TableSection\\\")\\n+HTML_TAG(\\\"th\\\", \\\"TableCell\\\")\\n+HTML_TAG(\\\"thead\\\", \\\"TableSection\\\")\\n+HTML_TAG(\\\"title\\\", \\\"Title\\\")\\n+HTML_TAG(\\\"tr\\\", \\\"TableRow\\\")\\n+HTML_TAG(\\\"tt\\\", \\\"Span\\\")\\n+HTML_TAG(\\\"u\\\", \\\"Span\\\")\\n+HTML_TAG(\\\"ul\\\", \\\"SharedList\\\")\\n+HTML_TAG(\\\"var\\\", \\\"Span\\\")\\n+HTML_TAG(\\\"wbr\\\", \\\"Shared\\\")\\n+HTML_TAG(\\\"xmp\\\", \\\"Span\\\")\\n+\\n+function SVG_TAG(name) {\\n+  allNodes.push(document.createElementNS(\\\"http://www.w3.org/2000/svg\\\", \\\"svg\\\"));\\n+}\\n+\\n+// List sorta stolen from SVG element factory.\\n+SVG_TAG(\\\"a\\\")\\n+SVG_TAG(\\\"polyline\\\")\\n+SVG_TAG(\\\"polygon\\\")\\n+SVG_TAG(\\\"circle\\\")\\n+SVG_TAG(\\\"ellipse\\\")\\n+SVG_TAG(\\\"line\\\")\\n+SVG_TAG(\\\"rect\\\")\\n+SVG_TAG(\\\"svg\\\")\\n+SVG_TAG(\\\"g\\\")\\n+SVG_TAG(\\\"foreignObject\\\")\\n+SVG_TAG(\\\"path\\\")\\n+SVG_TAG(\\\"text\\\")\\n+SVG_TAG(\\\"tspan\\\")\\n+SVG_TAG(\\\"image\\\")\\n+SVG_TAG(\\\"style\\\")\\n+SVG_TAG(\\\"linearGradient\\\")\\n+SVG_TAG(\\\"metadata\\\")\\n+SVG_TAG(\\\"radialGradient\\\")\\n+SVG_TAG(\\\"stop\\\")\\n+SVG_TAG(\\\"defs\\\")\\n+SVG_TAG(\\\"desc\\\")\\n+SVG_TAG(\\\"script\\\")\\n+SVG_TAG(\\\"use\\\")\\n+SVG_TAG(\\\"symbol\\\")\\n+SVG_TAG(\\\"marker\\\")\\n+SVG_TAG(\\\"title\\\")\\n+SVG_TAG(\\\"clipPath\\\")\\n+SVG_TAG(\\\"textPath\\\")\\n+SVG_TAG(\\\"filter\\\")\\n+SVG_TAG(\\\"feBlend\\\")\\n+SVG_TAG(\\\"feColorMatrix\\\")\\n+SVG_TAG(\\\"feComponentTransfer\\\")\\n+SVG_TAG(\\\"feComposite\\\")\\n+SVG_TAG(\\\"feFuncR\\\")\\n+SVG_TAG(\\\"feFuncG\\\")\\n+SVG_TAG(\\\"feFuncB\\\")\\n+SVG_TAG(\\\"feFuncA\\\")\\n+SVG_TAG(\\\"feGaussianBlur\\\")\\n+SVG_TAG(\\\"feMerge\\\")\\n+SVG_TAG(\\\"feMergeNode\\\")\\n+SVG_TAG(\\\"feMorphology\\\")\\n+SVG_TAG(\\\"feOffset\\\")\\n+SVG_TAG(\\\"feFlood\\\")\\n+SVG_TAG(\\\"feTile\\\")\\n+SVG_TAG(\\\"feTurbulence\\\")\\n+SVG_TAG(\\\"feConvolveMatrix\\\")\\n+SVG_TAG(\\\"feDistantLight\\\")\\n+SVG_TAG(\\\"fePointLight\\\")\\n+SVG_TAG(\\\"feSpotLight\\\")\\n+SVG_TAG(\\\"feDiffuseLighting\\\")\\n+SVG_TAG(\\\"feSpecularLighting\\\")\\n+SVG_TAG(\\\"feDisplacementMap\\\")\\n+SVG_TAG(\\\"feImage\\\")\\n+SVG_TAG(\\\"pattern\\\")\\n+SVG_TAG(\\\"mask\\\")\\n+SVG_TAG(\\\"svgSwitch\\\")\\n+\\n+// Toss in some other namespaced stuff too, for good measure\\n+allNodes.push(document.createElementNS(\\n+               \\\"http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul\\\",\\n+               \\\"window\\\"));\\n+allNodes.push(document.createElementNS(\\\"http://www.w3.org/1998/Math/MathML\\\",\\n+                                       \\\"math\\\"));\\n+allNodes.push(document.createElementNS(\\\"http://www.w3.org/2001/xml-events\\\",\\n+                                       \\\"testname\\\"));\\n+allNodes.push(document.createElementNS(\\\"bogus.namespace\\\", \\\"testname\\\"));\\n+\\n+var XMLDoc = document.implementation.createDocument(\\\"\\\", \\\"\\\", null);\\n+\\n+// And non-elements\\n+allNodes.push(document.createTextNode(\\\"some text\\\"));\\n+allNodes.push(document.createComment(\\\"some text\\\"));\\n+XMLNodes.push(XMLDoc.createCDATASection(\\\"some text\\\"));\\n+failNodes.push(document.createDocumentFragment());\\n+XMLNodes.push(XMLDoc.createProcessingInstruction(\\\"PI\\\", \\\"data\\\"));\\n+               \\n+function runTest() {\\n+  ok(document.nodePrincipal === undefined, \\\"Must not have document principal\\\");\\n+  ok(document.baseURIObject === undefined, \\\"Must not have document base URI\\\");\\n+  ok(document.documentURIObject === undefined, \\\"Must have document URI\\\");\\n+\\n+  for (var i = 0; i < allNodes.length; ++i) {\\n+    ok(allNodes[i].nodePrincipal === undefined,\\n+       \\\"Unexpected principal appears for \\\" + allNodes[i].nodeName);\\n+    ok(allNodes[i].baseURIObject === undefined,\\n+       \\\"Unexpected base URI appears for \\\" + allNodes[i].nodeName);\\n+  }\\n+}\\n+\\n+function runTest2() {\\n+  netscape.security.PrivilegeManager.enablePrivilege(\\\"UniversalXPConnect\\\");\\n+  isnot(document.nodePrincipal, null, \\\"Must have document principal\\\");\\n+  is(document.nodePrincipal instanceof Components.interfaces.nsIPrincipal,\\n+     true, \\\"document principal must be a principal\\\");\\n+  isnot(document.baseURIObject, null, \\\"Must have document base URI\\\");\\n+  is(document.baseURIObject instanceof Components.interfaces.nsIURI,\\n+     true, \\\"document base URI must be a URI\\\");\\n+  isnot(document.documentURIObject, null, \\\"Must have document URI\\\");\\n+  is(document.documentURIObject instanceof Components.interfaces.nsIURI,\\n+     true, \\\"document URI must be a URI\\\");\\n+  is(document.documentURIObject.spec, document.documentURI,\\n+     \\\"document URI must be the right URI\\\");\\n+     \\n+  for (var i = 0; i < allNodes.length; ++i) {\\n+    is(allNodes[i].nodePrincipal, document.nodePrincipal,\\n+       \\\"Unexpected principal for \\\" + allNodes[i].nodeName);\\n+    is(allNodes[i].baseURIObject, document.baseURIObject,\\n+       \\\"Unexpected base URI for \\\" + allNodes[i].nodeName);\\n+  }\\n+\\n+  for (i = 0; i < XMLNodes.length; ++i) {\\n+    is(XMLNodes[i].nodePrincipal, document.nodePrincipal,\\n+       \\\"Unexpected principal for \\\" + XMLNodes[i].nodeName);\\n+    is(XMLNodes[i].baseURIObject.spec, \\\"about:blank\\\",\\n+       \\\"Unexpected base URI for \\\" + XMLNodes[i].nodeName);\\n+  }\\n+\\n+  for (i = 0; i < failNodes.length; ++i) {\\n+    todo(failNodes[i].nodePrincipal == document.nodePrincipal,\\n+       \\\"Unexpected principal for \\\" + failNodes[i].nodeName);\\n+    todo(failNodes[i].baseURIObject == document.baseURIObject,\\n+       \\\"Unexpected base URI for \\\" + failNodes[i].nodeName);\\n+  }\\n+\\n+  var doc = $(\\\"t\\\").contentDocument;\\n+  try {\\n+    is(doc instanceof $(\\\"t\\\").contentWindow.HTMLDocument, true,\\n+      \\\"Expected an HTMLDocument here\\\");\\n+    todo(1, \\\"Someone fixed bug 396849; need to update this code\\\");\\n+  } catch (e) {\\n+    todo(0, \\\"Running into bug 396849\\\");\\n+  }\\n+  isnot(doc.nodePrincipal, null, \\\"Must have doc principal\\\");\\n+  is(doc.nodePrincipal instanceof Components.interfaces.nsIPrincipal,\\n+     true, \\\"doc principal must be a principal\\\");\\n+  isnot(doc.baseURIObject, null, \\\"Must have doc base URI\\\");\\n+  is(doc.baseURIObject instanceof Components.interfaces.nsIURI,\\n+     true, \\\"doc base URI must be a URI\\\");\\n+  isnot(doc.documentURIObject, null, \\\"Must have doc URI\\\");\\n+  is(doc.documentURIObject instanceof Components.interfaces.nsIURI,\\n+     true, \\\"doc URI must be a URI\\\");\\n+  is(doc.documentURIObject.spec, doc.documentURI,\\n+     \\\"doc URI must be the right URI\\\");\\n+}\\n+\\n+addLoadEvent(runTest);\\n+addLoadEvent(runTest2);\\n+addLoadEvent(runTest);\\n+addLoadEvent(SimpleTest.finish);\\n+\\n+</script>\\n+</pre>\\n+</body>\\n+</html>\\n+\\n\""}