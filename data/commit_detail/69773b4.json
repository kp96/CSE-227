{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas69773b4\""},"diff":"\"69773b4 Bug 389056 Don't break line between periods and quote, the additional patch r+sr+a=roc\\ndiff --git a/intl/lwbrk/src/jisx4501class.h b/intl/lwbrk/src/jisx4501class.h\\nindex e3032db..5f64838 100644\\n--- a/intl/lwbrk/src/jisx4501class.h\\n+++ b/intl/lwbrk/src/jisx4501class.h\\n@@ -46,7 +46,7 @@ static const PRUint32 gLBClass00[32] = {\\n 0x7AABAAA5, // U+0020 - U+0027\\n 0x7A7AAAA9, // U+0028 - U+002F\\n 0x66666666, // U+0030 - U+0037\\n-0x1AA9AA66, // U+0038 - U+003F\\n+0xAAA9AA66, // U+0038 - U+003F\\n 0x77777777, // U+0040 - U+0047\\n 0x77777777, // U+0048 - U+004F\\n 0x77777777, // U+0050 - U+0057\\n@@ -76,9 +76,9 @@ static const PRUint32 gLBClass00[32] = {\\n static const PRUint32 gLBClass20[32] = {\\n 0xB5555555, // U+2000 - U+2007\\n 0x77775555, // U+2008 - U+200F\\n-0x777211B1, // U+2010 - U+2017\\n+0x777277B7, // U+2010 - U+2017\\n 0x77777777, // U+2018 - U+201F\\n-0xA2227777, // U+2020 - U+2027\\n+0xAAAA7777, // U+2020 - U+2027\\n 0xB7777777, // U+2028 - U+202F\\n 0x77744444, // U+2030 - U+2037\\n 0x7A115107, // U+2038 - U+203F\\ndiff --git a/intl/lwbrk/src/nsJISx4501LineBreaker.cpp b/intl/lwbrk/src/nsJISx4501LineBreaker.cpp\\nindex b1fd3ea6..1e279da 100644\\n--- a/intl/lwbrk/src/nsJISx4501LineBreaker.cpp\\n+++ b/intl/lwbrk/src/nsJISx4501LineBreaker.cpp\\n@@ -382,12 +382,14 @@ static const PRUint16 gPairConservative[MAX_CLASSES] = {\\n #define U_EQUAL     PRUnichar('=')\\n #define U_PERCENT   PRUnichar('%')\\n #define U_AMPERSAND PRUnichar('&')\\n+#define U_SEMICOLON PRUnichar(';')\\n #define U_BACKSLASH PRUnichar('\\\\\\\\')\\n \\n #define NEED_CONTEXTUAL_ANALYSIS(c) (IS_HYPHEN(c) || \\\\\\n                                      (c) == U_SLASH || \\\\\\n                                      (c) == U_PERCENT || \\\\\\n                                      (c) == U_AMPERSAND || \\\\\\n+                                     (c) == U_SEMICOLON || \\\\\\n                                      (c) == U_BACKSLASH)\\n \\n #define IS_ASCII_DIGIT(u) (0x0030 <= (u) && (u) <= 0x0039)\\n@@ -431,7 +433,8 @@ IS_HYPHEN(PRUnichar u)\\n   return (u == U_HYPHEN ||\\n           u == 0x058A || // ARMENIAN HYPHEN\\n           u == 0x2010 || // HYPHEN\\n-          u == 0x2012);  // FIGURE DASH\\n+          u == 0x2012 || // FIGURE DASH\\n+          u == 0x2013);  // EN DASH\\n }\\n \\n static PRInt8\\n@@ -608,11 +611,9 @@ public:\\n     // is near it.\\n \\n     // Note that index is always larger than CONSERVATIVE_BREAK_RANGE here.\\n-    for (PRUint32 i = index - 1; index - CONSERVATIVE_BREAK_RANGE < i; --i) {\\n-      if (IS_NONBREAKABLE_SPACE(GetCharAt(i)))\\n+    for (PRUint32 i = index; index - CONSERVATIVE_BREAK_RANGE < i; --i) {\\n+      if (IS_NONBREAKABLE_SPACE(GetCharAt(i - 1)))\\n         return PR_TRUE;\\n-      if (i == 0)\\n-        break;\\n     }\\n     // Note that index is always less than mLength - CONSERVATIVE_BREAK_RANGE.\\n     for (PRUint32 i = index + 1; i < index + CONSERVATIVE_BREAK_RANGE; ++i) {\\n@@ -624,13 +625,9 @@ public:\\n \\n   PRBool HasCharacterAlready(PRUnichar aCh) {\\n     // Be careful for the index being unsigned.\\n-    if (mIndex == 0)\\n-      return PR_FALSE;\\n-    for (PRUint32 i = mIndex - 1; 0 < i; --i) {\\n-      if (GetCharAt(i) == aCh)\\n+    for (PRUint32 i = mIndex; i > 0; --i) {\\n+      if (GetCharAt(i - 1) == aCh)\\n         return PR_TRUE;\\n-      if (i == 0)\\n-        break;\\n     }\\n     return PR_FALSE;\\n   }\\n@@ -639,14 +636,10 @@ public:\\n     NS_ASSERTION(IS_HYPHEN(GetCharAt(mIndex)),\\n                  \\\"current character isn't hyphen\\\");\\n     // Be careful for the index being unsigned.\\n-    if (mIndex == 0)\\n-      return PR_FALSE;\\n-    for (PRUint32 i = mIndex - 1; 0 < i; --i) {\\n-      PRUnichar ch = GetCharAt(i);\\n+    for (PRUint32 i = mIndex; i > 0; --i) {\\n+      PRUnichar ch = GetCharAt(i - 1);\\n       if (!IS_HYPHEN(ch))\\n         return ch;\\n-      if (i == 0)\\n-        break;\\n     }\\n     return U_NULL;\\n   }\\n@@ -725,7 +718,7 @@ ContextualAnalysis(PRUnichar prev, PRUnichar cur, PRUnichar next,\\n           aState.GetCharAt(aState.Index() + 3) == U_PERCENT)\\n         return CLASS_OPEN;\\n     }\\n-  } else if (cur == U_AMPERSAND) {\\n+  } else if (cur == U_AMPERSAND || cur == U_SEMICOLON) {\\n     // If this may be a separator of params of URL, we should break after.\\n     if (!aState.UseConservativeBreaking(1) &&\\n         aState.HasCharacterAlready(U_EQUAL))\\ndiff --git a/intl/lwbrk/tools/anzx4501.html b/intl/lwbrk/tools/anzx4501.html\\nindex 44da8ee..9e5f900 100644\\n--- a/intl/lwbrk/tools/anzx4501.html\\n+++ b/intl/lwbrk/tools/anzx4501.html\\n@@ -92,10 +92,10 @@ Analysis of JIS X 4051 to Unicode General Category Mapping\\n <TD>31</TD>\\n <TD>2</TD>\\n <TD></TD>\\n-<TD>28</TD>\\n+<TD>24</TD>\\n <TD>3</TD>\\n <TD></TD>\\n-<TD BGCOLOR=white>64</TD>\\n+<TD BGCOLOR=white>60</TD>\\n <TD></TD>\\n <TD></TD>\\n <TD></TD>\\n@@ -112,11 +112,11 @@ Analysis of JIS X 4051 to Unicode General Category Mapping\\n <TD></TD>\\n <TD></TD>\\n <TD></TD>\\n-<TD>4</TD>\\n+<TD>1</TD>\\n <TD>12</TD>\\n <TD>1</TD>\\n <TD></TD>\\n-<TD>11</TD>\\n+<TD>10</TD>\\n <TD></TD>\\n <TD></TD>\\n <TD>2</TD>\\n@@ -131,10 +131,10 @@ Analysis of JIS X 4051 to Unicode General Category Mapping\\n <TD></TD>\\n <TD></TD>\\n <TD></TD>\\n-<TD>4</TD>\\n+<TD>1</TD>\\n <TD></TD>\\n <TD></TD>\\n-<TD BGCOLOR=white>4</TD>\\n+<TD BGCOLOR=white>1</TD>\\n <TD></TD>\\n <TD></TD>\\n <TD></TD>\\n@@ -155,7 +155,7 @@ Analysis of JIS X 4051 to Unicode General Category Mapping\\n <TD></TD>\\n <TD></TD>\\n <TD></TD>\\n-<TD>3</TD>\\n+<TD></TD>\\n <TD></TD>\\n <TD></TD>\\n <TD></TD>\\n@@ -326,10 +326,10 @@ Analysis of JIS X 4051 to Unicode General Category Mapping\\n <TD>157</TD>\\n <TD></TD>\\n <TD>33</TD>\\n-<TD>54</TD>\\n+<TD>57</TD>\\n <TD>125</TD>\\n <TD>3</TD>\\n-<TD BGCOLOR=white>391</TD>\\n+<TD BGCOLOR=white>394</TD>\\n <TD></TD>\\n <TD>19</TD>\\n <TD></TD>\\n@@ -346,7 +346,7 @@ Analysis of JIS X 4051 to Unicode General Category Mapping\\n <TD>3</TD>\\n <TD>30</TD>\\n <TD>4</TD>\\n-<TD>2</TD>\\n+<TD>5</TD>\\n <TD>2</TD>\\n <TD>2</TD>\\n <TD>4</TD>\\n@@ -443,10 +443,10 @@ Analysis of JIS X 4051 to Unicode General Category Mapping\\n <TD>2</TD>\\n <TD></TD>\\n <TD>6</TD>\\n-<TD>21</TD>\\n+<TD>25</TD>\\n <TD>16</TD>\\n <TD></TD>\\n-<TD BGCOLOR=white>46</TD>\\n+<TD BGCOLOR=white>50</TD>\\n <TD></TD>\\n <TD>1</TD>\\n <TD></TD>\\n@@ -467,7 +467,7 @@ Analysis of JIS X 4051 to Unicode General Category Mapping\\n <TD>3</TD>\\n <TD>1</TD>\\n <TD>1</TD>\\n-<TD>16</TD>\\n+<TD>20</TD>\\n <TD></TD>\\n <TD>2</TD>\\n <TD>3</TD>\\n@@ -574,7 +574,7 @@ Analysis of JIS X 4051 to Unicode General Category Mapping\\n </TR>\\n <TR><TH>00<TH>\\n <TD></TD>\\n-<TD>1</TD>\\n+<TD></TD>\\n <TD></TD>\\n <TD></TD>\\n <TD></TD>\\n@@ -583,7 +583,7 @@ Analysis of JIS X 4051 to Unicode General Category Mapping\\n <TD>126</TD>\\n <TD></TD>\\n <TD>7</TD>\\n-<TD>44</TD>\\n+<TD>45</TD>\\n <TD>2</TD>\\n <TD></TD>\\n </TR>\\n@@ -604,16 +604,16 @@ Analysis of JIS X 4051 to Unicode General Category Mapping\\n </TR>\\n <TR><TH>20<TH>\\n <TD>2</TD>\\n-<TD>11</TD>\\n-<TD>4</TD>\\n+<TD>8</TD>\\n+<TD>1</TD>\\n <TD></TD>\\n <TD>5</TD>\\n <TD>12</TD>\\n <TD></TD>\\n-<TD>101</TD>\\n+<TD>104</TD>\\n <TD></TD>\\n <TD></TD>\\n-<TD>2</TD>\\n+<TD>5</TD>\\n <TD>3</TD>\\n <TD></TD>\\n </TR>\\ndiff --git a/intl/lwbrk/tools/jisx4501class.txt b/intl/lwbrk/tools/jisx4501class.txt\\nindex 81e1c29..ac1e19b 100644\\n--- a/intl/lwbrk/tools/jisx4501class.txt\\n+++ b/intl/lwbrk/tools/jisx4501class.txt\\n@@ -8,7 +8,6 @@\\n 0021;002F;23\\n 0030;0039;15\\n 003C;;22\\n-003F;;4\\n 003A;003F;23\\n 0040;;18\\n 0041;005A;18\\n@@ -44,15 +43,15 @@\\n 2007;;24\\n 2000;200B;17\\n 200C;200F;18\\n-2010;;2\\n+2010;;18\\n 2011;;24\\n-2012;2013;2\\n+2012;2013;18\\n 2014;;7\\n 2015;;18\\n 2016;2017;18\\n 2018;201F;18\\n 2020;2023;18\\n-2024;2026;7\\n+2024;2026;23\\n 2027;;23\\n 2028;202E;18\\n 202F;;24\\n\""}