{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basabb12dd\""},"diff":"\"abb12dd fix for bug #393244:  occasionally hitting enter in the url bar will not have an effect r=gavin\\ndiff --git a/toolkit/components/autocomplete/src/nsAutoCompleteController.cpp b/toolkit/components/autocomplete/src/nsAutoCompleteController.cpp\\nindex 113cb4d..ac87369 100644\\n--- a/toolkit/components/autocomplete/src/nsAutoCompleteController.cpp\\n+++ b/toolkit/components/autocomplete/src/nsAutoCompleteController.cpp\\n@@ -183,7 +183,6 @@ nsAutoCompleteController::StartSearch(const nsAString &aSearchString)\\n { \\n   mSearchString = aSearchString;\\n   StartSearchTimer();\\n-\\n   return NS_OK;\\n }\\n \\n@@ -1029,7 +1028,11 @@ nsAutoCompleteController::StopSearch()\\n       mSearches->GetElementAt(i, getter_AddRefs(search));\\n       search->StopSearch();\\n     }\\n-  }\\n+    mSearchesOngoing = 0;\\n+    // since we were searching, but now we've stopped,\\n+    // we need to call PostSearchCleanup()\\n+    PostSearchCleanup();\\n+  } \\n   return NS_OK;\\n }\\n \\n@@ -1227,18 +1230,16 @@ nsAutoCompleteController::ProcessResult(PRInt32 aSearchIndex, nsIAutoCompleteRes\\n   else\\n     ClosePopup();\\n \\n-  // if the user hit enter but we still have searches ongoing,\\n-  // stop the searches, otherwise enter won't be handled\\n-  // by PostSearchCleanup() until the ongoing searches finish.\\n-  if (mEnterAfterSearch && mSearchesOngoing) {\\n+  if (mSearchesOngoing == 0) {\\n+    // If this is the last search to return, cleanup\\n+    PostSearchCleanup();\\n+  }\\n+  else if (mEnterAfterSearch) {\\n+    // since we still have searches ongoing (mSearchesOngoing != 0)\\n+    // and the user has hit enter, stop the searches\\n     StopSearch();\\n-    mSearchesOngoing = 0;  \\n   }\\n \\n-  // If this is the last search to return, cleanup\\n-  if (mSearchesOngoing == 0)\\n-    PostSearchCleanup();\\n-\\n   return NS_OK;\\n }\\n \\n\""}