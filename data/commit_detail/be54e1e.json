{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basbe54e1e\""},"diff":"\"be54e1e Bug 391266 - png files with tRNS chunk displaying incorrectly with color management.  r=pavlov, a=dsicore\\ndiff --git a/modules/libpr0n/decoders/png/nsPNGDecoder.cpp b/modules/libpr0n/decoders/png/nsPNGDecoder.cpp\\nindex f1b776e..e93e003 100644\\n--- a/modules/libpr0n/decoders/png/nsPNGDecoder.cpp\\n+++ b/modules/libpr0n/decoders/png/nsPNGDecoder.cpp\\n@@ -437,7 +437,7 @@ info_callback(png_structp png_ptr, png_infop info_ptr)\\n   if (decoder->mInProfile && gfxPlatform::GetCMSOutputProfile()) {\\n     PRUint32 outType;\\n \\n-    if (color_type & PNG_COLOR_MASK_ALPHA || trans)\\n+    if (color_type & PNG_COLOR_MASK_ALPHA || num_trans)\\n       outType = TYPE_RGBA_8;\\n     else\\n       outType = TYPE_RGB_8;\\n@@ -453,7 +453,7 @@ info_callback(png_structp png_ptr, png_infop info_ptr)\\n         color_type == PNG_COLOR_TYPE_GRAY_ALPHA)\\n       png_set_gray_to_rgb(png_ptr);\\n     if (gfxPlatform::IsCMSEnabled()) {\\n-      if (color_type & PNG_COLOR_MASK_ALPHA || trans)\\n+      if (color_type & PNG_COLOR_MASK_ALPHA || num_trans)\\n         decoder->mTransform = gfxPlatform::GetCMSRGBATransform();\\n       else\\n         decoder->mTransform = gfxPlatform::GetCMSRGBTransform();\\n\""}