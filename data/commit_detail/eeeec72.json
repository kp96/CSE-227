{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Baseeeec72\""},"diff":"\"eeeec72 Bug 385426. Be careful about looking for a previous soft-hyphen when checking for hyphen breaks. r=smontagu\\ndiff --git a/layout/generic/nsTextFrameThebes.cpp b/layout/generic/nsTextFrameThebes.cpp\\nindex ce8a0f2..011900e 100644\\n--- a/layout/generic/nsTextFrameThebes.cpp\\n+++ b/layout/generic/nsTextFrameThebes.cpp\\n@@ -2547,9 +2547,11 @@ PropertyProvider::GetHyphenationBreaks(PRUint32 aStart, PRUint32 aLength,\\n   // We need to visit skipped characters so that we can detect SHY\\n   run.SetVisitSkipped();\\n \\n+  PRInt32 prevTrailingCharOffset = run.GetPos().GetOriginalOffset() - 1;\\n   PRBool allowHyphenBreakBeforeNextChar =\\n-    run.GetPos().GetOriginalOffset() > mStart.GetOriginalOffset() &&\\n-    mFrag->CharAt(run.GetPos().GetOriginalOffset() - 1) == CH_SHY;\\n+    prevTrailingCharOffset >= mStart.GetOriginalOffset() &&\\n+    prevTrailingCharOffset < mStart.GetOriginalOffset() + mLength &&\\n+    mFrag->CharAt(prevTrailingCharOffset) == CH_SHY;\\n \\n   while (run.NextRun()) {\\n     NS_ASSERTION(run.GetRunLength() > 0, \\\"Shouldn't return zero-length runs\\\");\\n\""}