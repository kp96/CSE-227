{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basb919fdb\""},"diff":"\"b919fdb Bug 378216: Disable insecure extension updates by default. r=robstrong\\ndiff --git a/toolkit/locales/en-US/chrome/mozapps/extensions/extensions.dtd b/toolkit/locales/en-US/chrome/mozapps/extensions/extensions.dtd\\nindex d8f6db2..706421f 100644\\n--- a/toolkit/locales/en-US/chrome/mozapps/extensions/extensions.dtd\\n+++ b/toolkit/locales/en-US/chrome/mozapps/extensions/extensions.dtd\\n@@ -99,6 +99,7 @@\\n <!ENTITY includeUpdate.tooltip            \\\"Include this Add-on when installing the updates\\\">\\n \\n <!-- Status Messsages -->\\n+<!ENTITY insecureUpdate.label             \\\"Does not provide secure updates.\\\">\\n <!ENTITY needsDependencies.label          \\\"Requires additional items.\\\">\\n <!ENTITY blocklisted.label                \\\"Disabled for your protection.\\\">\\n <!ENTITY toBeDisabled.label               \\\"This add-on will be disabled when &brandShortName; is restarted.\\\">\\ndiff --git a/toolkit/locales/en-US/chrome/mozapps/extensions/extensions.properties b/toolkit/locales/en-US/chrome/mozapps/extensions/extensions.properties\\nindex 3bbb8b5..7a4f9bd 100644\\n--- a/toolkit/locales/en-US/chrome/mozapps/extensions/extensions.properties\\n+++ b/toolkit/locales/en-US/chrome/mozapps/extensions/extensions.properties\\n@@ -72,6 +72,7 @@ incompatibleThemeName=this Theme\\n incompatibleExtension=Disabled - not compatible with %S %S\\n incompatibleAddonMsg=Not compatible with %S %S\\n blocklistedDisabled=Disabled for your protection\\n+insecureUpdateMessage=\\\"%S\\\" will not be installed because it does not provide secure updates\\n \\n invalidGUIDMessage=\\\"%S\\\" could not be installed because of an error in its Install Manifest (\\\"%S\\\" is not a valid GUID). Please contact the author of this item about the problem.\\n invalidVersionMessage=\\\"%S\\\" could not be installed because of an error in its Install Manifest (\\\"%S\\\" is not a valid Version String). Please contact the author of this item about the problem.\\n@@ -130,6 +131,7 @@ xpinstallDisabledMsgLocked=Software installation has been disabled by your syste\\n xpinstallDisabledMsg=Software installation is currently disabled. Click Enable and try again.\\n safeModeMsg=All add-ons have been disabled by safe mode.\\n disabledCompatMsg=Add-on compatibility checking is disabled. You may have incompatible add-ons.\\n+disabledUpdateSecurityMsg=Add-on update security checking is disabled. You may be compromised by updates.\\n noUpdatesMsg=No updates were found.\\n offlineUpdateMsg=%S is currently in offline mode and is unable to update Add-ons. Click Go Online and try again.\\n offlineInstallMsg=%S is currently in offline mode and is unable to install Add-ons. Click Go Online and try again.\\ndiff --git a/toolkit/mozapps/extensions/content/extensions.js b/toolkit/mozapps/extensions/content/extensions.js\\nindex 04afcb9..cff71a0 100644\\n--- a/toolkit/mozapps/extensions/content/extensions.js\\n+++ b/toolkit/mozapps/extensions/content/extensions.js\\n@@ -57,6 +57,7 @@ var gDownloadManager  = null;\\n var gObserverIndex    = -1;\\n var gInSafeMode       = false;\\n var gCheckCompat      = true;\\n+var gCheckUpdateSecurity = true;\\n var gUpdatesOnly      = false;\\n var gAppID            = \\\"\\\";\\n var gPref             = null;\\n@@ -66,6 +67,7 @@ var gPlugins          = null;\\n var gPluginsDS        = null;\\n \\n const PREF_EM_CHECK_COMPATIBILITY           = \\\"extensions.checkCompatibility\\\";\\n+const PREF_EM_CHECK_UPDATE_SECURITY         = \\\"extensions.checkUpdateSecurity\\\";\\n const PREF_EXTENSIONS_GETMORETHEMESURL      = \\\"extensions.getMoreThemesURL\\\";\\n const PREF_EXTENSIONS_GETMOREEXTENSIONSURL  = \\\"extensions.getMoreExtensionsURL\\\";\\n const PREF_EXTENSIONS_DSS_ENABLED           = \\\"extensions.dss.enabled\\\";\\n@@ -267,6 +269,7 @@ function showView(aView) {\\n                       [\\\"plugin\\\", \\\"?plugin\\\"],\\n                       [\\\"previewImage\\\", \\\"?previewImage\\\"],\\n                       [\\\"satisfiesDependencies\\\", \\\"?satisfiesDependencies\\\"],\\n+                      [\\\"providesUpdatesSecurely\\\", \\\"?providesUpdatesSecurely\\\"],\\n                       [\\\"type\\\", \\\"?type\\\"],\\n                       [\\\"updateable\\\", \\\"?updateable\\\"],\\n                       [\\\"updateURL\\\", \\\"?updateURL\\\"],\\n@@ -316,6 +319,7 @@ function showView(aView) {\\n                       [\\\"opType\\\", \\\"?opType\\\"],\\n                       [\\\"previewImage\\\", \\\"?previewImage\\\"],\\n                       [\\\"satisfiesDependencies\\\", \\\"?satisfiesDependencies\\\"],\\n+                      [\\\"providesUpdatesSecurely\\\", \\\"?providesUpdatesSecurely\\\"],\\n                       [\\\"type\\\", \\\"?type\\\"],\\n                       [\\\"updateURL\\\", \\\"?updateURL\\\"],\\n                       [\\\"version\\\", \\\"?version\\\"],\\n@@ -654,6 +658,10 @@ function Startup()\\n     gCheckCompat = gPref.getBoolPref(PREF_EM_CHECK_COMPATIBILITY);\\n   } catch(e) { }\\n \\n+  try {\\n+    gCheckUpdateSecurity = gPref.getBoolPref(PREF_EM_CHECK_UPDATE_SECURITY);\\n+  } catch(e) { }\\n+\\n   // Sort on startup and anytime an add-on is installed or upgraded.\\n   gExtensionManager.sortTypeByProperty(nsIUpdateItem.TYPE_ADDON, \\\"name\\\", true);\\n   // Extension Command Updating is handled by a command controller.\\n@@ -689,6 +697,23 @@ function Startup()\\n                 msgText, buttonLabel, buttonAccesskey,\\n                 true, notifyData);\\n   }\\n+  if (!gCheckUpdateSecurity) {\\n+    var defaultCheckSecurity = true;\\n+    try {\\n+      defaultCheckSecurity = defaultPref.getBoolPref(PREF_EM_CHECK_UPDATE_SECURITY);\\n+    } catch (e) { }\\n+\\n+    // App has update security checking enabled by default so show warning\\n+    if (defaultCheckSecurity) {\\n+      var msgText = getExtensionString(\\\"disabledUpdateSecurityMsg\\\");\\n+      var buttonLabel = getExtensionString(\\\"enableButtonLabel\\\");\\n+      var buttonAccesskey = getExtensionString(\\\"enableButtonAccesskey\\\");\\n+      var notifyData = \\\"addons-enable-updatesecurity\\\";\\n+      showMessage(\\\"chrome://mozapps/skin/extensions/question.png\\\",\\n+                  msgText, buttonLabel, buttonAccesskey,\\n+                  true, notifyData);\\n+    }\\n+  }\\n   if (gInSafeMode) {\\n     showMessage(\\\"chrome://mozapps/skin/extensions/question.png\\\",\\n                 getExtensionString(\\\"safeModeMsg\\\"),\\n@@ -809,7 +834,7 @@ XPInstallDownloadManager.prototype = {\\n       var type = isTheme ? nsIUpdateItem.TYPE_THEME : nsIUpdateItem.TYPE_EXTENSION;\\n       var item = Components.classes[\\\"@mozilla.org/updates/item;1\\\"]\\n                            .createInstance(Components.interfaces.nsIUpdateItem);\\n-      item.init(url, \\\" \\\", \\\"app-profile\\\", \\\"\\\", \\\"\\\", displayName, url, \\\"\\\", iconURL, \\\"\\\", type, \\\"\\\");\\n+      item.init(url, \\\" \\\", \\\"app-profile\\\", \\\"\\\", \\\"\\\", displayName, url, \\\"\\\", iconURL, \\\"\\\", \\\"\\\", type, \\\"\\\");\\n       items.push(item);\\n \\n       // Advance the enumerator\\n@@ -1368,6 +1393,10 @@ const gAddonsMsgObserver = {\\n       gPref.clearUserPref(PREF_EM_CHECK_COMPATIBILITY);\\n       gCheckCompat = true;\\n       break;\\n+    case \\\"addons-enable-updatesecurity\\\":\\n+      gPref.clearUserPref(PREF_EM_CHECK_UPDATE_SECURITY);\\n+      gCheckUpdateSecurity = true;\\n+      break;\\n     case \\\"addons-no-updates\\\":\\n       var children = gExtensionsView.children;\\n       for (var i = 0; i < children.length; ++i) {\\n@@ -1690,6 +1719,7 @@ var gExtensionsViewController = {\\n              (!selectedItem.opType ||\\n              selectedItem.opType == \\\"needs-disable\\\")) &&\\n              !selectedItem.isBlocklisted &&\\n+             (!gCheckUpdateSecurity || selectedItem.providesUpdatesSecurely) &&\\n              (!gCheckCompat || selectedItem.isCompatible) &&\\n              selectedItem.satisfiesDependencies &&\\n              !gExtensionsView.hasAttribute(\\\"update-operation\\\");\\ndiff --git a/toolkit/mozapps/extensions/content/extensions.xml b/toolkit/mozapps/extensions/content/extensions.xml\\nindex 2682e39..7fe2538 100644\\n--- a/toolkit/mozapps/extensions/content/extensions.xml\\n+++ b/toolkit/mozapps/extensions/content/extensions.xml\\n@@ -129,6 +129,7 @@\\n       <property name=\\\"isCompatible\\\" onget=\\\"return this.getAttribute('compatible') == 'true';\\\"/>\\n       <property name=\\\"isBlocklisted\\\" onget=\\\"return this.getAttribute('blocklisted') == 'true';\\\"/>\\n       <property name=\\\"isDisabled\\\" onget=\\\"return this.getAttribute('isDisabled') == 'true';\\\"/>\\n+      <property name=\\\"providesUpdatesSecurely\\\" onget=\\\"return this.getAttribute('providesUpdatesSecurely') == 'true';\\\"/>\\n       <property name=\\\"satisfiesDependencies\\\" onget=\\\"return this.getAttribute('satisfiesDependencies') == 'true';\\\"/>\\n       <property name=\\\"opType\\\">\\n         <getter>\\n@@ -239,6 +240,9 @@\\n             <xul:hbox flex=\\\"1\\\" class=\\\"incompatibleBox attention\\\">\\n               <xul:label anonid=\\\"incompatibleLabel\\\" crop=\\\"end\\\"/>\\n             </xul:hbox>\\n+            <xul:hbox flex=\\\"1\\\" class=\\\"insecureUpdateBox attention\\\">\\n+              <xul:label value=\\\"&insecureUpdate.label;\\\" crop=\\\"end\\\"/>\\n+            </xul:hbox>\\n             <xul:hbox flex=\\\"1\\\" class=\\\"needsDependenciesBox attention\\\">\\n               <xul:label value=\\\"&needsDependencies.label;\\\" crop=\\\"end\\\"/>\\n             </xul:hbox>\\ndiff --git a/toolkit/mozapps/extensions/public/nsIExtensionManager.idl b/toolkit/mozapps/extensions/public/nsIExtensionManager.idl\\nindex 8345d97..6de6b65 100644\\n--- a/toolkit/mozapps/extensions/public/nsIExtensionManager.idl\\n+++ b/toolkit/mozapps/extensions/public/nsIExtensionManager.idl\\n@@ -478,7 +478,7 @@ interface nsIExtensionManager : nsISupports\\n  * XXXben work in progress, the name of this interface will change after the\\n  *        update system is complete, probably to nsIAddon\\n  */\\n-[scriptable, uuid(a15390e0-2ad6-422c-9596-94f95286c16f)]\\n+[scriptable, uuid(f559f340-5160-420f-abc8-19b251708e7e)]\\n interface nsIUpdateItem : nsISupports\\n {\\n   /**\\n@@ -535,6 +535,12 @@ interface nsIUpdateItem : nsISupports\\n    */\\n   readonly attribute AString  updateRDF;\\n \\n+  /**\\n+   * The public key to verify updates for this item. This must be the public\\n+   * part of the key that was used to sign update manifests for this add-on.\\n+   */\\n+  readonly attribute AString  updateKey;\\n+  \\n   const unsigned long TYPE_APP         = 0x01;\\n   const unsigned long TYPE_EXTENSION   = 0x02;\\n   const unsigned long TYPE_THEME       = 0x04;\\n@@ -564,7 +570,8 @@ interface nsIUpdateItem : nsISupports\\n             in AString installLocationKey, in AString minAppVersion,\\n             in AString maxAppVersion, in AString name,\\n             in AString downloadURL, in AString xpiHash, in AString iconURL,\\n-            in AString updateURL, in long type, in AString targetAppID);\\n+            in AString updateURL, in AString updateKey, in long type,\\n+            in AString targetAppID);\\n \\n   /**\\n    * Returns a JS Object source representing an nsIUpdateItem.\\ndiff --git a/toolkit/mozapps/extensions/src/nsExtensionManager.js.in b/toolkit/mozapps/extensions/src/nsExtensionManager.js.in\\nindex 5d09751..e5d6937 100644\\n--- a/toolkit/mozapps/extensions/src/nsExtensionManager.js.in\\n+++ b/toolkit/mozapps/extensions/src/nsExtensionManager.js.in\\n@@ -60,6 +60,7 @@ const nsIURL                          = Components.interfaces.nsIURL\\n const nsIDirectoryEnumerator          = Components.interfaces.nsIDirectoryEnumerator;\\n \\n const PREF_EM_CHECK_COMPATIBILITY     = \\\"extensions.checkCompatibility\\\";\\n+const PREF_EM_CHECK_UPDATE_SECURITY   = \\\"extensions.checkUpdateSecurity\\\";\\n const PREF_EM_LAST_APP_VERSION        = \\\"extensions.lastAppVersion\\\";\\n const PREF_UPDATE_COUNT               = \\\"extensions.update.count\\\";\\n const PREF_UPDATE_DEFAULT_URL         = \\\"extensions.update.url\\\";\\n@@ -151,6 +152,7 @@ const INSTALLERROR_INCOMPATIBLE_VERSION  = -3;\\n const INSTALLERROR_PHONED_HOME           = -4;\\n const INSTALLERROR_INCOMPATIBLE_PLATFORM = -5;\\n const INSTALLERROR_BLOCKLISTED           = -6;\\n+const INSTALLERROR_INSECURE_UPDATE       = -7;\\n \\n const MODE_RDONLY   = 0x01;\\n const MODE_WRONLY   = 0x02;\\n@@ -173,6 +175,7 @@ var gInstallManifestRoot  = null;\\n var gVersionChecker       = null;\\n var gLoggingEnabled       = null;\\n var gCheckCompatibility   = true;\\n+var gCheckUpdateSecurity  = true;\\n var gLocale               = \\\"en-US\\\";\\n \\n /**\\n@@ -315,10 +318,12 @@ function getResourceForID(id) {\\n  * ...\\n  */\\n function makeItem(id, version, locationKey, minVersion, maxVersion, name,\\n-                  updateURL, updateHash, iconURL, updateRDF, type, targetAppID) {\\n+                  updateURL, updateHash, iconURL, updateRDF, updateKey, type, \\n+                  targetAppID) {\\n   var item = new UpdateItem();\\n   item.init(id, version, locationKey, minVersion, maxVersion, name,\\n-            updateURL, updateHash, iconURL, updateRDF, type, targetAppID);\\n+            updateURL, updateHash, iconURL, updateRDF, updateKey, type,\\n+            targetAppID);\\n   return item;\\n }\\n \\n@@ -2431,8 +2436,9 @@ ExtensionManager.prototype = {\\n     case \\\"nsPref:changed\\\":\\n       if (data == PREF_EM_LOGGING_ENABLED)\\n         this._loggingToggled();\\n-      else if (data == PREF_EM_CHECK_COMPATIBILITY)\\n-        this._checkCompatToggled();\\n+      else if (data == PREF_EM_CHECK_COMPATIBILITY ||\\n+               data == PREF_EM_CHECK_UPDATE_SECURITY)\\n+        this._updateAppDisabledState();\\n       else if ((data == PREF_MATCH_OS_LOCALE) || (data == PREF_SELECTED_LOCALE))\\n         this._updateLocale();\\n       break;\\n@@ -2465,11 +2471,12 @@ ExtensionManager.prototype = {\\n   },\\n \\n   /**\\n-   * Enables or disables extensions that are incompatible depending upon the pref\\n-   * setting for compatibility checking.\\n+   * When a preference is toggled that affects whether an item is usable or not\\n+   * we must app-enable or app-disable the item based on the new settings.\\n    */\\n-  _checkCompatToggled: function() {\\n+  _updateAppDisabledState: function() {\\n     gCheckCompatibility = getPref(\\\"getBoolPref\\\", PREF_EM_CHECK_COMPATIBILITY, true);\\n+    gCheckUpdateSecurity = getPref(\\\"getBoolPref\\\", PREF_EM_CHECK_UPDATE_SECURITY, true);\\n     var ds = this.datasource;\\n \\n     // Enumerate all items\\n@@ -2506,6 +2513,7 @@ ExtensionManager.prototype = {\\n     }\\n     gLoggingEnabled = getPref(\\\"getBoolPref\\\", PREF_EM_LOGGING_ENABLED, false);\\n     gCheckCompatibility = getPref(\\\"getBoolPref\\\", PREF_EM_CHECK_COMPATIBILITY, true);\\n+    gCheckUpdateSecurity = getPref(\\\"getBoolPref\\\", PREF_EM_CHECK_UPDATE_SECURITY, true);\\n     gPref.addObserver(\\\"extensions.\\\", this, false);\\n     gPref.addObserver(PREF_MATCH_OS_LOCALE, this, false);\\n     gPref.addObserver(PREF_SELECTED_LOCALE, this, false);\\n@@ -2751,6 +2759,7 @@ ExtensionManager.prototype = {\\n                       \\\"\\\", /* XPI Update Hash */\\n                       getManifestProperty(installManifest, \\\"iconURL\\\"),\\n                       getManifestProperty(installManifest, \\\"updateURL\\\"),\\n+                      getManifestProperty(installManifest, \\\"updateKey\\\"),\\n                       installData.type,\\n                       targetAppInfo ? targetAppInfo.appID : gApp.ID);\\n     }\\n@@ -2802,6 +2811,11 @@ ExtensionManager.prototype = {\\n           callback(installManifest, installData.id, location, installData.type);\\n           em._appDisableItem(id);\\n         }\\n+        else if (installData.error == INSTALLERROR_INSECURE_UPDATE) {\\n+          LOG(\\\"... success, item installed but does not provide updates securely\\\");\\n+          callback(installManifest, installData.id, location, installData.type);\\n+          em._appDisableItem(id);\\n+        }\\n         else if (installData.error == INSTALLERROR_BLOCKLISTED) {\\n           LOG(\\\"... success, item installed but is blocklisted\\\");\\n           callback(installManifest, installData.id, location, installData.type);\\n@@ -2820,8 +2834,6 @@ ExtensionManager.prototype = {\\n               return \\\"Invalid GUID\\\";\\n             case INSTALLERROR_INVALID_VERSION:\\n               return \\\"Invalid Version\\\";\\n-            case INSTALLERROR_INCOMPATIBLE_VERSION:\\n-              return \\\"Incompatible Version\\\";\\n             case INSTALLERROR_INCOMPATIBLE_PLATFORM:\\n               return \\\"Incompatible Platform\\\";\\n             }\\n@@ -3475,8 +3487,22 @@ ExtensionManager.prototype = {\\n       }\\n       else if (allAppManaged)\\n         allAppManaged = false;\\n-      // appDisabled is determined by an item being compatible,\\n-      // satisfying its dependencies, and not being blocklisted\\n+\\n+      if (ds.getItemProperty(id, \\\"providesUpdatesSecurely\\\") == \\\"false\\\") {\\n+        /* It's possible the previous version did not understand updateKeys so\\n+         * check if we can import one for this addon from it's manifest. */\\n+        var location = this.getInstallLocation(id);\\n+        var installRDF = location.getItemFile(id, FILE_INSTALL_MANIFEST);\\n+        if (installRDF.exists()) {\\n+          var metadataDS = getInstallManifest(installRDF);\\n+          var literal = metadataDS.GetTarget(gInstallManifestRoot, EM_R(\\\"updateKey\\\"), true);\\n+          if (literal && literal instanceof Components.interfaces.nsIRDFLiteral)\\n+            ds.setItemProperty(id, EM_R(\\\"updateKey\\\"), literal);\\n+        }\\n+      }\\n+\\n+      // appDisabled is determined by an item being compatible, using secure\\n+      // updates, satisfying its dependencies, and not being blocklisted\\n       if (this._isUsableItem(id)) {\\n         if (ds.getItemProperty(id, \\\"appDisabled\\\"))\\n           ds.setItemProperty(id, EM_R(\\\"appDisabled\\\"), null);\\n@@ -3853,6 +3879,8 @@ ExtensionManager.prototype = {\\n    *                     INSTALLERROR_INCOMPATIBLE_PLATFORM\\n    *                       error, item is not compatible with the operating\\n    *                       system or ABI the application was built for.\\n+   *                     INSTALLERROR_INSECURE_UPDATE\\n+   *                       error, item has no secure method of providing updates\\n    *                     INSTALLERROR_BLOCKLISTED\\n    *                       error, item is blocklisted\\n    */\\n@@ -3863,6 +3891,8 @@ ExtensionManager.prototype = {\\n                         type        : 0,\\n                         error       : INSTALLERROR_SUCCESS,\\n                         targetApps  : [],\\n+                        updateURL   : \\\"\\\",\\n+                        updateKey   : \\\"\\\",\\n                         currentApp  : null };\\n \\n     // Fetch properties from the Install Manifest\\n@@ -3871,6 +3901,7 @@ ExtensionManager.prototype = {\\n     installData.name     = getManifestProperty(installManifest, \\\"name\\\");\\n     installData.type     = getAddonTypeFromInstallManifest(installManifest);\\n     installData.updateURL= getManifestProperty(installManifest, \\\"updateURL\\\");\\n+    installData.updateKey= getManifestProperty(installManifest, \\\"updateKey\\\");\\n \\n     /**\\n      * Reads a property off a Target Application resource\\n@@ -3948,12 +3979,23 @@ ExtensionManager.prototype = {\\n       installData.error = INSTALLERROR_INVALID_GUID;\\n       return installData;\\n     }\\n-\\n-    // Check the target application range specified by the extension metadata.\\n+    \\n+    // Check that the add-on provides a secure update method.\\n+    if (gCheckUpdateSecurity &&\\n+        installData.updateURL &&\\n+        installData.updateURL.substring(0, 6) != \\\"https:\\\" &&\\n+        !installData.updateKey) {\\n+      installData.error = INSTALLERROR_INSECURE_UPDATE;\\n+      return installData;\\n+    }\\n+      \\n+    // Check that the target application range allows compatibility with the app\\n     if (gCheckCompatibility &&\\n-        !this.datasource.isCompatible(installManifest, gInstallManifestRoot, undefined))\\n+        !this.datasource.isCompatible(installManifest, gInstallManifestRoot, undefined)) {\\n       installData.error = INSTALLERROR_INCOMPATIBLE_VERSION;\\n-\\n+      return installData;\\n+    }\\n+    \\n     // Check if the item is blocklisted.\\n     if (!gBlocklist)\\n       gBlocklist = Components.classes[\\\"@mozilla.org/extensions/blocklist;1\\\"]\\n@@ -4192,6 +4234,7 @@ ExtensionManager.prototype = {\\n                             \\\"\\\", /* XPI Update Hash */\\n                             \\\"\\\", /* Icon URL */\\n                             installData.updateURL || \\\"\\\",\\n+                            installData.updateKey || \\\"\\\",\\n                             installData.type,\\n                             installData.currentApp.id);\\n         em.update([item], 1, nsIExtensionManager.UPDATE_CHECK_COMPATIBILITY, this);\\n@@ -4415,6 +4458,14 @@ ExtensionManager.prototype = {\\n           installData.version + \\\" was not installed.\\\");\\n       showBlocklistMessage([installData], true);\\n       break;\\n+    case INSTALLERROR_INSECURE_UPDATE:\\n+      LOG(\\\"No secure updates: Item: \\\\\\\"\\\" + installData.id + \\\"\\\\\\\" version \\\" + \\n+          installData.version + \\\" was not installed.\\\");\\n+      var bundle = BundleManager.getBundle(URI_EXTENSIONS_PROPERTIES);\\n+      showMessage(\\\"incompatibleTitle\\\", \\n+                  [bundle.GetStringFromName(\\\"type-\\\" + installData.type)], \\n+                  \\\"insecureUpdateMessage\\\", [installData.name]);\\n+      break;\\n     default:\\n       break;\\n     }\\n@@ -5064,9 +5115,23 @@ ExtensionManager.prototype = {\\n    */\\n   _isUsableItem: function(id) {\\n     var ds = this.datasource;\\n-    return ((!gCheckCompatibility || ds.getItemProperty(id, \\\"compatible\\\") == \\\"true\\\") &&\\n-            ds.getItemProperty(id, \\\"blocklisted\\\") == \\\"false\\\" &&\\n-            ds.getItemProperty(id, \\\"satisfiesDependencies\\\") == \\\"true\\\");\\n+    /* If we're not compatibility checking or if the item is compatible\\n+     * and if it isn't blocklisted and has all dependencies satisfied then\\n+     * proceed to the security check */\\n+    if ((!gCheckCompatibility || ds.getItemProperty(id, \\\"compatible\\\") == \\\"true\\\") &&\\n+        ds.getItemProperty(id, \\\"blocklisted\\\") == \\\"false\\\" &&\\n+        ds.getItemProperty(id, \\\"satisfiesDependencies\\\") == \\\"true\\\") {\\n+\\n+      // appManaged items aren't updated so no need to check update security.\\n+      if (ds.getItemProperty(id, \\\"appManaged\\\") == \\\"true\\\")\\n+        return true;\\n+\\n+      /* If we are not ignoring update security then check that the item has\\n+       * a secure update mechanism */\\n+      return (!gCheckUpdateSecurity ||\\n+              ds.getItemProperty(id, \\\"providesUpdatesSecurely\\\") == \\\"true\\\");\\n+    }\\n+    return false;\\n   },\\n \\n   /**\\n@@ -6164,11 +6229,54 @@ RDFItemUpdater.prototype = {\\n           \\\"doesn't give up much in the way of information when the load fails.\\\\r\\\\n\\\" +\\n           \\\"\\\\r\\\\nTry checking that: \\\\r\\\\n\\\" +\\n           \\\" 1. Your remote RDF file exists at the location.\\\\r\\\\n\\\" +\\n-          \\\" 2. Your RDF file is valid XML (starts with <?xml version=\\\\\\\"1.0?\\\\\\\">\\\\r\\\\n\\\" +\\n+          \\\" 2. Your RDF file is valid XML (starts with <?xml version=\\\\\\\"1.0\\\\\\\"?>\\\\r\\\\n\\\" +\\n           \\\"    and loads in Firefox displaying pretty printed like other XML documents\\\\r\\\\n\\\" +\\n           \\\" 3. Your server is sending the data in the correct MIME\\\\r\\\\n\\\" +\\n           \\\"    type (text/xml)\\\");\\n+    }      \\n+\\n+    // If we have an update key then the update manifest must be signed\\n+    if (aLocalItem.updateKey) {\\n+      var extensionRes = gRDF.GetResource(getItemPrefix(aLocalItem.type) + aLocalItem.id);\\n+      LOG(extensionRes.Value);\\n+      var signature = this._getPropertyFromResource(aDatasource, extensionRes, \\\"signature\\\", null);\\n+      if (signature) {\\n+        var serializer = new RDFSerializer();\\n+        try {\\n+          var updateString = serializer.serializeResource(aDatasource, extensionRes);\\n+          var verifier = Components.classes[\\\"@mozilla.org/security/datasignatureverifier;1\\\"]\\n+                                   .getService(Components.interfaces.nsIDataSignatureVerifier);\\n+          try {\\n+            if (!verifier.verifyData(updateString, signature, aLocalItem.updateKey)) {\\n+              LOG(\\\"RDFItemUpdater:onDatasourceLoaded: Update manifest for \\\" +\\n+                  aLocalItem.id + \\\" failed signature check.\\\");\\n+              this._updater.checkForDone(aLocalItem, nsIAddonUpdateCheckListener.STATUS_FAILURE);\\n+              return;\\n+            }\\n+          }\\n+          catch (e) {\\n+            LOG(\\\"RDFItemUpdater:onDatasourceLoaded: Failed to verify signature for \\\" +\\n+                aLocalItem.id + \\\". This indicates a malformed update key or signature.\\\");\\n+            this._updater.checkForDone(aLocalItem, nsIAddonUpdateCheckListener.STATUS_FAILURE);\\n+            return;\\n+          }\\n+        }\\n+        catch (e) {\\n+          LOG(\\\"RDFItemUpdater:onDatasourceLoaded: Failed to generate signature \\\" +\\n+              \\\"string for \\\" + aLocalItem.id + \\\". Serializer threw \\\" + e);\\n+          this._updater.checkForDone(aLocalItem, nsIAddonUpdateCheckListener.STATUS_FAILURE);\\n+          return;\\n+        }\\n+      }\\n+      else {\\n+        LOG(\\\"RDFItemUpdater:onDatasourceLoaded: Update manifest for \\\" +\\n+            aLocalItem.id + \\\" did not contain a signature.\\\");\\n+        this._updater.checkForDone(aLocalItem, nsIAddonUpdateCheckListener.STATUS_FAILURE);\\n+        return;\\n+      }\\n     }\\n+    /* If there is no updateKey either the update was over SSL, or it is an old\\n+     * addon that we are allowing a grace update. */\\n \\n     // Parse the response RDF\\n     var newerItem, sameItem;\\n@@ -6344,16 +6452,37 @@ RDFItemUpdater.prototype = {\\n       if (appID != this._updater._appID && appID != TOOLKIT_ID)\\n         continue;\\n \\n+      var updateLink = this._getPropertyFromResource(aDataSource, targetApp, \\\"updateLink\\\", aLocalItem);\\n+      var updateHash = this._getPropertyFromResource(aDataSource, targetApp, \\\"updateHash\\\", aLocalItem);\\n+      if (aUpdateCheckType == nsIExtensionManager.UPDATE_CHECK_NEWVERSION) {\\n+        // New version information is useless without a link to get it from\\n+        if (!updateLink)\\n+          continue;\\n+\\n+        /* If the update link is non-ssl and we do not have a hash or the hash\\n+         * is of an insecure nature then we must ignore this update. Bypass\\n+         * this if not checking update security. Currently we only consider\\n+         * the sha hashing algorithms as secure. */\\n+        if (gCheckUpdateSecurity && updateLink.substring(0, 6) != \\\"https:\\\" && \\n+            (!updateHash || updateHash.substring(0, 3) != \\\"sha\\\")) {\\n+          LOG(\\\"RDFItemUpdater:_parseV20Update: Update for \\\" + aLocalItem.id +\\n+              \\\" at \\\" + updateLink + \\\" ignored because it is insecure. updateLink \\\" +\\n+              \\\" must be a https url or an updateHash must be specified.\\\");\\n+          continue;\\n+        }\\n+      }\\n+\\n       var updatedItem = makeItem(aLocalItem.id,\\n                                  version,\\n                                  aLocalItem.installLocationKey,\\n                                  this._getPropertyFromResource(aDataSource, targetApp, \\\"minVersion\\\", aLocalItem),\\n                                  this._getPropertyFromResource(aDataSource, targetApp, \\\"maxVersion\\\", aLocalItem),\\n                                  aLocalItem.name,\\n-                                 this._getPropertyFromResource(aDataSource, targetApp, \\\"updateLink\\\", aLocalItem),\\n-                                 this._getPropertyFromResource(aDataSource, targetApp, \\\"updateHash\\\", aLocalItem),\\n+                                 updateLink,\\n+                                 updateHash,\\n                                  \\\"\\\", /* Icon URL */\\n                                  \\\"\\\", /* RDF Update URL */\\n+                                 \\\"\\\", /* Update Key */\\n                                  aLocalItem.type,\\n                                  appID);\\n \\n@@ -6370,6 +6499,158 @@ RDFItemUpdater.prototype = {\\n };\\n \\n /**\\n+ * A serialisation method for RDF data that produces an identical string\\n+ * provided that the RDF assertions match.\\n+ * The serialisation is not complete, only assertions stemming from a given\\n+ * resource are included, multiple references to the same resource are not\\n+ * permitted, and the RDF prolog and epilog are not included.\\n+ * RDF Blob and Date literals are not supported.\\n+ */\\n+function RDFSerializer()\\n+{\\n+  this.cUtils = Components.classes[\\\"@mozilla.org/rdf/container-utils;1\\\"]\\n+                          .getService(Components.interfaces.nsIRDFContainerUtils);\\n+  this.resources = [];\\n+}\\n+\\n+RDFSerializer.prototype = {\\n+  INDENT: \\\"  \\\",      // The indent used for pretty-printing\\n+  resources: null,   // Array of the resources that have been found\\n+  \\n+  /**\\n+   * Escapes characters from a string that should not appear in XML.\\n+   * @param string     The string to be escaped\\n+   * @returns a string with all characters invalid in XML character data\\n+   *          converted to entity references.\\n+   */\\n+  escapeEntities: function(string)\\n+  {\\n+    string = string.replace(/&/g, \\\"&amp;\\\");\\n+    string = string.replace(/</g, \\\"&lt;\\\");\\n+    string = string.replace(/>/g, \\\"&gt;\\\");\\n+    string = string.replace(/\\\"/g, \\\"&quot;\\\");\\n+    return string;\\n+  },\\n+  \\n+  /**\\n+   * Serializes all the elements of an RDF container.\\n+   * @param ds         The datasource holding the data\\n+   * @param container  The RDF container to output the child elements of\\n+   * @param indent     The current level of indent for pretty-printing\\n+   * @returns a string containing the serialized elements.\\n+   */\\n+  serializeContainerItems: function(ds, container, indent)\\n+  {\\n+    var result = \\\"\\\";\\n+    var items = container.GetElements();\\n+    while (items.hasMoreElements()) {\\n+      var item = items.getNext().QueryInterface(Components.interfaces.nsIRDFResource);\\n+      result += indent + \\\"<RDF:li>\\\\n\\\"\\n+      result += this.serializeResource(ds, item, indent + this.INDENT);\\n+      result += indent + \\\"</RDF:li>\\\\n\\\"\\n+    }\\n+    return result;\\n+  },\\n+  \\n+  /**\\n+   * Serializes all em:* (see EM_NS) properties of an RDF resource except for\\n+   * the em:signature property. As this serialization is to be compared against\\n+   * the manifest signature it cannot contain the em:signature property itself.\\n+   * @param ds         The datasource holding the data\\n+   * @param resource   The RDF resource to output the properties of\\n+   * @param indent     The current level of indent for pretty-printing\\n+   * @returns a string containing the serialized properties.\\n+   */\\n+  serializeResourceProperties: function(ds, resource, indent)\\n+  {\\n+    var result = \\\"\\\";\\n+    var items = [];\\n+    var arcs = ds.ArcLabelsOut(resource);\\n+    while (arcs.hasMoreElements()) {\\n+      var arc = arcs.getNext().QueryInterface(Components.interfaces.nsIRDFResource);\\n+      if (arc.ValueUTF8.substring(0, PREFIX_NS_EM.length) != PREFIX_NS_EM)\\n+        continue;\\n+      var prop = arc.ValueUTF8.substring(PREFIX_NS_EM.length);\\n+      if (prop == \\\"signature\\\")\\n+        continue;\\n+  \\n+      var targets = ds.GetTargets(resource, arc, true);\\n+      while (targets.hasMoreElements()) {\\n+        var target = targets.getNext();\\n+        if (target instanceof Components.interfaces.nsIRDFResource) {\\n+          var item = indent + \\\"<em:\\\" + prop + \\\">\\\\n\\\";\\n+          item += this.serializeResource(ds, target, indent + this.INDENT);\\n+          item += indent + \\\"</em:\\\" + prop + \\\">\\\\n\\\";\\n+          items.push(item);\\n+        }\\n+        else if (target instanceof Components.interfaces.nsIRDFLiteral) {\\n+          items.push(indent + \\\"<em:\\\" + prop + \\\">\\\" + this.escapeEntities(target.Value) + \\\"</em:\\\" + prop + \\\">\\\\n\\\");\\n+        }\\n+        else if (target instanceof Components.interfaces.nsIRDFInt) {\\n+          items.push(indent + \\\"<em:\\\" + prop + \\\" NC:parseType=\\\\\\\"Integer\\\\\\\">\\\" + target.Value + \\\"</em:\\\" + prop + \\\">\\\\n\\\");\\n+        }\\n+        else {\\n+          throw new Error(\\\"Cannot serialize unknown literal type\\\");\\n+        }\\n+      }\\n+    }\\n+    items.sort();\\n+    result += items.join(\\\"\\\");\\n+    return result;\\n+  },\\n+  \\n+  /**\\n+   * Recursively serializes an RDF resource and all resources it links to.\\n+   * This will only output EM_NS properties and will ignore any em:signature\\n+   * property.\\n+   * @param ds         The datasource holding the data\\n+   * @param resource   The RDF resource to serialize\\n+   * @param indent     The current level of indent for pretty-printing.\\n+   *                   Leave undefined for no indent\\n+   * @returns a string containing the serialized resource.\\n+   * @throws if the RDF data contains multiple references to the same resource.\\n+   */\\n+  serializeResource: function(ds, resource, indent)\\n+  {\\n+    if (this.resources.indexOf(resource) != -1 ) {\\n+      // We cannot output multiple references to the same resource.\\n+      throw new Error(\\\"Cannot serialize multiple references to \\\"+resource.Value);\\n+    }\\n+    if (indent === undefined)\\n+      indent = \\\"\\\";\\n+    \\n+    this.resources.push(resource);\\n+    var container = null;\\n+    var type = \\\"Description\\\";\\n+    if (this.cUtils.IsSeq(ds, resource)) {\\n+      type = \\\"Seq\\\";\\n+      container = this.cUtils.MakeSeq(ds, resource);\\n+    }\\n+    else if (this.cUtils.IsAlt(ds, resource)) {\\n+      type = \\\"Alt\\\";\\n+      container = this.cUtils.MakeAlt(ds, resource);\\n+    }\\n+    else if (this.cUtils.IsBag(ds, resource)) {\\n+      type = \\\"Bag\\\";\\n+      container = this.cUtils.MakeBag(ds, resource);\\n+    }\\n+  \\n+    var result = indent + \\\"<RDF:\\\" + type;\\n+    if (!gRDF.IsAnonymousResource(resource))\\n+      result += \\\" about=\\\\\\\"\\\" + this.escapeEntities(resource.ValueUTF8) + \\\"\\\\\\\"\\\";\\n+    result += \\\">\\\\n\\\";\\n+  \\n+    if (container)\\n+      result += this.serializeContainerItems(ds, container, indent + this.INDENT);\\n+      \\n+    result += this.serializeResourceProperties(ds, resource, indent + this.INDENT);\\n+  \\n+    result += indent + \\\"</RDF:\\\" + type + \\\">\\\\n\\\";\\n+    return result;\\n+  }\\n+}\\n+\\n+/**\\n  * A Datasource that holds Extensions.\\n  * - Implements nsIRDFDataSource to drive UI\\n  * - Uses a RDF/XML datasource for storage (this is undesirable)\\n@@ -6669,6 +6950,7 @@ ExtensionsDataSource.prototype = {\\n                     updateHash ? updateHash : \\\"\\\",\\n                     this.getItemProperty(id, \\\"iconURL\\\"),\\n                     this.getItemProperty(id, \\\"updateURL\\\"),\\n+                    this.getItemProperty(id, \\\"updateKey\\\"),\\n                     this.getItemProperty(id, \\\"type\\\"),\\n                     targetAppInfo ? targetAppInfo.appID : gApp.ID);\\n   },\\n@@ -7122,7 +7404,7 @@ ExtensionsDataSource.prototype = {\\n     // Copy the assertions over from the source datasource.\\n     // Assert properties with single values\\n     var singleProps = [\\\"version\\\", \\\"updateURL\\\", \\\"updateService\\\", \\\"optionsURL\\\",\\n-                       \\\"aboutURL\\\", \\\"iconURL\\\", \\\"internalName\\\"];\\n+                       \\\"aboutURL\\\", \\\"iconURL\\\", \\\"internalName\\\", \\\"updateKey\\\"];\\n \\n     // Items installed into restricted Install Locations can also be locked\\n     // (can't be removed or disabled), and hidden (not shown in the UI)\\n@@ -7738,6 +8020,19 @@ ExtensionsDataSource.prototype = {\\n   },\\n \\n   /**\\n+   * Get the providesUpdatesSecurely property (whether or not this item has a\\n+   * secure update mechanism)\\n+   */\\n+  _rdfGet_providesUpdatesSecurely: function(item, property) {\\n+    var id = stripPrefix(item.Value, PREFIX_ITEM_URI);\\n+    if (this.getItemProperty(id, \\\"updateKey\\\") ||\\n+        !this.getItemProperty(id, \\\"updateURL\\\") ||\\n+        this.getItemProperty(id, \\\"updateURL\\\").substring(0, 6) == \\\"https:\\\")\\n+      return EM_L(\\\"true\\\");\\n+    return EM_L(\\\"false\\\");\\n+  },\\n+\\n+  /**\\n    * Get the em:blocklisted property (whether or not this item is blocklisted)\\n    */\\n   _rdfGet_blocklisted: function(item, property) {\\n@@ -8192,7 +8487,7 @@ UpdateItem.prototype = {\\n    * See nsIUpdateService.idl\\n    */\\n   init: function(id, version, installLocationKey, minAppVersion, maxAppVersion,\\n-                 name, downloadURL, xpiHash, iconURL, updateURL, type,\\n+                 name, downloadURL, xpiHash, iconURL, updateURL, updateKey, type,\\n                  targetAppID) {\\n     this._id                  = id;\\n     this._version             = version;\\n@@ -8204,6 +8499,7 @@ UpdateItem.prototype = {\\n     this._xpiHash             = xpiHash;\\n     this._iconURL             = iconURL;\\n     this._updateURL           = updateURL;\\n+    this._updateKey           = updateKey;\\n     this._type                = type;\\n     this._targetAppID         = targetAppID;\\n   },\\n@@ -8221,6 +8517,7 @@ UpdateItem.prototype = {\\n   get xpiHash()           { return this._xpiHash;           },\\n   get iconURL()           { return this._iconURL            },\\n   get updateRDF()         { return this._updateURL;         },\\n+  get updateKey()         { return this._updateKey;         },\\n   get type()              { return this._type;              },\\n   get targetAppID()       { return this._targetAppID;       },\\n \\n@@ -8238,6 +8535,7 @@ UpdateItem.prototype = {\\n              xpiHash            : this._xpiHash,\\n              iconURL            : this._iconURL,\\n              updateRDF          : this._updateURL,\\n+             updateKey          : this._updateKey,\\n              type               : this._type,\\n              targetAppID        : this._targetAppID\\n            }.toSource();\\ndiff --git a/toolkit/mozapps/extensions/test/unit/addons/test_bug378216_1/install.rdf b/toolkit/mozapps/extensions/test/unit/addons/test_bug378216_1/install.rdf\\nnew file mode 100644\\nindex 0000000..e08a666\\n--- /dev/null\\n+++ b/toolkit/mozapps/extensions/test/unit/addons/test_bug378216_1/install.rdf\\n@@ -0,0 +1,22 @@\\n+<?xml version=\\\"1.0\\\"?>\\n+\\n+<RDF xmlns=\\\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\\\"\\n+     xmlns:em=\\\"http://www.mozilla.org/2004/em-rdf#\\\">\\n+\\n+  <Description about=\\\"urn:mozilla:install-manifest\\\">\\n+    <em:id>test_bug378216_1@tests.mozilla.org</em:id>\\n+    <em:version>1.0</em:version>\\n+    \\n+    <em:targetApplication>\\n+      <Description>\\n+        <em:id>xpcshell@tests.mozilla.org</em:id>\\n+        <em:minVersion>1</em:minVersion>\\n+        <em:maxVersion>1</em:maxVersion>\\n+      </Description>\\n+    </em:targetApplication>\\n+    \\n+    <!-- Front End MetaData -->\\n+    <em:name>Bug 378216 Test 1</em:name>\\n+\\n+  </Description>      \\n+</RDF>\\ndiff --git a/toolkit/mozapps/extensions/test/unit/addons/test_bug378216_10/install.rdf b/toolkit/mozapps/extensions/test/unit/addons/test_bug378216_10/install.rdf\\nnew file mode 100644\\nindex 0000000..1edf111\\n--- /dev/null\\n+++ b/toolkit/mozapps/extensions/test/unit/addons/test_bug378216_10/install.rdf\\n@@ -0,0 +1,27 @@\\n+<?xml version=\\\"1.0\\\"?>\\n+\\n+<RDF xmlns=\\\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\\\"\\n+     xmlns:em=\\\"http://www.mozilla.org/2004/em-rdf#\\\">\\n+\\n+  <Description about=\\\"urn:mozilla:install-manifest\\\">\\n+    <em:id>test_bug378216_10@tests.mozilla.org</em:id>\\n+    <em:version>1.0</em:version>\\n+    \\n+    <em:targetApplication>\\n+      <Description>\\n+        <em:id>xpcshell@tests.mozilla.org</em:id>\\n+        <em:minVersion>1</em:minVersion>\\n+        <em:maxVersion>1</em:maxVersion>\\n+      </Description>\\n+    </em:targetApplication>\\n+    \\n+    <!-- Front End MetaData -->\\n+    <em:name>Bug 378216 Test 10</em:name>\\n+    <em:updateURL>http://localhost:4444/test_bug378216.rdf</em:updateURL>\\n+    <em:updateKey>MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDK426erD/H3XtsjvaB5+PJqbhj\\n+                  Zc9EDI5OCJS8R3FIObJ9ZHJK1TXeaE7JWqt9WUmBWTEFvwS+FI9vWu8058N9CHhD\\n+                  NyeP6i4LuUYjTURnn7Yw/IgzyIJ2oKsYa32RuxAyteqAWqPT/J63wBixIeCxmysf\\n+                  awB/zH4KaPiY3vnrzQIDAQAB</em:updateKey>\\n+\\n+  </Description>      \\n+</RDF>\\ndiff --git a/toolkit/mozapps/extensions/test/unit/addons/test_bug378216_11/install.rdf b/toolkit/mozapps/extensions/test/unit/addons/test_bug378216_11/install.rdf\\nnew file mode 100644\\nindex 0000000..0bfa2bb\\n--- /dev/null\\n+++ b/toolkit/mozapps/extensions/test/unit/addons/test_bug378216_11/install.rdf\\n@@ -0,0 +1,27 @@\\n+<?xml version=\\\"1.0\\\"?>\\n+\\n+<RDF xmlns=\\\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\\\"\\n+     xmlns:em=\\\"http://www.mozilla.org/2004/em-rdf#\\\">\\n+\\n+  <Description about=\\\"urn:mozilla:install-manifest\\\">\\n+    <em:id>test_bug378216_11@tests.mozilla.org</em:id>\\n+    <em:version>1.0</em:version>\\n+    \\n+    <em:targetApplication>\\n+      <Description>\\n+        <em:id>xpcshell@tests.mozilla.org</em:id>\\n+        <em:minVersion>1</em:minVersion>\\n+        <em:maxVersion>1</em:maxVersion>\\n+      </Description>\\n+    </em:targetApplication>\\n+    \\n+    <!-- Front End MetaData -->\\n+    <em:name>Bug 378216 Test 11</em:name>\\n+    <em:updateURL>http://localhost:4444/test_bug378216.rdf</em:updateURL>\\n+    <em:updateKey>MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDK426erD/H3XtsjvaB5+PJqbhj\\n+                  Zc9EDI5OCJS8R3FIObJ9ZHJK1TXeaE7JWqt9WUmBWTEFvwS+FI9vWu8058N9CHhD\\n+                  NyeP6i4LuUYjTURnn7Yw/IgzyIJ2oKsYa32RuxAyteqAWqPT/J63wBixIeCxmysf\\n+                  awB/zH4KaPiY3vnrzQIDAQAB</em:updateKey>\\n+\\n+  </Description>      \\n+</RDF>\\ndiff --git a/toolkit/mozapps/extensions/test/unit/addons/test_bug378216_12/install.rdf b/toolkit/mozapps/extensions/test/unit/addons/test_bug378216_12/install.rdf\\nnew file mode 100644\\nindex 0000000..1741a98\\n--- /dev/null\\n+++ b/toolkit/mozapps/extensions/test/unit/addons/test_bug378216_12/install.rdf\\n@@ -0,0 +1,27 @@\\n+<?xml version=\\\"1.0\\\"?>\\n+\\n+<RDF xmlns=\\\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\\\"\\n+     xmlns:em=\\\"http://www.mozilla.org/2004/em-rdf#\\\">\\n+\\n+  <Description about=\\\"urn:mozilla:install-manifest\\\">\\n+    <em:id>test_bug378216_12@tests.mozilla.org</em:id>\\n+    <em:version>1.0</em:version>\\n+    \\n+    <em:targetApplication>\\n+      <Description>\\n+        <em:id>xpcshell@tests.mozilla.org</em:id>\\n+        <em:minVersion>1</em:minVersion>\\n+        <em:maxVersion>1</em:maxVersion>\\n+      </Description>\\n+    </em:targetApplication>\\n+    \\n+    <!-- Front End MetaData -->\\n+    <em:name>Bug 378216 Test 12</em:name>\\n+    <em:updateURL>http://localhost:4444/test_bug378216.rdf</em:updateURL>\\n+    <em:updateKey>MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDK426erD/H3XtsjvaB5+PJqbhj\\n+                  Zc9EDI5OCJS8R3FIObJ9ZHJK1TXeaE7JWqt9WUmBWTEFvwS+FI9vWu8058N9CHhD\\n+                  NyeP6i4LuUYjTURnn7Yw/IgzyIJ2oKsYa32RuxAyteqAWqPT/J63wBixIeCxmysf\\n+                  awB/zH4KaPiY3vnrzQIDAQAB</em:updateKey>\\n+\\n+  </Description>      \\n+</RDF>\\ndiff --git a/toolkit/mozapps/extensions/test/unit/addons/test_bug378216_13/install.rdf b/toolkit/mozapps/extensions/test/unit/addons/test_bug378216_13/install.rdf\\nnew file mode 100644\\nindex 0000000..f2dd65a\\n--- /dev/null\\n+++ b/toolkit/mozapps/extensions/test/unit/addons/test_bug378216_13/install.rdf\\n@@ -0,0 +1,27 @@\\n+<?xml version=\\\"1.0\\\"?>\\n+\\n+<RDF xmlns=\\\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\\\"\\n+     xmlns:em=\\\"http://www.mozilla.org/2004/em-rdf#\\\">\\n+\\n+  <Description about=\\\"urn:mozilla:install-manifest\\\">\\n+    <em:id>test_bug378216_13@tests.mozilla.org</em:id>\\n+    <em:version>1.0</em:version>\\n+    \\n+    <em:targetApplication>\\n+      <Description>\\n+        <em:id>xpcshell@tests.mozilla.org</em:id>\\n+        <em:minVersion>1</em:minVersion>\\n+        <em:maxVersion>1</em:maxVersion>\\n+      </Description>\\n+    </em:targetApplication>\\n+    \\n+    <!-- Front End MetaData -->\\n+    <em:name>Bug 378216 Test 13</em:name>\\n+    <em:updateURL>http://localhost:4444/test_bug378216.rdf</em:updateURL>\\n+    <em:updateKey>MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDK426erD/H3XtsjvaB5+PJqbhj\\n+                  Zc9EDI5OCJS8R3FIObJ9ZHJK1TXeaE7JWqt9WUmBWTEFvwS+FI9vWu8058N9CHhD\\n+                  NyeP6i4LuUYjTURnn7Yw/IgzyIJ2oKsYa32RuxAyteqAWqPT/J63wBixIeCxmysf\\n+                  awB/zH4KaPiY3vnrzQIDAQAB</em:updateKey>\\n+\\n+  </Description>      \\n+</RDF>\\ndiff --git a/toolkit/mozapps/extensions/test/unit/addons/test_bug378216_2/install.rdf b/toolkit/mozapps/extensions/test/unit/addons/test_bug378216_2/install.rdf\\nnew file mode 100644\\nindex 0000000..263a226\\n--- /dev/null\\n+++ b/toolkit/mozapps/extensions/test/unit/addons/test_bug378216_2/install.rdf\\n@@ -0,0 +1,23 @@\\n+<?xml version=\\\"1.0\\\"?>\\n+\\n+<RDF xmlns=\\\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\\\"\\n+     xmlns:em=\\\"http://www.mozilla.org/2004/em-rdf#\\\">\\n+\\n+  <Description about=\\\"urn:mozilla:install-manifest\\\">\\n+    <em:id>test_bug378216_2@tests.mozilla.org</em:id>\\n+    <em:version>1.0</em:version>\\n+    \\n+    <em:targetApplication>\\n+      <Description>\\n+        <em:id>xpcshell@tests.mozilla.org</em:id>\\n+        <em:minVersion>1</em:minVersion>\\n+        <em:maxVersion>1</em:maxVersion>\\n+      </Description>\\n+    </em:targetApplication>\\n+    \\n+    <!-- Front End MetaData -->\\n+    <em:name>Bug 378216 Test 2</em:name>\\n+    <em:updateURL>http://localhost:4444/test_bug378216.rdf</em:updateURL>\\n+\\n+  </Description>      \\n+</RDF>\\ndiff --git a/toolkit/mozapps/extensions/test/unit/addons/test_bug378216_3/install.rdf b/toolkit/mozapps/extensions/test/unit/addons/test_bug378216_3/install.rdf\\nnew file mode 100644\\nindex 0000000..d710d90\\n--- /dev/null\\n+++ b/toolkit/mozapps/extensions/test/unit/addons/test_bug378216_3/install.rdf\\n@@ -0,0 +1,23 @@\\n+<?xml version=\\\"1.0\\\"?>\\n+\\n+<RDF xmlns=\\\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\\\"\\n+     xmlns:em=\\\"http://www.mozilla.org/2004/em-rdf#\\\">\\n+\\n+  <Description about=\\\"urn:mozilla:install-manifest\\\">\\n+    <em:id>test_bug378216_3@tests.mozilla.org</em:id>\\n+    <em:version>1.0</em:version>\\n+    \\n+    <em:targetApplication>\\n+      <Description>\\n+        <em:id>xpcshell@tests.mozilla.org</em:id>\\n+        <em:minVersion>1</em:minVersion>\\n+        <em:maxVersion>1</em:maxVersion>\\n+      </Description>\\n+    </em:targetApplication>\\n+    \\n+    <!-- Front End MetaData -->\\n+    <em:name>Bug 378216 Test 3</em:name>\\n+    <em:updateURL>https://localhost:4444/test_bug378216_3/update.rdf</em:updateURL>\\n+\\n+  </Description>      \\n+</RDF>\\ndiff --git a/toolkit/mozapps/extensions/test/unit/addons/test_bug378216_4/install.rdf b/toolkit/mozapps/extensions/test/unit/addons/test_bug378216_4/install.rdf\\nnew file mode 100644\\nindex 0000000..b488f28\\n--- /dev/null\\n+++ b/toolkit/mozapps/extensions/test/unit/addons/test_bug378216_4/install.rdf\\n@@ -0,0 +1,26 @@\\n+<?xml version=\\\"1.0\\\"?>\\n+\\n+<RDF xmlns=\\\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\\\"\\n+     xmlns:em=\\\"http://www.mozilla.org/2004/em-rdf#\\\">\\n+\\n+  <Description about=\\\"urn:mozilla:install-manifest\\\">\\n+    <em:id>test_bug378216_4@tests.mozilla.org</em:id>\\n+    <em:version>1.0</em:version>\\n+    \\n+    <em:targetApplication>\\n+      <Description>\\n+        <em:id>xpcshell@tests.mozilla.org</em:id>\\n+        <em:minVersion>1</em:minVersion>\\n+        <em:maxVersion>1</em:maxVersion>\\n+      </Description>\\n+    </em:targetApplication>\\n+    \\n+    <!-- Front End MetaData -->\\n+    <em:name>Bug 378216 Test 4</em:name>\\n+    <em:updateKey>MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDK426erD/H3XtsjvaB5+PJqbhj\\n+                  Zc9EDI5OCJS8R3FIObJ9ZHJK1TXeaE7JWqt9WUmBWTEFvwS+FI9vWu8058N9CHhD\\n+                  NyeP6i4LuUYjTURnn7Yw/IgzyIJ2oKsYa32RuxAyteqAWqPT/J63wBixIeCxmysf\\n+                  awB/zH4KaPiY3vnrzQIDAQAB</em:updateKey>\\n+\\n+  </Description>      \\n+</RDF>\\ndiff --git a/toolkit/mozapps/extensions/test/unit/addons/test_bug378216_5/install.rdf b/toolkit/mozapps/extensions/test/unit/addons/test_bug378216_5/install.rdf\\nnew file mode 100644\\nindex 0000000..ccfd547\\n--- /dev/null\\n+++ b/toolkit/mozapps/extensions/test/unit/addons/test_bug378216_5/install.rdf\\n@@ -0,0 +1,27 @@\\n+<?xml version=\\\"1.0\\\"?>\\n+\\n+<RDF xmlns=\\\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\\\"\\n+     xmlns:em=\\\"http://www.mozilla.org/2004/em-rdf#\\\">\\n+\\n+  <Description about=\\\"urn:mozilla:install-manifest\\\">\\n+    <em:id>test_bug378216_5@tests.mozilla.org</em:id>\\n+    <em:version>1.0</em:version>\\n+    \\n+    <em:targetApplication>\\n+      <Description>\\n+        <em:id>xpcshell@tests.mozilla.org</em:id>\\n+        <em:minVersion>1</em:minVersion>\\n+        <em:maxVersion>1</em:maxVersion>\\n+      </Description>\\n+    </em:targetApplication>\\n+    \\n+    <!-- Front End MetaData -->\\n+    <em:name>Bug 378216 Test 5</em:name>\\n+    <em:updateURL>http://localhost:4444/test_bug378216.rdf</em:updateURL>\\n+    <em:updateKey>MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDK426erD/H3XtsjvaB5+PJqbhj\\n+                  Zc9EDI5OCJS8R3FIObJ9ZHJK1TXeaE7JWqt9WUmBWTEFvwS+FI9vWu8058N9CHhD\\n+                  NyeP6i4LuUYjTURnn7Yw/IgzyIJ2oKsYa32RuxAyteqAWqPT/J63wBixIeCxmysf\\n+                  awB/zH4KaPiY3vnrzQIDAQAB</em:updateKey>\\n+\\n+  </Description>      \\n+</RDF>\\ndiff --git a/toolkit/mozapps/extensions/test/unit/addons/test_bug378216_6/install.rdf b/toolkit/mozapps/extensions/test/unit/addons/test_bug378216_6/install.rdf\\nnew file mode 100644\\nindex 0000000..75a575e\\n--- /dev/null\\n+++ b/toolkit/mozapps/extensions/test/unit/addons/test_bug378216_6/install.rdf\\n@@ -0,0 +1,27 @@\\n+<?xml version=\\\"1.0\\\"?>\\n+\\n+<RDF xmlns=\\\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\\\"\\n+     xmlns:em=\\\"http://www.mozilla.org/2004/em-rdf#\\\">\\n+\\n+  <Description about=\\\"urn:mozilla:install-manifest\\\">\\n+    <em:id>test_bug378216_6@tests.mozilla.org</em:id>\\n+    <em:version>1.0</em:version>\\n+    \\n+    <em:targetApplication>\\n+      <Description>\\n+        <em:id>xpcshell@tests.mozilla.org</em:id>\\n+        <em:minVersion>1</em:minVersion>\\n+        <em:maxVersion>1</em:maxVersion>\\n+      </Description>\\n+    </em:targetApplication>\\n+    \\n+    <!-- Front End MetaData -->\\n+    <em:name>Bug 378216 Test 6</em:name>\\n+    <em:updateURL>https://localhost:4444/test_bug378216_6/update.rdf</em:updateURL>\\n+    <em:updateKey>MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDK426erD/H3XtsjvaB5+PJqbhj\\n+                  Zc9EDI5OCJS8R3FIObJ9ZHJK1TXeaE7JWqt9WUmBWTEFvwS+FI9vWu8058N9CHhD\\n+                  NyeP6i4LuUYjTURnn7Yw/IgzyIJ2oKsYa32RuxAyteqAWqPT/J63wBixIeCxmysf\\n+                  awB/zH4KaPiY3vnrzQIDAQAB</em:updateKey>\\n+\\n+  </Description>      \\n+</RDF>\\ndiff --git a/toolkit/mozapps/extensions/test/unit/addons/test_bug378216_7/install.rdf b/toolkit/mozapps/extensions/test/unit/addons/test_bug378216_7/install.rdf\\nnew file mode 100644\\nindex 0000000..f754bdc\\n--- /dev/null\\n+++ b/toolkit/mozapps/extensions/test/unit/addons/test_bug378216_7/install.rdf\\n@@ -0,0 +1,27 @@\\n+<?xml version=\\\"1.0\\\"?>\\n+\\n+<RDF xmlns=\\\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\\\"\\n+     xmlns:em=\\\"http://www.mozilla.org/2004/em-rdf#\\\">\\n+\\n+  <Description about=\\\"urn:mozilla:install-manifest\\\">\\n+    <em:id>test_bug378216_7@tests.mozilla.org</em:id>\\n+    <em:version>1.0</em:version>\\n+    \\n+    <em:targetApplication>\\n+      <Description>\\n+        <em:id>xpcshell@tests.mozilla.org</em:id>\\n+        <em:minVersion>1</em:minVersion>\\n+        <em:maxVersion>1</em:maxVersion>\\n+      </Description>\\n+    </em:targetApplication>\\n+    \\n+    <!-- Front End MetaData -->\\n+    <em:name>Bug 378216 Test 7</em:name>\\n+    <em:updateURL>http://localhost:4444/test_bug378216.rdf</em:updateURL>\\n+    <em:updateKey>MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDK426erD/H3XtsjvaB5+PJqbhj\\n+                  Zc9EDI5OCJS8R3FIObJ9ZHJK1TXeaE7JWqt9WUmBWTEFvwS+FI9vWu8058N9CHhD\\n+                  NyeP6i4LuUYjTURnn7Yw/IgzyIJ2oKsYa32RuxAyteqAWqPT/J63wBixIeCxmysf\\n+                  awB/zH4KaPiY3vnrzQIDAQAB</em:updateKey>\\n+\\n+  </Description>      \\n+</RDF>\\ndiff --git a/toolkit/mozapps/extensions/test/unit/addons/test_bug378216_8/install.rdf b/toolkit/mozapps/extensions/test/unit/addons/test_bug378216_8/install.rdf\\nnew file mode 100644\\nindex 0000000..264eb3e\\n--- /dev/null\\n+++ b/toolkit/mozapps/extensions/test/unit/addons/test_bug378216_8/install.rdf\\n@@ -0,0 +1,27 @@\\n+<?xml version=\\\"1.0\\\"?>\\n+\\n+<RDF xmlns=\\\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\\\"\\n+     xmlns:em=\\\"http://www.mozilla.org/2004/em-rdf#\\\">\\n+\\n+  <Description about=\\\"urn:mozilla:install-manifest\\\">\\n+    <em:id>test_bug378216_8@tests.mozilla.org</em:id>\\n+    <em:version>1.0</em:version>\\n+    \\n+    <em:targetApplication>\\n+      <Description>\\n+        <em:id>xpcshell@tests.mozilla.org</em:id>\\n+        <em:minVersion>1</em:minVersion>\\n+        <em:maxVersion>1</em:maxVersion>\\n+      </Description>\\n+    </em:targetApplication>\\n+    \\n+    <!-- Front End MetaData -->\\n+    <em:name>Bug 378216 Test 8</em:name>\\n+    <em:updateURL>http://localhost:4444/test_bug378216.rdf</em:updateURL>\\n+    <em:updateKey>MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDK426erD/H3XtsjvaB5+PJqbhj\\n+                  Zc9EDI5OCJS8R3FIObJ9ZHJK1TXeaE7JWqt9WUmBWTEFvwS+FI9vWu8058N9CHhD\\n+                  NyeP6i4LuUYjTURnn7Yw/IgzyIJ2oKsYa32RuxAyteqAWqPT/J63wBixIeCxmysf\\n+                  awB/zH4KaPiY3vnrzQIDAQAB</em:updateKey>\\n+\\n+  </Description>      \\n+</RDF>\\ndiff --git a/toolkit/mozapps/extensions/test/unit/addons/test_bug378216_9/install.rdf b/toolkit/mozapps/extensions/test/unit/addons/test_bug378216_9/install.rdf\\nnew file mode 100644\\nindex 0000000..db88aa0\\n--- /dev/null\\n+++ b/toolkit/mozapps/extensions/test/unit/addons/test_bug378216_9/install.rdf\\n@@ -0,0 +1,27 @@\\n+<?xml version=\\\"1.0\\\"?>\\n+\\n+<RDF xmlns=\\\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\\\"\\n+     xmlns:em=\\\"http://www.mozilla.org/2004/em-rdf#\\\">\\n+\\n+  <Description about=\\\"urn:mozilla:install-manifest\\\">\\n+    <em:id>test_bug378216_9@tests.mozilla.org</em:id>\\n+    <em:version>1.0</em:version>\\n+    \\n+    <em:targetApplication>\\n+      <Description>\\n+        <em:id>xpcshell@tests.mozilla.org</em:id>\\n+        <em:minVersion>1</em:minVersion>\\n+        <em:maxVersion>1</em:maxVersion>\\n+      </Description>\\n+    </em:targetApplication>\\n+    \\n+    <!-- Front End MetaData -->\\n+    <em:name>Bug 378216 Test 9</em:name>\\n+    <em:updateURL>http://localhost:4444/test_bug378216.rdf</em:updateURL>\\n+    <em:updateKey>MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDK426erD/H3XtsjvaB5+PJqbhj\\n+                  Zc9EDI5OCJS8R3FIObJ9ZHJK1TXeaE7JWqt9WUmBWTEFvwS+FI9vWu8058N9CHhD\\n+                  NyeP6i4LuUYjTURnn7Yw/IgzyIJ2oKsYa32RuxAyteqAWqPT/J63wBixIeCxmysf\\n+                  awB/zH4KaPiY3vnrzQIDAQAB</em:updateKey>\\n+\\n+  </Description>      \\n+</RDF>\\ndiff --git a/toolkit/mozapps/extensions/test/unit/data/test_bug378216.rdf b/toolkit/mozapps/extensions/test/unit/data/test_bug378216.rdf\\nnew file mode 100644\\nindex 0000000..139ba73\\n--- /dev/null\\n+++ b/toolkit/mozapps/extensions/test/unit/data/test_bug378216.rdf\\n@@ -0,0 +1,197 @@\\n+<?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?>\\n+\\n+<RDF:RDF xmlns:RDF=\\\"http://www.w3.org/1999/02/22-rdf-syntax-ns#\\\"\\n+         xmlns:em=\\\"http://www.mozilla.org/2004/em-rdf#\\\">\\n+\\n+  <RDF:Description about=\\\"urn:mozilla:extension:test_bug378216_5@tests.mozilla.org\\\">\\n+    <em:updates>\\n+      <RDF:Seq>\\n+        <RDF:li>\\n+          <RDF:Description>\\n+            <em:version>2.0</em:version>\\n+            <em:targetApplication>\\n+              <RDF:Description>\\n+                <em:id>xpcshell@tests.mozilla.org</em:id>\\n+                <em:minVersion>1</em:minVersion>\\n+                <em:maxVersion>1</em:maxVersion>\\n+                <em:updateLink>http://localhost:4444/broken.xpi</em:updateLink>\\n+              </RDF:Description>\\n+            </em:targetApplication>\\n+          </RDF:Description>\\n+        </RDF:li>\\n+      </RDF:Seq>\\n+    </em:updates>\\n+  </RDF:Description>\\n+\\n+  <RDF:Description about=\\\"urn:mozilla:extension:test_bug378216_7@tests.mozilla.org\\\">\\n+    <em:updates>\\n+      <RDF:Seq>\\n+        <RDF:li>\\n+          <RDF:Description>\\n+            <em:version>2.0</em:version>\\n+            <em:targetApplication>\\n+              <RDF:Description>\\n+                <em:id>xpcshell@tests.mozilla.org</em:id>\\n+                <em:minVersion>1</em:minVersion>\\n+                <em:maxVersion>2</em:maxVersion>\\n+                <em:updateLink>http://localhost:4444/broken.xpi</em:updateLink>\\n+              </RDF:Description>\\n+            </em:targetApplication>\\n+          </RDF:Description>\\n+        </RDF:li>\\n+      </RDF:Seq>\\n+    </em:updates>\\n+    <em:signature>MIGTMA0GCSqGSIb3DQEBBQUAA4GBAMO1O2gwSCCth1GwYMgscfaNakpN40PJfOWt\\n+                  ub2HVdg8+OXMciF8d/9eVWm8eH/IxuxyZlmRZTs3O5tv9eWAY5uBCtqDf1WgTsGk\\n+                  jrgZow1fITkZI7w0//C8eKdMLAtGueGfNs2IlTd5P/0KH/hf1rPc1wUqEqKCd4+L\\n+                  BcVq13ad</em:signature>\\n+  </RDF:Description>\\n+\\n+  <RDF:Description about=\\\"urn:mozilla:extension:test_bug378216_8@tests.mozilla.org\\\">\\n+    <em:updates>\\n+      <RDF:Seq>\\n+        <RDF:li>\\n+          <RDF:Description>\\n+            <em:version>2.0</em:version>\\n+            <em:targetApplication>\\n+              <RDF:Description>\\n+                <em:id>xpcshell@tests.mozilla.org</em:id>\\n+                <em:minVersion>1</em:minVersion>\\n+                <em:maxVersion>1</em:maxVersion>\\n+                <em:updateLink>http://localhost:4444/broken.xpi</em:updateLink>\\n+              </RDF:Description>\\n+            </em:targetApplication>\\n+          </RDF:Description>\\n+        </RDF:li>\\n+      </RDF:Seq>\\n+    </em:updates>\\n+    <em:signature>MIGTMA0GCSqGSIb3DQEBBQUAA4GBAMH/33P/bn148mVkAB8i5X8c4LhY52E+MPUT\\n+                  yKHGpowZnRLgL2O0dfpm+rljOBfKi51322PFrsc6VIFml6x4Lrb5foxSyB0Vs9pb\\n+                  SEDFWUKquOQvceQ9iEx5Pe0VzrmUZgcQxd8ksSunWL4wJaBZ/evE5amFC6sw3pv/\\n+                  fjt8p3GN</em:signature>\\n+  </RDF:Description>\\n+\\n+  <RDF:Description about=\\\"urn:mozilla:extension:test_bug378216_9@tests.mozilla.org\\\">\\n+    <em:updates>\\n+      <RDF:Seq>\\n+        <RDF:li>\\n+          <RDF:Description>\\n+            <em:version>2.0</em:version>\\n+            <em:targetApplication>\\n+              <RDF:Description>\\n+                <em:id>xpcshell@tests.mozilla.org</em:id>\\n+                <em:minVersion>1</em:minVersion>\\n+                <em:maxVersion>1</em:maxVersion>\\n+                <em:updateLink>http://localhost:4444/broken.xpi</em:updateLink>\\n+                <em:updateHash>sha1:78fc1d2887eda35b4ad2e3a0b60120ca271ce6e6</em:updateHash>\\n+              </RDF:Description>\\n+            </em:targetApplication>\\n+          </RDF:Description>\\n+        </RDF:li>\\n+      </RDF:Seq>\\n+    </em:updates>\\n+    <em:signature>MIGTMA0GCSqGSIb3DQEBBQUAA4GBAJ5Dv3Zd7/j5dLchCw9iO/cxPq8oOhOYD2M+\\n+                  jUKvmHCyTBRIEaJrE4N7yVbRYk++ERIfyVepLivsVi4pBmF7JTdw0NaKUA0LiOoT\\n+                  mRL8I7s5NPjCiiNcdqbncWyiZwIj1w1nkbWGTlH/gEjRW/LbvT4JAuec8yNFDa4S\\n+                  X8mOMf7k</em:signature>\\n+  </RDF:Description>\\n+\\n+  <RDF:Description about=\\\"urn:mozilla:extension:test_bug378216_10@tests.mozilla.org\\\">\\n+    <em:updates>\\n+      <RDF:Seq>\\n+        <RDF:li>\\n+          <RDF:Description>\\n+            <em:version>2.0</em:version>\\n+            <em:targetApplication>\\n+              <RDF:Description>\\n+                <em:id>xpcshell@tests.mozilla.org</em:id>\\n+                <em:minVersion>1</em:minVersion>\\n+                <em:maxVersion>1</em:maxVersion>\\n+                <em:updateLink>https://localhost:4444/broken.xpi</em:updateLink>\\n+              </RDF:Description>\\n+            </em:targetApplication>\\n+          </RDF:Description>\\n+        </RDF:li>\\n+      </RDF:Seq>\\n+    </em:updates>\\n+    <em:signature>MIGTMA0GCSqGSIb3DQEBBQUAA4GBAGvf7XqqoTl5WofrNq55E7W+UttOEDXLB3Oi\\n+                  XDiXe0i6njlozilseaUo1hgfQhhzN9gkyetP5tGBVcLRrVyliKpJmD6ABCVGW1lS\\n+                  qS+SEw7gDHyHkvwKMyWKedpRGChqLYnnf+Y+CX3MWLZLkwPXMKdTYgN3Rx0lEnJk\\n+                  37LSEMKE</em:signature>\\n+  </RDF:Description>\\n+\\n+  <RDF:Description about=\\\"urn:mozilla:extension:test_bug378216_11@tests.mozilla.org\\\">\\n+    <em:updates>\\n+      <RDF:Seq>\\n+        <RDF:li>\\n+          <RDF:Description>\\n+            <em:version>2.0</em:version>\\n+            <em:targetApplication>\\n+              <RDF:Description>\\n+                <em:id>xpcshell@tests.mozilla.org</em:id>\\n+                <em:minVersion>1</em:minVersion>\\n+                <em:maxVersion>1</em:maxVersion>\\n+                <em:updateLink>https://localhost:4444/broken.xpi</em:updateLink>\\n+                <em:updateHash>sha1:78fc1d2887eda35b4ad2e3a0b60120ca271ce6e6</em:updateHash>\\n+              </RDF:Description>\\n+            </em:targetApplication>\\n+          </RDF:Description>\\n+        </RDF:li>\\n+      </RDF:Seq>\\n+    </em:updates>\\n+    <em:signature>MIGTMA0GCSqGSIb3DQEBBQUAA4GBACMX/KReOGSJ8CMGRroH1v3Gjv/Qs/pqH+Ow\\n+                  o+hCKWLUKx7hpJgVJkXXdAHW0U88NXlp1S2H0WqA7I/CdmNXJSPzzV/J4z1dZgXh\\n+                  JbW6mqNb0pj6nIe7g8OLzSxDgBmO4DUP5DAmnmqciJLWQzN7OdbcwrWz6xPN5kZF\\n+                  A90eF5zy</em:signature>\\n+  </RDF:Description>\\n+\\n+  <RDF:Description about=\\\"urn:mozilla:extension:test_bug378216_12@tests.mozilla.org\\\">\\n+    <em:updates>\\n+      <RDF:Seq>\\n+        <RDF:li>\\n+          <RDF:Description>\\n+            <em:version>2.0</em:version>\\n+            <em:targetApplication>\\n+              <RDF:Description>\\n+                <em:id>xpcshell@tests.mozilla.org</em:id>\\n+                <em:minVersion>1</em:minVersion>\\n+                <em:maxVersion>1</em:maxVersion>\\n+                <em:updateLink>http://localhost:4444/broken.xpi</em:updateLink>\\n+                <em:updateHash>md2:78fc1d2887eda35b4ad2e3a0b60120ca271ce6e6</em:updateHash>\\n+              </RDF:Description>\\n+            </em:targetApplication>\\n+          </RDF:Description>\\n+        </RDF:li>\\n+      </RDF:Seq>\\n+    </em:updates>\\n+    <em:signature>MIGTMA0GCSqGSIb3DQEBBQUAA4GBAJRfcFvHIWxVyycCw8IjNmEhabc2uqA1zQwp\\n+                  5oKh3Y23hwIsQ6xy68Wtjte1NEYFRt5fWkbMXj9YQj6LpVbzBKiGATcrq6MycZKK\\n+                  o5N22cWbrKKRweJezTyN4eLfQg21pG7r8mdfS0bIA28ZVFtQOmORejoUesEouCGy\\n+                  eKYk9nS2</em:signature>\\n+  </RDF:Description>\\n+\\n+  <RDF:Description about=\\\"urn:mozilla:extension:test_bug378216_13@tests.mozilla.org\\\">\\n+    <em:updates>\\n+      <RDF:Seq>\\n+        <RDF:li>\\n+          <RDF:Description>\\n+            <em:version>2.0</em:version>\\n+            <em:targetApplication>\\n+              <RDF:Description>\\n+                <em:id>xpcshell@tests.mozilla.org</em:id>\\n+                <em:minVersion>1</em:minVersion>\\n+                <em:maxVersion>1</em:maxVersion>\\n+                <em:updateLink>https://localhost:4444/broken.xpi</em:updateLink>\\n+                <em:updateHash>md2:78fc1d2887eda35b4ad2e3a0b60120ca271ce6e6</em:updateHash>\\n+              </RDF:Description>\\n+            </em:targetApplication>\\n+          </RDF:Description>\\n+        </RDF:li>\\n+      </RDF:Seq>\\n+    </em:updates>\\n+    <em:signature>MIGTMA0GCSqGSIb3DQEBBQUAA4GBALQKwzLFr/VOw3gJvv/LCh3/PWDd9FqmFnX+\\n+                  hJjBmCaUDtG7CXn1i0h8ed8IeRHpLLT7FCzVwU3bH9BUjdm8wc3ObtlNbd8go01a\\n+                  CoXz50r3rYPcYz4WS+7/+lvrUqsuWd9Wj+q0NeCPiNaaro6/AolE2Qf5JFRL3lxY\\n+                  lsKWAnVO</em:signature>\\n+  </RDF:Description>\\n+</RDF:RDF>\\ndiff --git a/toolkit/mozapps/extensions/test/unit/test_bug299716.js b/toolkit/mozapps/extensions/test/unit/test_bug299716.js\\nindex 1fbc370..34162a3 100644\\n--- a/toolkit/mozapps/extensions/test/unit/test_bug299716.js\\n+++ b/toolkit/mozapps/extensions/test/unit/test_bug299716.js\\n@@ -50,6 +50,9 @@ var env = Components.classes[\\\"@mozilla.org/process/environment;1\\\"]\\n                     .getService(Components.interfaces.nsIEnvironment);\\n env.set(\\\"XPCOM_DEBUG_BREAK\\\", \\\"stack\\\");\\n \\n+// Disables security checking our updates which haven't been signed\\n+gPrefs.setBoolPref(\\\"extensions.checkUpdateSecurity\\\", false);\\n+\\n // This allows the EM to attempt to display errors to the user without failing.\\n var promptService = {\\n   // nsIPromptService\\n@@ -300,6 +303,7 @@ var next_test = function() {};\\n \\n function do_check_item(aItem, aVersion, aAddonsEntry) {\\n   if (aAddonsEntry.installed) {\\n+    do_check_neq(aItem, null);\\n     do_check_eq(aItem.version, aVersion);\\n   } else {\\n     do_check_eq(aItem, null);\\ndiff --git a/toolkit/mozapps/extensions/test/unit/test_bug299716_2.js b/toolkit/mozapps/extensions/test/unit/test_bug299716_2.js\\nindex 8072b31..2c1c233 100644\\n--- a/toolkit/mozapps/extensions/test/unit/test_bug299716_2.js\\n+++ b/toolkit/mozapps/extensions/test/unit/test_bug299716_2.js\\n@@ -36,6 +36,9 @@\\n  * ***** END LICENSE BLOCK *****\\n  */\\n \\n+// Disables security checking our updates which haven't been signed\\n+gPrefs.setBoolPref(\\\"extensions.checkUpdateSecurity\\\", false);\\n+\\n // Update check listener.\\n const checkListener = {\\n   // nsIAddonUpdateCheckListener\\ndiff --git a/toolkit/mozapps/extensions/test/unit/test_bug378216.js b/toolkit/mozapps/extensions/test/unit/test_bug378216.js\\nnew file mode 100644\\nindex 0000000..2befe5b\\n--- /dev/null\\n+++ b/toolkit/mozapps/extensions/test/unit/test_bug378216.js\\n@@ -0,0 +1,235 @@\\n+/* ***** BEGIN LICENSE BLOCK *****\\n+ * Version: MPL 1.1/GPL 2.0/LGPL 2.1\\n+ *\\n+ * The contents of this file are subject to the Mozilla Public License Version\\n+ * 1.1 (the \\\"License\\\"); you may not use this file except in compliance with\\n+ * the License. You may obtain a copy of the License at\\n+ * http://www.mozilla.org/MPL/\\n+ *\\n+ * Software distributed under the License is distributed on an \\\"AS IS\\\" basis,\\n+ * WITHOUT WARRANTY OF ANY KIND, either express or implied. See the License\\n+ * for the specific language governing rights and limitations under the\\n+ * License.\\n+ *\\n+ * The Original Code is mozilla.org code.\\n+ *\\n+ * The Initial Developer of the Original Code is\\n+ *      Dave Townsend <dtownsend@oxymoronical.com>.\\n+ *\\n+ * Portions created by the Initial Developer are Copyright (C) 2007\\n+ * the Initial Developer. All Rights Reserved.\\n+ *\\n+ * Contributor(s):\\n+ *\\n+ * Alternatively, the contents of this file may be used under the terms of\\n+ * either the GNU General Public License Version 2 or later (the \\\"GPL\\\"), or\\n+ * the GNU Lesser General Public License Version 2.1 or later (the \\\"LGPL\\\"),\\n+ * in which case the provisions of the GPL or the LGPL are applicable instead\\n+ * of those above. If you wish to allow use of your version of this file only\\n+ * under the terms of either the GPL or the LGPL, and not to allow others to\\n+ * use your version of this file under the terms of the MPL, indicate your\\n+ * decision by deleting the provisions above and replace them with the notice\\n+ * and other provisions required by the GPL or the LGPL. If you do not delete\\n+ * the provisions above, a recipient may use your version of this file under\\n+ * the terms of any one of the MPL, the GPL or the LGPL.\\n+ *\\n+ * ***** END LICENSE BLOCK *****\\n+ */\\n+\\n+/**\\n+ * Tests for update security restrictions.\\n+ *\\n+ * Install tests:\\n+ *\\n+ * Test     updateKey   updateURL   expected\\n+ *-------------------------------------------\\n+ * 1        absent      absent      success\\n+ * 2        absent      http        failure\\n+ * 3        absent      https       success\\n+ * 4        present     absent      success\\n+ * 5        present     http        success\\n+ * 6        present     https       success\\n+ *\\n+ * Update tests:\\n+ *\\n+ * Test     signature   updateHash  updateLink   expected\\n+ *--------------------------------------------------------\\n+ * 5        absent      absent      http         fail\\n+ * 7        broken      absent      http         fail\\n+ * 8        correct     absent      http         no update\\n+ * 9        correct     sha1        http         update\\n+ * 10       corrent     absent      https        update\\n+ * 11       corrent     sha1        https        update\\n+ * 12       corrent     md2         http         no update\\n+ * 13       corrent     md2         https        update\\n+ */\\n+\\n+do_import_script(\\\"netwerk/test/httpserver/httpd.js\\\");\\n+\\n+// This allows the EM to attempt to display errors to the user without failing\\n+var promptService = {\\n+  alert: function(aParent, aDialogTitle, aText) {\\n+  },\\n+  \\n+  alertCheck: function(aParent, aDialogTitle, aText, aCheckMsg, aCheckState) {\\n+  },\\n+  \\n+  confirm: function(aParent, aDialogTitle, aText) {\\n+  },\\n+  \\n+  confirmCheck: function(aParent, aDialogTitle, aText, aCheckMsg, aCheckState) {\\n+  },\\n+  \\n+  confirmEx: function(aParent, aDialogTitle, aText, aButtonFlags, aButton0Title, aButton1Title, aButton2Title, aCheckMsg, aCheckState) {\\n+  },\\n+  \\n+  prompt: function(aParent, aDialogTitle, aText, aValue, aCheckMsg, aCheckState) {\\n+  },\\n+  \\n+  promptUsernameAndPassword: function(aParent, aDialogTitle, aText, aUsername, aPassword, aCheckMsg, aCheckState) {\\n+  },\\n+\\n+  promptPassword: function(aParent, aDialogTitle, aText, aPassword, aCheckMsg, aCheckState) {\\n+  },\\n+  \\n+  select: function(aParent, aDialogTitle, aText, aCount, aSelectList, aOutSelection) {\\n+  },\\n+  \\n+  QueryInterface: function(iid) {\\n+    if (iid.equals(Components.interfaces.nsIPromptService)\\n+     || iid.equals(Components.interfaces.nsISupports))\\n+      return this;\\n+  \\n+    throw Components.results.NS_ERROR_NO_INTERFACE;\\n+  }\\n+};\\n+\\n+var PromptServiceFactory = {\\n+  createInstance: function (outer, iid) {\\n+    if (outer != null)\\n+      throw Components.results.NS_ERROR_NO_AGGREGATION;\\n+    return promptService.QueryInterface(iid);\\n+  }\\n+};\\n+var registrar = Components.manager.QueryInterface(Components.interfaces.nsIComponentRegistrar);\\n+registrar.registerFactory(Components.ID(\\\"{6cc9c9fe-bc0b-432b-a410-253ef8bcc699}\\\"), \\\"PromptService\\\",\\n+                          \\\"@mozilla.org/embedcomp/prompt-service;1\\\", PromptServiceFactory);\\n+\\n+\\n+var updateListener = {\\n+onUpdateStarted: function()\\n+{\\n+},\\n+\\n+onUpdateEnded: function()\\n+{\\n+  do_test_finished();\\n+},\\n+\\n+onAddonUpdateStarted: function(addon)\\n+{\\n+},\\n+\\n+onAddonUpdateEnded: function(addon, status)\\n+{\\n+  var nsIAddonUpdateCheckListener = Components.interfaces.nsIAddonUpdateCheckListener;\\n+  switch (addon.id)\\n+  {\\n+    case \\\"test_bug378216_5@tests.mozilla.org\\\":\\n+      // Update has no signature\\n+      do_check_eq(status, nsIAddonUpdateCheckListener.STATUS_FAILURE);\\n+      break;\\n+    case \\\"test_bug378216_7@tests.mozilla.org\\\":\\n+      // Update has a signature that does not match\\n+      do_check_eq(status, nsIAddonUpdateCheckListener.STATUS_FAILURE);\\n+      break;\\n+    case \\\"test_bug378216_8@tests.mozilla.org\\\":\\n+      // Update has a signature but no secure update\\n+      do_check_eq(status, nsIAddonUpdateCheckListener.STATUS_NO_UPDATE);\\n+      break;\\n+    case \\\"test_bug378216_9@tests.mozilla.org\\\":\\n+      // Update has a signature and a hashed update\\n+      do_check_eq(status, nsIAddonUpdateCheckListener.STATUS_UPDATE);\\n+      do_check_eq(addon.version, \\\"2.0\\\");\\n+      break;\\n+    case \\\"test_bug378216_10@tests.mozilla.org\\\":\\n+      // Update has a signature and a https update\\n+      do_check_eq(status, nsIAddonUpdateCheckListener.STATUS_UPDATE);\\n+      do_check_eq(addon.version, \\\"2.0\\\");\\n+      break;\\n+    case \\\"test_bug378216_11@tests.mozilla.org\\\":\\n+      // Update has a signature and a hashed https update\\n+      do_check_eq(status, nsIAddonUpdateCheckListener.STATUS_UPDATE);\\n+      do_check_eq(addon.version, \\\"2.0\\\");\\n+      break;\\n+    case \\\"test_bug378216_12@tests.mozilla.org\\\":\\n+      // Update has a signature and an insecure hash against the update\\n+      do_check_eq(status, nsIAddonUpdateCheckListener.STATUS_NO_UPDATE);\\n+      break;\\n+    case \\\"test_bug378216_13@tests.mozilla.org\\\":\\n+      // The insecure hash doesn't matter if we have an https link\\n+      do_check_eq(status, nsIAddonUpdateCheckListener.STATUS_UPDATE);\\n+      do_check_eq(addon.version, \\\"2.0\\\");\\n+      break;\\n+    default:\\n+      do_throw(\\\"Update check for unknown \\\"+addon.id);\\n+  }\\n+}\\n+}\\n+\\n+function run_test()\\n+{\\n+  // Setup for test\\n+  createAppInfo(\\\"xpcshell@tests.mozilla.org\\\", \\\"XPCShell\\\", \\\"1\\\");\\n+  startupEM();\\n+  gEM.installItemFromFile(do_get_addon(\\\"test_bug378216_1\\\"), NS_INSTALL_LOCATION_APPPROFILE);\\n+  gEM.installItemFromFile(do_get_addon(\\\"test_bug378216_2\\\"), NS_INSTALL_LOCATION_APPPROFILE);\\n+  gEM.installItemFromFile(do_get_addon(\\\"test_bug378216_3\\\"), NS_INSTALL_LOCATION_APPPROFILE);\\n+  gEM.installItemFromFile(do_get_addon(\\\"test_bug378216_4\\\"), NS_INSTALL_LOCATION_APPPROFILE);\\n+  gEM.installItemFromFile(do_get_addon(\\\"test_bug378216_5\\\"), NS_INSTALL_LOCATION_APPPROFILE);\\n+  gEM.installItemFromFile(do_get_addon(\\\"test_bug378216_6\\\"), NS_INSTALL_LOCATION_APPPROFILE);\\n+  gEM.installItemFromFile(do_get_addon(\\\"test_bug378216_7\\\"), NS_INSTALL_LOCATION_APPPROFILE);\\n+  gEM.installItemFromFile(do_get_addon(\\\"test_bug378216_8\\\"), NS_INSTALL_LOCATION_APPPROFILE);\\n+  gEM.installItemFromFile(do_get_addon(\\\"test_bug378216_9\\\"), NS_INSTALL_LOCATION_APPPROFILE);\\n+  gEM.installItemFromFile(do_get_addon(\\\"test_bug378216_10\\\"), NS_INSTALL_LOCATION_APPPROFILE);\\n+  gEM.installItemFromFile(do_get_addon(\\\"test_bug378216_11\\\"), NS_INSTALL_LOCATION_APPPROFILE);\\n+  gEM.installItemFromFile(do_get_addon(\\\"test_bug378216_12\\\"), NS_INSTALL_LOCATION_APPPROFILE);\\n+  gEM.installItemFromFile(do_get_addon(\\\"test_bug378216_13\\\"), NS_INSTALL_LOCATION_APPPROFILE);\\n+  \\n+  restartEM();\\n+  \\n+  do_check_neq(gEM.getItemForID(\\\"test_bug378216_1@tests.mozilla.org\\\"), null);\\n+  // Test 2 has an insecure updateURL and no updateKey so should fail to install\\n+  do_check_eq(gEM.getItemForID(\\\"test_bug378216_2@tests.mozilla.org\\\"), null);\\n+  do_check_neq(gEM.getItemForID(\\\"test_bug378216_3@tests.mozilla.org\\\"), null);\\n+  do_check_neq(gEM.getItemForID(\\\"test_bug378216_4@tests.mozilla.org\\\"), null);\\n+  do_check_neq(gEM.getItemForID(\\\"test_bug378216_5@tests.mozilla.org\\\"), null);\\n+  do_check_neq(gEM.getItemForID(\\\"test_bug378216_6@tests.mozilla.org\\\"), null);\\n+  do_check_neq(gEM.getItemForID(\\\"test_bug378216_7@tests.mozilla.org\\\"), null);\\n+  do_check_neq(gEM.getItemForID(\\\"test_bug378216_8@tests.mozilla.org\\\"), null);\\n+  do_check_neq(gEM.getItemForID(\\\"test_bug378216_9@tests.mozilla.org\\\"), null);\\n+  do_check_neq(gEM.getItemForID(\\\"test_bug378216_10@tests.mozilla.org\\\"), null);\\n+  do_check_neq(gEM.getItemForID(\\\"test_bug378216_11@tests.mozilla.org\\\"), null);\\n+  do_check_neq(gEM.getItemForID(\\\"test_bug378216_12@tests.mozilla.org\\\"), null);\\n+  do_check_neq(gEM.getItemForID(\\\"test_bug378216_13@tests.mozilla.org\\\"), null);\\n+\\n+  server = new nsHttpServer();\\n+  server.registerDirectory(\\\"/\\\", do_get_file(\\\"toolkit/mozapps/extensions/test/unit/data\\\"));\\n+  server.start(4444);\\n+  \\n+  var updates = [\\n+    gEM.getItemForID(\\\"test_bug378216_5@tests.mozilla.org\\\"),\\n+    gEM.getItemForID(\\\"test_bug378216_7@tests.mozilla.org\\\"),\\n+    gEM.getItemForID(\\\"test_bug378216_8@tests.mozilla.org\\\"),\\n+    gEM.getItemForID(\\\"test_bug378216_9@tests.mozilla.org\\\"),\\n+    gEM.getItemForID(\\\"test_bug378216_10@tests.mozilla.org\\\"),\\n+    gEM.getItemForID(\\\"test_bug378216_11@tests.mozilla.org\\\"),\\n+    gEM.getItemForID(\\\"test_bug378216_12@tests.mozilla.org\\\"),\\n+    gEM.getItemForID(\\\"test_bug378216_13@tests.mozilla.org\\\"),\\n+  ];\\n+  \\n+  gEM.update(updates, updates.length,\\n+             Components.interfaces.nsIExtensionManager.UPDATE_CHECK_NEWVERSION,\\n+             updateListener);\\n+  do_test_pending();\\n+}\\ndiff --git a/toolkit/mozapps/extensions/test/unit/test_bug384052.js b/toolkit/mozapps/extensions/test/unit/test_bug384052.js\\nindex 90e0312..e04b8a7 100644\\n--- a/toolkit/mozapps/extensions/test/unit/test_bug384052.js\\n+++ b/toolkit/mozapps/extensions/test/unit/test_bug384052.js\\n@@ -80,7 +80,7 @@ function run_test()\\n \\n   var item = Cc[\\\"@mozilla.org/updates/item;1\\\"].createInstance(Ci.nsIUpdateItem);\\n   item.init(\\\"test@mozilla.org\\\", \\\"1.0\\\", \\\"app-profile\\\", \\\"0.0\\\", \\\"100.0\\\", \\\"Test extension\\\",\\n-            null, null, \\\"\\\", null, item.TYPE_EXTENSION, \\\"xpcshell@tests.mozilla.org\\\");\\n+            null, null, \\\"\\\", null, null, item.TYPE_EXTENSION, \\\"xpcshell@tests.mozilla.org\\\");\\n \\n   gExpectedURL = gTestURL.replace(/%ITEM_ID%/, item.id)\\n                          .replace(/%CUSTOM1%/, \\\"custom_parameter_1\\\")\\ndiff --git a/toolkit/themes/pinstripe/mozapps/extensions/extensions.css b/toolkit/themes/pinstripe/mozapps/extensions/extensions.css\\nindex 940f104..7704828 100644\\n--- a/toolkit/themes/pinstripe/mozapps/extensions/extensions.css\\n+++ b/toolkit/themes/pinstripe/mozapps/extensions/extensions.css\\n@@ -136,6 +136,7 @@ richlistitem .notifyBadge {\\n richlistitem[availableUpdateURL][updateable=\\\"true\\\"] .updateBadge,\\n richlistitem[availableUpdateURL][updateable=\\\"true\\\"] .updateAvailableBox,\\n richlistitem[compatible=\\\"false\\\"] .notifyBadge,\\n+richlistitem[providesUpdatesSecurely=\\\"false\\\"] .notifyBadge,\\n richlistitem[blocklisted=\\\"true\\\"] .notifyBadge,\\n richlistitem[satisfiesDependencies=\\\"false\\\"] .notifyBadge {\\n   display: -moz-box;\\n@@ -205,6 +206,7 @@ richlistitem[type=\\\"4\\\"] .disableHide {\\n \\n /* Selected Add-on status messages and images */\\n richlistitem[compatible=\\\"true\\\"] .incompatibleBox,\\n+richlistitem[providesUpdatesSecurely=\\\"true\\\"] .insecureUpdateBox,\\n richlistitem[satisfiesDependencies=\\\"true\\\"] .needsDependenciesBox,\\n richlistitem[blocklisted=\\\"false\\\"] .blocklistedBox,\\n richlistitem[opType=\\\"needs-uninstall\\\"] .blocklistedBox,\\ndiff --git a/toolkit/themes/winstripe/mozapps/extensions/extensions.css b/toolkit/themes/winstripe/mozapps/extensions/extensions.css\\nindex df98c00..1867345 100644\\n--- a/toolkit/themes/winstripe/mozapps/extensions/extensions.css\\n+++ b/toolkit/themes/winstripe/mozapps/extensions/extensions.css\\n@@ -205,6 +205,7 @@ richlistitem .notifyBadge {\\n richlistitem[availableUpdateURL][updateable=\\\"true\\\"] .updateBadge,\\n richlistitem[availableUpdateURL][updateable=\\\"true\\\"] .updateAvailableBox,\\n richlistitem[compatible=\\\"false\\\"] .notifyBadge,\\n+richlistitem[providesUpdatesSecurely=\\\"false\\\"] .notifyBadge,\\n richlistitem[blocklisted=\\\"true\\\"] .notifyBadge,\\n richlistitem[satisfiesDependencies=\\\"false\\\"] .notifyBadge {\\n   display: -moz-box;\\n@@ -274,6 +275,7 @@ richlistitem[type=\\\"4\\\"] .disableHide {\\n \\n /* Selected Add-on status messages and images */\\n richlistitem[compatible=\\\"true\\\"] .incompatibleBox,\\n+richlistitem[providesUpdatesSecurely=\\\"true\\\"] .insecureUpdateBox,\\n richlistitem[satisfiesDependencies=\\\"true\\\"] .needsDependenciesBox,\\n richlistitem[blocklisted=\\\"false\\\"] .blocklistedBox,\\n richlistitem[opType=\\\"needs-uninstall\\\"] .blocklistedBox,\\n\""}