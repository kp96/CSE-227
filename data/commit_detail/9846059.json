{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas9846059\""},"diff":"\"9846059 Back out 398020 due to test failures.\\ndiff --git a/browser/base/content/browser-places.js b/browser/base/content/browser-places.js\\nindex 91969a3..3444c01 100644\\n--- a/browser/base/content/browser-places.js\\n+++ b/browser/base/content/browser-places.js\\n@@ -205,9 +205,8 @@ var PlacesCommandHook = {\\n     // it to the content area\\n     var starIcon = document.getElementById(\\\"star-button\\\");\\n     if (starIcon && isElementVisible(starIcon)) {\\n-      var dockTo = starIcon.parentNode; // urlbar endcap\\n       this.bookmarkPage(getBrowser().selectedBrowser, aParent, aShowEditUI,\\n-                        dockTo, \\\"after_start\\\");\\n+                        starIcon, \\\"after_start\\\");\\n     }\\n     else {\\n       this.bookmarkPage(getBrowser().selectedBrowser, aParent, aShowEditUI,\\ndiff --git a/browser/base/content/browser.js b/browser/base/content/browser.js\\nindex 7b1a175..63de19b 100644\\n--- a/browser/base/content/browser.js\\n+++ b/browser/base/content/browser.js\\n@@ -956,9 +956,9 @@ function delayedStartup()\\n   if (gURLBar && document.documentElement.getAttribute(\\\"chromehidden\\\").indexOf(\\\"toolbar\\\") != -1) {\\n     gURLBar.setAttribute(\\\"readonly\\\", \\\"true\\\");\\n     gURLBar.setAttribute(\\\"enablehistory\\\", \\\"false\\\");\\n-    var urlbarEndcap = document.getElementById(\\\"urlbar-endcap\\\");\\n-    if (urlbarEndcap)\\n-      urlbarEndcap.setAttribute(\\\"hidden\\\", \\\"true\\\");\\n+    var goButtonStack = document.getElementById(\\\"go-button-stack\\\");\\n+    if (goButtonStack)\\n+      goButtonStack.setAttribute(\\\"hidden\\\", \\\"true\\\");\\n   }\\n \\n   if (gURLBar) {\\n@@ -5574,9 +5574,9 @@ function showToolbars() {\\n     gURLBar.setAttribute(\\\"enablehistory\\\", \\\"true\\\");\\n   }\\n   \\n-  var urlbarEndcap = document.getElementById(\\\"urlbar-endcap\\\");\\n-  if (urlbarEndcap)\\n-    urlbarEndcap.removeAttribute(\\\"hidden\\\");\\n+  var goButtonStack = document.getElementById(\\\"go-button-stack\\\");\\n+  if (goButtonStack)\\n+    goButtonStack.removeAttribute(\\\"hidden\\\");\\n   \\n   return false; // Dismiss the notification message\\n }\\ndiff --git a/browser/base/content/browser.xul b/browser/base/content/browser.xul\\nindex 70ea737..0dd2062 100644\\n--- a/browser/base/content/browser.xul\\n+++ b/browser/base/content/browser.xul\\n@@ -264,17 +264,20 @@\\n #endif\\n             </hbox>\\n           </textbox>\\n-          <hbox id=\\\"urlbar-endcap\\\" class=\\\"endcap\\\" chromedir=\\\"&locale.dir;\\\">\\n-            <toolbarbutton id=\\\"star-button\\\"\\n-                           onclick=\\\"if (event.button == 0) PlacesStarButton.onClick(event);\\\"/>\\n-            <toolbarbutton id=\\\"go-button\\\" chromedir=\\\"&locale.dir;\\\"\\n-                           label=\\\"&goEndCap.label;\\\"\\n-                           onclick=\\\"handleURLBarCommand(event);\\\"\\n-                           ondragover=\\\"nsDragAndDrop.dragOver(event, goButtonObserver);\\\"\\n-                           ondragdrop=\\\"nsDragAndDrop.drop(event, goButtonObserver);\\\"\\n-                           ondragexit=\\\"nsDragAndDrop.dragExit(event, goButtonObserver);\\\"\\n-                           tooltiptext=\\\"&goEndCap.tooltip;\\\"/>\\n-          </hbox>\\n+          <stack id=\\\"go-button-stack\\\" class=\\\"endcap\\\">\\n+            <box class=\\\"endcap-box\\\" chromedir=\\\"&locale.dir;\\\"/>\\n+            <hbox>\\n+              <toolbarbutton id=\\\"star-button\\\"\\n+                             onclick=\\\"if (event.button == 0) PlacesStarButton.onClick(event);\\\"/>\\n+              <toolbarbutton id=\\\"go-button\\\" chromedir=\\\"&locale.dir;\\\"\\n+                             label=\\\"&goEndCap.label;\\\"\\n+                             onclick=\\\"handleURLBarCommand(event);\\\"\\n+                             ondragover=\\\"nsDragAndDrop.dragOver(event, goButtonObserver);\\\"\\n+                             ondragdrop=\\\"nsDragAndDrop.drop(event, goButtonObserver);\\\"\\n+                             ondragexit=\\\"nsDragAndDrop.dragExit(event, goButtonObserver);\\\"\\n+                             tooltiptext=\\\"&goEndCap.tooltip;\\\"/>\\n+            </hbox>\\n+          </stack>\\n         </hbox>\\n       </toolbaritem>\\n \\ndiff --git a/browser/components/search/content/search.xml b/browser/components/search/content/search.xml\\nindex e131bb8..639d35a0 100644\\n--- a/browser/components/search/content/search.xml\\n+++ b/browser/components/search/content/search.xml\\n@@ -102,14 +102,15 @@\\n           </xul:textbox>\\n         </xul:hbox>\\n \\n-        <xul:box class=\\\"endcap\\\" chromedir=\\\"&locale.dir;\\\">\\n+        <xul:stack class=\\\"search-go-button-stack endcap\\\">\\n+          <xul:box class=\\\"endcap-box\\\" chromedir=\\\"&locale.dir;\\\"/>\\n           <xul:toolbarbutton class=\\\"search-go-button\\\"\\n                              anonid=\\\"search-go-button\\\"\\n                              chromedir=\\\"&locale.dir;\\\"\\n                              oncommand=\\\"document.getBindingParent(this).handleSearchCommand(event);\\\"\\n                              onclick=\\\"checkForMiddleClick(this, event);\\\"\\n                              label=\\\"&searchEndCap.label;\\\" />\\n-        </xul:box>\\n+        </xul:stack>\\n       </xul:hbox>\\n     </content>\\n \\ndiff --git a/browser/themes/winstripe/browser/browser.css b/browser/themes/winstripe/browser/browser.css\\nindex 293a65a..3ab3175 100644\\n--- a/browser/themes/winstripe/browser/browser.css\\n+++ b/browser/themes/winstripe/browser/browser.css\\n@@ -1004,7 +1004,10 @@ statusbarpanel#statusbar-display {\\n /* ::::: endcaps ::::: */\\n \\n .endcap {\\n-  margin: 2px 0px 2px 0px;\\n+  padding: 2px 0px 2px 0px;\\n+}\\n+\\n+.endcap-box {\\n   -moz-border-radius: 0 4px 4px 0;\\n   border: 1px solid ThreeDShadow;\\n   border-left-width: 0;\\n@@ -1013,18 +1016,17 @@ statusbarpanel#statusbar-display {\\n   background-position: 50% 50%;\\n }\\n \\n-.endcap[chromedir=\\\"rtl\\\"] {\\n+toolbar:not([mode=\\\"text\\\"]) .endcap:hover > .endcap-box {\\n+  background-image: url(\\\"chrome://browser/skin/endcap-bkgnd-hover.png\\\");\\n+}\\n+\\n+.endcap-box[chromedir=\\\"rtl\\\"] {\\n   -moz-border-radius: 4px 0 0 4px;\\n   border-left-width: 1px;\\n   border-right-width: 0;\\n }\\n \\n-toolbar:not([mode=\\\"text\\\"]) .endcap:hover {\\n-  background-image: url(\\\"chrome://browser/skin/endcap-bkgnd-hover.png\\\");\\n-}\\n-\\n-toolbar[mode=\\\"text\\\"] .endcap {\\n-  margin: 0;\\n+toolbar[mode=\\\"text\\\"] .endcap-box {\\n   border: none;\\n   background-image: none;\\n }\\n@@ -1060,6 +1062,10 @@ toolbar[mode=\\\"text\\\"] #go-button {\\n   padding: 3px;\\n }\\n \\n+toolbar[mode=\\\"text\\\"] #go-button-stack {\\n+  padding: 0;\\n+}\\n+\\n #go-button > .toolbarbutton-icon {\\n   margin: 0;\\n }\\n@@ -1098,7 +1104,8 @@ toolbar:not([mode=\\\"text\\\"]) #star-button[starred=\\\"true\\\"],\\n }\\n \\n #star-button > .toolbarbutton-icon {\\n-  margin: 3px;\\n+  margin-left: 3px;\\n+  margin-right: 3px;\\n }\\n \\n /* ::::: content area ::::: */\\ndiff --git a/browser/themes/winstripe/browser/searchbar.css b/browser/themes/winstripe/browser/searchbar.css\\nindex 2bb518e..93e6250 100644\\n--- a/browser/themes/winstripe/browser/searchbar.css\\n+++ b/browser/themes/winstripe/browser/searchbar.css\\n@@ -163,6 +163,10 @@ toolbar[mode=\\\"text\\\"] .search-go-button {\\n   -moz-appearance: toolbarbutton;\\n }\\n \\n+toolbar[mode=\\\"text\\\"] .search-go-button-stack {\\n+  padding: 0px;\\n+}\\n+\\n toolbar[mode=\\\"text\\\"] .search-go-button {\\n   background-image: none;\\n   list-style-image: none;\\n\""}