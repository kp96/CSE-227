{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basd2a98a31\""},"diff":"\"d2a98a31 Bug 396982. Location bar autocomplete leaks. Patch by Nickolay Ponomarev <asqueella@gmail.com>. r=sspitzer/sayrer, a=mconnor\\ndiff --git a/toolkit/components/places/src/nsNavHistory.h b/toolkit/components/places/src/nsNavHistory.h\\nindex 1ed0611..650b0c3 100644\\n--- a/toolkit/components/places/src/nsNavHistory.h\\n+++ b/toolkit/components/places/src/nsNavHistory.h\\n@@ -591,6 +591,7 @@ protected:\\n   nsresult PerformAutoComplete();\\n   nsresult StartAutoCompleteTimer(PRUint32 aMilliseconds);\\n   static void AutoCompleteTimerCallback(nsITimer* aTimer, void* aClosure);\\n+  void DoneSearching();\\n \\n   PRInt32 mExpireDays;\\n \\ndiff --git a/toolkit/components/places/src/nsNavHistoryAutoComplete.cpp b/toolkit/components/places/src/nsNavHistoryAutoComplete.cpp\\nindex 186266b..9df379d 100644\\n--- a/toolkit/components/places/src/nsNavHistoryAutoComplete.cpp\\n+++ b/toolkit/components/places/src/nsNavHistoryAutoComplete.cpp\\n@@ -241,8 +241,17 @@ nsNavHistory::PerformAutoComplete()\\n     mCurrentChunkEndTime -= AUTOCOMPLETE_SEARCH_CHUNK;\\n     rv = StartAutoCompleteTimer(AUTOCOMPLETE_SEARCH_TIMEOUT);\\n     NS_ENSURE_SUCCESS(rv, rv);\\n+  } else {\\n+    DoneSearching();\\n   }\\n-  return rv;\\n+  return NS_OK;\\n+}\\n+\\n+void\\n+nsNavHistory::DoneSearching()\\n+{\\n+  mCurrentResult = nsnull;\\n+  mCurrentListener = nsnull;\\n }\\n \\n // nsNavHistory::StartSearch\\n@@ -412,7 +421,7 @@ nsNavHistory::StopSearch()\\n     mAutoCompleteTimer->Cancel();\\n \\n   mCurrentSearchString.Truncate();\\n-  mCurrentListener = nsnull;\\n+  DoneSearching();\\n \\n   return NS_OK;\\n }\\n\""}