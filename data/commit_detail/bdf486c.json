{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basbdf486c\""},"diff":"\"bdf486c Bug 395170 - with color managment on, grayscale pngs displaying incorrectly. r=vlad, a=pavlov\\ndiff --git a/modules/libpr0n/decoders/png/nsPNGDecoder.cpp b/modules/libpr0n/decoders/png/nsPNGDecoder.cpp\\nindex e93e003..69feefa 100644\\n--- a/modules/libpr0n/decoders/png/nsPNGDecoder.cpp\\n+++ b/modules/libpr0n/decoders/png/nsPNGDecoder.cpp\\n@@ -476,20 +476,6 @@ info_callback(png_structp png_ptr, png_infop info_ptr)\\n       png_set_gamma(png_ptr, 2.2, 0.45455);\\n   }\\n \\n-  if (color_type == PNG_COLOR_TYPE_GRAY ||\\n-      color_type == PNG_COLOR_TYPE_GRAY_ALPHA)\\n-      png_set_gray_to_rgb(png_ptr);\\n-\\n-  if (png_get_gAMA(png_ptr, info_ptr, &aGamma)) {\\n-      if ((aGamma <= 0.0) || (aGamma > 21474.83)) {\\n-          aGamma = 0.45455;\\n-          png_set_gAMA(png_ptr, info_ptr, aGamma);\\n-      }\\n-      png_set_gamma(png_ptr, 2.2, aGamma);\\n-  }\\n-  else\\n-      png_set_gamma(png_ptr, 2.2, 0.45455);\\n-\\n   /* let libpng expand interlaced images */\\n   if (interlace_type == PNG_INTERLACE_ADAM7) {\\n     /* number_passes = */\\n\""}