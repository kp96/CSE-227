{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas04220b6\""},"diff":"\"04220b6 Bug 227749 - \\\"Add \\\"Copy Source Location\\\" to download manager context menu\\\" [p=jhenry@ccs.neu.edu (Jon Henry) r=sdwilsh ui-r=beltzner]\\ndiff --git a/toolkit/locales/en-US/chrome/mozapps/downloads/downloads.dtd b/toolkit/locales/en-US/chrome/mozapps/downloads/downloads.dtd\\nindex 5f1c2f0..518c93c 100644\\n--- a/toolkit/locales/en-US/chrome/mozapps/downloads/downloads.dtd\\n+++ b/toolkit/locales/en-US/chrome/mozapps/downloads/downloads.dtd\\n@@ -28,6 +28,8 @@\\n <!ENTITY cmd.openWith.accesskey           \\\"h\\\">\\n <!ENTITY cmd.retry.label                  \\\"Retry\\\">\\n <!ENTITY cmd.retry.accesskey              \\\"R\\\">\\n+<!ENTITY cmd.copyLocation.label           \\\"Copy Source Location\\\">\\n+<!ENTITY cmd.copyLocation.accesskey       \\\"L\\\">\\n <!ENTITY cmd.remove.label                 \\\"Remove\\\">\\n <!ENTITY cmd.remove.accesskey             \\\"e\\\">\\n <!ENTITY cmd.info.label                   \\\"Information\\\">\\ndiff --git a/toolkit/mozapps/downloads/content/downloads.js b/toolkit/mozapps/downloads/content/downloads.js\\nindex 0bd31c7..c15b333 100644\\n--- a/toolkit/mozapps/downloads/content/downloads.js\\n+++ b/toolkit/mozapps/downloads/content/downloads.js\\n@@ -364,6 +364,15 @@ function retryDownload(aDownload)\\n   gDownloadManager.retryDownload(aDownload.getAttribute(\\\"dlid\\\"));\\n }\\n \\n+function copySourceLocation(aDownload)\\n+{\\n+  var uri = aDownload.getAttribute(\\\"uri\\\");\\n+  var clipboard = Cc[\\\"@mozilla.org/widget/clipboardhelper;1\\\"].\\n+                  getService(Ci.nsIClipboardHelper);\\n+\\n+  clipboard.copyString(uri);\\n+}\\n+\\n // This is called by the progress listener. We don't actually use the event\\n // system here to minimize time wastage. \\n var gLastComputedMean = -1;\\n@@ -449,19 +458,26 @@ function Shutdown()\\n // View Context Menus\\n var gContextMenus = [\\n   // DOWNLOAD_DOWNLOADING\\n-  [\\\"menuitem_pause\\\", \\\"menuitem_cancel\\\"],\\n+  [\\\"menuitem_pause\\\", \\\"menuitem_cancel\\\", \\\"menuseparator_copy_location\\\",\\n+   \\\"menuitem_copyLocation\\\"],\\n   // DOWNLOAD_FINISHED\\n-  [\\\"menuitem_open\\\", \\\"menuitem_show\\\", \\\"menuitem_remove\\\"],\\n+  [\\\"menuitem_open\\\", \\\"menuitem_show\\\", \\\"menuitem_remove\\\",\\n+   \\\"menuseparator_copy_location\\\", \\\"menuitem_copyLocation\\\"],\\n   // DOWNLOAD_FAILED\\n-  [\\\"menuitem_retry\\\", \\\"menuitem_remove\\\"],\\n+  [\\\"menuitem_retry\\\", \\\"menuitem_remove\\\", \\\"menuseparator_copy_location\\\",\\n+   \\\"menuitem_copyLocation\\\"],\\n   // DOWNLOAD_CANCELED\\n-  [\\\"menuitem_retry\\\", \\\"menuitem_remove\\\"],\\n+  [\\\"menuitem_retry\\\", \\\"menuitem_remove\\\", \\\"menuseparator_copy_location\\\",\\n+   \\\"menuitem_copyLocation\\\"],\\n   // DOWNLOAD_PAUSED\\n-  [\\\"menuitem_resume\\\", \\\"menuitem_cancel\\\"],\\n+  [\\\"menuitem_resume\\\", \\\"menuitem_cancel\\\", \\\"menuseparator_copy_location\\\",\\n+   \\\"menuitem_copyLocation\\\"],\\n   // DOWNLOAD_QUEUED\\n-  [\\\"menuitem_cancel\\\"],\\n+  [\\\"menuitem_cancel\\\", \\\"menuseparator_copy_location\\\",\\n+   \\\"menuitem_copyLocation\\\"],\\n   // DOWNLOAD_BLOCKED\\n-  [\\\"menuitem_retry\\\", \\\"menuitem_remove\\\"]\\n+  [\\\"menuitem_retry\\\", \\\"menuitem_remove\\\", \\\"menuseparator_copy_location\\\",\\n+   \\\"menuitem_copyLocation\\\"]\\n ];\\n \\n function buildContextMenu(aEvent)\\n@@ -557,6 +573,7 @@ var gDownloadViewController = {\\n       case \\\"cmd_retry\\\":\\n         return dl.removable;\\n       case \\\"cmd_showInfo\\\":\\n+      case \\\"cmd_copyLocation\\\":\\n         return true;\\n     }\\n     return false;\\n@@ -616,6 +633,9 @@ var gDownloadViewController = {\\n     },\\n     cmd_showInfo: function(aSelectedItem) {\\n       showDownloadInfo(aSelectedItem);\\n+    },\\n+    cmd_copyLocation: function(aSelectedItem) {\\n+      copySourceLocation(aSelectedItem);\\n     }\\n   }\\n };\\ndiff --git a/toolkit/mozapps/downloads/content/downloads.xul b/toolkit/mozapps/downloads/content/downloads.xul\\nindex a7e835c..30facac 100644\\n--- a/toolkit/mozapps/downloads/content/downloads.xul\\n+++ b/toolkit/mozapps/downloads/content/downloads.xul\\n@@ -98,6 +98,8 @@\\n              oncommand=\\\"gDownloadViewController.doCommand('cmd_show');\\\"/>\\n     <command id=\\\"cmd_showInfo\\\"\\n              oncommand=\\\"gDownloadViewController.doCommand('cmd_showInfo');\\\"/>\\n+    <command id=\\\"cmd_copyLocation\\\"\\n+             oncommand=\\\"gDownloadViewController.doCommand('cmd_copyLocation');\\\"/>\\n   </commandset>\\n     \\n   <keyset id=\\\"downloadKeys\\\">\\n@@ -147,6 +149,13 @@\\n     <menuitem id=\\\"menuitem_remove\\\"\\n               label=\\\"&cmd.remove.label;\\\" accesskey=\\\"&cmd.remove.accesskey;\\\"\\n               command=\\\"cmd_remove\\\"/>\\n+              \\n+    <menuseparator id=\\\"menuseparator_copy_location\\\"/>\\n+              \\n+    <menuitem id=\\\"menuitem_copyLocation\\\"\\n+              label=\\\"&cmd.copyLocation.label;\\\"\\n+              accesskey=\\\"&cmd.copyLocation.accesskey;\\\"\\n+              command=\\\"cmd_copyLocation\\\"/>\\n   </vbox>\\n   \\n   <menupopup id=\\\"downloadContextMenu\\\" onpopupshowing=\\\"return buildContextMenu(event);\\\"/>\\n\""}