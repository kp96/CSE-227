{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basa20d56b\""},"diff":"\"a20d56b Bug 392252 need new APIs for converting AppUnits to gfx usable pixels r=sharparrow1, sr+a=roc\\ndiff --git a/accessible/src/atk/Makefile.in b/accessible/src/atk/Makefile.in\\nindex 6c72a76..771172b 100644\\n--- a/accessible/src/atk/Makefile.in\\n+++ b/accessible/src/atk/Makefile.in\\n@@ -50,6 +50,7 @@ REQUIRES\\t= content \\\\\\n \\t\\t  dom \\\\\\n \\t\\t  editor \\\\\\n \\t\\t  gfx \\\\\\n+\\t\\t  thebes \\\\\\n \\t\\t  intl \\\\\\n \\t\\t  layout \\\\\\n \\t\\t  locale \\\\\\ndiff --git a/accessible/src/base/Makefile.in b/accessible/src/base/Makefile.in\\nindex 1bfa38b..179486f 100644\\n--- a/accessible/src/base/Makefile.in\\n+++ b/accessible/src/base/Makefile.in\\n@@ -54,6 +54,7 @@ REQUIRES\\t= appshell \\\\\\n \\t\\t  dom \\\\\\n \\t\\t  editor \\\\\\n \\t\\t  gfx \\\\\\n+\\t\\t  thebes \\\\\\n \\t\\t  intl \\\\\\n \\t\\t  layout \\\\\\n \\t\\t  locale \\\\\\ndiff --git a/accessible/src/mac/Makefile.in b/accessible/src/mac/Makefile.in\\nindex e99ae3d..29a2d0e 100644\\n--- a/accessible/src/mac/Makefile.in\\n+++ b/accessible/src/mac/Makefile.in\\n@@ -51,6 +51,7 @@ REQUIRES\\t= content \\\\\\n \\t\\t  dom \\\\\\n \\t\\t  editor \\\\\\n \\t\\t  gfx \\\\\\n+\\t\\t  thebes \\\\\\n \\t\\t  intl \\\\\\n \\t\\t  locale \\\\\\n \\t\\t  string \\\\\\ndiff --git a/accessible/src/msaa/Makefile.in b/accessible/src/msaa/Makefile.in\\nindex 678655d..608f68a 100644\\n--- a/accessible/src/msaa/Makefile.in\\n+++ b/accessible/src/msaa/Makefile.in\\n@@ -50,6 +50,7 @@ REQUIRES\\t= content \\\\\\n \\t\\t  dom \\\\\\n \\t\\t  editor \\\\\\n \\t\\t  gfx \\\\\\n+\\t\\t  thebes \\\\\\n \\t\\t  htmlparser \\\\\\n \\t\\t  intl \\\\\\n \\t\\t  layout \\\\\\ndiff --git a/accessible/src/other/Makefile.in b/accessible/src/other/Makefile.in\\nindex d03ab64..523c710 100755\\n--- a/accessible/src/other/Makefile.in\\n+++ b/accessible/src/other/Makefile.in\\n@@ -50,6 +50,7 @@ REQUIRES\\t= content \\\\\\n \\t\\t  dom \\\\\\n \\t\\t  editor \\\\\\n \\t\\t  gfx \\\\\\n+\\t\\t  thebes \\\\\\n \\t\\t  htmlparser \\\\\\n \\t\\t  intl \\\\\\n \\t\\t  layout \\\\\\ndiff --git a/accessible/src/xforms/Makefile.in b/accessible/src/xforms/Makefile.in\\nindex 1b5f771..508c09f 100755\\n--- a/accessible/src/xforms/Makefile.in\\n+++ b/accessible/src/xforms/Makefile.in\\n@@ -52,6 +52,7 @@ REQUIRES\\t= content \\\\\\n       dom \\\\\\n       editor \\\\\\n       gfx \\\\\\n+      thebes \\\\\\n       intl \\\\\\n       layout \\\\\\n       locale \\\\\\ndiff --git a/accessible/src/xul/Makefile.in b/accessible/src/xul/Makefile.in\\nindex d666523..7fde713 100644\\n--- a/accessible/src/xul/Makefile.in\\n+++ b/accessible/src/xul/Makefile.in\\n@@ -52,6 +52,7 @@ REQUIRES\\t= content \\\\\\n \\t\\t  dom \\\\\\n \\t\\t  editor \\\\\\n \\t\\t  gfx \\\\\\n+\\t\\t  thebes \\\\\\n \\t\\t  intl \\\\\\n \\t\\t  layout \\\\\\n \\t\\t  locale \\\\\\ndiff --git a/content/events/src/Makefile.in b/content/events/src/Makefile.in\\nindex d32ec6a..5f8318f 100644\\n--- a/content/events/src/Makefile.in\\n+++ b/content/events/src/Makefile.in\\n@@ -51,6 +51,7 @@ REQUIRES\\t= xpcom \\\\\\n \\t\\t  js \\\\\\n \\t\\t  locale \\\\\\n \\t\\t  gfx \\\\\\n+\\t\\t  thebes \\\\\\n \\t\\t  layout \\\\\\n \\t\\t  widget \\\\\\n \\t\\t  caps \\\\\\ndiff --git a/content/html/content/src/Makefile.in b/content/html/content/src/Makefile.in\\nindex a6edfef..8bae404 100644\\n--- a/content/html/content/src/Makefile.in\\n+++ b/content/html/content/src/Makefile.in\\n@@ -49,6 +49,7 @@ LIBXUL_LIBRARY\\t= 1\\n REQUIRES\\t= xpcom \\\\\\n \\t\\t  string \\\\\\n \\t\\t  gfx \\\\\\n+\\t\\t  thebes \\\\\\n \\t\\t  layout \\\\\\n \\t\\t  widget \\\\\\n \\t\\t  dom \\\\\\ndiff --git a/content/html/document/src/Makefile.in b/content/html/document/src/Makefile.in\\nindex 23ac373..51dfe30 100644\\n--- a/content/html/document/src/Makefile.in\\n+++ b/content/html/document/src/Makefile.in\\n@@ -49,6 +49,7 @@ LIBXUL_LIBRARY\\t= 1\\n REQUIRES\\t= xpcom \\\\\\n \\t\\t  string \\\\\\n \\t\\t  gfx \\\\\\n+\\t\\t  thebes \\\\\\n \\t\\t  layout \\\\\\n \\t\\t  widget \\\\\\n \\t\\t  dom \\\\\\ndiff --git a/content/svg/document/src/Makefile.in b/content/svg/document/src/Makefile.in\\nindex f812686..845afae 100644\\n--- a/content/svg/document/src/Makefile.in\\n+++ b/content/svg/document/src/Makefile.in\\n@@ -51,6 +51,7 @@ REQUIRES\\t= content \\\\\\n \\t\\t  xpcom \\\\\\n \\t\\t  string \\\\\\n \\t\\t  gfx \\\\\\n+\\t\\t  thebes \\\\\\n \\t\\t  dom \\\\\\n \\t\\t  webshell \\\\\\n \\t\\t  htmlparser \\\\\\ndiff --git a/content/xbl/src/Makefile.in b/content/xbl/src/Makefile.in\\nindex 6de22a5..3c4986d 100644\\n--- a/content/xbl/src/Makefile.in\\n+++ b/content/xbl/src/Makefile.in\\n@@ -51,6 +51,7 @@ REQUIRES\\t= xpcom \\\\\\n \\t\\t  js \\\\\\n \\t\\t  dom \\\\\\n \\t\\t  gfx \\\\\\n+\\t\\t  thebes \\\\\\n \\t\\t  layout \\\\\\n \\t\\t  xultmpl \\\\\\n \\t\\t  widget \\\\\\ndiff --git a/content/xml/content/src/Makefile.in b/content/xml/content/src/Makefile.in\\nindex e7dd530..8c0e710 100644\\n--- a/content/xml/content/src/Makefile.in\\n+++ b/content/xml/content/src/Makefile.in\\n@@ -51,6 +51,7 @@ REQUIRES\\t= xpcom \\\\\\n \\t\\t  js \\\\\\n \\t\\t  dom \\\\\\n \\t\\t  gfx \\\\\\n+\\t\\t  thebes \\\\\\n \\t\\t  layout \\\\\\n \\t\\t  widget \\\\\\n \\t\\t  necko \\\\\\ndiff --git a/content/xml/document/src/Makefile.in b/content/xml/document/src/Makefile.in\\nindex e8c56bc..d77e017 100644\\n--- a/content/xml/document/src/Makefile.in\\n+++ b/content/xml/document/src/Makefile.in\\n@@ -51,6 +51,7 @@ REQUIRES\\t= xpcom \\\\\\n \\t\\t  js \\\\\\n \\t\\t  dom \\\\\\n \\t\\t  gfx \\\\\\n+\\t\\t  thebes \\\\\\n \\t\\t  layout \\\\\\n \\t\\t  widget \\\\\\n \\t\\t  caps \\\\\\ndiff --git a/content/xtf/src/Makefile.in b/content/xtf/src/Makefile.in\\nindex 2d53a80..7df3859 100644\\n--- a/content/xtf/src/Makefile.in\\n+++ b/content/xtf/src/Makefile.in\\n@@ -50,6 +50,7 @@ REQUIRES\\t= xpcom \\\\\\n \\t\\t  layout \\\\\\n \\t\\t  widget \\\\\\n \\t\\t  gfx \\\\\\n+\\t\\t  thebes \\\\\\n \\t\\t  dom \\\\\\n \\t\\t  js \\\\\\n \\t\\t  locale \\\\\\ndiff --git a/content/xul/content/src/Makefile.in b/content/xul/content/src/Makefile.in\\nindex 8b21de9..2bb29d4 100644\\n--- a/content/xul/content/src/Makefile.in\\n+++ b/content/xul/content/src/Makefile.in\\n@@ -52,6 +52,7 @@ endif\\n REQUIRES\\t= xpcom \\\\\\n \\t\\t  string \\\\\\n \\t\\t  gfx \\\\\\n+\\t\\t  thebes \\\\\\n \\t\\t  layout \\\\\\n \\t\\t  content \\\\\\n \\t\\t  widget \\\\\\ndiff --git a/content/xul/document/src/Makefile.in b/content/xul/document/src/Makefile.in\\nindex 8151b22..c1c5d6e 100644\\n--- a/content/xul/document/src/Makefile.in\\n+++ b/content/xul/document/src/Makefile.in\\n@@ -51,6 +51,7 @@ REQUIRES\\t= xpcom \\\\\\n \\t\\t  exthandler \\\\\\n \\t\\t  mimetype \\\\\\n \\t\\t  gfx \\\\\\n+\\t\\t  thebes \\\\\\n \\t\\t  layout \\\\\\n \\t\\t  content \\\\\\n \\t\\t  widget \\\\\\ndiff --git a/content/xul/templates/src/Makefile.in b/content/xul/templates/src/Makefile.in\\nindex e88e5d1..34b85e3 100644\\n--- a/content/xul/templates/src/Makefile.in\\n+++ b/content/xul/templates/src/Makefile.in\\n@@ -52,6 +52,7 @@ REQUIRES\\t= xpcom \\\\\\n \\t\\t  xpconnect \\\\\\n \\t\\t  caps \\\\\\n \\t\\t  gfx \\\\\\n+\\t\\t  thebes \\\\\\n \\t\\t  layout \\\\\\n \\t\\t  content \\\\\\n \\t\\t  pref \\\\\\ndiff --git a/docshell/base/Makefile.in b/docshell/base/Makefile.in\\nindex 7380218..fd10746 100644\\n--- a/docshell/base/Makefile.in\\n+++ b/docshell/base/Makefile.in\\n@@ -56,6 +56,7 @@ REQUIRES\\t= xpcom \\\\\\n \\t\\t  caps \\\\\\n \\t\\t  necko \\\\\\n \\t\\t  gfx \\\\\\n+\\t\\t  thebes \\\\\\n \\t\\t  layout \\\\\\n \\t\\t  content \\\\\\n \\t\\t  dom \\\\\\ndiff --git a/docshell/build/Makefile.in b/docshell/build/Makefile.in\\nindex bff9e63..a018bc2 100644\\n--- a/docshell/build/Makefile.in\\n+++ b/docshell/build/Makefile.in\\n@@ -62,6 +62,7 @@ REQUIRES\\t= xpcom \\\\\\n \\t\\t  necko \\\\\\n \\t\\t  nkcache \\\\\\n \\t\\t  gfx \\\\\\n+\\t\\t  thebes \\\\\\n \\t\\t  content \\\\\\n \\t\\t  layout \\\\\\n \\t\\t  webshell \\\\\\ndiff --git a/dom/src/base/Makefile.in b/dom/src/base/Makefile.in\\nindex 17ffabe..596954a 100644\\n--- a/dom/src/base/Makefile.in\\n+++ b/dom/src/base/Makefile.in\\n@@ -53,6 +53,7 @@ REQUIRES\\t= xpcom \\\\\\n \\t\\t  js \\\\\\n \\t\\t  widget \\\\\\n \\t\\t  gfx \\\\\\n+\\t\\t  thebes \\\\\\n \\t\\t  layout \\\\\\n \\t\\t  content \\\\\\n \\t\\t  caps \\\\\\ndiff --git a/dom/src/offline/Makefile.in b/dom/src/offline/Makefile.in\\nindex 80732a3..127e93d 100644\\n--- a/dom/src/offline/Makefile.in\\n+++ b/dom/src/offline/Makefile.in\\n@@ -51,6 +51,7 @@ REQUIRES       = xpcom         \\\\\\n \\t\\t content       \\\\\\n \\t\\t caps          \\\\\\n \\t\\t gfx           \\\\\\n+\\t\\t thebes        \\\\\\n \\t\\t js            \\\\\\n \\t\\t layout        \\\\\\n \\t\\t locale        \\\\\\ndiff --git a/dom/src/storage/Makefile.in b/dom/src/storage/Makefile.in\\nindex de6100f..5f35765 100644\\n--- a/dom/src/storage/Makefile.in\\n+++ b/dom/src/storage/Makefile.in\\n@@ -51,6 +51,7 @@ REQUIRES       = xpcom         \\\\\\n                  content       \\\\\\n                  caps          \\\\\\n                  gfx           \\\\\\n+                 thebes        \\\\\\n                  js            \\\\\\n                  layout        \\\\\\n                  locale        \\\\\\ndiff --git a/editor/composer/src/Makefile.in b/editor/composer/src/Makefile.in\\nindex d6beb07..6202777b 100644\\n--- a/editor/composer/src/Makefile.in\\n+++ b/editor/composer/src/Makefile.in\\n@@ -65,6 +65,7 @@ REQUIRES\\t= xpcom \\\\\\n \\t\\t  webshell \\\\\\n \\t\\t  docshell \\\\\\n \\t\\t  gfx \\\\\\n+\\t\\t  thebes \\\\\\n \\t\\t  widget \\\\\\n \\t\\t  xuldoc \\\\\\n \\t\\t  txtsvc \\\\\\ndiff --git a/editor/libeditor/base/Makefile.in b/editor/libeditor/base/Makefile.in\\nindex 3ca776f..4059045 100644\\n--- a/editor/libeditor/base/Makefile.in\\n+++ b/editor/libeditor/base/Makefile.in\\n@@ -59,6 +59,7 @@ REQUIRES\\t= xpcom \\\\\\n \\t\\t  pref \\\\\\n \\t\\t  view \\\\\\n \\t\\t  gfx \\\\\\n+\\t\\t  thebes \\\\\\n \\t\\t  widget \\\\\\n \\t\\t  unicharutil \\\\\\n \\t\\t  commandhandler \\\\\\ndiff --git a/editor/libeditor/text/Makefile.in b/editor/libeditor/text/Makefile.in\\nindex ba6f9022..a15e89e 100644\\n--- a/editor/libeditor/text/Makefile.in\\n+++ b/editor/libeditor/text/Makefile.in\\n@@ -59,6 +59,7 @@ REQUIRES\\t= xpcom \\\\\\n \\t\\t  pref \\\\\\n \\t\\t  lwbrk \\\\\\n \\t\\t  gfx \\\\\\n+\\t\\t  thebes \\\\\\n \\t\\t  widget \\\\\\n \\t\\t  unicharutil \\\\\\n \\t\\t  $(NULL)\\ndiff --git a/editor/txtsvc/src/Makefile.in b/editor/txtsvc/src/Makefile.in\\nindex 8bfbfa4..a38d2d6 100644\\n--- a/editor/txtsvc/src/Makefile.in\\n+++ b/editor/txtsvc/src/Makefile.in\\n@@ -52,6 +52,7 @@ REQUIRES\\t= xpcom \\\\\\n \\t\\t  string \\\\\\n \\t\\t  editor \\\\\\n \\t\\t  gfx \\\\\\n+\\t\\t  thebes \\\\\\n \\t\\t  layout \\\\\\n \\t\\t  content \\\\\\n \\t\\t  dom \\\\\\ndiff --git a/embedding/browser/webBrowser/Makefile.in b/embedding/browser/webBrowser/Makefile.in\\nindex e352baf..4fcdd6c 100644\\n--- a/embedding/browser/webBrowser/Makefile.in\\n+++ b/embedding/browser/webBrowser/Makefile.in\\n@@ -54,6 +54,7 @@ REQUIRES\\t= xpcom \\\\\\n \\t\\t  docshell \\\\\\n \\t\\t  widget \\\\\\n \\t\\t  gfx \\\\\\n+\\t\\t  thebes \\\\\\n \\t\\t  layout \\\\\\n \\t\\t  content \\\\\\n \\t\\t  dom \\\\\\ndiff --git a/embedding/components/find/src/Makefile.in b/embedding/components/find/src/Makefile.in\\nindex f963b26..7ff8d49a 100644\\n--- a/embedding/components/find/src/Makefile.in\\n+++ b/embedding/components/find/src/Makefile.in\\n@@ -51,6 +51,7 @@ REQUIRES\\t= string \\\\\\n \\t\\t  dom \\\\\\n \\t\\t  docshell \\\\\\n \\t\\t  gfx \\\\\\n+\\t\\t  thebes \\\\\\n \\t\\t  layout \\\\\\n \\t\\t  editor \\\\\\n \\t\\t  locale \\\\\\ndiff --git a/extensions/layout-debug/src/Makefile.in b/extensions/layout-debug/src/Makefile.in\\nindex 617b940..dffb102 100644\\n--- a/extensions/layout-debug/src/Makefile.in\\n+++ b/extensions/layout-debug/src/Makefile.in\\n@@ -55,6 +55,7 @@ REQUIRES\\t= xpcom \\\\\\n \\t\\t  docshell \\\\\\n \\t\\t  dom \\\\\\n \\t\\t  gfx \\\\\\n+\\t\\t  thebes \\\\\\n \\t\\t  content \\\\\\n \\t\\t  necko \\\\\\n \\t\\t  layout \\\\\\ndiff --git a/gfx/public/nsIDeviceContext.h b/gfx/public/nsIDeviceContext.h\\nindex aa0bd7d..c06646b 100644\\n--- a/gfx/public/nsIDeviceContext.h\\n+++ b/gfx/public/nsIDeviceContext.h\\n@@ -44,6 +44,8 @@\\n #include \\\"nsRect.h\\\"\\n #include \\\"nsIWidget.h\\\"\\n #include \\\"nsIRenderingContext.h\\\"\\n+// XXX we need only gfxTypes.h, but we cannot include it directly.\\n+#include \\\"gfxPoint.h\\\"\\n \\n class nsIView;\\n class nsIFontMetrics;\\n@@ -166,10 +168,10 @@ const PRUint8 kUseAltDCFor_CREATERC_PAINT  = 0x04; // Use when creating Renderin\\n const PRUint8 kUseAltDCFor_SURFACE_DIM     = 0x08; // Use it for getting the Surface Dimensions\\n #endif\\n \\n-// 7353cfdf-964f-4c20-8729-b11729cc0000\\n+// 4dd372b6-ef19-4995-a7ac-ba3efd3f656f\\n #define NS_IDEVICE_CONTEXT_IID   \\\\\\n-{ 0x7353cfdf, 0x964f, 0x4c20, \\\\\\n- { 0x87, 0x29, 0xb1, 0x17, 0x29, 0xcc, 0x00, 0x00 } }\\n+{ 0x4dd372b6, 0xef19, 0x4995, \\\\\\n+ { 0xa7, 0xac, 0xba, 0x3e, 0xfd, 0x3f, 0x65, 0x6f } }\\n \\n //a cross platform way of specifying a native palette handle\\n typedef void * nsPalette;\\n@@ -281,12 +283,24 @@ public:\\n   static PRInt32 AppUnitsPerCSSPixel() { return 60; }\\n \\n   /**\\n+   * Convert app units to CSS pixels which is used in gfx/thebes.\\n+   */\\n+  static gfxFloat AppUnitsToGfxCSSPixels(nscoord aAppUnits)\\n+  { return gfxFloat(aAppUnits) / AppUnitsPerCSSPixel(); }\\n+\\n+  /**\\n    * Gets the number of app units in one device pixel; this number is usually\\n    * a factor of AppUnitsPerCSSPixel(), although that is not guaranteed.\\n    */\\n   PRInt32 AppUnitsPerDevPixel() const { return mAppUnitsPerDevPixel; }\\n \\n   /**\\n+   * Convert app units to device pixels which is used in gfx/thebes.\\n+   */\\n+  gfxFloat AppUnitsToGfxUnits(nscoord aAppUnits) const\\n+  { return gfxFloat(aAppUnits) / AppUnitsPerDevPixel(); }\\n+\\n+  /**\\n    * Gets the number of app units in one inch; this is the device's DPI\\n    * times AppUnitsPerDevPixel().\\n    */\\ndiff --git a/gfx/src/Makefile.in b/gfx/src/Makefile.in\\nindex 7db0c97..b7c9048 100644\\n--- a/gfx/src/Makefile.in\\n+++ b/gfx/src/Makefile.in\\n@@ -59,6 +59,7 @@ REQUIRES\\t= xpcom \\\\\\n \\t\\t  view \\\\\\n \\t\\t  pref \\\\\\n \\t\\t  unicharutil \\\\\\n+\\t\\t  thebes \\\\\\n \\t\\t  $(NULL)\\n \\n DIRS        = shared\\ndiff --git a/gfx/src/thebes/nsThebesFontMetrics.cpp b/gfx/src/thebes/nsThebesFontMetrics.cpp\\nindex c6ac42b..880c052 100644\\n--- a/gfx/src/thebes/nsThebesFontMetrics.cpp\\n+++ b/gfx/src/thebes/nsThebesFontMetrics.cpp\\n@@ -73,7 +73,7 @@ nsThebesFontMetrics::Init(const nsFont& aFont, nsIAtom* aLangGroup,\\n     mTextRunRTL = PR_FALSE;\\n \\n     // work around layout giving us 0 sized fonts...\\n-    double size = NSAppUnitsToFloatPixels(aFont.size, mP2A);\\n+    gfxFloat size = gfxFloat(aFont.size) / mP2A;\\n     if (size == 0.0)\\n         size = 1.0;\\n \\ndiff --git a/layout/base/nsCSSRendering.h b/layout/base/nsCSSRendering.h\\nindex 59f61d6..b063192 100644\\n--- a/layout/base/nsCSSRendering.h\\n+++ b/layout/base/nsCSSRendering.h\\n@@ -201,7 +201,7 @@ public:\\n \\n   /**\\n    * Function for painting the decoration lines for the text.\\n-   * NOTE: aPt, aLineSize, aAscent, aOffset and aReferredHeight are non-rounded\\n+   * NOTE: aPt, aLineSize, aAscent, aOffset and aPreferredHeight are non-rounded\\n    *       device pixels, not app units.\\n    *   input:\\n    *     @param aGfxContext\\ndiff --git a/layout/base/nsLayoutUtils.cpp b/layout/base/nsLayoutUtils.cpp\\nindex cc1608e..9f6ac35 100644\\n--- a/layout/base/nsLayoutUtils.cpp\\n+++ b/layout/base/nsLayoutUtils.cpp\\n@@ -2141,11 +2141,10 @@ nsLayoutUtils::DrawImage(nsIRenderingContext* aRenderingContext,\\n   // of the image)\\n   gfxRect pxSrc;\\n   if (aSourceRect) {\\n-    PRInt32 p2a = nsIDeviceContext::AppUnitsPerCSSPixel();\\n-    pxSrc.pos.x = NSAppUnitsToFloatPixels(aSourceRect->x, p2a);\\n-    pxSrc.pos.y = NSAppUnitsToFloatPixels(aSourceRect->y, p2a);\\n-    pxSrc.size.width = NSAppUnitsToFloatPixels(aSourceRect->width, p2a);\\n-    pxSrc.size.height = NSAppUnitsToFloatPixels(aSourceRect->height, p2a);\\n+    pxSrc.pos.x = nsIDeviceContext::AppUnitsToGfxCSSPixels(aSourceRect->x);\\n+    pxSrc.pos.y = nsIDeviceContext::AppUnitsToGfxCSSPixels(aSourceRect->y);\\n+    pxSrc.size.width = nsIDeviceContext::AppUnitsToGfxCSSPixels(aSourceRect->width);\\n+    pxSrc.size.height = nsIDeviceContext::AppUnitsToGfxCSSPixels(aSourceRect->height);\\n   } else {\\n     pxSrc.pos.x = pxSrc.pos.y = 0.0;\\n     PRInt32 w = 0, h = 0;\\n@@ -2157,7 +2156,6 @@ nsLayoutUtils::DrawImage(nsIRenderingContext* aRenderingContext,\\n \\n   nsCOMPtr<nsIDeviceContext> dc;\\n   aRenderingContext->GetDeviceContext(*getter_AddRefs(dc));\\n-  PRInt32 d2a = dc->AppUnitsPerDevPixel();\\n \\n   nsRefPtr<gfxContext> ctx = static_cast<gfxContext*>\\n                                         (aRenderingContext->GetNativeGraphicData(\\n@@ -2170,10 +2168,10 @@ nsLayoutUtils::DrawImage(nsIRenderingContext* aRenderingContext,\\n   // pixel, but then convert back to gfxFloats for the rest of the math.\\n   gfxRect pxDest;\\n   {\\n-    pxDest.pos.x = NSAppUnitsToFloatPixels(aDestRect.x, d2a);\\n-    pxDest.pos.y = NSAppUnitsToFloatPixels(aDestRect.y, d2a);\\n-    pxDest.size.width = NSAppUnitsToFloatPixels(aDestRect.width, d2a);\\n-    pxDest.size.height = NSAppUnitsToFloatPixels(aDestRect.height, d2a);\\n+    pxDest.pos.x = dc->AppUnitsToGfxUnits(aDestRect.x);\\n+    pxDest.pos.y = dc->AppUnitsToGfxUnits(aDestRect.y);\\n+    pxDest.size.width = dc->AppUnitsToGfxUnits(aDestRect.width);\\n+    pxDest.size.height = dc->AppUnitsToGfxUnits(aDestRect.height);\\n     if (ctx->UserToDevicePixelSnapped(pxDest))\\n       pxDest = ctx->DeviceToUser(pxDest);\\n   }\\n@@ -2184,10 +2182,10 @@ nsLayoutUtils::DrawImage(nsIRenderingContext* aRenderingContext,\\n   // been intersected with, and we should be rounding those consistently.)\\n   gfxRect pxDirty;\\n   {\\n-    pxDirty.pos.x = NSAppUnitsToFloatPixels(dirtyRect.x, d2a);\\n-    pxDirty.pos.y = NSAppUnitsToFloatPixels(dirtyRect.y, d2a);\\n-    pxDirty.size.width = NSAppUnitsToFloatPixels(dirtyRect.width, d2a);\\n-    pxDirty.size.height = NSAppUnitsToFloatPixels(dirtyRect.height, d2a);\\n+    pxDirty.pos.x = dc->AppUnitsToGfxUnits(dirtyRect.x);\\n+    pxDirty.pos.y = dc->AppUnitsToGfxUnits(dirtyRect.y);\\n+    pxDirty.size.width = dc->AppUnitsToGfxUnits(dirtyRect.width);\\n+    pxDirty.size.height = dc->AppUnitsToGfxUnits(dirtyRect.height);\\n     if (ctx->UserToDevicePixelSnapped(pxDirty))\\n       pxDirty = ctx->DeviceToUser(pxDirty);\\n   }\\ndiff --git a/layout/base/nsLayoutUtils.h b/layout/base/nsLayoutUtils.h\\nindex 4a01186..66916b1 100644\\n--- a/layout/base/nsLayoutUtils.h\\n+++ b/layout/base/nsLayoutUtils.h\\n@@ -660,10 +660,10 @@ public:\\n \\n   /**\\n    * Draw a single image.\\n-   *   @param aImage            The image.\\n    *   @param aRenderingContext Where to draw the image, set up with an\\n    *                            appropriate scale and transform for drawing in\\n    *                            app units (aDestRect).\\n+   *   @param aImage            The image.\\n    *   @param aDestRect         Where to draw the image (app units).\\n    *   @param aDirtyRect        Draw only within this region (rounded to the\\n    *                            nearest pixel); the intersection of\\ndiff --git a/layout/base/nsPresContext.h b/layout/base/nsPresContext.h\\nindex 88639cd..93ec0f2 100644\\n--- a/layout/base/nsPresContext.h\\n+++ b/layout/base/nsPresContext.h\\n@@ -61,6 +61,8 @@\\n #include \\\"nsIDocument.h\\\"\\n #include \\\"nsInterfaceHashtable.h\\\"\\n #include \\\"nsCycleCollectionParticipant.h\\\"\\n+// XXX we need only gfxTypes.h, but we cannot include it directly.\\n+#include \\\"gfxPoint.h\\\"\\n class nsImageLoader;\\n #ifdef IBMBIDI\\n class nsBidiPresUtils;\\n@@ -496,6 +498,9 @@ public:\\n   { return NSAppUnitsToFloatPixels(aAppUnits,\\n                                    nsIDeviceContext::AppUnitsPerCSSPixel()); }\\n \\n+  static gfxFloat AppUnitsToGfxCSSPixels(nscoord aAppUnits)\\n+  { return nsIDeviceContext::AppUnitsToGfxCSSPixels(aAppUnits); }\\n+\\n   nscoord DevPixelsToAppUnits(PRInt32 aPixels) const\\n   { return NSIntPixelsToAppUnits(aPixels,\\n                                  mDeviceContext->AppUnitsPerDevPixel()); }\\n@@ -504,6 +509,9 @@ public:\\n   { return NSAppUnitsToIntPixels(aAppUnits,\\n                                  mDeviceContext->AppUnitsPerDevPixel()); }\\n \\n+  gfxFloat AppUnitsToGfxUnits(nscoord aAppUnits) const\\n+  { return mDeviceContext->AppUnitsToGfxUnits(aAppUnits); }\\n+\\n   nscoord TwipsToAppUnits(PRInt32 aTwips) const\\n   { return NSToCoordRound(NS_TWIPS_TO_INCHES(aTwips) *\\n                           mDeviceContext->AppUnitsPerInch()); }\\ndiff --git a/layout/base/nsPresShell.cpp b/layout/base/nsPresShell.cpp\\nindex 4637f0f..0bda370 100644\\n--- a/layout/base/nsPresShell.cpp\\n+++ b/layout/base/nsPresShell.cpp\\n@@ -22,7 +22,7 @@\\n  *\\n  * Contributor(s):\\n  *   Steve Clark <buster@netscape.com>\\n- *   H�kan Waara <hwaara@chello.se>\\n+ *   Håkan Waara <hwaara@chello.se>\\n  *   Dan Rosen <dr@netscape.com>\\n  *   Daniel Glazman <glazman@netscape.com>\\n  *   Mats Palmgren <mats.palmgren@bredband.net>\\n@@ -4771,11 +4771,10 @@ PresShell::RenderDocument(const nsRect& aRect, PRBool aUntrusted,\\n     builder.LeavePresShell(rootFrame, rect);\\n \\n     if (NS_SUCCEEDED(rv)) {\\n-      nscoord appUnitsPerDevPixel = mPresContext->AppUnitsPerDevPixel();\\n       // Ensure that r.x,r.y gets drawn at (0,0)\\n       aThebesContext->Save();\\n-      aThebesContext->Translate(gfxPoint(-NSAppUnitsToFloatPixels(rect.x,appUnitsPerDevPixel),\\n-                                         -NSAppUnitsToFloatPixels(rect.y,appUnitsPerDevPixel)));\\n+      aThebesContext->Translate(gfxPoint(-mPresContext->AppUnitsToGfxUnits(rect.x),\\n+                                         -mPresContext->AppUnitsToGfxUnits(rect.y)));\\n \\n       nsIDeviceContext* devCtx = mPresContext->DeviceContext();\\n       nsCOMPtr<nsIRenderingContext> rc;\\ndiff --git a/layout/generic/nsBlockFrame.cpp b/layout/generic/nsBlockFrame.cpp\\nindex cb2dfdc..b18811d 100644\\n--- a/layout/generic/nsBlockFrame.cpp\\n+++ b/layout/generic/nsBlockFrame.cpp\\n@@ -5779,14 +5779,17 @@ nsBlockFrame::PaintTextDecorationLine(nsIRenderingContext& aRenderingContext,\\n     PRBool isRTL = visibility->mDirection == NS_STYLE_DIRECTION_RTL;\\n     nsRefPtr<gfxContext> ctx = (gfxContext*)\\n       aRenderingContext.GetNativeGraphicData(nsIRenderingContext::NATIVE_THEBES_CONTEXT);\\n-    gfxFloat a2p = 1.0 / PresContext()->AppUnitsPerDevPixel();\\n-    gfxPoint pt((start + aPt.x) * a2p, (aLine->mBounds.y + aPt.y) * a2p);\\n-    gfxSize size(width * a2p, aSize * a2p);\\n-    nsCSSRendering::PaintDecorationLine(ctx, aColor, pt, size,\\n-                                        aLine->GetAscent() * a2p, aOffset * a2p,\\n-                                        aSize * a2p, aDecoration,\\n-                                        NS_STYLE_BORDER_STYLE_SOLID,\\n-                                        isRTL);\\n+    PRInt32 app = PresContext()->AppUnitsPerDevPixel();\\n+    gfxPoint pt(PresContext()->AppUnitsToGfxUnits(start + aPt.x),\\n+                PresContext()->AppUnitsToGfxUnits(aLine->mBounds.y + aPt.y));\\n+    gfxSize size(PresContext()->AppUnitsToGfxUnits(width),\\n+                 PresContext()->AppUnitsToGfxUnits(aSize));\\n+    nsCSSRendering::PaintDecorationLine(\\n+      ctx, aColor, pt, size,\\n+      PresContext()->AppUnitsToGfxUnits(aLine->GetAscent()),\\n+      PresContext()->AppUnitsToGfxUnits(aOffset),\\n+      PresContext()->AppUnitsToGfxUnits(aSize),\\n+      aDecoration, NS_STYLE_BORDER_STYLE_SOLID, isRTL);\\n   }\\n }\\n \\ndiff --git a/layout/generic/nsHTMLContainerFrame.cpp b/layout/generic/nsHTMLContainerFrame.cpp\\nindex b8897ec..fcdd497 100644\\n--- a/layout/generic/nsHTMLContainerFrame.cpp\\n+++ b/layout/generic/nsHTMLContainerFrame.cpp\\n@@ -214,12 +214,15 @@ nsHTMLContainerFrame::PaintTextDecorationLine(\\n   nscoord innerWidth = mRect.width - bp.left - bp.right;\\n   nsRefPtr<gfxContext> ctx = (gfxContext*)\\n     aRenderingContext.GetNativeGraphicData(nsIRenderingContext::NATIVE_THEBES_CONTEXT);\\n-  gfxFloat a2p = 1.0 / PresContext()->AppUnitsPerDevPixel();\\n-  gfxPoint pt((bp.left + aPt.x) * a2p, (bp.top + aPt.y) * a2p);\\n-  gfxSize size(innerWidth * a2p, aSize * a2p);\\n-  nsCSSRendering::PaintDecorationLine(ctx, aColor, pt, size, aAscent * a2p,\\n-                                      aOffset * a2p, aSize * a2p, aDecoration,\\n-                                      NS_STYLE_BORDER_STYLE_SOLID, isRTL);\\n+  gfxPoint pt(PresContext()->AppUnitsToGfxUnits(bp.left + aPt.x),\\n+              PresContext()->AppUnitsToGfxUnits(bp.top + aPt.y));\\n+  gfxSize size(PresContext()->AppUnitsToGfxUnits(innerWidth),\\n+               PresContext()->AppUnitsToGfxUnits(aSize));\\n+  nsCSSRendering::PaintDecorationLine(\\n+    ctx, aColor, pt, size, PresContext()->AppUnitsToGfxUnits(aAscent),\\n+    PresContext()->AppUnitsToGfxUnits(aOffset),\\n+    PresContext()->AppUnitsToGfxUnits(aSize),\\n+    aDecoration, NS_STYLE_BORDER_STYLE_SOLID, isRTL);\\n }\\n \\n void\\ndiff --git a/layout/generic/nsInlineFrame.cpp b/layout/generic/nsInlineFrame.cpp\\nindex 4a34f8e..1607608 100644\\n--- a/layout/generic/nsInlineFrame.cpp\\n+++ b/layout/generic/nsInlineFrame.cpp\\n@@ -560,7 +560,7 @@ nsInlineFrame::ReflowFrames(nsPresContext* aPresContext,\\n     fm->GetMaxAscent(aMetrics.ascent);\\n     fm->GetHeight(aMetrics.height);\\n     // Include the text-decoration lines to the height.\\n-    // Currently, only undeline is overflowable.\\n+    // Currently, only underline is overflowable.\\n     nscoord offset, size;\\n     fm->GetUnderline(offset, size);\\n     nscoord ascentAndUnderline =\\ndiff --git a/layout/generic/nsTextFrameThebes.cpp b/layout/generic/nsTextFrameThebes.cpp\\nindex 729153a..3381ced 100644\\n--- a/layout/generic/nsTextFrameThebes.cpp\\n+++ b/layout/generic/nsTextFrameThebes.cpp\\n@@ -3716,10 +3716,11 @@ FillClippedRect(gfxContext* aCtx, nsPresContext* aPresContext,\\n {\\n   gfxRect r = aRect.Intersect(aDirtyRect);\\n   // For now, we need to put this in pixel coordinates\\n-  float t2p = 1.0f / aPresContext->AppUnitsPerDevPixel();\\n+  PRInt32 app = aPresContext->AppUnitsPerDevPixel();\\n   aCtx->NewPath();\\n   // pixel-snap\\n-  aCtx->Rectangle(gfxRect(r.X()*t2p, r.Y()*t2p, r.Width()*t2p, r.Height()*t2p), PR_TRUE);\\n+  aCtx->Rectangle(gfxRect(r.X() / app, r.Y() / app,\\n+                          r.Width() / app, r.Height() / app), PR_TRUE);\\n   aCtx->SetColor(gfxRGBA(aColor));\\n   aCtx->Fill();\\n }\\n@@ -3790,12 +3791,12 @@ nsTextFrame::PaintTextDecorations(gfxContext* aCtx, const gfxRect& aDirtyRect,\\n     return;\\n \\n   gfxFont::Metrics fontMetrics = GetFontMetrics(aProvider.GetFontGroup());\\n-  gfxFloat a2p = 1.0 / aTextPaintStyle.PresContext()->AppUnitsPerDevPixel();\\n+  PRInt32 app = aTextPaintStyle.PresContext()->AppUnitsPerDevPixel();\\n \\n   // XXX aFramePt is in AppUnits, shouldn't it be nsFloatPoint?\\n-  gfxPoint pt(aFramePt.x * a2p, aFramePt.y * a2p);\\n-  gfxSize size(GetRect().width * a2p, 0);\\n-  gfxFloat ascent = mAscent * a2p;\\n+  gfxPoint pt(aFramePt.x / app, aFramePt.y / app);\\n+  gfxSize size(GetRect().width / app, 0);\\n+  gfxFloat ascent = mAscent / app;\\n \\n   if (decorations & NS_FONT_DECORATION_OVERLINE) {\\n     size.height = fontMetrics.underlineSize;\\n@@ -4174,13 +4175,13 @@ nsTextFrame::PaintTextSelectionDecorations(gfxContext* aCtx,\\n     gfxFloat advance = hyphenWidth +\\n       mTextRun->GetAdvanceWidth(offset, length, &aProvider);\\n     if (type == aSelectionType) {\\n-      gfxFloat a2p = 1.0 / aTextPaintStyle.PresContext()->AppUnitsPerDevPixel();\\n+      PRInt32 app = aTextPaintStyle.PresContext()->AppUnitsPerDevPixel();\\n       // XXX aTextBaselinePt is in AppUnits, shouldn't it be nsFloatPoint?\\n-      gfxPoint pt((aTextBaselinePt.x + xOffset) * a2p,\\n-                  (aTextBaselinePt.y - mAscent) * a2p);\\n-      gfxFloat width = PR_ABS(advance) * a2p;\\n+      gfxPoint pt((aTextBaselinePt.x + xOffset) / app,\\n+                  (aTextBaselinePt.y - mAscent) / app);\\n+      gfxFloat width = PR_ABS(advance) / app;\\n       DrawSelectionDecorations(aCtx, aSelectionType, aTextPaintStyle,\\n-                               pt, width, mAscent * a2p, decorationMetrics,\\n+                               pt, width, mAscent / app, decorationMetrics,\\n                                mTextRun->IsRightToLeft());\\n     }\\n     iterator.UpdateWithAdvance(advance);\\ndiff --git a/layout/inspector/src/Makefile.in b/layout/inspector/src/Makefile.in\\nindex 335b011..0d0bf61 100644\\n--- a/layout/inspector/src/Makefile.in\\n+++ b/layout/inspector/src/Makefile.in\\n@@ -50,6 +50,7 @@ REQUIRES\\t= xpcom \\\\\\n \\t\\t  string \\\\\\n \\t\\t  dom \\\\\\n \\t\\t  gfx \\\\\\n+\\t\\t  thebes \\\\\\n \\t\\t  layout \\\\\\n \\t\\t  content \\\\\\n \\t\\t  widget \\\\\\ndiff --git a/layout/printing/Makefile.in b/layout/printing/Makefile.in\\nindex 8d53c44..da2b6f5 100644\\n--- a/layout/printing/Makefile.in\\n+++ b/layout/printing/Makefile.in\\n@@ -53,6 +53,7 @@ REQUIRES\\t= xpcom \\\\\\n \\t\\t  dom \\\\\\n \\t\\t  widget \\\\\\n \\t\\t  gfx \\\\\\n+\\t\\t  thebes \\\\\\n \\t\\t  view \\\\\\n \\t\\t  necko \\\\\\n \\t\\t  webshell \\\\\\ndiff --git a/layout/style/Makefile.in b/layout/style/Makefile.in\\nindex 1ef5f0d..264678f 100644\\n--- a/layout/style/Makefile.in\\n+++ b/layout/style/Makefile.in\\n@@ -56,6 +56,7 @@ REQUIRES\\t= xpcom \\\\\\n \\t\\t  dom \\\\\\n \\t\\t  content \\\\\\n \\t\\t  gfx \\\\\\n+\\t\\t  thebes \\\\\\n \\t\\t  widget \\\\\\n \\t\\t  caps \\\\\\n \\t\\t  locale \\\\\\ndiff --git a/layout/xul/base/src/nsTextBoxFrame.cpp b/layout/xul/base/src/nsTextBoxFrame.cpp\\nindex ef03708..eb35e04e 100644\\n--- a/layout/xul/base/src/nsTextBoxFrame.cpp\\n+++ b/layout/xul/base/src/nsTextBoxFrame.cpp\\n@@ -452,14 +452,14 @@ nsTextBoxFrame::PaintTitle(nsIRenderingContext& aRenderingContext,\\n \\n     nsRefPtr<gfxContext> ctx = (gfxContext*)\\n       aRenderingContext.GetNativeGraphicData(nsIRenderingContext::NATIVE_THEBES_CONTEXT);\\n-    gfxFloat a2p = 1.0 / presContext->AppUnitsPerDevPixel();\\n-    gfxPoint pt(textRect.x * a2p, textRect.y * a2p);\\n-    gfxFloat width = textRect.width * a2p;\\n-    gfxFloat baselinePixel = baseline * a2p;\\n+    gfxPoint pt(presContext->AppUnitsToGfxUnits(textRect.x),\\n+                presContext->AppUnitsToGfxUnits(textRect.y));\\n+    gfxFloat width = presContext->AppUnitsToGfxUnits(textRect.width);\\n+    gfxFloat baselinePixel = presContext->AppUnitsToGfxUnits(baseline);\\n     if (decorations & (NS_FONT_DECORATION_OVERLINE | NS_FONT_DECORATION_UNDERLINE)) {\\n       fontMet->GetUnderline(offset, size);\\n-      gfxFloat offsetPixel = offset * a2p;\\n-      gfxFloat sizePixel = size * a2p;\\n+      gfxFloat offsetPixel = presContext->AppUnitsToGfxUnits(offset);\\n+      gfxFloat sizePixel = presContext->AppUnitsToGfxUnits(size);\\n       if (decorations & NS_FONT_DECORATION_OVERLINE) {\\n         nsCSSRendering::PaintDecorationLine(ctx, overColor,\\n                                             pt, gfxSize(width, sizePixel),\\n@@ -481,8 +481,8 @@ nsTextBoxFrame::PaintTitle(nsIRenderingContext& aRenderingContext,\\n     }\\n     if (decorations & NS_FONT_DECORATION_LINE_THROUGH) {\\n       fontMet->GetStrikeout(offset, size);\\n-      gfxFloat offsetPixel = offset * a2p;\\n-      gfxFloat sizePixel = size * a2p;\\n+      gfxFloat offsetPixel = presContext->AppUnitsToGfxUnits(offset);\\n+      gfxFloat sizePixel = presContext->AppUnitsToGfxUnits(size);\\n       nsCSSRendering::PaintDecorationLine(ctx, underColor,\\n                                           pt, gfxSize(width, sizePixel),\\n                                           baselinePixel, offsetPixel,\\ndiff --git a/modules/oji/src/Makefile.in b/modules/oji/src/Makefile.in\\nindex 73e0994..7777194 100644\\n--- a/modules/oji/src/Makefile.in\\n+++ b/modules/oji/src/Makefile.in\\n@@ -64,6 +64,7 @@ REQUIRES\\t= xpcom \\\\\\n \\t\\t  xpconnect \\\\\\n \\t\\t  windowwatcher \\\\\\n \\t\\t  gfx \\\\\\n+\\t\\t  thebes \\\\\\n \\t\\t  content \\\\\\n \\t\\t  layout \\\\\\n \\t\\t  docshell \\\\\\ndiff --git a/modules/plugin/base/src/Makefile.in b/modules/plugin/base/src/Makefile.in\\nindex 87bcef0..e49cbd5 100644\\n--- a/modules/plugin/base/src/Makefile.in\\n+++ b/modules/plugin/base/src/Makefile.in\\n@@ -66,6 +66,7 @@ REQUIRES\\t= xpcom \\\\\\n \\t\\t  unicharutil \\\\\\n \\t\\t  dom \\\\\\n \\t\\t  gfx \\\\\\n+\\t\\t  thebes \\\\\\n \\t\\t  content \\\\\\n \\t\\t  widget \\\\\\n \\t\\t  mimetype \\\\\\ndiff --git a/toolkit/components/autocomplete/src/Makefile.in b/toolkit/components/autocomplete/src/Makefile.in\\nindex 10a6d5f..d293b59 100644\\n--- a/toolkit/components/autocomplete/src/Makefile.in\\n+++ b/toolkit/components/autocomplete/src/Makefile.in\\n@@ -61,6 +61,7 @@ REQUIRES =\\txpcom \\\\\\n \\t\\tcontent \\\\\\n \\t\\tview \\\\\\n \\t\\tgfx \\\\\\n+\\t\\tthebes \\\\\\n \\t\\tlocale \\\\\\n \\t\\tnecko \\\\\\n \\t \\t$(NULL)\\ndiff --git a/toolkit/components/build/Makefile.in b/toolkit/components/build/Makefile.in\\nindex dc8e297..470c81e 100644\\n--- a/toolkit/components/build/Makefile.in\\n+++ b/toolkit/components/build/Makefile.in\\n@@ -81,6 +81,7 @@ REQUIRES = \\t\\\\\\n \\t\\tcontent \\\\\\n \\t\\tfind \\\\\\n \\t\\tgfx \\\\\\n+\\t\\tthebes \\\\\\n \\t\\tlocale \\\\\\n \\t\\tunicharutil \\\\\\n \\t\\txuldoc \\\\\\ndiff --git a/toolkit/components/satchel/src/Makefile.in b/toolkit/components/satchel/src/Makefile.in\\nindex 061f535..e8126d2 100644\\n--- a/toolkit/components/satchel/src/Makefile.in\\n+++ b/toolkit/components/satchel/src/Makefile.in\\n@@ -59,6 +59,7 @@ REQUIRES =\\t\\\\\\n \\t\\tlayout \\\\\\n \\t\\tdocshell \\\\\\n \\t\\tgfx \\\\\\n+\\t\\tthebes \\\\\\n \\t\\tnecko \\\\\\n \\t\\twidget \\\\\\n \\t\\tcontent \\\\\\ndiff --git a/toolkit/components/typeaheadfind/src/Makefile.in b/toolkit/components/typeaheadfind/src/Makefile.in\\nindex 9bead7e..ab58e54 100755\\n--- a/toolkit/components/typeaheadfind/src/Makefile.in\\n+++ b/toolkit/components/typeaheadfind/src/Makefile.in\\n@@ -55,6 +55,7 @@ REQUIRES\\t= content \\\\\\n \\t\\t  editor \\\\\\n \\t\\t  find \\\\\\n \\t\\t  gfx \\\\\\n+\\t\\t  thebes \\\\\\n \\t\\t  layout \\\\\\n \\t\\t  locale \\\\\\n \\t\\t  necko \\\\\\ndiff --git a/uriloader/base/Makefile.in b/uriloader/base/Makefile.in\\nindex 960d49f..6e1af89 100644\\n--- a/uriloader/base/Makefile.in\\n+++ b/uriloader/base/Makefile.in\\n@@ -55,6 +55,7 @@ REQUIRES\\t= xpcom \\\\\\n \\t\\t  js \\\\\\n \\t\\t  docshell \\\\\\n \\t\\t  gfx \\\\\\n+\\t\\t  thebes \\\\\\n \\t\\t  layout \\\\\\n \\t\\t  content \\\\\\n \\t\\t  widget \\\\\\ndiff --git a/xpfe/appshell/src/Makefile.in b/xpfe/appshell/src/Makefile.in\\nindex 107ee1d..65b6f34 100644\\n--- a/xpfe/appshell/src/Makefile.in\\n+++ b/xpfe/appshell/src/Makefile.in\\n@@ -59,6 +59,7 @@ REQUIRES\\t= xpcom \\\\\\n \\t\\t  docshell \\\\\\n \\t\\t  webshell \\\\\\n \\t\\t  gfx \\\\\\n+\\t\\t  thebes \\\\\\n \\t\\t  layout \\\\\\n \\t\\t  content \\\\\\n \\t\\t  dom \\\\\\ndiff --git a/xpfe/components/winhooks/Makefile.in b/xpfe/components/winhooks/Makefile.in\\nindex e465d24..fce2de1 100644\\n--- a/xpfe/components/winhooks/Makefile.in\\n+++ b/xpfe/components/winhooks/Makefile.in\\n@@ -64,6 +64,7 @@ REQUIRES\\t= \\\\\\n \\t\\t  widget \\\\\\n \\t\\t  imglib2 \\\\\\n \\t\\t  gfx \\\\\\n+\\t\\t  thebes \\\\\\n \\t\\t  locale \\\\\\n \\t\\t  xulapp \\\\\\n \\t\\t  embed_base \\\\\\n\""}