{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas632db9c\""},"diff":"\"632db9c Bug 393566, add cycle collection to XULPopupListener, r+sr=peterv, a=dbaron\\ndiff --git a/content/xul/content/src/nsXULPopupListener.cpp b/content/xul/content/src/nsXULPopupListener.cpp\\nindex ec046a7..d9c8a92 100644\\n--- a/content/xul/content/src/nsXULPopupListener.cpp\\n+++ b/content/xul/content/src/nsXULPopupListener.cpp\\n@@ -96,11 +96,11 @@ nsXULPopupListener::~nsXULPopupListener(void)\\n   ClosePopup();\\n }\\n \\n-NS_IMPL_ADDREF(nsXULPopupListener)\\n-NS_IMPL_RELEASE(nsXULPopupListener)\\n+NS_IMPL_CYCLE_COLLECTION_2(nsXULPopupListener, mElement, mPopupContent);\\n+NS_IMPL_CYCLE_COLLECTING_ADDREF(nsXULPopupListener)\\n+NS_IMPL_CYCLE_COLLECTING_RELEASE(nsXULPopupListener)\\n \\n-\\n-NS_INTERFACE_MAP_BEGIN(nsXULPopupListener)\\n+NS_INTERFACE_MAP_BEGIN_CYCLE_COLLECTION(nsXULPopupListener)\\n   NS_INTERFACE_MAP_ENTRY(nsIDOMMouseListener)\\n   NS_INTERFACE_MAP_ENTRY(nsIDOMContextMenuListener)\\n   NS_INTERFACE_MAP_ENTRY_AMBIGUOUS(nsIDOMEventListener, nsIDOMMouseListener)\\ndiff --git a/content/xul/content/src/nsXULPopupListener.h b/content/xul/content/src/nsXULPopupListener.h\\nindex 07e24b8..4cc80d3 100644\\n--- a/content/xul/content/src/nsXULPopupListener.h\\n+++ b/content/xul/content/src/nsXULPopupListener.h\\n@@ -54,6 +54,7 @@\\n #include \\\"nsIFrame.h\\\"\\n #include \\\"nsIDOMMouseListener.h\\\"\\n #include \\\"nsIDOMContextMenuListener.h\\\"\\n+#include \\\"nsCycleCollectionParticipant.h\\\"\\n \\n class nsXULPopupListener : public nsIDOMMouseListener,\\n                            public nsIDOMContextMenuListener\\n@@ -66,9 +67,10 @@ public:\\n     nsXULPopupListener(nsIDOMElement *aElement, PRBool aIsContext);\\n     virtual ~nsXULPopupListener(void);\\n \\n-public:\\n     // nsISupports\\n-    NS_DECL_ISUPPORTS\\n+    NS_DECL_CYCLE_COLLECTING_ISUPPORTS\\n+    NS_DECL_CYCLE_COLLECTION_CLASS_AMBIGUOUS(nsXULPopupListener,\\n+                                             nsIDOMMouseListener)\\n \\n     // nsIDOMMouseListener\\n     NS_IMETHOD MouseDown(nsIDOMEvent* aMouseEvent);\\n@@ -104,7 +106,7 @@ private:\\n     nsresult FireFocusOnTargetContent(nsIDOMNode* aTargetNode);\\n \\n     // |mElement| is the node to which this listener is attached.\\n-    nsIDOMElement* mElement;               // Weak ref. The element will go away first.\\n+    nsCOMPtr<nsIDOMElement> mElement;\\n \\n     // The popup that is getting shown on top of mElement.\\n     nsCOMPtr<nsIContent> mPopupContent; \\n\""}