{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas7d8fc08\""},"diff":"\"7d8fc08 393622 add logging to HTTP channel resuming code r+sr+a=bz\\ndiff --git a/netwerk/protocol/http/src/nsHttpChannel.cpp b/netwerk/protocol/http/src/nsHttpChannel.cpp\\nindex 5c0a77d..8648891 100644\\n--- a/netwerk/protocol/http/src/nsHttpChannel.cpp\\n+++ b/netwerk/protocol/http/src/nsHttpChannel.cpp\\n@@ -801,6 +801,7 @@ nsHttpChannel::ProcessResponse()\\n         // So if a server does that and sends 200 instead of 206 that we\\n         // expect, notify our caller.\\n         if (mResuming) {\\n+            LOG((\\\"Server ignored our Range header, cancelling [this=%p]\\\\n\\\", this));\\n             Cancel(NS_ERROR_NOT_RESUMABLE);\\n             rv = CallOnStartRequest();\\n             break;\\n@@ -858,6 +859,8 @@ nsHttpChannel::ProcessResponse()\\n     case 412: // Precondition failed\\n     case 416: // Invalid range\\n         if (mResuming) {\\n+            LOG((\\\"Resuming and got %i status, aborting [this=%p]\\\\n\\\",\\n+                 httpStatus, this));\\n             Cancel(NS_ERROR_ENTITY_CHANGED);\\n             rv = CallOnStartRequest();\\n             break;\\n@@ -923,8 +926,11 @@ nsHttpChannel::ProcessNormal()\\n         }\\n         // If we were passed an entity id, verify it's equal to the server's\\n         else if (!mEntityID.IsEmpty()) {\\n-            if (!mEntityID.Equals(id))\\n+            if (!mEntityID.Equals(id)) {\\n+                LOG((\\\"Entity mismatch, expected '%s', got '%s', aborting [this=%p]\\\",\\n+                     mEntityID.get(), id.get(), this));\\n                 Cancel(NS_ERROR_ENTITY_CHANGED);\\n+            }\\n         }\\n     }\\n \\n@@ -4677,6 +4683,8 @@ NS_IMETHODIMP\\n nsHttpChannel::ResumeAt(PRUint64 aStartPos,\\n                         const nsACString& aEntityID)\\n {\\n+    LOG((\\\"nsHttpChannel::ResumeAt [this=%p startPos=%llu id='%s']\\\\n\\\",\\n+         this, aStartPos, PromiseFlatCString(aEntityID).get()));\\n     mEntityID = aEntityID;\\n     mStartPos = aStartPos;\\n     mResuming = PR_TRUE;\\n\""}