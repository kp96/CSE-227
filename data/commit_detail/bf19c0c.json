{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basbf19c0c\""},"diff":"\"bf19c0c Remove setTimeout so that we don't call focus on a window that's no longer active once the timeout runs.  b=330006  r=gavin\\ndiff --git a/browser/base/content/tabbrowser.xml b/browser/base/content/tabbrowser.xml\\nindex e00f234..f95c39b 100644\\n--- a/browser/base/content/tabbrowser.xml\\n+++ b/browser/base/content/tabbrowser.xml\\n@@ -768,35 +768,30 @@\\n               whatToFocus = newBrowser.focusedWindow;\\n             }\\n  \\n-            // Change focus for this window to |aElement|, without focusing the\\n-            // window itself.\\n-            function setFocus(aElement) {\\n-              var cmdDispatcher = document.commandDispatcher;\\n-\\n-              var ww =\\n-                Components.classes[\\\"@mozilla.org/embedcomp/window-watcher;1\\\"]\\n-                          .getService(Components.interfaces.nsIWindowWatcher);\\n-              if (ww.activeWindow == window) {\\n-                cmdDispatcher.suppressFocusScroll = true;\\n-                aElement.focus();\\n-                cmdDispatcher.suppressFocusScroll = false;\\n+            // Change focus for this window to |whatToFocus|, without\\n+            // focusing the window itself.\\n+            var cmdDispatcher = document.commandDispatcher;\\n+\\n+            var ww =\\n+              Components.classes[\\\"@mozilla.org/embedcomp/window-watcher;1\\\"]\\n+                        .getService(Components.interfaces.nsIWindowWatcher);\\n+            if (ww.activeWindow == window) {\\n+              cmdDispatcher.suppressFocusScroll = true;\\n+              whatToFocus.focus();\\n+              cmdDispatcher.suppressFocusScroll = false;\\n+            }\\n+            else {\\n+              // set the element in command dispatcher so focus will restore\\n+              // properly when the window does become active\\n+              if (whatToFocus instanceof Window) {\\n+                cmdDispatcher.focusedWindow = whatToFocus;\\n+                cmdDispatcher.focusedElement = null;\\n               }\\n               else {\\n-                // set the element in command dispatcher so focus will restore\\n-                // properly when the window does become active\\n-                if (aElement instanceof Window) {\\n-                  cmdDispatcher.focusedWindow = aElement;\\n-                  cmdDispatcher.focusedElement = null;\\n-                }\\n-                else {\\n-                  cmdDispatcher.focusedWindow = aElement.ownerDocument.defaultView;\\n-                  cmdDispatcher.focusedElement = aElement;\\n-                }\\n+                cmdDispatcher.focusedWindow = whatToFocus.ownerDocument.defaultView;\\n+                cmdDispatcher.focusedElement = whatToFocus;\\n               }\\n             }\\n-\\n-            // Use setTimeout to avoid focus outline ghosting.\\n-            setTimeout(setFocus, 0, whatToFocus);\\n           ]]>\\n         </body>\\n       </method>\\n\""}