{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas6df9987\""},"diff":"\"6df9987 Bug 393040 - nsIAccessible::name fails on menupopup, r=aaronlev, sr=neil, a=dsicore\\ndiff --git a/accessible/src/xul/nsXULMenuAccessible.cpp b/accessible/src/xul/nsXULMenuAccessible.cpp\\nindex cf7ee4b..5e0d533 100644\\n--- a/accessible/src/xul/nsXULMenuAccessible.cpp\\n+++ b/accessible/src/xul/nsXULMenuAccessible.cpp\\n@@ -657,23 +657,21 @@ void nsXULMenupopupAccessible::GenerateMenu(nsIDOMNode *aNode)\\n   }\\n }\\n \\n-NS_IMETHODIMP nsXULMenupopupAccessible::GetName(nsAString& _retval)\\n+NS_IMETHODIMP\\n+nsXULMenupopupAccessible::GetName(nsAString& aName)\\n {\\n-  nsCOMPtr<nsIDOMElement> element(do_QueryInterface(mDOMNode));\\n-  NS_ASSERTION(element, \\\"No element for popup node!\\\");\\n+  aName.Truncate();\\n \\n-  while (element) {\\n-    element->GetAttribute(NS_LITERAL_STRING(\\\"label\\\"), _retval);\\n-    if (!_retval.IsEmpty())\\n-      return NS_OK;\\n-    nsCOMPtr<nsIDOMNode> parentNode, node(do_QueryInterface(element));\\n-    if (!node)\\n-      return NS_ERROR_FAILURE;\\n-    node->GetParentNode(getter_AddRefs(parentNode));\\n-    element = do_QueryInterface(parentNode);\\n+  if (!mDOMNode)\\n+    return NS_ERROR_FAILURE;\\n+\\n+  nsCOMPtr<nsIContent> content(do_QueryInterface(mDOMNode));\\n+  while (content && aName.IsEmpty()) {\\n+    content->GetAttr(kNameSpaceID_None, nsAccessibilityAtoms::label, aName);\\n+    content = content->GetParent();\\n   }\\n \\n-  return NS_ERROR_FAILURE;\\n+  return NS_OK;\\n }\\n \\n NS_IMETHODIMP nsXULMenupopupAccessible::GetRole(PRUint32 *aRole)\\n\""}