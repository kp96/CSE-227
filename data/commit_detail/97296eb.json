{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas97296eb\""},"diff":"\"97296eb Bug 315687 - Sanity check paper size prefs created before bug 309988 was fixed. r=vladimir, sr=pavlov, a=pavlov.\\ndiff --git a/embedding/browser/photon/src/nsPrintSettingsImpl.cpp b/embedding/browser/photon/src/nsPrintSettingsImpl.cpp\\nindex 78a82c3..8cd181b 100644\\n--- a/embedding/browser/photon/src/nsPrintSettingsImpl.cpp\\n+++ b/embedding/browser/photon/src/nsPrintSettingsImpl.cpp\\n@@ -60,7 +60,6 @@ nsPrintSettings::nsPrintSettings() :\\n   mPrintOptions(0L),\\n   mPrintReversed(PR_FALSE),\\n   mPrintInColor(PR_TRUE),\\n-  mPaperSize(kLetterPaperSize),\\n   mOrientation(kPortraitOrientation),\\n   mPrintToFile(PR_FALSE),\\n   mPrintFrameType(kFramesAsIs),\\n@@ -144,19 +143,6 @@ NS_IMETHODIMP nsPrintSettings::SetPrintInColor(PRBool aPrintInColor)\\n   return NS_OK;\\n }\\n \\n-/* attribute short paperSize; */\\n-NS_IMETHODIMP nsPrintSettings::GetPaperSize(PRInt32 *aPaperSize)\\n-{\\n-  //NS_ENSURE_ARG_POINTER(aPaperSize);\\n-  *aPaperSize = mPaperSize;\\n-  return NS_OK;\\n-}\\n-NS_IMETHODIMP nsPrintSettings::SetPaperSize(PRInt32 aPaperSize)\\n-{\\n-  mPaperSize = aPaperSize;\\n-  return NS_OK;\\n-}\\n-\\n /* attribute short orientation; */\\n NS_IMETHODIMP nsPrintSettings::GetOrientation(PRInt32 *aOrientation)\\n {\\ndiff --git a/embedding/browser/photon/src/nsPrintSettingsImpl.h b/embedding/browser/photon/src/nsPrintSettingsImpl.h\\nindex 4f9b0c1..d33b44b 100644\\n--- a/embedding/browser/photon/src/nsPrintSettingsImpl.h\\n+++ b/embedding/browser/photon/src/nsPrintSettingsImpl.h\\n@@ -92,7 +92,6 @@ protected:\\n \\n   PRBool        mPrintReversed;\\n   PRBool        mPrintInColor; // a false means grayscale\\n-  PRInt32       mPaperSize;    // see page size consts\\n   PRInt32       mOrientation;  // see orientation consts\\n   nsString      mPrintCommand;\\n   PRBool        mPrintToFile;\\ndiff --git a/toolkit/components/printing/content/printdialog.js b/toolkit/components/printing/content/printdialog.js\\nindex adeb6de..f3fc8b5 100644\\n--- a/toolkit/components/printing/content/printdialog.js\\n+++ b/toolkit/components/printing/content/printdialog.js\\n@@ -406,11 +406,7 @@ function onAccept()\\n   saveToPrefs = gPrefs.getBoolPref(\\\"print.save_print_settings\\\");\\n \\n   if (saveToPrefs && printService != null) {\\n-    var flags = gPrintSetInterface.kInitSavePaperSizeType  | \\n-                gPrintSetInterface.kInitSavePaperSizeUnit  |\\n-                gPrintSetInterface.kInitSavePaperWidth     | \\n-                gPrintSetInterface.kInitSavePaperHeight    |\\n-                gPrintSetInterface.kInitSavePaperName      | \\n+    var flags = gPrintSetInterface.kInitSavePaperSize      | \\n                 gPrintSetInterface.kInitSaveColorSpace     |\\n                 gPrintSetInterface.kInitSaveInColor        |\\n                 gPrintSetInterface.kInitSaveResolutionName |\\ndiff --git a/toolkit/components/printing/content/printjoboptions.js b/toolkit/components/printing/content/printjoboptions.js\\nindex 41a00cd..ab99017 100644\\n--- a/toolkit/components/printing/content/printjoboptions.js\\n+++ b/toolkit/components/printing/content/printjoboptions.js\\n@@ -201,7 +201,6 @@ function createPaperArrayFromDefaults()\\n     obj.width  = paperWidths[i];\\n     obj.height = paperHeights[i];\\n     obj.inches = paperInches[i];\\n-    obj.paperSize = paperEnums[i]; // deprecated\\n     \\n     /* Calculate the width/height in millimeters */\\n     if (paperInches[i]) {\\n@@ -238,7 +237,6 @@ function createPaperArrayFromPrinterFeatures()\\n     obj.width_mm  = gPrefs.getIntPref(\\\"print.tmp.printerfeatures.\\\"  + printername + \\\".paper.\\\" + i + \\\".width_mm\\\");\\n     obj.height_mm = gPrefs.getIntPref(\\\"print.tmp.printerfeatures.\\\"  + printername + \\\".paper.\\\" + i + \\\".height_mm\\\");\\n     obj.inches    = gPrefs.getBoolPref(\\\"print.tmp.printerfeatures.\\\" + printername + \\\".paper.\\\" + i + \\\".is_inch\\\");\\n-    obj.paperSize = 666; // deprecated\\n     \\n     /* Calculate the width/height in paper's native units (either inches or millimeters) */\\n     if (obj.inches) {\\n@@ -909,7 +907,6 @@ function onAccept()\\n     print_resolution_name  = gResolutionArray[resolutionSelectedInx].name;\\n     print_colorspace       = gColorspaceArray[colorspaceSelectedInx].name;\\n \\n-    gPrintSettings.paperSize       = gPaperArray[paperSelectedInx].paperSize; // deprecated\\n     gPrintSettings.paperSizeType   = print_paper_type;\\n     gPrintSettings.paperSizeUnit   = print_paper_unit;\\n     gPrintSettings.paperWidth      = print_paper_width;\\n@@ -944,7 +941,6 @@ function onAccept()\\n \\n     if (doDebug) {\\n       dump(\\\"onAccept******************************\\\\n\\\");\\n-      dump(\\\"paperSize        \\\"+gPrintSettings.paperSize+\\\" (deprecated)\\\\n\\\");\\n       dump(\\\"paperSizeType    \\\"+print_paper_type+\\\" (should be 1)\\\\n\\\");\\n       dump(\\\"paperSizeUnit    \\\"+print_paper_unit+\\\"\\\\n\\\");\\n       dump(\\\"paperWidth       \\\"+print_paper_width+\\\"\\\\n\\\");\\ndiff --git a/widget/public/nsIPrintSettings.idl b/widget/public/nsIPrintSettings.idl\\nindex 4f76ecf..9735b98 100644\\n--- a/widget/public/nsIPrintSettings.idl\\n+++ b/widget/public/nsIPrintSettings.idl\\n@@ -58,7 +58,7 @@ interface nsIPrintSession;\\n  *\\n  * @status UNDER_REVIEW\\n  */\\n-[scriptable, uuid(89c06ccb-6d41-4846-a8e2-63bfa7bd3157)]\\n+[scriptable, uuid(b1b5e3cc-a52c-4325-a7f6-e1ac6fac19a5)]\\n \\n interface nsIPrintSettings : nsISupports\\n {\\n@@ -75,12 +75,12 @@ interface nsIPrintSettings : nsISupports\\n   const unsigned long kInitSaveBGColors       = 0x00000080;\\n   const unsigned long kInitSaveBGImages       = 0x00000100;\\n   const unsigned long kInitSavePaperSize      = 0x00000200;\\n-  const unsigned long kInitSavePaperName      = 0x00000400;\\n-  const unsigned long kInitSavePaperSizeUnit  = 0x00000800;\\n-  const unsigned long kInitSavePaperSizeType  = 0x00001000;\\n+  /* Flag 0x00000400 is unused */\\n+  /* Flag 0x00000800 is unused */\\n+  /* Flag 0x00001000 is unused */\\n   const unsigned long kInitSavePaperData      = 0x00002000;\\n-  const unsigned long kInitSavePaperWidth     = 0x00004000;\\n-  const unsigned long kInitSavePaperHeight    = 0x00008000;\\n+  /* Flag 0x00004000 is unused */\\n+  /* Flag 0x00008000 is unused */\\n \\n   const unsigned long kInitSaveReversed       = 0x00010000;\\n   const unsigned long kInitSaveInColor        = 0x00020000;\\n@@ -250,7 +250,6 @@ interface nsIPrintSettings : nsISupports\\n \\n   attribute boolean printReversed;\\n   attribute boolean printInColor;  /* a false means grayscale */\\n-  attribute long    paperSize;     /*  see page size consts */\\n   attribute long    orientation;   /*  see orientation consts */\\n   attribute wstring printCommand;\\n   attribute long    numCopies;\\ndiff --git a/widget/src/windows/nsPrintSettingsWin.cpp b/widget/src/windows/nsPrintSettingsWin.cpp\\nindex 6253303..a955cc4 100644\\n--- a/widget/src/windows/nsPrintSettingsWin.cpp\\n+++ b/widget/src/windows/nsPrintSettingsWin.cpp\\n@@ -243,7 +243,6 @@ Tester::Tester()\\n     ps->SetPaperSizeUnit(nsIPrintSettings::kPaperSizeMillimeters);\\n     ps->SetPrintReversed(PR_TRUE);\\n     ps->SetPrintInColor(PR_TRUE);\\n-    ps->SetPaperSize(5);\\n     ps->SetOrientation(nsIPrintSettings::kLandscapeOrientation);\\n     ps->SetPrintCommand(NS_ConvertUTF8toUTF16(\\\"Command\\\").get());\\n     ps->SetNumCopies(2);\\ndiff --git a/widget/src/xpwidgets/nsPrintOptionsImpl.cpp b/widget/src/xpwidgets/nsPrintOptionsImpl.cpp\\nindex 0675ba02..dc3eeb3 100644\\n--- a/widget/src/xpwidgets/nsPrintOptionsImpl.cpp\\n+++ b/widget/src/xpwidgets/nsPrintOptionsImpl.cpp\\n@@ -86,8 +86,6 @@ static const char kPrintFooterStrCenter[] = \\\"print_footercenter\\\";\\n static const char kPrintFooterStrRight[]  = \\\"print_footerright\\\";\\n \\n // Additional Prefs\\n-static const char kPrintPaperSize[]     = \\\"print_paper_size\\\"; // deprecated\\n-\\n static const char kPrintReversed[]      = \\\"print_reversed\\\";\\n static const char kPrintInColor[]       = \\\"print_in_color\\\";\\n static const char kPrintPaperName[]     = \\\"print_paper_name\\\";\\n@@ -302,6 +300,40 @@ nsPrintOptions::ReadPrefs(nsIPrintSettings* aPS, const nsAString& aPrinterName,\\n     )                                                   \\\\\\n   )\\n \\n+  // Paper size prefs are read as a group\\n+  if (aFlags & nsIPrintSettings::kInitSavePaperSize) {\\n+    PRInt32 sizeUnit, sizeType;\\n+    double width, height;\\n+\\n+    PRBool success = GETINTPREF(kPrintPaperSizeUnit, &sizeUnit)\\n+                  && GETINTPREF(kPrintPaperSizeType, &sizeType)\\n+                  && GETDBLPREF(kPrintPaperWidth, width)\\n+                  && GETDBLPREF(kPrintPaperHeight, height)\\n+                  && GETSTRPREF(kPrintPaperName, str);\\n+\\n+    // Bug 315687: Sanity check paper size to avoid paper size values in\\n+    // mm when the size unit flag is inches. The value 100 is arbitrary\\n+    // and can be changed.\\n+    if (success) {\\n+      success = (sizeUnit == nsIPrintSettings::kPaperSizeInches)\\n+             && (width < 100.0)\\n+             && (height < 100.0);\\n+    }\\n+\\n+    if (success) {\\n+      aPS->SetPaperSizeUnit(sizeUnit);\\n+      DUMP_INT(kReadStr, kPrintPaperSizeUnit, sizeUnit);\\n+      aPS->SetPaperSizeType(sizeType);\\n+      DUMP_INT(kReadStr, kPrintPaperSizeType, sizeType);\\n+      aPS->SetPaperWidth(width);\\n+      DUMP_DBL(kReadStr, kPrintPaperWidth, width);\\n+      aPS->SetPaperHeight(height);\\n+      DUMP_DBL(kReadStr, kPrintPaperHeight, height);\\n+      aPS->SetPaperName(str.get());\\n+      DUMP_STR(kReadStr, kPrintPaperName, str.get());\\n+    }\\n+  }\\n+\\n   if (aFlags & nsIPrintSettings::kInitSaveOddEvenPages) {\\n   if (GETBOOLPREF(kPrintEvenPages, &b)) {\\n     aPS->SetPrintOptions(nsIPrintSettings::kPrintEvenPages, b);\\n@@ -372,13 +404,6 @@ nsPrintOptions::ReadPrefs(nsIPrintSettings* aPS, const nsAString& aPrinterName,\\n     }\\n   }\\n \\n-  if (aFlags & nsIPrintSettings::kInitSavePaperSize) {\\n-    if (GETINTPREF(kPrintPaperSize, &iVal)) { // this has been deprecated\\n-      aPS->SetPaperSize(iVal);\\n-      DUMP_INT(kReadStr, kPrintPaperSize, iVal);\\n-    }\\n-  }\\n-\\n   if (aFlags & nsIPrintSettings::kInitSaveReversed) {\\n     if (GETBOOLPREF(kPrintReversed, &b)) {\\n       aPS->SetPrintReversed(b);\\n@@ -393,13 +418,6 @@ nsPrintOptions::ReadPrefs(nsIPrintSettings* aPS, const nsAString& aPrinterName,\\n     }\\n   }\\n \\n-  if (aFlags & nsIPrintSettings::kInitSavePaperName) {\\n-    if (GETSTRPREF(kPrintPaperName, str)) {\\n-      aPS->SetPaperName(str.get());\\n-      DUMP_STR(kReadStr, kPrintPaperName, str.get());\\n-    }\\n-  }\\n-\\n   if (aFlags & nsIPrintSettings::kInitSavePlexName) {\\n     if (GETSTRPREF(kPrintPlexName, str)) {\\n       aPS->SetPlexName(str.get());\\n@@ -407,20 +425,6 @@ nsPrintOptions::ReadPrefs(nsIPrintSettings* aPS, const nsAString& aPrinterName,\\n     }\\n   }\\n \\n-  if (aFlags & nsIPrintSettings::kInitSavePaperSizeUnit) {\\n-    if (GETINTPREF(kPrintPaperSizeUnit, &iVal)) {\\n-      aPS->SetPaperSizeUnit(iVal);\\n-      DUMP_INT(kReadStr, kPrintPaperSizeUnit, iVal);\\n-    }\\n-  }\\n-\\n-  if (aFlags & nsIPrintSettings::kInitSavePaperSizeType) {\\n-    if (GETINTPREF(kPrintPaperSizeType, &iVal)) {\\n-      aPS->SetPaperSizeType(iVal);\\n-      DUMP_INT(kReadStr, kPrintPaperSizeType, iVal);\\n-    }\\n-  }\\n-\\n   if (aFlags & nsIPrintSettings::kInitSavePaperData) {\\n     if (GETINTPREF(kPrintPaperData, &iVal)) {\\n       aPS->SetPaperData(iVal);\\n@@ -428,20 +432,6 @@ nsPrintOptions::ReadPrefs(nsIPrintSettings* aPS, const nsAString& aPrinterName,\\n     }\\n   }\\n \\n-  if (aFlags & nsIPrintSettings::kInitSavePaperWidth) {\\n-    if (GETDBLPREF(kPrintPaperWidth, dbl)) {\\n-      aPS->SetPaperWidth(dbl);\\n-      DUMP_DBL(kReadStr, kPrintPaperWidth, dbl);\\n-    }\\n-  }\\n-\\n-  if (aFlags & nsIPrintSettings::kInitSavePaperHeight) {\\n-    if (GETDBLPREF(kPrintPaperHeight, dbl)) {\\n-      aPS->SetPaperHeight(dbl);\\n-      DUMP_DBL(kReadStr, kPrintPaperHeight, dbl);\\n-    }\\n-  }\\n-\\n   if (aFlags & nsIPrintSettings::kInitSaveColorspace) {\\n     if (GETSTRPREF(kPrintColorspace, str)) {\\n       aPS->SetColorspace(str.get());\\n@@ -547,6 +537,34 @@ nsPrintOptions::WritePrefs(nsIPrintSettings *aPS, const nsAString& aPrinterName,\\n     }\\n   }\\n \\n+  // Paper size prefs are saved as a group\\n+  if (aFlags & nsIPrintSettings::kInitSavePaperSize) {\\n+    PRInt16 sizeUnit, sizeType;\\n+    double width, height;\\n+    PRUnichar *name;\\n+ \\n+    if (\\n+      NS_SUCCEEDED(aPS->GetPaperSizeUnit(&sizeUnit)) &&\\n+      NS_SUCCEEDED(aPS->GetPaperSizeType(&sizeType)) &&\\n+      NS_SUCCEEDED(aPS->GetPaperWidth(&width)) &&\\n+      NS_SUCCEEDED(aPS->GetPaperHeight(&height)) &&\\n+      NS_SUCCEEDED(aPS->GetPaperName(&name))\\n+    ) {\\n+      DUMP_INT(kWriteStr, kPrintPaperSizeUnit, sizeUnit);\\n+      mPrefBranch->SetIntPref(GetPrefName(kPrintPaperSizeUnit, aPrinterName),\\n+                              PRInt32(sizeUnit));\\n+      DUMP_INT(kWriteStr, kPrintPaperSizeType, sizeType);\\n+      mPrefBranch->SetIntPref(GetPrefName(kPrintPaperSizeType, aPrinterName),\\n+                              PRInt32(sizeType));\\n+      DUMP_DBL(kWriteStr, kPrintPaperWidth, width);\\n+      WritePrefDouble(GetPrefName(kPrintPaperWidth, aPrinterName), width);\\n+      DUMP_DBL(kWriteStr, kPrintPaperHeight, height);\\n+      WritePrefDouble(GetPrefName(kPrintPaperHeight, aPrinterName), height);\\n+      DUMP_STR(kWriteStr, kPrintPaperName, name);\\n+      WritePrefString(name, GetPrefName(kPrintPaperName, aPrinterName));\\n+    }\\n+  }\\n+\\n   PRBool     b;\\n   PRUnichar* uStr;\\n   PRInt32    iVal;\\n@@ -627,14 +645,6 @@ nsPrintOptions::WritePrefs(nsIPrintSettings *aPS, const nsAString& aPrinterName,\\n     }\\n   }\\n \\n-  if (aFlags & nsIPrintSettings::kInitSavePaperSize) {\\n-    if (NS_SUCCEEDED(aPS->GetPaperSize(&iVal))) {\\n-      DUMP_INT(kWriteStr, kPrintPaperSize, iVal);\\n-      mPrefBranch->SetIntPref(GetPrefName(kPrintPaperSize, aPrinterName), iVal);\\n-      // this has been deprecated\\n-    }\\n-  }\\n-\\n   if (aFlags & nsIPrintSettings::kInitSaveReversed) {\\n     if (NS_SUCCEEDED(aPS->GetPrintReversed(&b))) {\\n       DUMP_BOOL(kWriteStr, kPrintReversed, b);\\n@@ -649,13 +659,6 @@ nsPrintOptions::WritePrefs(nsIPrintSettings *aPS, const nsAString& aPrinterName,\\n     }\\n   }\\n \\n-  if (aFlags & nsIPrintSettings::kInitSavePaperName) {\\n-    if (NS_SUCCEEDED(aPS->GetPaperName(&uStr))) {\\n-      DUMP_STR(kWriteStr, kPrintPaperName, uStr);\\n-      WritePrefString(uStr, GetPrefName(kPrintPaperName, aPrinterName));\\n-    }\\n-  }\\n-\\n   if (aFlags & nsIPrintSettings::kInitSavePlexName) {\\n     if (NS_SUCCEEDED(aPS->GetPlexName(&uStr))) {\\n       DUMP_STR(kWriteStr, kPrintPlexName, uStr);\\n@@ -663,22 +666,6 @@ nsPrintOptions::WritePrefs(nsIPrintSettings *aPS, const nsAString& aPrinterName,\\n     }\\n   }\\n \\n-  if (aFlags & nsIPrintSettings::kInitSavePaperSizeUnit) {\\n-    if (NS_SUCCEEDED(aPS->GetPaperSizeUnit(&iVal16))) {\\n-      DUMP_INT(kWriteStr, kPrintPaperSizeUnit, iVal16);\\n-      mPrefBranch->SetIntPref(GetPrefName(kPrintPaperSizeUnit, aPrinterName),\\n-                              PRInt32(iVal16));\\n-    }\\n-  }\\n- \\n-  if (aFlags & nsIPrintSettings::kInitSavePaperSizeType) {\\n-    if (NS_SUCCEEDED(aPS->GetPaperSizeType(&iVal16))) {\\n-      DUMP_INT(kWriteStr, kPrintPaperSizeType, iVal16);\\n-      mPrefBranch->SetIntPref(GetPrefName(kPrintPaperSizeType, aPrinterName),\\n-                              PRInt32(iVal16));\\n-    }\\n-  }\\n-\\n   if (aFlags & nsIPrintSettings::kInitSavePaperData) {\\n     if (NS_SUCCEEDED(aPS->GetPaperData(&iVal16))) {\\n       DUMP_INT(kWriteStr, kPrintPaperData, iVal16);\\n@@ -687,20 +674,6 @@ nsPrintOptions::WritePrefs(nsIPrintSettings *aPS, const nsAString& aPrinterName,\\n     }\\n   }\\n \\n-  if (aFlags & nsIPrintSettings::kInitSavePaperWidth) {\\n-    if (NS_SUCCEEDED(aPS->GetPaperWidth(&dbl))) {\\n-      DUMP_DBL(kWriteStr, kPrintPaperWidth, dbl);\\n-      WritePrefDouble(GetPrefName(kPrintPaperWidth, aPrinterName), dbl);\\n-    }\\n-  }\\n-\\n-  if (aFlags & nsIPrintSettings::kInitSavePaperHeight) {\\n-    if (NS_SUCCEEDED(aPS->GetPaperHeight(&dbl))) {\\n-      DUMP_DBL(kWriteStr, kPrintPaperHeight, dbl);\\n-      WritePrefDouble(GetPrefName(kPrintPaperHeight, aPrinterName), dbl);\\n-    }\\n-  }\\n-\\n   if (aFlags & nsIPrintSettings::kInitSaveColorspace) {\\n     if (NS_SUCCEEDED(aPS->GetColorspace(&uStr))) {\\n       DUMP_STR(kWriteStr, kPrintColorspace, uStr);\\n@@ -1244,7 +1217,6 @@ Tester::Tester()\\n     ps->SetPaperSizeUnit(nsIPrintSettings::kPaperSizeMillimeters);\\n     ps->SetPrintReversed(PR_TRUE);\\n     ps->SetPrintInColor(PR_TRUE);\\n-    ps->SetPaperSize(5);\\n     ps->SetOrientation(nsIPrintSettings::kLandscapeOrientation);\\n     ps->SetPrintCommand(NS_ConvertUTF8toUTF16(\\\"Command\\\").get());\\n     ps->SetNumCopies(2);\\n@@ -1270,13 +1242,8 @@ Tester::Tester()\\n       {kPrintBGImages, nsIPrintSettings::kInitSaveBGImages},\\n       {kPrintShrinkToFit, nsIPrintSettings::kInitSaveShrinkToFit},\\n       {kPrintPaperSize, nsIPrintSettings::kInitSavePaperSize},\\n-      {kPrintPaperName, nsIPrintSettings::kInitSavePaperName},\\n       {kPrintPlexName, nsIPrintSettings::kInitSavePlexName},\\n-      {kPrintPaperSizeUnit, nsIPrintSettings::kInitSavePaperSizeUnit},\\n-      {kPrintPaperSizeType, nsIPrintSettings::kInitSavePaperSizeType},\\n       {kPrintPaperData, nsIPrintSettings::kInitSavePaperData},\\n-      {kPrintPaperWidth, nsIPrintSettings::kInitSavePaperWidth},\\n-      {kPrintPaperHeight, nsIPrintSettings::kInitSavePaperHeight},\\n       {kPrintReversed, nsIPrintSettings::kInitSaveReversed},\\n       {kPrintInColor, nsIPrintSettings::kInitSaveInColor},\\n       {kPrintColorspace, nsIPrintSettings::kInitSaveColorspace},\\ndiff --git a/widget/src/xpwidgets/nsPrintSettingsImpl.cpp b/widget/src/xpwidgets/nsPrintSettingsImpl.cpp\\nindex 0928226..497894a 100644\\n--- a/widget/src/xpwidgets/nsPrintSettingsImpl.cpp\\n+++ b/widget/src/xpwidgets/nsPrintSettingsImpl.cpp\\n@@ -191,19 +191,6 @@ NS_IMETHODIMP nsPrintSettings::SetPrintInColor(PRBool aPrintInColor)\\n   return NS_OK;\\n }\\n \\n-/* attribute short paperSize; */\\n-NS_IMETHODIMP nsPrintSettings::GetPaperSize(PRInt32 *aPaperSize)\\n-{\\n-  //NS_ENSURE_ARG_POINTER(aPaperSize);\\n-  *aPaperSize = mPaperSize;\\n-  return NS_OK;\\n-}\\n-NS_IMETHODIMP nsPrintSettings::SetPaperSize(PRInt32 aPaperSize)\\n-{\\n-  mPaperSize = aPaperSize;\\n-  return NS_OK;\\n-}\\n-\\n /* attribute short orientation; */\\n NS_IMETHODIMP nsPrintSettings::GetOrientation(PRInt32 *aOrientation)\\n {\\n@@ -1003,7 +990,6 @@ nsPrintSettings& nsPrintSettings::operator=(const nsPrintSettings& rhs)\\n   mPaperSizeUnit       = rhs.mPaperSizeUnit;\\n   mPrintReversed       = rhs.mPrintReversed;\\n   mPrintInColor        = rhs.mPrintInColor;\\n-  mPaperSize           = rhs.mPaperSize;\\n   mOrientation         = rhs.mOrientation;\\n   mPrintCommand        = rhs.mPrintCommand;\\n   mNumCopies           = rhs.mNumCopies;\\ndiff --git a/widget/src/xpwidgets/nsPrintSettingsImpl.h b/widget/src/xpwidgets/nsPrintSettingsImpl.h\\nindex 80c1885..7f44792 100644\\n--- a/widget/src/xpwidgets/nsPrintSettingsImpl.h\\n+++ b/widget/src/xpwidgets/nsPrintSettingsImpl.h\\n@@ -118,7 +118,6 @@ protected:\\n \\n   PRBool        mPrintReversed;\\n   PRBool        mPrintInColor; // a false means grayscale\\n-  PRInt32       mPaperSize;    // see page size consts\\n   PRInt32       mOrientation;  // see orientation consts\\n   nsString      mColorspace;\\n   nsString      mResolutionName;\\ndiff --git a/xpfe/global/resources/content/printdialog.js b/xpfe/global/resources/content/printdialog.js\\nindex d1ab7e8..32ff0e5 100644\\n--- a/xpfe/global/resources/content/printdialog.js\\n+++ b/xpfe/global/resources/content/printdialog.js\\n@@ -405,11 +405,7 @@ function onAccept()\\n   saveToPrefs = gPrefs.getBoolPref(\\\"print.save_print_settings\\\");\\n \\n   if (saveToPrefs && printService != null) {\\n-    var flags = gPrintSetInterface.kInitSavePaperSizeType  | \\n-                gPrintSetInterface.kInitSavePaperSizeUnit  |\\n-                gPrintSetInterface.kInitSavePaperWidth     | \\n-                gPrintSetInterface.kInitSavePaperHeight    |\\n-                gPrintSetInterface.kInitSavePaperName      | \\n+    var flags = gPrintSetInterface.kInitSavePaperSize      | \\n                 gPrintSetInterface.kInitSaveColorSpace     |\\n                 gPrintSetInterface.kInitSaveInColor        |\\n                 gPrintSetInterface.kInitSaveResolutionName |\\ndiff --git a/xpfe/global/resources/content/unix/printjoboptions.js b/xpfe/global/resources/content/unix/printjoboptions.js\\nindex a106f82..d77235c 100644\\n--- a/xpfe/global/resources/content/unix/printjoboptions.js\\n+++ b/xpfe/global/resources/content/unix/printjoboptions.js\\n@@ -200,7 +200,6 @@ function createPaperArrayFromDefaults()\\n     obj.width  = paperWidths[i];\\n     obj.height = paperHeights[i];\\n     obj.inches = paperInches[i];\\n-    obj.paperSize = paperEnums[i]; // deprecated\\n     \\n     /* Calculate the width/height in millimeters */\\n     if (paperInches[i]) {\\n@@ -237,7 +236,6 @@ function createPaperArrayFromPrinterFeatures()\\n     obj.width_mm  = gPrefs.getIntPref(\\\"print.tmp.printerfeatures.\\\"  + printername + \\\".paper.\\\" + i + \\\".width_mm\\\");\\n     obj.height_mm = gPrefs.getIntPref(\\\"print.tmp.printerfeatures.\\\"  + printername + \\\".paper.\\\" + i + \\\".height_mm\\\");\\n     obj.inches    = gPrefs.getBoolPref(\\\"print.tmp.printerfeatures.\\\" + printername + \\\".paper.\\\" + i + \\\".is_inch\\\");\\n-    obj.paperSize = 666; // deprecated\\n     \\n     /* Calculate the width/height in paper's native units (either inches or millimeters) */\\n     if (obj.inches) {\\n@@ -908,7 +906,6 @@ function onAccept()\\n     print_resolution_name  = gResolutionArray[resolutionSelectedInx].name;\\n     print_colorspace       = gColorspaceArray[colorspaceSelectedInx].name;\\n \\n-    gPrintSettings.paperSize       = gPaperArray[paperSelectedInx].paperSize; // deprecated\\n     gPrintSettings.paperSizeType   = print_paper_type;\\n     gPrintSettings.paperSizeUnit   = print_paper_unit;\\n     gPrintSettings.paperWidth      = print_paper_width;\\n@@ -943,7 +940,6 @@ function onAccept()\\n \\n     if (doDebug) {\\n       dump(\\\"onAccept******************************\\\\n\\\");\\n-      dump(\\\"paperSize        \\\"+gPrintSettings.paperSize+\\\" (deprecated)\\\\n\\\");\\n       dump(\\\"paperSizeType    \\\"+print_paper_type+\\\" (should be 1)\\\\n\\\");\\n       dump(\\\"paperSizeUnit    \\\"+print_paper_unit+\\\"\\\\n\\\");\\n       dump(\\\"paperWidth       \\\"+print_paper_width+\\\"\\\\n\\\");\\n\""}