{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas1f4e049\""},"diff":"\"1f4e049 Make sure to tear down the XBL binding for nodes which forced one even though not in the document.  Bug 389636, r+sr+a=sicking\\ndiff --git a/content/base/src/nsGenericElement.cpp b/content/base/src/nsGenericElement.cpp\\nindex fcc0296..0082689 100644\\n--- a/content/base/src/nsGenericElement.cpp\\n+++ b/content/base/src/nsGenericElement.cpp\\n@@ -2089,7 +2089,8 @@ nsGenericElement::UnbindFromTree(PRBool aDeep, PRBool aNullParent)\\n                   \\\"Shallow unbind won't clear document and binding parent on \\\"\\n                   \\\"kids!\\\");\\n   // Make sure to unbind this node before doing the kids\\n-  nsIDocument *document = GetCurrentDoc();\\n+  nsIDocument *document =\\n+    HasFlag(NODE_FORCE_XBL_BINDINGS) ? GetOwnerDoc() : GetCurrentDoc();\\n   if (document) {\\n     // Notify XBL- & nsIAnonymousContentCreator-generated\\n     // anonymous content that the document is changing.\\ndiff --git a/layout/reftests/bugs/389636-1.html b/layout/reftests/bugs/389636-1.html\\nnew file mode 100644\\nindex 0000000..e3ab2ca\\n--- /dev/null\\n+++ b/layout/reftests/bugs/389636-1.html\\n@@ -0,0 +1,31 @@\\n+<!DOCTYPE html>\\n+<html class=\\\"reftest-wait\\\">\\n+<head>\\n+<script>\\n+function finishTest()\\n+{\\n+  document.documentElement.className = \\\"\\\";\\n+}\\n+\\n+function boom()\\n+{\\n+  var HTML_NS = \\\"http://www.w3.org/1999/xhtml\\\";\\n+  var XUL_NS  = \\\"http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul\\\";\\n+\\n+  var clonedRichListBox = document.createElementNS(XUL_NS, 'richlistbox').cloneNode(false);\\n+  var div = document.createElementNS(HTML_NS, \\\"div\\\");\\n+\\n+  div.appendChild(clonedRichListBox);\\n+\\n+  document.body.appendChild(clonedRichListBox);\\n+\\n+  setTimeout(finishTest, 100);\\n+}\\n+\\n+</script>\\n+\\n+</head>\\n+<body onload=\\\"setTimeout(boom, 100);\\\" style=\\\"visibility: hidden\\\"> \\n+\\n+</body>\\n+</html>\\ndiff --git a/layout/reftests/bugs/reftest.list b/layout/reftests/bugs/reftest.list\\nindex f5133d1b..b98295c 100644\\n--- a/layout/reftests/bugs/reftest.list\\n+++ b/layout/reftests/bugs/reftest.list\\n@@ -368,6 +368,7 @@ fails == 386310-1d.html 386310-1-ref.html\\n == 387201-2.html about:blank  # Really an assertion test rather than a rendering test\\n == 387201-3.html about:blank  # Really an assertion test rather than a rendering test\\n == 387344-1.html 387344-1-ref.html\\n+== 389636-1.html about:blank  # assertion test\\n == 389924-1a.html 389924-1-ref.html\\n == 389924-1b.html 389924-1-ref.html\\n != 389924-1a.html about:blank\\n\""}