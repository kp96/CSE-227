{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basff20db8b\""},"diff":"\"ff20db8b Be consistent as to when we forward to the inner window. bug 393669, r+sr=jst\\ndiff --git a/dom/src/base/nsDOMClassInfo.cpp b/dom/src/base/nsDOMClassInfo.cpp\\nindex f582eb1..db7d310 100644\\n--- a/dom/src/base/nsDOMClassInfo.cpp\\n+++ b/dom/src/base/nsDOMClassInfo.cpp\\n@@ -4463,7 +4463,9 @@ nsWindowSH::SetProperty(nsIXPConnectWrappedNative *wrapper, JSContext *cx,\\n   }\\n #endif\\n \\n-  if (win->IsOuterWindow() && !ObjectIsNativeWrapper(cx, obj)) {\\n+  JSObject *realObj;\\n+  wrapper->GetJSObject(&realObj);\\n+  if (win->IsOuterWindow() && obj == realObj) {\\n     // XXXjst: Do security checks here when we remove the security\\n     // checks on the inner window.\\n \\n@@ -4542,7 +4544,9 @@ nsWindowSH::AddProperty(nsIXPConnectWrappedNative *wrapper, JSContext *cx,\\n   }\\n #endif\\n \\n-  if (win->IsOuterWindow() && !ObjectIsNativeWrapper(cx, obj) ) {\\n+  JSObject *realObj;\\n+  wrapper->GetJSObject(&realObj);\\n+  if (win->IsOuterWindow() && obj == realObj) {\\n     // XXXjst: Do security checks here when we remove the security\\n     // checks on the inner window.\\n \\n@@ -5571,7 +5575,9 @@ nsWindowSH::NewResolve(nsIXPConnectWrappedNative *wrapper, JSContext *cx,\\n     }\\n \\n     JSObject *innerObj;\\n-    if (!ObjectIsNativeWrapper(cx, obj) &&\\n+    JSObject *realObj;\\n+    wrapper->GetJSObject(&realObj);\\n+    if (realObj == obj &&\\n         innerWin && (innerObj = innerWin->GetGlobalJSObject())) {\\n #ifdef DEBUG_SH_FORWARDING\\n       printf(\\\" --- Forwarding resolve to inner window %p\\\\n\\\", (void *)innerWin);\\n\""}