{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basa41e4a4\""},"diff":"\"a41e4a4 Relanding patch for bug 137155 on trunk because we think it may be OK now. Patch by darin, r+sr=bzbarsky+biesi, a=bzbarsky\\ndiff --git a/netwerk/protocol/http/src/nsHttpTransaction.cpp b/netwerk/protocol/http/src/nsHttpTransaction.cpp\\nindex f670267..b5b904f 100644\\n--- a/netwerk/protocol/http/src/nsHttpTransaction.cpp\\n+++ b/netwerk/protocol/http/src/nsHttpTransaction.cpp\\n@@ -44,7 +44,9 @@\\n #include \\\"nsHttpRequestHead.h\\\"\\n #include \\\"nsHttpResponseHead.h\\\"\\n #include \\\"nsHttpChunkedDecoder.h\\\"\\n+#include \\\"nsNetSegmentUtils.h\\\"\\n #include \\\"nsTransportUtils.h\\\"\\n+#include \\\"nsNetUtil.h\\\"\\n #include \\\"nsProxyRelease.h\\\"\\n #include \\\"nsIOService.h\\\"\\n #include \\\"nsAutoLock.h\\\"\\n@@ -266,7 +268,12 @@ nsHttpTransaction::Init(PRUint8 caps,\\n         rv = multi->AppendStream(requestBody);\\n         if (NS_FAILED(rv)) return rv;\\n \\n-        mRequestStream = multi;\\n+        // wrap the multiplexed input stream with a buffered input stream, so\\n+        // that we write data in the largest chunks possible.  this is actually\\n+        // necessary to workaround some common server bugs (see bug 137155).\\n+        rv = NS_NewBufferedInputStream(getter_AddRefs(mRequestStream), multi,\\n+                                       NET_DEFAULT_SEGMENT_SIZE);\\n+        if (NS_FAILED(rv)) return rv;\\n     }\\n     else\\n         mRequestStream = headers;\\n\""}