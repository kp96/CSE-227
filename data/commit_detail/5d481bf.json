{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas5d481bf\""},"diff":"\"5d481bf Bug 261790 port various changes betwen xpfe/toolkit Relanding patch after aviary branch landing - already reviewed\\ndiff --git a/browser/base/content/tabbrowser.xml b/browser/base/content/tabbrowser.xml\\nindex ca77b4e..e42f533 100644\\n--- a/browser/base/content/tabbrowser.xml\\n+++ b/browser/base/content/tabbrowser.xml\\n@@ -283,7 +283,7 @@\\n               if (aStateFlags & nsIWebProgressListener.STATE_START)\\n                   this.mBrowser.mFavIconURL = null;\\n \\n-              if (aStateFlags & nsIWebProgressListener.STATE_START && \\n+              if (aStateFlags & nsIWebProgressListener.STATE_START &&\\n                   aStateFlags & nsIWebProgressListener.STATE_IS_NETWORK) {\\n                 // It's okay to clear what the user typed when we start\\n                 // loading a document. If the user types, this flag gets\\n@@ -296,7 +296,7 @@\\n                 if (!this.mBlank) {\\n                   this.mTab.setAttribute(\\\"busy\\\", \\\"true\\\");\\n                   this.mTab.label = this.mTabBrowser.mStringBundle.getString(\\\"tabs.loading\\\");\\n-                  this.mTab.removeAttribute(\\\"image\\\"); \\n+                  this.mTab.removeAttribute(\\\"image\\\");\\n                   this.mIcon = null;\\n \\n                   if (this.mTabBrowser.mCurrentTab == this.mTab)\\n@@ -342,10 +342,10 @@\\n                     p.onStateChange(aWebProgress, aRequest, aStateFlags, aStatus);\\n                 }\\n               }\\n-            }\\n-            ,\\n+            },\\n \\n-            onLocationChange : function(aWebProgress, aRequest, aLocation) {\\n+            onLocationChange : function(aWebProgress, aRequest, aLocation)\\n+            {\\n               // The document loaded correctly, clear the value if we should\\n               if (this.mBrowser.userTypedClear)\\n                 this.mBrowser.userTypedValue = null;\\n@@ -359,7 +359,8 @@\\n               }\\n             },\\n \\n-            onStatusChange : function(aWebProgress, aRequest, aStatus, aMessage) {\\n+            onStatusChange : function(aWebProgress, aRequest, aStatus, aMessage)\\n+            {\\n               if (this.mBlank)\\n                 return;\\n \\n@@ -391,8 +392,7 @@\\n                 return this;\\n               throw Components.results.NS_NOINTERFACE;\\n             }\\n-                  \\n-            });\\n+          });\\n         ]]>\\n         </body>\\n       </method>\\n@@ -412,7 +412,7 @@\\n         <body>\\n           <![CDATA[\\n             return (aURI && this.mPrefs.getBoolPref(\\\"browser.chrome.site_icons\\\") &&\\n-                    this.mPrefs.getBoolPref(\\\"browser.chrome.favicons\\\") && \\n+                    this.mPrefs.getBoolPref(\\\"browser.chrome.favicons\\\") &&\\n                     (\\\"schemeIs\\\" in aURI) && (aURI.schemeIs(\\\"http\\\") || aURI.schemeIs(\\\"https\\\")));\\n           ]]>\\n         </body>\\n@@ -591,7 +591,7 @@\\n \\n             // Update the window title.\\n             this.updateTitlebar();\\n-            \\n+\\n             // If the new tab is busy, and our current state is not busy, then\\n             // we need to fire a start to all progress listeners.\\n             const nsIWebProgressListener = Components.interfaces.nsIWebProgressListener;\\n@@ -859,7 +859,9 @@\\n             }\\n \\n             // Wire up a progress listener to our filter.\\n-            const listener = this.mTabProgressListener(this.mCurrentTab, this.mCurrentBrowser, false);\\n+            const listener = this.mTabProgressListener(this.mCurrentTab,\\n+                                                       this.mCurrentBrowser,\\n+                                                       false);\\n             filter.addProgressListener(listener, Components.interfaces.nsIWebProgress.NOTIFY_ALL);\\n             this.mTabListeners[0] = listener;\\n           ]]>\\n@@ -886,16 +888,14 @@\\n         <parameter name=\\\"aPostData\\\"/>\\n         <body>\\n           <![CDATA[\\n-            var blank = (aURI == \\\"about:blank\\\");\\n-\\n             if (!this.mTabbedMode)\\n               this.enterTabbedMode();\\n \\n-            var b = document.createElementNS(\\\"http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul\\\",\\n-                                             \\\"browser\\\"); \\n             var t = document.createElementNS(\\\"http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul\\\",\\n                                              \\\"tab\\\");\\n \\n+            var blank = (aURI == \\\"about:blank\\\");\\n+\\n             if (blank)\\n               t.setAttribute(\\\"label\\\", this.mStringBundle.getString(\\\"tabs.untitled\\\"));\\n             else\\n@@ -910,6 +910,8 @@\\n             t.setAttribute(\\\"onerror\\\", \\\"this.parentNode.parentNode.parentNode.parentNode.addToMissedIconCache(this.getAttribute('image')); this.removeAttribute('image');\\\");\\n             this.mTabContainer.appendChild(t);\\n \\n+            var b = document.createElementNS(\\\"http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul\\\",\\n+                                             \\\"browser\\\");\\n             b.setAttribute(\\\"type\\\", \\\"content\\\");\\n             b.setAttribute(\\\"message\\\", \\\"true\\\");\\n             b.setAttribute(\\\"contextmenu\\\", this.getAttribute(\\\"contentcontextmenu\\\"));\\n\""}