{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basca2df7d\""},"diff":"\"ca2df7d Bug 309452: Dropping a tab to another tabbar should drop the URL, patch by Dorando <bugzilla-mozilla@dorando.at>, r=mconnor\\ndiff --git a/browser/base/content/tabbrowser.xml b/browser/base/content/tabbrowser.xml\\nindex a1ee75c..a10afef 100644\\n--- a/browser/base/content/tabbrowser.xml\\n+++ b/browser/base/content/tabbrowser.xml\\n@@ -93,10 +93,6 @@\\n           <xul:tabs class=\\\"tabbrowser-tabs\\\" closebutton=\\\"true\\\" flex=\\\"1\\\"\\n                     setfocus=\\\"false\\\"\\n                     onclick=\\\"this.parentNode.parentNode.parentNode.onTabClick(event);\\\"\\n-                    ondragover=\\\"nsDragAndDrop.dragOver(event, this.parentNode.parentNode.parentNode);\\n-                                event.stopPropagation();\\\"\\n-                    ondragdrop=\\\"nsDragAndDrop.drop(event, this.parentNode.parentNode.parentNode);\\n-                                event.stopPropagation();\\\"\\n                     xbl:inherits=\\\"onnewtab\\\"\\n                     ondblclick=\\\"this.parentNode.parentNode.parentNode.onTabBarDblClick(event);\\\"\\n                     onclosetab=\\\"var node = this.parentNode;\\n@@ -1451,13 +1447,14 @@\\n         <![CDATA[\\n           if (aEvent.target.localName == \\\"tab\\\") {\\n             aXferData.data = new TransferData();\\n-            aXferData.data.addDataForFlavour(\\\"text/x-moz-tab\\\", aEvent.target._tPos);\\n             \\n             var URI = this.getBrowserForTab(aEvent.target).currentURI;\\n             if (URI) {\\n               aXferData.data.addDataForFlavour(\\\"text/unicode\\\", URI.spec);\\n               aXferData.data.addDataForFlavour(\\\"text/x-moz-url\\\", URI.spec + \\\"\\\\n\\\" + aEvent.target.label);\\n               aXferData.data.addDataForFlavour(\\\"text/html\\\", '<a href=\\\"' + URI.spec + '\\\">' + aEvent.target.label + '</a>');\\n+            } else {\\n+              aXferData.data.addDataForFlavour(\\\"text/unicode\\\", \\\"about:blank\\\");\\n             }\\n           }\\n         ]]>\\n@@ -1507,10 +1504,12 @@\\n           <![CDATA[\\n             if (aDragSession.sourceNode && aDragSession.sourceNode.parentNode == this.mTabContainer) {\\n               var newIndex = this.getNewIndex(aEvent);\\n-              if (newIndex > aXferData.data) \\n+              var oldIndex = aDragSession.sourceNode._tPos;\\n+\\n+              if (newIndex > oldIndex) \\n                 newIndex--;\\n-              if (newIndex != aXferData.data) \\n-                this.moveTabTo(this.mTabs[aXferData.data], newIndex);\\n+              if (newIndex != oldIndex) \\n+                this.moveTabTo(this.mTabs[oldIndex], newIndex);\\n             } else {\\n               var url = transferUtils.retrieveURLFromData(aXferData.data, aXferData.flavour.contentType);\\n \\n@@ -1559,7 +1558,6 @@\\n         <body>\\n         <![CDATA[\\n           var flavourSet = new FlavourSet();\\n-          flavourSet.appendFlavour(\\\"text/x-moz-tab\\\"); // this has to be first to support DnD reordering\\n           flavourSet.appendFlavour(\\\"text/x-moz-url\\\");\\n           flavourSet.appendFlavour(\\\"text/unicode\\\");\\n           flavourSet.appendFlavour(\\\"application/x-moz-file\\\", \\\"nsIFile\\\");\\n\""}