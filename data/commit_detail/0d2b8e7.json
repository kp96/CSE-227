{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas0d2b8e7\""},"diff":"\"0d2b8e7 Bug 264610: Domain Guessing: URL is not updated when guessing loads www.hostname.com, patch by Phil Ringnalda <bugzilla@philringnalda.com>, r=vlad\\ndiff --git a/browser/base/content/tabbrowser.xml b/browser/base/content/tabbrowser.xml\\nindex e1f927e..7be972c 100644\\n--- a/browser/base/content/tabbrowser.xml\\n+++ b/browser/base/content/tabbrowser.xml\\n@@ -316,12 +316,12 @@\\n               if (aStateFlags & nsIWebProgressListener.STATE_START &&\\n                   aStateFlags & nsIWebProgressListener.STATE_IS_NETWORK) {\\n                 // It's okay to clear what the user typed when we start\\n-                // loading a document. If the user types, this flag gets\\n-                // set to false, if the document load ends without an\\n-                // onLocationChange, this flag also gets set to false\\n-                // (so we keep it while switching tabs after failed load\\n+                // loading a document. If the user types, this counter gets\\n+                // set to zero, if the document load ends without an\\n+                // onLocationChange, this counter gets decremented\\n+                // (so we keep it while switching tabs after failed loads)\\n                 if (aWebProgress.DOMWindow == this.mBrowser.contentWindow)\\n-                  this.mBrowser.userTypedClear = true;\\n+                  this.mBrowser.userTypedClear++;\\n \\n                 if (!this.mBlank) {\\n                   this.mTab.setAttribute(\\\"busy\\\", \\\"true\\\");\\n@@ -335,9 +335,10 @@\\n               else if (aStateFlags & nsIWebProgressListener.STATE_STOP &&\\n                        aStateFlags & nsIWebProgressListener.STATE_IS_NETWORK) {\\n                 if (aWebProgress.DOMWindow == this.mBrowser.contentWindow) {\\n-                  // The document is done loading, it's okay to clear\\n-                  // the value again.\\n-                  this.mBrowser.userTypedClear = false;\\n+                  // The document is done loading, we no longer want the\\n+                  // value cleared.\\n+                  if (this.mBrowser.userTypedClear > 0)\\n+                    this.mBrowser.userTypedClear--;\\n \\n                   if (!this.mBrowser.mIconURL)\\n                     this.mTabBrowser.useDefaultIcon(this.mTab);\\n@@ -374,7 +375,7 @@\\n             onLocationChange : function(aWebProgress, aRequest, aLocation)\\n             {\\n               // The document loaded correctly, clear the value if we should\\n-              if (this.mBrowser.userTypedClear)\\n+              if (this.mBrowser.userTypedClear > 0)\\n                 this.mBrowser.userTypedValue = null;\\n \\n               if (aWebProgress.DOMWindow == this.mBrowser.contentWindow)\\n@@ -657,11 +658,11 @@\\n \\n             var webProgress = this.mCurrentBrowser.webProgress;\\n             var securityUI = this.mCurrentBrowser.securityUI;\\n-            // Remember the current clear state, then set it to false\\n+            // Remember the current clear state, then set it to zero\\n             // so we don't clear the userTypedValue when just switching\\n             // tabs. Set it back to its old state after we're done.\\n             var userTypedClear = this.mCurrentBrowser.userTypedClear;\\n-            this.mCurrentBrowser.userTypedClear = false;\\n+            this.mCurrentBrowser.userTypedClear = 0;\\n             var i, p;\\n             for (i = 0; i < this.mProgressListeners.length; i++) {\\n               p = this.mProgressListeners[i];\\n\""}