{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas61d87ef\""},"diff":"\"61d87ef Flush out layout when doing sync updates.  Bug 393723, r+sr=roc, a=dbaron\\ndiff --git a/editor/libeditor/base/nsEditor.cpp b/editor/libeditor/base/nsEditor.cpp\\nindex bfe8a85..4d6e708 100644\\n--- a/editor/libeditor/base/nsEditor.cpp\\n+++ b/editor/libeditor/base/nsEditor.cpp\\n@@ -2501,7 +2501,7 @@ NS_IMETHODIMP nsEditor::ScrollSelectionIntoView(PRBool aScrollToAnchor)\\n       // If the editor is relying on asynchronous reflows, we have\\n       // to use asynchronous requests to scroll, so that the scrolling happens\\n       // after reflow requests are processed.\\n-\\n+      // XXXbz why not just always do async scroll?\\n       syncScroll = !(flags & nsIPlaintextEditor::eEditorUseAsyncUpdatesMask);\\n     }\\n \\n@@ -4356,9 +4356,14 @@ nsresult nsEditor::EndUpdateViewBatch()\\n \\n       // If we're doing async updates, use NS_VMREFRESH_DEFERRED here, so that\\n       // the reflows we caused will get processed before the invalidates.\\n-      if (flags & nsIPlaintextEditor::eEditorUseAsyncUpdatesMask)\\n+      if (flags & nsIPlaintextEditor::eEditorUseAsyncUpdatesMask) {\\n         updateFlag = NS_VMREFRESH_DEFERRED;\\n-\\n+      } else {\\n+        // Flush out layout.  Need to do this because if we have no invalidates\\n+        // to flush the viewmanager code won't flush our reflow here, and we\\n+        // have selection code that does sync caret scrolling in this case.\\n+        presShell->FlushPendingNotifications(Flush_Layout);\\n+      }\\n       mViewManager->EndUpdateViewBatch(updateFlag);\\n     }\\n \\n\""}