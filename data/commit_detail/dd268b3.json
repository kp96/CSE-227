{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basdd268b3\""},"diff":"\"dd268b3 fix for bug #395445:  Tag and Star icon both show for Location bar entries r=dietrich, a=mconnor for m8\\ndiff --git a/toolkit/components/places/src/nsNavHistoryAutoComplete.cpp b/toolkit/components/places/src/nsNavHistoryAutoComplete.cpp\\nindex cbedb9e..9f8b90d 100644\\n--- a/toolkit/components/places/src/nsNavHistoryAutoComplete.cpp\\n+++ b/toolkit/components/places/src/nsNavHistoryAutoComplete.cpp\\n@@ -331,22 +331,28 @@ nsNavHistory::StartSearch(const nsAString & aSearchString,\\n       nsAutoString style;\\n       aPreviousResult->GetStyleAt(i, style);\\n       if (!style.Equals(NS_LITERAL_STRING(\\\"tag\\\"))) {\\n-        nsAutoString url, title;\\n+        nsAutoString url;\\n         aPreviousResult->GetValueAt(i, url);\\n-        aPreviousResult->GetCommentAt(i, title);\\n \\n-        PRBool isMatch = CaseInsensitiveFindInReadable(mCurrentSearchString, url);\\n-        if (!isMatch)\\n-          isMatch = CaseInsensitiveFindInReadable(mCurrentSearchString, title);\\n+        // make sure the url isn't already listed, as a tag result\\n+        PRBool dummy;\\n+        if (!mCurrentResultURLs.Get(url, &dummy)) {\\n+          nsAutoString title;\\n+          aPreviousResult->GetCommentAt(i, title);\\n \\n-        if (isMatch) {\\n-          nsAutoString image;\\n-          aPreviousResult->GetImageAt(i, image);\\n+          PRBool isMatch = CaseInsensitiveFindInReadable(mCurrentSearchString, url);\\n+          if (!isMatch)\\n+            isMatch = CaseInsensitiveFindInReadable(mCurrentSearchString, title);\\n \\n-          mCurrentResultURLs.Put(url, PR_TRUE);\\n+          if (isMatch) {\\n+            nsAutoString image;\\n+            aPreviousResult->GetImageAt(i, image);\\n+\\n+            mCurrentResultURLs.Put(url, PR_TRUE);\\n   \\n-          rv = mCurrentResult->AppendMatch(url, title, image, style);\\n-          NS_ENSURE_SUCCESS(rv, rv);\\n+            rv = mCurrentResult->AppendMatch(url, title, image, style);\\n+            NS_ENSURE_SUCCESS(rv, rv);\\n+          }\\n         }\\n       }\\n     }\\n\""}