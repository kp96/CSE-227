{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas6a854e4\""},"diff":"\"6a854e4 Bug 393033 - xul:tree reports bad  posinset/setsize attributes\\ndiff --git a/accessible/src/xul/nsXULTreeAccessible.cpp b/accessible/src/xul/nsXULTreeAccessible.cpp\\nindex 6b5a57f..6c915a5 100644\\n--- a/accessible/src/xul/nsXULTreeAccessible.cpp\\n+++ b/accessible/src/xul/nsXULTreeAccessible.cpp\\n@@ -721,20 +721,36 @@ nsXULTreeitemAccessible::GetAttributesInternal(nsIPersistentProperties *aAttribu\\n   rv = view->GetLevel(mRow, &level);\\n   NS_ENSURE_SUCCESS(rv, rv);\\n \\n-  PRInt32 lvl = -1;\\n-  PRInt32 startIndex = mRow;\\n-  for (;startIndex - 1 > 0 &&\\n-        NS_SUCCEEDED(view->GetLevel(startIndex - 1, &lvl)) && lvl != level;\\n-        startIndex--);\\n-\\n-  lvl = -1;\\n-  PRInt32 endIndex = mRow;\\n-  for (;endIndex - 1 > 0 &&\\n-        NS_SUCCEEDED(view->GetLevel(endIndex - 1, &lvl)) && lvl != level;\\n-        endIndex--);\\n-\\n-  PRInt32 setSize = endIndex - startIndex + 1;\\n-  PRInt32 posInSet = mRow - startIndex + 1;\\n+  PRInt32 topCount = 1;\\n+  for (PRInt32 index = mRow - 1; index >= 0; index--) {\\n+    PRInt32 lvl = -1;\\n+    if (NS_SUCCEEDED(view->GetLevel(index, &lvl))) {\\n+      if (lvl < level)\\n+        break;\\n+\\n+      if (lvl == level)\\n+        topCount++;\\n+    }\\n+  }\\n+\\n+  PRInt32 rowCount = 0;\\n+  rv = view->GetRowCount(&rowCount);\\n+  NS_ENSURE_SUCCESS(rv, rv);\\n+\\n+  PRInt32 bottomCount = 0;\\n+  for (PRInt32 index = mRow + 1; index < rowCount; index++) {\\n+    PRInt32 lvl = -1;\\n+    if (NS_SUCCEEDED(view->GetLevel(index, &lvl))) {\\n+      if (lvl < level)\\n+        break;\\n+\\n+      if (lvl == level)\\n+        bottomCount++;\\n+    }\\n+  }\\n+\\n+  PRInt32 setSize = topCount + bottomCount;\\n+  PRInt32 posInSet = topCount;\\n \\n   // set the group attributes\\n   nsAccUtils::SetAccGroupAttrs(aAttributes, level + 1, posInSet, setSize);\\n\""}