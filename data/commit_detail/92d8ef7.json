{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas92d8ef7\""},"diff":"\"92d8ef7 Bug 393294, DOM event leaks (patch 2), r+sr+a=jst\\ndiff --git a/content/events/src/nsDOMBeforeUnloadEvent.cpp b/content/events/src/nsDOMBeforeUnloadEvent.cpp\\nindex 3a51500..9919364 100644\\n--- a/content/events/src/nsDOMBeforeUnloadEvent.cpp\\n+++ b/content/events/src/nsDOMBeforeUnloadEvent.cpp\\n@@ -59,6 +59,11 @@ nsDOMBeforeUnloadEvent::nsDOMBeforeUnloadEvent(nsPresContext* aPresContext,\\n \\n nsDOMBeforeUnloadEvent::~nsDOMBeforeUnloadEvent() \\n {\\n+  if (mEventIsInternal &&\\n+      mEvent->eventStructType == NS_BEFORE_PAGE_UNLOAD_EVENT) {\\n+      delete static_cast<nsBeforePageUnloadEvent*>(mEvent);\\n+      mEvent = nsnull;\\n+  }\\n }\\n \\n NS_IMPL_ADDREF_INHERITED(nsDOMBeforeUnloadEvent, nsDOMEvent)\\ndiff --git a/content/events/src/nsDOMCommandEvent.cpp b/content/events/src/nsDOMCommandEvent.cpp\\nindex b7c3ca4..bd47d02 100644\\n--- a/content/events/src/nsDOMCommandEvent.cpp\\n+++ b/content/events/src/nsDOMCommandEvent.cpp\\n@@ -51,6 +51,14 @@ nsDOMCommandEvent::nsDOMCommandEvent(nsPresContext* aPresContext,\\n   }\\n }\\n \\n+nsDOMCommandEvent::~nsDOMCommandEvent()\\n+{\\n+  if (mEventIsInternal && mEvent->eventStructType == NS_COMMAND_EVENT) {\\n+    delete static_cast<nsCommandEvent*>(mEvent);\\n+    mEvent = nsnull;\\n+  }\\n+}\\n+\\n NS_INTERFACE_MAP_BEGIN(nsDOMCommandEvent)\\n   NS_INTERFACE_MAP_ENTRY(nsIDOMCommandEvent)\\n   NS_INTERFACE_MAP_ENTRY_CONTENT_CLASSINFO(CommandEvent)\\ndiff --git a/content/events/src/nsDOMCommandEvent.h b/content/events/src/nsDOMCommandEvent.h\\nindex 1700d53..69c47f3 100644\\n--- a/content/events/src/nsDOMCommandEvent.h\\n+++ b/content/events/src/nsDOMCommandEvent.h\\n@@ -47,6 +47,7 @@ class nsDOMCommandEvent : public nsDOMEvent,\\n public:\\n   nsDOMCommandEvent(nsPresContext* aPresContext,\\n                     nsCommandEvent* aEvent);\\n+  virtual ~nsDOMCommandEvent();\\n \\n   NS_DECL_ISUPPORTS_INHERITED\\n \\n\""}