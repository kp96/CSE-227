{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas1be98ab\""},"diff":"\"1be98ab bug 321000 - search bar should strip newlines from pasted text, browser chrome test.  r=gavin\\ndiff --git a/browser/base/content/test/Makefile.in b/browser/base/content/test/Makefile.in\\nindex c1659fb..7c2ad4e 100644\\n--- a/browser/base/content/test/Makefile.in\\n+++ b/browser/base/content/test/Makefile.in\\n@@ -47,5 +47,11 @@ _TEST_FILES = \\ttest_feed_discovery.html \\\\\\n \\t   feed_discovery.html \\\\\\n     $(NULL)\\n \\n+_BROWSER_FILES = browser_bug321000.js \\\\\\n+    $(NULL)\\n+\\n libs:: $(_TEST_FILES)\\n \\t$(INSTALL) $(foreach f,$^,\\\"$f\\\") $(DEPTH)/_tests/testing/mochitest/tests/$(relativesrcdir)\\n+\\n+libs::\\t$(_BROWSER_FILES)\\n+\\t$(INSTALL) $(foreach f,$^,\\\"$f\\\") $(DEPTH)/_tests/testing/mochitest/browser/$(relativesrcdir)\\ndiff --git a/browser/base/content/test/browser_bug321000.js b/browser/base/content/test/browser_bug321000.js\\nnew file mode 100644\\nindex 0000000..f8c1ccf\\n--- /dev/null\\n+++ b/browser/base/content/test/browser_bug321000.js\\n@@ -0,0 +1,25 @@\\n+const Ci = Components.interfaces;\\n+const Cc = Components.classes;\\n+\\n+function testPaste(name, element, expected) {\\n+  element.focus();\\n+  EventUtils.synthesizeKey(\\\"v\\\", { accelKey: true });\\n+  is(element.value, expected, name);\\n+}\\n+\\n+// test bug 23485 and bug 321000\\n+// urlbar should strip newlines,\\n+// search bar should replace newlines with spaces\\n+function test() {\\n+  var testString = \\\"  hello hello  \\\\n  world\\\\nworld  \\\";\\n+  // Put a multi-line string in the clipboard\\n+  Components.classes[\\\"@mozilla.org/widget/clipboardhelper;1\\\"]\\n+            .getService(Components.interfaces.nsIClipboardHelper)\\n+            .copyString(testString);\\n+  testPaste('urlbar strips newlines and surrounding whitespace', \\n+            document.getElementById('urlbar'),\\n+            testString.replace(/\\\\s*\\\\n\\\\s*/g,''));\\n+  testPaste('searchbar replaces newlines with spaces', \\n+            document.getElementById('searchbar'),\\n+            testString.replace('\\\\n',' ','g'));\\n+}\\n\""}