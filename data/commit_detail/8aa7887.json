{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas8aa7887\""},"diff":"\"8aa7887 Bug 393924 - Stop setting the bookmarkFeedURI annotation on livemark children. r=sspitzer.\\ndiff --git a/browser/components/places/content/controller.js b/browser/components/places/content/controller.js\\nindex 3ac4177..d422277 100755\\n--- a/browser/components/places/content/controller.js\\n+++ b/browser/components/places/content/controller.js\\n@@ -445,6 +445,7 @@ PlacesController.prototype = {\\n    * rules:\\n    *    \\\"link\\\"              node is a URI\\n    *    \\\"bookmark\\\"          node is a bookamrk\\n+   *    \\\"livemarkChild\\\"     node is a child of a livemark\\n    *    \\\"folder\\\"            node is a folder\\n    *    \\\"query\\\"             node is a query\\n    *    \\\"dynamiccontainer\\\"  node is a dynamic container\\n@@ -506,6 +507,9 @@ PlacesController.prototype = {\\n             var mss = PlacesUtils.microsummaries;\\n             if (mss.hasMicrosummary(node.itemId))\\n               nodeData[\\\"microsummary\\\"] = true;\\n+            else if (node.parent &&\\n+                     PlacesUtils.nodeIsLivemarkContainer(node.parent))\\n+              nodeData[\\\"livemarkChild\\\"] = true;\\n           }\\n           break;\\n         case Ci.nsINavHistoryResultNode.RESULT_TYPE_DAY:\\ndiff --git a/browser/components/places/content/placesOverlay.xul b/browser/components/places/content/placesOverlay.xul\\nindex d6af6b7..915fcc2 100644\\n--- a/browser/components/places/content/placesOverlay.xul\\n+++ b/browser/components/places/content/placesOverlay.xul\\n@@ -155,7 +155,7 @@\\n                label=\\\"&cutCmd.label;\\\"\\n                accesskey=\\\"&cutCmd.accesskey;\\\" \\n                selection=\\\"separator|link|folder|mixed\\\"\\n-               forcehideselection=\\\"livemark/bookmarkFeedURI\\\"/>\\n+               forcehideselection=\\\"livemarkChild\\\"/>\\n     <menuitem id=\\\"placesContext_copy\\\"\\n               command=\\\"cmd_copy\\\"\\n               label=\\\"&copyCmd.label;\\\"\\n@@ -172,7 +172,7 @@\\n               label=\\\"&deleteCmd.label;\\\"\\n               accesskey=\\\"&deleteCmd.accesskey;\\\"\\n               selection=\\\"host|separator|link|folder|day\\\"\\n-              forcehideselection=\\\"livemark/bookmarkFeedURI\\\"/>\\n+              forcehideselection=\\\"livemarkChild\\\"/>\\n     <menuseparator id=\\\"placesContext_deleteSeparator\\\"/>\\n     <menuitem id=\\\"placesContext_reload\\\"\\n               command=\\\"placesCmd_reload\\\"\\n@@ -195,7 +195,7 @@\\n               label=\\\"&cmd.properties.label;\\\" \\n               accesskey=\\\"&cmd.properties.accesskey;\\\"\\n               selection=\\\"bookmark|folder\\\"\\n-              forcehideselection=\\\"livemark/bookmarkFeedURI\\\"/>\\n+              forcehideselection=\\\"livemarkChild\\\"/>\\n   </popup>\\n \\n </overlay>\\ndiff --git a/browser/components/places/content/utils.js b/browser/components/places/content/utils.js\\nindex b6b5d50..40fa901 100644\\n--- a/browser/components/places/content/utils.js\\n+++ b/browser/components/places/content/utils.js\\n@@ -390,10 +390,10 @@ var PlacesUtils = {\\n   },\\n \\n  /**\\n-  * Determines whether a ResultNode is a remote container registered by the\\n+  * Determines whether a result node is a remote container registered by the\\n   * livemark service.\\n   * @param aNode\\n-  *        A NavHistory Result Node\\n+  *        A result Node\\n   * @returns true if the node is a livemark container item\\n   */\\n   nodeIsLivemarkContainer: function PU_nodeIsLivemarkContainer(aNode) {\\n@@ -402,19 +402,13 @@ var PlacesUtils = {\\n   },\\n \\n  /**\\n-  * Determines whether a ResultNode is a live-bookmark item\\n+  * Determines whether a result node is a live-bookmark item\\n   * @param aNode\\n-  *        A NavHistory Result Node\\n+  *        A result node\\n   * @returns true if the node is a livemark container item\\n   */\\n   nodeIsLivemarkItem: function PU_nodeIsLivemarkItem(aNode) {\\n-    if (this.nodeIsBookmark(aNode)) {\\n-      if (this.annotations\\n-              .itemHasAnnotation(aNode.itemId, \\\"livemark/bookmarkFeedURI\\\"))\\n-        return true;\\n-    }\\n-\\n-    return false;\\n+    return aNode.parent && this.nodeIsLivemarkContainer(aNode.parent);\\n   },\\n \\n   /**\\ndiff --git a/toolkit/components/places/src/nsLivemarkService.js b/toolkit/components/places/src/nsLivemarkService.js\\nindex 098b3e60..38df437 100644\\n--- a/toolkit/components/places/src/nsLivemarkService.js\\n+++ b/toolkit/components/places/src/nsLivemarkService.js\\n@@ -66,7 +66,6 @@ const DEFAULT_FAIL_MSG = \\\"Live Bookmark feed failed to load.\\\";\\n const LMANNO_FEEDURI = \\\"livemark/feedURI\\\";\\n const LMANNO_SITEURI = \\\"livemark/siteURI\\\";\\n const LMANNO_EXPIRATION = \\\"livemark/expiration\\\";\\n-const LMANNO_BMANNO = \\\"livemark/bookmarkFeedURI\\\";\\n \\n const PS_CONTRACTID = \\\"@mozilla.org/preferences-service;1\\\";\\n const NH_CONTRACTID = \\\"@mozilla.org/browser/nav-history-service;1\\\";\\n@@ -551,8 +550,6 @@ LivemarkLoadListener.prototype = {\\n   function LS_insertLivemarkChild(folderId, uri, title) {\\n     var id = this._bms.insertBookmark(folderId, uri, this._bms.DEFAULT_INDEX,\\n                                       title);\\n-    this._ans.setItemAnnotation(id, LMANNO_BMANNO, uri.spec, 0,\\n-                                this._ans.EXPIRE_NEVER);\\n   },\\n \\n   /**\\ndiff --git a/toolkit/components/places/tests/chrome/Makefile.in b/toolkit/components/places/tests/chrome/Makefile.in\\nindex c952ba0..2be386e 100644\\n--- a/toolkit/components/places/tests/chrome/Makefile.in\\n+++ b/toolkit/components/places/tests/chrome/Makefile.in\\n@@ -49,7 +49,6 @@ _HTTP_FILES\\t= \\\\\\n \\t\\t$(NULL)\\n \\n _CHROME_FILES\\t= \\\\\\n-\\t\\ttest_add_livemark.xul \\\\\\n \\t\\ttest_371798.xul \\\\\\n \\t\\t$(NULL)\\n \\n\""}