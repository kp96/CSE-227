{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas0cffe92\""},"diff":"\"0cffe92 Bug 394740, Inline MayDispatchMutationEvent, r+sr=peterv, a=jst\\ndiff --git a/content/base/public/nsIDocument.h b/content/base/public/nsIDocument.h\\nindex abb77b0..fdb774d 100644\\n--- a/content/base/public/nsIDocument.h\\n+++ b/content/base/public/nsIDocument.h\\n@@ -41,6 +41,7 @@\\n #include \\\"nsStringGlue.h\\\"\\n #include \\\"nsIDocumentObserver.h\\\" // for nsUpdateType\\n #include \\\"nsCOMPtr.h\\\"\\n+#include \\\"nsCOMArray.h\\\"\\n #include \\\"nsIURI.h\\\"\\n #include \\\"nsWeakPtr.h\\\"\\n #include \\\"nsIWeakReferenceUtils.h\\\"\\n@@ -95,8 +96,8 @@ class mozAutoSubtreeModified;\\n \\n // IID for the nsIDocument interface\\n #define NS_IDOCUMENT_IID      \\\\\\n-{ 0x6700e22b, 0x95b8, 0x44cf, \\\\\\n-  { 0x8f, 0x5a, 0x57, 0x2c, 0x14, 0x5b, 0xd1, 0xa1 } }\\n+{ 0x9a26d0aa, 0x37d2, 0x4313, \\\\\\n+  { 0x9e, 0x53, 0x16, 0xd1, 0xa4, 0x67, 0xb3, 0x5b } }\\n \\n \\n // Flag for AddStyleSheet().\\n@@ -853,7 +854,12 @@ public:\\n    *\\n    * @param aTarget is the target for the mutation event.\\n    */\\n-  virtual void MayDispatchMutationEvent(nsINode* aTarget) = 0;\\n+  void MayDispatchMutationEvent(nsINode* aTarget)\\n+  {\\n+    if (mSubtreeModifiedDepth > 0) {\\n+      mSubtreeModifiedTargets.AppendObject(aTarget);\\n+    }\\n+  }\\n \\n   /**\\n    * Marks as not-going-to-be-collected for the given generation of\\n@@ -962,6 +968,9 @@ protected:\\n   PRUint32 mMarkedCCGeneration;\\n \\n   nsTObserverArray<nsIPresShell> mPresShells;\\n+\\n+  nsCOMArray<nsINode> mSubtreeModifiedTargets;\\n+  PRUint32            mSubtreeModifiedDepth;\\n };\\n \\n NS_DEFINE_STATIC_IID_ACCESSOR(nsIDocument, NS_IDOCUMENT_IID)\\ndiff --git a/content/base/src/nsDocument.cpp b/content/base/src/nsDocument.cpp\\nindex 8d2fdd0..92b5d71 100644\\n--- a/content/base/src/nsDocument.cpp\\n+++ b/content/base/src/nsDocument.cpp\\n@@ -5757,14 +5757,6 @@ nsDocument::OnPageHide(PRBool aPersisted)\\n }\\n \\n void\\n-nsDocument::MayDispatchMutationEvent(nsINode* aTarget)\\n-{\\n-  if (mSubtreeModifiedDepth > 0) {\\n-    mSubtreeModifiedTargets.AppendObject(aTarget);\\n-  }\\n-}\\n-\\n-void\\n nsDocument::WillDispatchMutationEvent(nsINode* aTarget)\\n {\\n   NS_ASSERTION(mSubtreeModifiedDepth != 0 ||\\ndiff --git a/content/base/src/nsDocument.h b/content/base/src/nsDocument.h\\nindex fc7c35c..482458d 100644\\n--- a/content/base/src/nsDocument.h\\n+++ b/content/base/src/nsDocument.h\\n@@ -73,7 +73,6 @@\\n #include \\\"nsINodeInfo.h\\\"\\n #include \\\"nsIDOMDocumentEvent.h\\\"\\n #include \\\"nsIDOM3DocumentEvent.h\\\"\\n-#include \\\"nsCOMArray.h\\\"\\n #include \\\"nsHashtable.h\\\"\\n #include \\\"nsInterfaceHashtable.h\\\"\\n #include \\\"nsIBoxObject.h\\\"\\n@@ -507,7 +506,6 @@ public:\\n   virtual void OnPageShow(PRBool aPersisted);\\n   virtual void OnPageHide(PRBool aPersisted);\\n   \\n-  virtual void MayDispatchMutationEvent(nsINode* aTarget);\\n   virtual void WillDispatchMutationEvent(nsINode* aTarget);\\n   virtual void MutationEventDispatched(nsINode* aTarget);\\n \\n@@ -819,9 +817,6 @@ private:\\n   // Member to store out last-selected stylesheet set.\\n   nsString mLastStyleSheetSet;\\n \\n-  nsCOMArray<nsINode> mSubtreeModifiedTargets;\\n-  PRUint32            mSubtreeModifiedDepth;\\n-\\n   // Our update nesting level\\n   PRUint32 mUpdateNestLevel;\\n };\\n\""}