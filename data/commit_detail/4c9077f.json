{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas4c9077f\""},"diff":"\"4c9077f Bug 392718 - With beautified ftp listings, long filenames are truncated, making them hard to read, patch by DÃ£o Gottwald <dao@design-noir.de>, r+sr+a1.9=bz\\ndiff --git a/netwerk/streamconv/converters/nsIndexedToHTML.cpp b/netwerk/streamconv/converters/nsIndexedToHTML.cpp\\nindex 71aadc0..00a8cca 100644\\n--- a/netwerk/streamconv/converters/nsIndexedToHTML.cpp\\n+++ b/netwerk/streamconv/converters/nsIndexedToHTML.cpp\\n@@ -809,7 +809,7 @@ nsIndexedToHTML::OnIndexAvailable(nsIRequest *aRequest,\\n     // Truncate long names to not stretch the table\\n     //XXX this should be left to the stylesheet (bug 391471)\\n     nsString escapedShort;\\n-    if (description.Length() > 31) {\\n+    if (description.Length() > 46) {\\n         nsCOMPtr<nsIChannel> channel = do_QueryInterface(aRequest);\\n         nsCOMPtr<nsIURI> uri;\\n         rv = channel->GetURI(getter_AddRefs(uri));\\n@@ -819,13 +819,22 @@ nsIndexedToHTML::OnIndexAvailable(nsIRequest *aRequest,\\n         PRBool isSchemeGopher = PR_FALSE;\\n         if (!(NS_SUCCEEDED(uri->SchemeIs(\\\"gopher\\\", &isSchemeGopher)) && isSchemeGopher)) {\\n             //XXX this potentially truncates after a combining char (bug 391472)\\n+            nsXPIDLString descriptionAffix;\\n+            descriptionAffix.Assign(description);\\n+            descriptionAffix.Cut(0, descriptionAffix.Length() - 15);\\n+            if (NS_IS_LOW_SURROGATE(descriptionAffix.First()))\\n+                descriptionAffix.Cut(0, 1);\\n             description.Truncate(30);\\n             if (NS_IS_HIGH_SURROGATE(description.Last()))\\n-                description.Truncate(description.Length()-1);\\n+                description.Truncate(description.Length() - 1);\\n \\n             escapedShort.Adopt(nsEscapeHTML2(description.get(), description.Length()));\\n             // add HORIZONTAL ELLIPSIS (U+2026)\\n             escapedShort.AppendLiteral(\\\"&#8230;\\\");\\n+            nsString tmp;\\n+            tmp.Adopt(nsEscapeHTML2(descriptionAffix.get(), descriptionAffix.Length()));\\n+            escapedShort.Append(tmp);\\n+\\n             pushBuffer.AppendLiteral(\\\" title=\\\\\\\"\\\");\\n             pushBuffer.Append(escaped);\\n             pushBuffer.AppendLiteral(\\\"\\\\\\\"\\\");\\n\""}