{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas3542eb8\""},"diff":"\"3542eb8 Bug 377575 - Table resize information tooltip location is misplaced, patch by Mathieu Fenniak <mfenniak-moz@mathieu.fenniak.net>, r=glazou, sr=jst, a1.9=dbaron\\ndiff --git a/editor/libeditor/html/nsHTMLEditor.cpp b/editor/libeditor/html/nsHTMLEditor.cpp\\nindex 38b596a..3375aa9 100644\\n--- a/editor/libeditor/html/nsHTMLEditor.cpp\\n+++ b/editor/libeditor/html/nsHTMLEditor.cpp\\n@@ -162,6 +162,8 @@ nsHTMLEditor::nsHTMLEditor()\\n , mSnapToGridEnabled(PR_FALSE)\\n , mIsInlineTableEditingEnabled(PR_TRUE)\\n , mGridSize(0)\\n+, mInfoXIncrement(20)\\n+, mInfoYIncrement(20)\\n {\\n } \\n \\ndiff --git a/editor/libeditor/html/nsHTMLEditor.h b/editor/libeditor/html/nsHTMLEditor.h\\nindex b860cbc..a2d397b 100644\\n--- a/editor/libeditor/html/nsHTMLEditor.h\\n+++ b/editor/libeditor/html/nsHTMLEditor.h\\n@@ -908,7 +908,6 @@ protected:\\n   void     SetFinalSize(PRInt32 aX, PRInt32 aY);\\n   void     DeleteRefToAnonymousNode(nsIDOMNode * aNode);\\n   void     SetResizeIncrements(PRInt32 aX, PRInt32 aY, PRInt32 aW, PRInt32 aH, PRBool aPreserveRatio);\\n-  void     SetInfoIncrements(PRInt8 aX, PRInt8 aY);\\n \\n   /* ABSOLUTE POSITIONING */\\n \\ndiff --git a/editor/libeditor/html/nsHTMLObjectResizer.cpp b/editor/libeditor/html/nsHTMLObjectResizer.cpp\\nindex 4f76ad1..f430752 100644\\n--- a/editor/libeditor/html/nsHTMLObjectResizer.cpp\\n+++ b/editor/libeditor/html/nsHTMLObjectResizer.cpp\\n@@ -519,13 +519,6 @@ nsHTMLEditor::HideShadowAndInfo()\\n     mResizingInfo->SetAttribute(NS_LITERAL_STRING(\\\"class\\\"), NS_LITERAL_STRING(\\\"hidden\\\"));\\n }\\n \\n-void\\n-nsHTMLEditor::SetInfoIncrements(PRInt8 aX, PRInt8 aY)\\n-{\\n-  mInfoXIncrement = aX;\\n-  mInfoYIncrement = aY;\\n-}\\n-\\n nsresult\\n nsHTMLEditor::StartResizing(nsIDOMElement *aHandle)\\n {\\n@@ -565,35 +558,27 @@ nsHTMLEditor::StartResizing(nsIDOMElement *aHandle)\\n   aHandle->GetAttribute(NS_LITERAL_STRING(\\\"anonlocation\\\"), locationStr);\\n   if (locationStr.Equals(kTopLeft)) {\\n     SetResizeIncrements(1, 1, -1, -1, preserveRatio);\\n-    SetInfoIncrements(20, 20);\\n   }\\n   else if (locationStr.Equals(kTop)) {\\n     SetResizeIncrements(0, 1, 0, -1, PR_FALSE);\\n-    SetInfoIncrements(0, 20);\\n   }\\n   else if (locationStr.Equals(kTopRight)) {\\n     SetResizeIncrements(0, 1, 1, -1, preserveRatio);\\n-    SetInfoIncrements(-20, 20);\\n   }\\n   else if (locationStr.Equals(kLeft)) {\\n     SetResizeIncrements(1, 0, -1, 0, PR_FALSE);\\n-    SetInfoIncrements(20, 20);\\n   }\\n   else if (locationStr.Equals(kRight)) {\\n     SetResizeIncrements(0, 0, 1, 0, PR_FALSE);\\n-    SetInfoIncrements(-20, 0);\\n   }\\n   else if (locationStr.Equals(kBottomLeft)) {\\n     SetResizeIncrements(1, 0, -1, 1, preserveRatio);\\n-    SetInfoIncrements(20, -20);\\n   }\\n   else if (locationStr.Equals(kBottom)) {\\n     SetResizeIncrements(0, 0, 0, 1, PR_FALSE);\\n-    SetInfoIncrements(0, -20);\\n   }\\n   else if (locationStr.Equals(kBottomRight)) {\\n     SetResizeIncrements(0, 0, 1, 1, preserveRatio);\\n-    SetInfoIncrements(-20, -20);\\n   }\\n \\n   // make the shadow appear\\n@@ -696,62 +681,12 @@ nsHTMLEditor::SetResizingInfoPosition(PRInt32 aX, PRInt32 aY, PRInt32 aW, PRInt3\\n   nsCOMPtr<nsIDOMDocument> domdoc;\\n   nsEditor::GetDocument(getter_AddRefs(domdoc));\\n \\n-  nsCOMPtr<nsIDocument> doc (do_QueryInterface(domdoc));\\n-  if (!doc)\\n-    return NS_ERROR_UNEXPECTED;\\n-\\n-  // get the root content\\n-  nsCOMPtr<nsIDOMNSHTMLElement> nsElement = do_QueryInterface(doc->GetRootContent());\\n-  if (!nsElement) {return NS_ERROR_NULL_POINTER; }\\n-\\n-  // let's get the size of the document\\n-  PRInt32 w, h;\\n-  nsElement->GetOffsetWidth(&w);\\n-  nsElement->GetOffsetHeight(&h);\\n-  \\n-  if (mInfoXIncrement < 0)\\n-    aX = w - aX ;\\n-  if (mInfoYIncrement < 0)\\n-    aY = h - aY;\\n-\\n-  NS_NAMED_LITERAL_STRING(rightStr, \\\"right\\\");\\n   NS_NAMED_LITERAL_STRING(leftStr, \\\"left\\\");\\n   NS_NAMED_LITERAL_STRING(topStr, \\\"top\\\");\\n-  NS_NAMED_LITERAL_STRING(bottomStr, \\\"bottom\\\");\\n-  mHTMLCSSUtils->SetCSSPropertyPixels(mResizingInfo,\\n-                                      (mInfoXIncrement < 0) ? rightStr : leftStr,\\n-                                      aX + PR_ABS(mInfoXIncrement));\\n-  mHTMLCSSUtils->SetCSSPropertyPixels(mResizingInfo,\\n-                                      (mInfoYIncrement < 0) ? bottomStr : topStr,\\n-                                      aY + PR_ABS(mInfoYIncrement));\\n-\\n-  mHTMLCSSUtils->RemoveCSSProperty(mResizingInfo,\\n-                                   (mInfoXIncrement >= 0) ? rightStr  : leftStr);\\n-  mHTMLCSSUtils->RemoveCSSProperty(mResizingInfo,\\n-                                   (mInfoYIncrement >= 0) ? bottomStr  : topStr);\\n-\\n-  // let's make sure the info box does not go beyond the limits of the viewport\\n-  nsAutoString value;\\n-  float f;\\n-  nsCOMPtr<nsIAtom> unit;\\n-  if (mInfoXIncrement < 0) {\\n-    mHTMLCSSUtils->GetComputedProperty(mResizingInfo, nsEditProperty::cssLeft, value);\\n-    mHTMLCSSUtils->ParseLength(value, &f, getter_AddRefs(unit));\\n-    if (f <= 0) {\\n-      mHTMLCSSUtils->SetCSSPropertyPixels(mResizingInfo, leftStr, 0);\\n-      mHTMLCSSUtils->RemoveCSSProperty(mResizingInfo,\\n-                                       rightStr);\\n-    }\\n-  }\\n-  if (mInfoYIncrement < 0) {\\n-    mHTMLCSSUtils->GetComputedProperty(mResizingInfo, nsEditProperty::cssTop, value);\\n-    mHTMLCSSUtils->ParseLength(value, &f, getter_AddRefs(unit));\\n-    if (f <= 0) {\\n-      mHTMLCSSUtils->SetCSSPropertyPixels(mResizingInfo, topStr, 0);\\n-      mHTMLCSSUtils->RemoveCSSProperty(mResizingInfo,\\n-                                       bottomStr);\\n-    }\\n-  }\\n+  mHTMLCSSUtils->SetCSSPropertyPixels(mResizingInfo, leftStr,\\n+                                      aX + mInfoXIncrement);\\n+  mHTMLCSSUtils->SetCSSPropertyPixels(mResizingInfo, topStr,\\n+                                      aY + mInfoYIncrement);\\n \\n   nsCOMPtr<nsIDOMNode> textInfo;\\n   nsresult res = mResizingInfo->GetFirstChild(getter_AddRefs(textInfo));\\n\""}