{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas4a07b54\""},"diff":"\"4a07b54 fix for bug #344587:  dispatch tab open/close events in the correct order. thanks to simon <zeniko@gmail.com> for the fix. r=sspitzer,mano sr=mconnor\\ndiff --git a/browser/base/content/tabbrowser.xml b/browser/base/content/tabbrowser.xml\\nindex 013e219..7028b3b 100644\\n--- a/browser/base/content/tabbrowser.xml\\n+++ b/browser/base/content/tabbrowser.xml\\n@@ -1341,16 +1341,8 @@\\n             }\\n             setTimeout(_delayedUpdate, 0, this.mTabContainer);\\n \\n-            // We're committed to closing the tab now.  \\n-            // Dispatch a notification.\\n-            // We dispatch it before any teardown so that event listeners can\\n-            // inspect the tab that's about to close.\\n-            var evt = document.createEvent(\\\"Events\\\");\\n-            evt.initEvent(\\\"TabClose\\\", true, false);\\n-            aTab.dispatchEvent(evt);\\n-\\n             if (l == 1) {\\n-              // add a new blank tab to replace the one being closed\\n+              // add a new blank tab to replace the one we're about to close\\n               // (this ensures that the remaining tab is as good as new)\\n               this.addTab(\\\"about:blank\\\");\\n               l++;\\n@@ -1362,6 +1354,14 @@\\n                 this.setStripVisibilityTo(false);\\n             }\\n \\n+            // We're committed to closing the tab now.  \\n+            // Dispatch a notification.\\n+            // We dispatch it before any teardown so that event listeners can\\n+            // inspect the tab that's about to close.\\n+            var evt = document.createEvent(\\\"Events\\\");\\n+            evt.initEvent(\\\"TabClose\\\", true, false);\\n+            aTab.dispatchEvent(evt);\\n+\\n             var index = -1;\\n             if (this.mCurrentTab == aTab)\\n               index = this.mTabContainer.selectedIndex;\\n\""}