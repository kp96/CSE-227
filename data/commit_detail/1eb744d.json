{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas1eb744d\""},"diff":"\"1eb744d [OS/2] Bug 397514: Fix build break following for bug 96041, p=wuno, r=me\\ndiff --git a/gfx/thebes/public/gfxOS2Fonts.h b/gfx/thebes/public/gfxOS2Fonts.h\\nindex 62723a7..f5862c0 100644\\n--- a/gfx/thebes/public/gfxOS2Fonts.h\\n+++ b/gfx/thebes/public/gfxOS2Fonts.h\\n@@ -71,7 +71,7 @@ public:\\n \\n protected:\\n     gfxMatrix mCTM;\\n-    virtual PRBool SetupCairoFont(cairo_t *aCR);\\n+    virtual PRBool SetupCairoFont(gfxContext *aContext);\\n \\n private:\\n     cairo_font_face_t *mFontFace;\\ndiff --git a/gfx/thebes/src/gfxOS2Fonts.cpp b/gfx/thebes/src/gfxOS2Fonts.cpp\\nindex 049d908..53f9a77 100644\\n--- a/gfx/thebes/src/gfxOS2Fonts.cpp\\n+++ b/gfx/thebes/src/gfxOS2Fonts.cpp\\n@@ -352,11 +352,11 @@ nsString gfxOS2Font::GetUniqueName()\\n     return mName;\\n }\\n \\n-PRBool gfxOS2Font::SetupCairoFont(cairo_t *aCR)\\n+PRBool gfxOS2Font::SetupCairoFont(gfxContext *aContext)\\n {\\n #ifdef DEBUG_thebes_2\\n     printf(\\\"gfxOS2Font[%#x]::SetupCairoFont(%#x)\\\\n\\\",\\n-           (unsigned)this, (unsigned) aCR);\\n+           (unsigned)this, (unsigned) aContext);\\n #endif\\n     // gfxPangoFont checks the CTM but Windows doesn't so leave away here, too\\n \\n@@ -367,7 +367,7 @@ PRBool gfxOS2Font::SetupCairoFont(cairo_t *aCR)\\n         // the cairo_t, precluding any further drawing.\\n         return PR_FALSE;\\n     }\\n-    cairo_set_scaled_font(aCR, scaledFont);\\n+    cairo_set_scaled_font(aContext->GetCairo(), scaledFont);\\n     return PR_TRUE;\\n }\\n \\n@@ -443,6 +443,8 @@ gfxTextRun *gfxOS2FontGroup::MakeTextRun(const PRUnichar* aString, PRUint32 aLen\\n \\n     InitTextRun(textRun, (PRUint8 *)utf8.get(), utf8.Length(), headerLen);\\n \\n+    textRun->FetchGlyphExtents(aParams->mContext);\\n+\\n     return textRun;\\n }\\n \\n@@ -477,6 +479,8 @@ gfxTextRun *gfxOS2FontGroup::MakeTextRun(const PRUint8* aString, PRUint32 aLengt\\n         InitTextRun(textRun, (PRUint8 *)utf8.get(), utf8.Length(), headerLen);\\n     }\\n \\n+    textRun->FetchGlyphExtents(aParams->mContext);\\n+\\n     return textRun;\\n }\\n \\n\""}