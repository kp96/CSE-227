{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas4b624ef\""},"diff":"\"4b624ef export urld type to the native clipboard on Mac OS X. patch by Stan Shebs. b=393609 r=josh sr=roc\\ndiff --git a/widget/src/cocoa/nsChildView.mm b/widget/src/cocoa/nsChildView.mm\\nindex dbbc31d..65be888 100644\\n--- a/widget/src/cocoa/nsChildView.mm\\n+++ b/widget/src/cocoa/nsChildView.mm\\n@@ -1839,6 +1839,7 @@ NSEvent* gLastDragEvent = nil;\\n                                                           NSFilesPromisePboardType,\\n                                                           kWildcardPboardType,\\n                                                           kCorePboardType_url,\\n+                                                          kCorePboardType_urld,\\n                                                           kCorePboardType_urln,\\n                                                           nil]];\\n \\ndiff --git a/widget/src/cocoa/nsClipboard.mm b/widget/src/cocoa/nsClipboard.mm\\nindex 8560309..a66998e 100644\\n--- a/widget/src/cocoa/nsClipboard.mm\\n+++ b/widget/src/cocoa/nsClipboard.mm\\n@@ -492,6 +492,8 @@ nsClipboard::PasteboardDictFromTransferable(nsITransferable* aTransferable)\\n         NSString *nativeTitle = [[NSString alloc] initWithCharacters:urlTitle.get() length:urlTitle.Length()];\\n         // be nice to Carbon apps, normalize the receiver's contents using Form C.\\n         [pasteboardOutputDict setObject:[nativeTitle precomposedStringWithCanonicalMapping] forKey:kCorePboardType_urln];\\n+        // Also put the title out as 'urld', since some recipients will look for that.\\n+        [pasteboardOutputDict setObject:[nativeTitle precomposedStringWithCanonicalMapping] forKey:kCorePboardType_urld];\\n         [nativeTitle release];\\n       }\\n \\ndiff --git a/widget/src/cocoa/nsDragService.h b/widget/src/cocoa/nsDragService.h\\nindex ce94490..4fe2cf9 100644\\n--- a/widget/src/cocoa/nsDragService.h\\n+++ b/widget/src/cocoa/nsDragService.h\\n@@ -45,6 +45,7 @@\\n \\n extern NSString* const kWildcardPboardType;\\n extern NSString* const kCorePboardType_url;\\n+extern NSString* const kCorePboardType_urld;\\n extern NSString* const kCorePboardType_urln;\\n \\n class nsDragService : public nsBaseDragService\\ndiff --git a/widget/src/cocoa/nsDragService.mm b/widget/src/cocoa/nsDragService.mm\\nindex f24e684..b6ae738 100644\\n--- a/widget/src/cocoa/nsDragService.mm\\n+++ b/widget/src/cocoa/nsDragService.mm\\n@@ -84,6 +84,7 @@ nsISupportsArray *gDraggedTransferables = nsnull;\\n \\n NSString* const kWildcardPboardType = @\\\"MozillaWildcard\\\";\\n NSString* const kCorePboardType_url  = @\\\"CorePasteboardFlavorType 0x75726C20\\\"; // 'url '  url\\n+NSString* const kCorePboardType_urld = @\\\"CorePasteboardFlavorType 0x75726C64\\\"; // 'urld'  desc\\n NSString* const kCorePboardType_urln = @\\\"CorePasteboardFlavorType 0x75726C6E\\\"; // 'urln'  title\\n \\n nsDragService::nsDragService()\\n@@ -135,6 +136,7 @@ static nsresult SetUpDragClipboard(nsISupportsArray* aTransferableArray)\\n       id currentValue = [pasteboardOutputDict valueForKey:currentKey];\\n       if (currentKey == NSStringPboardType ||\\n           currentKey == kCorePboardType_url ||\\n+          currentKey == kCorePboardType_urld ||\\n           currentKey == kCorePboardType_urln) {\\n         [dragPBoard setString:currentValue forType:currentKey];\\n       }\\n\""}