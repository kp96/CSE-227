{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basd149ea5\""},"diff":"\"d149ea5 When sniffing text/plain and we decide it's really text/plain, just claim the sniffer didn't find a type, so that other sniffers get a crack at it.  Bug 395533, r+sr=biesi, a=bsmedberg\\ndiff --git a/netwerk/streamconv/converters/nsUnknownDecoder.cpp b/netwerk/streamconv/converters/nsUnknownDecoder.cpp\\nindex 86d1a66..185bccf 100644\\n--- a/netwerk/streamconv/converters/nsUnknownDecoder.cpp\\n+++ b/netwerk/streamconv/converters/nsUnknownDecoder.cpp\\n@@ -270,7 +270,7 @@ nsUnknownDecoder::GetMIMETypeFromContent(nsIRequest* aRequest,\\n   mBufferLen = 0;\\n   type.Assign(mContentType);\\n   mContentType.Truncate();\\n-  return NS_OK;\\n+  return type.IsEmpty() ? NS_ERROR_NOT_AVAILABLE : NS_OK;\\n }\\n \\n \\n@@ -711,6 +711,10 @@ nsBinaryDetector::DetermineContentType(nsIRequest* aRequest)\\n   if (mContentType.Equals(APPLICATION_OCTET_STREAM)) {\\n     // We want to guess at it instead\\n     mContentType = APPLICATION_GUESS_FROM_EXT;\\n+  } else {\\n+    // Let the text/plain type we already have be, so that other content\\n+    // sniffers can also get a shot at this data.\\n+    mContentType.Truncate();\\n   }\\n }\\n \\n\""}