{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas3febe0f\""},"diff":"\"3febe0f Bug 392761. getClientRects/getBoundingClientRect *do* take scrolling into account, including viewport scrolling. r+sr=dbaron\\ndiff --git a/content/base/src/nsGenericElement.cpp b/content/base/src/nsGenericElement.cpp\\nindex 0082689..bc8d699 100644\\n--- a/content/base/src/nsGenericElement.cpp\\n+++ b/content/base/src/nsGenericElement.cpp\\n@@ -83,6 +83,7 @@\\n #ifdef MOZ_XUL\\n #include \\\"nsXULElement.h\\\"\\n #endif /* MOZ_XUL */\\n+#include \\\"nsFrameManager.h\\\"\\n \\n #include \\\"nsBindingManager.h\\\"\\n #include \\\"nsXBLBinding.h\\\"\\n@@ -694,19 +695,14 @@ nsNSElementTearoff::GetElementsByClassName(const nsAString& aClasses,\\n static nsPoint\\n GetOffsetFromInitialContainingBlock(nsIFrame* aFrame)\\n {\\n-  nsPresContext* presContext = aFrame->PresContext();\\n-  nsIPresShell* shell = presContext->PresShell();\\n-  nsIFrame* rootScrollFrame = shell->GetRootScrollFrame();\\n+  nsIFrame* rootFrame = aFrame->PresContext()->FrameManager()->GetRootFrame();\\n   nsPoint pt(0,0);\\n-  nsIFrame* child = aFrame;\\n-  for (nsIFrame* p = aFrame->GetParent(); p && p != rootScrollFrame;\\n-       p = p->GetParent()) {\\n-    pt += p->GetPositionOfChildIgnoringScrolling(child);\\n+  for (nsIFrame* p = aFrame; p != rootFrame; p = p->GetParent()) {\\n     // coordinates of elements inside a foreignobject are relative to the top-left\\n     // of the nearest foreignobject\\n-    if (p->IsFrameOfType(nsIFrame::eSVGForeignObject))\\n+    if (p->IsFrameOfType(nsIFrame::eSVGForeignObject) && p != aFrame)\\n       return pt;\\n-    child = p;\\n+    pt += p->GetPosition();\\n   }\\n   return pt;\\n }\\n\""}