{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas799f2c5\""},"diff":"\"799f2c5 Bug 249136. Focus and key navigation broken for links opened in new tabs. r=mconnor, r=timeless, a=bsmedberg\\ndiff --git a/browser/base/content/tabbrowser.xml b/browser/base/content/tabbrowser.xml\\nindex 0a17aed..8eee4e3 100644\\n--- a/browser/base/content/tabbrowser.xml\\n+++ b/browser/base/content/tabbrowser.xml\\n@@ -953,6 +953,30 @@\\n         </body>\\n       </method>\\n \\n+      <method name=\\\"loadOneTab\\\">\\n+        <parameter name=\\\"aURI\\\"/>\\n+        <parameter name=\\\"aReferrerURI\\\"/>\\n+        <parameter name=\\\"aCharset\\\"/>\\n+        <parameter name=\\\"aPostData\\\"/>\\n+        <parameter name=\\\"aLoadInBackground\\\"/>\\n+        <body>\\n+          <![CDATA[\\n+            var tab = this.addTab(aURI, aReferrerURI, aCharset, aPostData);\\n+            var bgLoad = (typeof(aLoadInBackground) != \\\"undefined\\\") ? aLoadInBackground :\\n+                         this.mPrefs.getBoolPref(\\\"browser.tabs.loadInBackground\\\");\\n+            // Set newly selected tab after quick timeout, otherwise hideous focus problems\\n+            // can occur when \\\"browser.tabs.loadInBackground\\\" is false and presshell is not ready\\n+            if (!bgLoad) {\\n+              function selectNewForegroundTab(browser, tab) {\\n+                this.selectedTab = tab;\\n+              }\\n+              setTimeout(selectNewForegroundTab, 0, getBrowser(), tab);\\n+            }\\n+            return tab;\\n+         ]]>\\n+        </body>\\n+      </method>\\n+\\n       <method name=\\\"addTab\\\">\\n         <parameter name=\\\"aURI\\\"/>\\n         <parameter name=\\\"aReferrerURI\\\"/>\\n@@ -1457,20 +1481,15 @@\\n \\n               this.dragDropSecurityCheck(aEvent, aDragSession, url);\\n \\n-              var bgLoad = this.mPrefs.getBoolPref(\\\"browser.tabs.loadInBackground\\\");\\n-\\n-              var tab = null;\\n               if (aEvent.originalTarget.localName != \\\"tab\\\") {\\n                 // We're adding a new tab.\\n-                tab = this.addTab(getShortcutOrURI(url));\\n+                this.loadOneTab(getShortcutOrURI(url));\\n               }\\n               else {\\n                 // Load in an existing tab.\\n-                tab = aEvent.originalTarget;\\n+                var tab = aEvent.originalTarget;\\n                 this.getBrowserForTab(tab).loadURI(getShortcutOrURI(url));\\n               }\\n-              if (this.mCurrentTab != tab && !bgLoad)\\n-                this.selectedTab = tab;\\n             }\\n           ]]>\\n         </body>\\n\""}