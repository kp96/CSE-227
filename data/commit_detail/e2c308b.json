{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Base2c308b\""},"diff":"\"e2c308b Fix bug 397605.  r+sr+a=jst\\ndiff --git a/content/base/src/nsScriptLoader.cpp b/content/base/src/nsScriptLoader.cpp\\nindex 146f99f..e7ec96c 100644\\n--- a/content/base/src/nsScriptLoader.cpp\\n+++ b/content/base/src/nsScriptLoader.cpp\\n@@ -852,13 +852,13 @@ nsScriptLoader::PrepareLoadedRequest(nsScriptLoadRequest* aRequest,\\n     // the script has a non-cert principal, the document's principal should be\\n     // downgraded.\\n     if (channel) {\\n-      nsCOMPtr<nsISupports> owner;\\n-      channel->GetOwner(getter_AddRefs(owner));\\n-      nsCOMPtr<nsIPrincipal> principal = do_QueryInterface(owner);\\n-\\n-      if (principal) {\\n+      nsCOMPtr<nsIPrincipal> channelPrincipal;\\n+      nsContentUtils::GetSecurityManager()->\\n+        GetChannelPrincipal(channel, getter_AddRefs(channelPrincipal));\\n+      if (channelPrincipal) {\\n         nsCOMPtr<nsIPrincipal> newPrincipal =\\n-          MaybeDowngradeToCodebase(mDocument->NodePrincipal(), principal);\\n+          MaybeDowngradeToCodebase(mDocument->NodePrincipal(),\\n+                                   channelPrincipal);\\n \\n         mDocument->SetPrincipal(newPrincipal);\\n       }\\n\""}