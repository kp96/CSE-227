{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas2ea9fe4\""},"diff":"\"2ea9fe4 Bug 386711 (followup) Use single queries in nsNavHistoryExpire methods (for mak77@supereva.it, r=dietrich)\\ndiff --git a/toolkit/components/places/src/nsNavHistoryExpire.cpp b/toolkit/components/places/src/nsNavHistoryExpire.cpp\\nindex 1368cee..1eee5d9 100644\\n--- a/toolkit/components/places/src/nsNavHistoryExpire.cpp\\n+++ b/toolkit/components/places/src/nsNavHistoryExpire.cpp\\n@@ -406,11 +406,14 @@ nsNavHistoryExpire::EraseVisits(mozIStorageConnection* aConnection,\\n   nsCAutoString deletedVisitIds;\\n   for (PRUint32 i = 0; i < aRecords.Length(); i ++) {\\n     // Do not add comma separator for the first entry\\n-    if(! deletedVisitIds.IsEmpty())\\n+    if (! deletedVisitIds.IsEmpty())\\n       deletedVisitIds.AppendLiteral(\\\", \\\");\\n     deletedVisitIds.AppendInt(aRecords[i].visitID);\\n   }\\n \\n+  if (deletedVisitIds.IsEmpty())\\n+    return NS_OK;\\n+\\n   return aConnection->ExecuteSimpleSQL(\\n     NS_LITERAL_CSTRING(\\\"DELETE FROM moz_historyvisits WHERE id IN (\\\") +\\n     deletedVisitIds +\\n@@ -438,12 +441,15 @@ nsNavHistoryExpire::EraseHistory(mozIStorageConnection* aConnection,\\n         StringBeginsWith(aRecords[i].uri, NS_LITERAL_CSTRING(\\\"place:\\\")))\\n       continue;\\n     // Do not add comma separator for the first entry\\n-    if(! deletedPlaceIds.IsEmpty() )\\n+    if (! deletedPlaceIds.IsEmpty())\\n       deletedPlaceIds.AppendLiteral(\\\", \\\");\\n     deletedPlaceIds.AppendInt(aRecords[i].placeID);\\n     aRecords[i].erased = PR_TRUE;\\n   }\\n \\n+  if (deletedPlaceIds.IsEmpty())\\n+    return NS_OK;\\n+\\n   return aConnection->ExecuteSimpleSQL(\\n     NS_LITERAL_CSTRING(\\\"DELETE FROM moz_places WHERE id IN (\\\") +\\n     deletedPlaceIds +\\n@@ -466,11 +472,14 @@ nsNavHistoryExpire::EraseFavicons(mozIStorageConnection* aConnection,\\n     if (! aRecords[i].erased || aRecords[i].faviconID == 0)\\n       continue;\\n     // Do not add comma separator for the first entry\\n-    if(! deletedFaviconIds.IsEmpty() )\\n+    if (! deletedFaviconIds.IsEmpty())\\n       deletedFaviconIds.AppendLiteral(\\\", \\\");\\n     deletedFaviconIds.AppendInt(aRecords[i].faviconID);\\n   }\\n \\n+  if (deletedFaviconIds.IsEmpty())\\n+    return NS_OK;\\n+\\n   // delete only if id is not referenced in moz_places\\n   return aConnection->ExecuteSimpleSQL(\\n     NS_LITERAL_CSTRING(\\\"DELETE FROM moz_favicons WHERE id IN (\\\") +\\n\""}