{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas1cfd2b4\""},"diff":"\"1cfd2b4 #3011064 r=mkaply, sr=mkaply (OS/2 only) Patch from Andy Willis - add _declspec(dllexport/dllimport) for OS/2\\ndiff --git a/widget/src/os2/nsOS2Uni.cpp b/widget/src/os2/nsOS2Uni.cpp\\nindex 1cafeee..4a3592b 100644\\n--- a/widget/src/os2/nsOS2Uni.cpp\\n+++ b/widget/src/os2/nsOS2Uni.cpp\\n@@ -137,7 +137,7 @@ void OS2Uni::FreeUconvObjects()\\n /**********************************************************\\n     WideCharToMultiByte\\n  **********************************************************/\\n-nsresult\\n+NS_GFX_(nsresult)\\n WideCharToMultiByte(int aCodePage, const PRUnichar* aSrc,\\n                     PRInt32 aSrcLength, nsAutoCharBuffer& aResult,\\n                     PRInt32& aResultLength)\\n@@ -161,7 +161,7 @@ WideCharToMultiByte(int aCodePage, const PRUnichar* aSrc,\\n /**********************************************************\\n     MultiByteToWideChar\\n  **********************************************************/\\n-nsresult\\n+NS_GFX_(nsresult)\\n MultiByteToWideChar(int aCodePage, const char* aSrc,\\n                     PRInt32 aSrcLength, nsAutoChar16Buffer& aResult,\\n                     PRInt32& aResultLength)\\ndiff --git a/widget/src/os2/nsOS2Uni.h b/widget/src/os2/nsOS2Uni.h\\nindex 10a8e49..6d86fab 100644\\n--- a/widget/src/os2/nsOS2Uni.h\\n+++ b/widget/src/os2/nsOS2Uni.h\\n@@ -42,6 +42,7 @@\\n #include <uconv.h>\\n #include \\\"nsAutoBuffer.h\\\"\\n #include \\\"nsICharsetConverterManager.h\\\"\\n+#include \\\"gfxCore.h\\\"\\n \\n \\n enum ConverterRequest {\\n@@ -49,7 +50,7 @@ enum ConverterRequest {\\n   eConv_Decoder\\n };\\n \\n-class OS2Uni {\\n+class NS_GFX OS2Uni {\\n public:\\n   static nsISupports* GetUconvObject(int CodePage, ConverterRequest aReq);\\n   static void FreeUconvObjects();\\n@@ -62,11 +63,11 @@ private:\\n typedef nsAutoBuffer<char, CHAR_BUFFER_SIZE> nsAutoCharBuffer;\\n typedef nsAutoBuffer<PRUnichar, CHAR_BUFFER_SIZE> nsAutoChar16Buffer;\\n \\n-nsresult WideCharToMultiByte(int aCodePage, const PRUnichar* aSrc,\\n-                             PRInt32 aSrcLength, nsAutoCharBuffer& aResult,\\n-                             PRInt32& aResultLength);\\n-nsresult MultiByteToWideChar(int aCodePage, const char* aSrc,\\n-                             PRInt32 aSrcLength, nsAutoChar16Buffer& aResult,\\n-                             PRInt32& aResultLength);\\n-\\n+NS_GFX_(nsresult) WideCharToMultiByte(int aCodePage, const PRUnichar* aSrc,\\n+                                      PRInt32 aSrcLength, nsAutoCharBuffer& aResult,\\n+                                      PRInt32& aResultLength);\\n+NS_GFX_(nsresult) MultiByteToWideChar(int aCodePage, const char* aSrc,\\n+                                      PRInt32 aSrcLength, nsAutoChar16Buffer& aResult,\\n+                                      PRInt32& aResultLength);\\n+         \\n #endif\\ndiff --git a/widget/src/os2/nsPaletteOS2.h b/widget/src/os2/nsPaletteOS2.h\\nindex d1ecf44..4e7d26a 100644\\n--- a/widget/src/os2/nsPaletteOS2.h\\n+++ b/widget/src/os2/nsPaletteOS2.h\\n@@ -40,8 +40,9 @@\\n #define INCL_WIN\\n #define INCL_GPI\\n #include <os2.h>\\n+#include \\\"gfxCore.h\\\"\\n \\n-class nsPaletteOS2 {\\n+class NS_GFX nsPaletteOS2 {\\n public:\\n   static void FreeGlobalPalette();\\n   static void InitializeGlobalPalette();\\ndiff --git a/widget/src/os2/nsPrintOS2.cpp b/widget/src/os2/nsPrintOS2.cpp\\nindex 0ce619d..b310e02 100644\\n--- a/widget/src/os2/nsPrintOS2.cpp\\n+++ b/widget/src/os2/nsPrintOS2.cpp\\n@@ -50,7 +50,7 @@ static HMODULE hmodRes;\\n #define SHIFT_PTR(ptr,offset) ( *((LONG*)&ptr) += offset )\\n \\n \\n-class PRTQUEUE\\n+class NS_GFX PRTQUEUE\\n {\\n public:\\n    PRTQUEUE (const PRQINFO3* pPQI3)  { InitWithPQI3 (pPQI3); }\\n@@ -354,7 +354,7 @@ BOOL PRINTDLG::ShowProperties(ULONG printerNdx)\\n /*  Job management                                                          */\\n /****************************************************************************/\\n \\n-HDC PrnOpenDC( PRTQUEUE *pInfo, PSZ pszApplicationName, int copies, int destination, char *file )\\n+NS_GFX_(HDC) PrnOpenDC( PRTQUEUE *pInfo, PSZ pszApplicationName, int copies, int destination, char *file )\\n {\\n    HDC hdc = 0;\\n    PSZ pszLogAddress;\\n@@ -405,7 +405,7 @@ HDC PrnOpenDC( PRTQUEUE *pInfo, PSZ pszApplicationName, int copies, int destinat\\n }\\n \\n /* find the selected form */\\n-BOOL PrnQueryHardcopyCaps( HDC hdc, PHCINFO pHCInfo)\\n+NS_GFX_(BOOL) PrnQueryHardcopyCaps( HDC hdc, PHCINFO pHCInfo)\\n {\\n    BOOL rc = FALSE;\\n \\n@@ -440,19 +440,19 @@ BOOL PrnQueryHardcopyCaps( HDC hdc, PHCINFO pHCInfo)\\n /*  Library-level data and functions    -Printing                           */\\n /****************************************************************************/\\n \\n-BOOL PrnInitialize( HMODULE hmodResources)\\n+NS_GFX_(BOOL) PrnInitialize( HMODULE hmodResources)\\n {\\n    hmodRes = hmodResources;\\n    return TRUE;\\n }\\n \\n-BOOL PrnTerminate()\\n+NS_GFX_(BOOL) PrnTerminate()\\n {\\n    /* nop for now, may do something eventually */\\n    return TRUE;\\n }\\n \\n-BOOL PrnClosePrinter( PRTQUEUE *pPrintQueue)\\n+NS_GFX_(BOOL) PrnClosePrinter( PRTQUEUE *pPrintQueue)\\n {\\n    BOOL rc = FALSE;\\n \\ndiff --git a/widget/src/os2/nsPrintOS2.h b/widget/src/os2/nsPrintOS2.h\\nindex 9f6babd..62857db8 100644\\n--- a/widget/src/os2/nsPrintOS2.h\\n+++ b/widget/src/os2/nsPrintOS2.h\\n@@ -48,20 +48,21 @@\\n #define INCL_GRE_DEVICE\\n #include <os2.h>\\n #include <pmddim.h>\\n+#include \\\"gfxCore.h\\\"\\n \\n //---------------------------------------------------------------------------\\n // OS/2 Printing   - was in libprint\\n //---------------------------------------------------------------------------\\n // Library init and term; job properties per queue are cached during run.\\n-BOOL PrnInitialize(HMODULE hmodResources);\\n-BOOL PrnTerminate(void);\\n+NS_GFX_(BOOL) PrnInitialize(HMODULE hmodResources);\\n+NS_GFX_(BOOL) PrnTerminate(void);\\n \\n // opaque type to describe a print queue (printer)\\n-class PRTQUEUE;\\n+class NS_GFX PRTQUEUE;\\n \\n #define MAX_PRINT_QUEUES  (128)\\n \\n-class PRINTDLG\\n+class NS_GFX PRINTDLG\\n {\\n public:\\n    PRINTDLG();\\n@@ -83,16 +84,16 @@ private:\\n \\n \\n // Release app. resources associated with a printer\\n-BOOL PrnClosePrinter( PRTQUEUE *pPrintQueue);\\n+NS_GFX_(BOOL) PrnClosePrinter( PRTQUEUE *pPrintQueue);\\n \\n // Get a DC for the selected printer.  Must supply the application name.\\n-HDC PrnOpenDC( PRTQUEUE *pPrintQueue, PSZ pszApplicationName, int copies, int destination, char *file);\\n+NS_GFX_(HDC) PrnOpenDC( PRTQUEUE *pPrintQueue, PSZ pszApplicationName, int copies, int destination, char *file);\\n \\n // Get the hardcopy caps for the selected form\\n-BOOL PrnQueryHardcopyCaps( HDC hdc, PHCINFO pHCInfo);\\n+NS_GFX_(BOOL) PrnQueryHardcopyCaps( HDC hdc, PHCINFO pHCInfo);\\n \\n // Abort the current job started with PrnStartJob().\\n-BOOL PrnAbortJob( HDC hdc);\\n+NS_GFX_(BOOL) PrnAbortJob( HDC hdc);\\n \\n \\n \\n\""}