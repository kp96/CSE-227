{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basfdc9cd7\""},"diff":"\"fdc9cd7 Fix Convert to work for JSTYPE_VOID and make sure it reports an error. bug 394436, r=jst sr=brendan\\ndiff --git a/js/src/xpconnect/src/XPCCrossOriginWrapper.cpp b/js/src/xpconnect/src/XPCCrossOriginWrapper.cpp\\nindex 4419761..0f43de6 100644\\n--- a/js/src/xpconnect/src/XPCCrossOriginWrapper.cpp\\n+++ b/js/src/xpconnect/src/XPCCrossOriginWrapper.cpp\\n@@ -789,9 +789,15 @@ XPC_XOW_Convert(JSContext *cx, JSObject *obj, JSType type, jsval *vp)\\n     return JS_TRUE;\\n   }\\n \\n+  // Note: JSTYPE_VOID and JSTYPE_STRING are equivalent.\\n   nsresult rv = IsWrapperSameOrigin(cx, wrappedObj);\\n   if (NS_FAILED(rv) &&\\n-      (rv != NS_ERROR_DOM_PROP_ACCESS_DENIED || type != JSTYPE_STRING)) {\\n+      (rv != NS_ERROR_DOM_PROP_ACCESS_DENIED ||\\n+       (type != JSTYPE_STRING && type != JSTYPE_VOID))) {\\n+    // Ensure that we report some kind of error.\\n+    if (rv == NS_ERROR_DOM_PROP_ACCESS_DENIED) {\\n+      ThrowException(rv, cx);\\n+    }\\n     return JS_FALSE;\\n   }\\n \\n\""}