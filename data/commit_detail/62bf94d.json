{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas62bf94d\""},"diff":"\"62bf94d fix 240644, hang attaching file when last attachment was saved to a directory that no longer exists, r=roc,emaijala@kolumbus.fi, sr=mscott\\ndiff --git a/widget/src/windows/nsFilePicker.cpp b/widget/src/windows/nsFilePicker.cpp\\nindex 831e8e9..06a74cc 100644\\n--- a/widget/src/windows/nsFilePicker.cpp\\n+++ b/widget/src/windows/nsFilePicker.cpp\\n@@ -141,12 +141,23 @@ NS_IMETHODIMP nsFilePicker::ShowW(PRInt16 *aReturnVal)\\n   NS_NAMED_LITERAL_STRING(htmExt, \\\"html\\\");\\n   nsAutoString initialDir;\\n   if (mDisplayDirectory)\\n-    mDisplayDirectory->GetPath(initialDir);\\n+  {\\n+    PRBool exists;\\n+    // checking this up front seems to behave much better than\\n+    // just trying to open  a file picker on a non-existent directory.\\n+    mDisplayDirectory->Exists(&exists);\\n+    if (exists)\\n+      mDisplayDirectory->GetPath(initialDir);\\n+  }\\n \\n   // If no display directory, re-use the last one.\\n   if(initialDir.IsEmpty()) {\\n     // Allocate copy of last used dir.\\n     initialDir = mLastUsedUnicodeDirectory;\\n+    // defaulting to cwd instead of whatever the file picker defaults to\\n+    // is a lot faster if that default dir doesn't exist.\\n+    if (initialDir.IsEmpty())\\n+      initialDir = NS_LITERAL_STRING(\\\".\\\");\\n   }\\n \\n   mUnicodeFile.Truncate();\\n\""}