{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas5c8c7ff\""},"diff":"\"5c8c7ff Bug 385536, add test for clicking in a tree in a popup, r=gavin\\ndiff --git a/toolkit/content/tests/widgets/Makefile.in b/toolkit/content/tests/widgets/Makefile.in\\nindex 0912fb4..7483149 100644\\n--- a/toolkit/content/tests/widgets/Makefile.in\\n+++ b/toolkit/content/tests/widgets/Makefile.in\\n@@ -77,6 +77,7 @@ _TEST_FILES = \\ttest_bug360220.xul \\\\\\n \\t\\ttest_panelfrommenu.xul \\\\\\n \\t\\ttest_hiddenitems.xul \\\\\\n \\t\\ttest_hiddenpaging.xul \\\\\\n+\\t\\ttest_popup_tree.xul \\\\\\n \\t\\t$(NULL)\\n \\n ifeq (,$(filter mac cocoa,$(MOZ_WIDGET_TOOLKIT)))\\ndiff --git a/toolkit/content/tests/widgets/test_popup_tree.xul b/toolkit/content/tests/widgets/test_popup_tree.xul\\nnew file mode 100644\\nindex 0000000..c223b68\\n--- /dev/null\\n+++ b/toolkit/content/tests/widgets/test_popup_tree.xul\\n@@ -0,0 +1,74 @@\\n+<?xml version=\\\"1.0\\\"?>\\n+<?xml-stylesheet href=\\\"chrome://global/skin\\\" type=\\\"text/css\\\"?>\\n+<?xml-stylesheet href=\\\"/tests/SimpleTest/test.css\\\" type=\\\"text/css\\\"?>\\n+\\n+<window title=\\\"Tree in Popup Test\\\"\\n+        onload=\\\"setTimeout(runTests, 0);\\\"\\n+        xmlns=\\\"http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul\\\">\\n+\\n+  <script type=\\\"application/javascript\\\" src=\\\"/MochiKit/packed.js\\\"></script>\\n+  <script type=\\\"application/javascript\\\" src=\\\"/tests/SimpleTest/SimpleTest.js\\\"></script>      \\n+  <script type=\\\"application/javascript\\\" src=\\\"/tests/SimpleTest/EventUtils.js\\\"></script>      \\n+\\n+<panel id=\\\"panel\\\" onpopupshown=\\\"treeClick()\\\" onpopuphidden=\\\"SimpleTest.finish()\\\">\\n+  <tree id=\\\"tree\\\" width=\\\"350\\\" rows=\\\"5\\\">\\n+    <treecols>\\n+      <treecol id=\\\"name\\\" label=\\\"Name\\\" flex=\\\"1\\\"/>\\n+      <treecol id=\\\"address\\\" label=\\\"Street\\\" flex=\\\"1\\\"/>\\n+    </treecols>\\n+    <treechildren id=\\\"treechildren\\\">\\n+      <treeitem>\\n+        <treerow>\\n+          <treecell label=\\\"Justin Thyme\\\"/>\\n+          <treecell label=\\\"800 Bay Street\\\"/>\\n+        </treerow>\\n+      </treeitem>\\n+      <treeitem>\\n+        <treerow>\\n+          <treecell label=\\\"Mary Goround\\\"/>\\n+          <treecell label=\\\"47 University Avenue\\\"/>\\n+        </treerow>\\n+      </treeitem>\\n+    </treechildren>\\n+  </tree>\\n+</panel>\\n+\\n+<script class=\\\"testbody\\\" type=\\\"application/javascript\\\">\\n+<![CDATA[\\n+\\n+SimpleTest.waitForExplicitFinish();\\n+\\n+function runTests()\\n+{\\n+  $(\\\"panel\\\").openPopup(null, \\\"overlap\\\", 2, 2);\\n+}\\n+\\n+function treeClick()\\n+{\\n+  var tree = $(\\\"tree\\\");\\n+  is(tree.currentIndex, -1, \\\"selectedIndex before click\\\");\\n+  synthesizeMouseExpectEvent($(\\\"treechildren\\\"), 2, 2, { }, $(\\\"treechildren\\\"), \\\"click\\\", \\\"\\\");\\n+  is(tree.currentIndex, 0, \\\"selectedIndex after click\\\");\\n+\\n+  var x = { }, y = { }, width = { }, height = { };\\n+  tree.treeBoxObject.getCoordsForCellItem(1, tree.columns.address, \\\"\\\", x, y, width, height);\\n+  synthesizeMouseExpectEvent($(\\\"treechildren\\\"), x.value, y.value + 2,\\n+                             { }, $(\\\"treechildren\\\"), \\\"click\\\", \\\"\\\");\\n+  is(tree.currentIndex, 1, \\\"selectedIndex after second click \\\" + x.value + \\\",\\\" + y.value);\\n+\\n+  $(\\\"panel\\\").hidePopup();\\n+}\\n+\\n+]]>\\n+</script>\\n+\\n+<body xmlns=\\\"http://www.w3.org/1999/xhtml\\\">\\n+<p id=\\\"display\\\">\\n+</p>\\n+<div id=\\\"content\\\" style=\\\"display: none\\\">\\n+</div>\\n+<pre id=\\\"test\\\">\\n+</pre>\\n+</body>\\n+\\n+</window>\\n\""}