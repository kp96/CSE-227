{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas6a56b86\""},"diff":"\"6a56b86 Bug 283697 - Firefox Options (Preferences) panels are cropped (cut off). r=mconnor\\ndiff --git a/browser/components/preferences/preferences.xul b/browser/components/preferences/preferences.xul\\nindex ebc576a..a8ec6bb 100644\\n--- a/browser/components/preferences/preferences.xul\\n+++ b/browser/components/preferences/preferences.xul\\n@@ -75,12 +75,12 @@\\n #endif\\n             xmlns=\\\"http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul\\\"\\n #ifdef USE_WIN_TITLE_STYLE\\n-            style=\\\"&prefWindow.styleWin;\\\">\\n+            style=\\\"&prefWin.styleWin;\\\">\\n #else\\n #ifdef XP_MACOSX\\n             style=\\\"&prefWindow.styleMac;\\\">\\n #else\\n-            style=\\\"&prefWindow.styleGNOME;\\\">\\n+            style=\\\"&prefWin.styleGNOME;\\\">\\n #endif\\n #endif\\n   \\ndiff --git a/browser/locales/en-US/chrome/browser/preferences/preferences.dtd b/browser/locales/en-US/chrome/browser/preferences/preferences.dtd\\nindex 4f60c0e..a2cab95 100644\\n--- a/browser/locales/en-US/chrome/browser/preferences/preferences.dtd\\n+++ b/browser/locales/en-US/chrome/browser/preferences/preferences.dtd\\n@@ -3,9 +3,9 @@\\n <!ENTITY  prefWindow.titleGNOME   \\\"&brandShortName; Preferences\\\">\\n <!-- When making changes to prefWindow.styleWin test both Windows Classic and\\n      Luna since widget heights are different based on the OS theme -->\\n-<!ENTITY  prefWindow.styleWin     \\\"width: 42em; height: 44em;\\\">\\n+<!ENTITY  prefWin.styleWin        \\\"width: 42em; min-height: 44em;\\\">\\n <!ENTITY  prefWindow.styleMac     \\\"width: 47em;\\\">\\n-<!ENTITY  prefWindow.styleGNOME   \\\"width: 42em; height: 38.5em;\\\">\\n+<!ENTITY  prefWin.styleGNOME      \\\"width: 42em; min-height: 44.5em;\\\">\\n \\n <!ENTITY  paneMain.title          \\\"Main\\\">\\n <!ENTITY  paneTabs.title          \\\"Tabs\\\">\\ndiff --git a/browser/themes/winstripe/browser/preferences/preferences.css b/browser/themes/winstripe/browser/preferences/preferences.css\\nindex 84468c6..b79f977 100644\\n--- a/browser/themes/winstripe/browser/preferences/preferences.css\\n+++ b/browser/themes/winstripe/browser/preferences/preferences.css\\n@@ -268,5 +268,5 @@ filefield[disabled=\\\"true\\\"] .fileFieldIcon {\\n /* bottom-most box containing a groupbox in a prefpane. Prevents the bottom\\n    of the groupbox from being cutoff */\\n .bottomBox {\\n-  padding-bottom: 2px;\\n+  padding-bottom: 4px;\\n }\\ndiff --git a/toolkit/content/widgets/preferences.xml b/toolkit/content/widgets/preferences.xml\\nindex 3d1d5f1..425ae1a 100644\\n--- a/toolkit/content/widgets/preferences.xml\\n+++ b/toolkit/content/widgets/preferences.xml\\n@@ -629,6 +629,8 @@\\n       <property name=\\\"type\\\" onget=\\\"return this.getAttribute('type');\\\"/>\\n       <property name=\\\"_paneDeck\\\"\\n                 onget=\\\"return document.getAnonymousElementByAttribute(this, 'anonid', 'paneDeck');\\\"/>\\n+      <property name=\\\"_paneDeckContainer\\\"\\n+                onget=\\\"return document.getAnonymousElementByAttribute(this, 'class', 'paneDeckContainer');\\\"/>\\n       <property name=\\\"_selector\\\"\\n                 onget=\\\"return document.getAnonymousElementByAttribute(this, 'anonid', 'selector');\\\"/>\\n       <property name=\\\"lastSelected\\\" \\n@@ -737,8 +739,6 @@\\n                 oldPane.selected = !(aPaneElement.selected = true);\\n                 this.lastSelected = aPaneElement.id;\\n                 this.currentPane = aPaneElement;\\n-                this._initialized = true;\\n-\\n                 // Only animate if we've switched between prefpanes\\n                 if (this._shouldAnimate && oldPane.id != aPaneElement.id) {\\n                   // Don't let the new pane content flex to the current window\\n@@ -747,6 +747,23 @@\\n                   aPaneElement.style.opacity = 0.0;\\n                   this.animate(oldPane, aPaneElement);\\n                 }\\n+                else if (this._initialized && !this._shouldAnimate) {\\n+                  var targetHeight = parseInt(window.getComputedStyle(this._paneDeckContainer, \\\"\\\").height);\\n+                  targetHeight -= parseInt(window.getComputedStyle(this, \\\"\\\").paddingTop);\\n+                  targetHeight -= parseInt(window.getComputedStyle(this, \\\"\\\").paddingBottom);\\n+                  if (aPaneElement.contentHeight > targetHeight) {\\n+                    // To workaround the bottom border of a groupbox from being\\n+                    // cutoff an hbox with a class of bottomBox may enclose it.\\n+                    // This needs to include its padding to resize properly.\\n+                    // See bug 394433\\n+                    var bottomPadding = 0;\\n+                    var bottomBox = aPaneElement.getElementsByAttribute(\\\"class\\\", \\\"bottomBox\\\")[0];\\n+                    if (bottomBox)\\n+                      bottomPadding = parseInt(window.getComputedStyle(bottomBox, \\\"\\\").paddingBottom);\\n+                    window.innerHeight += bottomPadding + aPaneElement.contentHeight - targetHeight;\\n+                  }\\n+                }\\n+                this._initialized = true;\\n               }\\n               break;\\n             }\\n\""}