{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas2b3228a\""},"diff":"\"2b3228a Bug 396556 - Bookmarks menu does not update when adding/deleting/reloading livemarks or when adding/deleting bookmarks. r=dietrich.\\ndiff --git a/browser/components/places/content/menu.xml b/browser/components/places/content/menu.xml\\nindex 1e33e6e..5b096d9 100755\\n--- a/browser/components/places/content/menu.xml\\n+++ b/browser/components/places/content/menu.xml\\n@@ -257,6 +257,7 @@\\n \\n           if (element) {\\n             element.node = child;\\n+            element.node.viewIndex = 0;\\n             if (child.icon)\\n               element.setAttribute(\\\"image\\\", child.icon.spec);\\n \\ndiff --git a/browser/components/places/content/toolbar.xml b/browser/components/places/content/toolbar.xml\\nindex 6a39372..0c3ca2b 100755\\n--- a/browser/components/places/content/toolbar.xml\\n+++ b/browser/components/places/content/toolbar.xml\\n@@ -238,6 +238,7 @@\\n             button.setAttribute(\\\"image\\\", child.icon.spec);\\n           button.className = \\\"menuitem-iconic bookmark-item\\\";\\n           button.node = child;\\n+          button.node.viewIndex = 0;\\n           if (before)\\n             this.insertBefore(button, before);\\n           else\\n@@ -521,7 +522,10 @@\\n           else if (PlacesUtils.nodeIsContainer(aNode)) {\\n             if (PlacesUtils.nodeIsLivemarkContainer(aNode)) {\\n               var folder = aNode.itemId;\\n-              var siteURIString = PlacesUtils.livemarks.getSiteURI(folder).spec;\\n+              var siteURIString = \\\"\\\";\\n+              var siteURI = PlacesUtils.livemarks.getSiteURI(folder);\\n+              if (siteURI)\\n+                siteURIString = siteURI.spec;\\n               if (siteURIString) {\\n                 if (button.getAttribute(\\\"siteURI\\\") != siteURIString)\\n                   button.setAttribute(\\\"siteURI\\\", siteURIString);\\ndiff --git a/toolkit/components/places/public/nsINavHistoryService.idl b/toolkit/components/places/public/nsINavHistoryService.idl\\nindex f82310f..4528a3c 100644\\n--- a/toolkit/components/places/public/nsINavHistoryService.idl\\n+++ b/toolkit/components/places/public/nsINavHistoryService.idl\\n@@ -134,8 +134,13 @@ interface nsINavHistoryResultNode : nsISupports\\n \\n   /**\\n    * Value with undefined meaning for use by the view. Its initial value will\\n-   * be -1. The tree view uses this value to indicate the row in the tree that\\n-   * this node is at. Other views may use this value however they choose.\\n+   * be -1. The result implementation treats nodes with this property set to\\n+   * -1 as invisible!\\n+   *\\n+   * View-implementations may use this value to track the node index in the\\n+   * view, e.g. the tree view uses this value to indicate the row in the\\n+   * tree that this node is at. Other views may choose not to use this, but\\n+   * should inititalize this value to anything but -1 for visible nodes.\\n    */\\n   attribute long viewIndex;\\n \\n\""}