{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basad6b019\""},"diff":"\"ad6b019 Bug 392303 - Simplify installer changes - Part 1. r=sspitzer\\ndiff --git a/browser/installer/windows/nsis/installer.nsi b/browser/installer/windows/nsis/installer.nsi\\nindex b85f22d..b1a829f 100755\\n--- a/browser/installer/windows/nsis/installer.nsi\\n+++ b/browser/installer/windows/nsis/installer.nsi\\n@@ -80,10 +80,7 @@ Var fhUninstallLog\\n !insertmacro WordReplace\\n !insertmacro GetSize\\n !insertmacro GetParameters\\n-!insertmacro GetParent\\n !insertmacro GetOptions\\n-!insertmacro GetRoot\\n-!insertmacro DriveSpace\\n \\n ; NSIS provided macros that we have overridden\\n !include overrides.nsh\\n@@ -99,18 +96,18 @@ Var fhUninstallLog\\n \\n VIAddVersionKey \\\"FileDescription\\\" \\\"${BrandShortName} Installer\\\"\\n \\n+!insertmacro AddHandlerValues\\n+!insertmacro CanWriteToInstallDir\\n+!insertmacro CheckDiskSpace\\n+!insertmacro CleanVirtualStore\\n+!insertmacro CloseApp\\n+!insertmacro CreateRegKey\\n !insertmacro GetLongPath\\n+!insertmacro GetSingleInstallPath\\n !insertmacro RegCleanMain\\n !insertmacro RegCleanUninstall\\n-!insertmacro CloseApp\\n !insertmacro WriteRegStr2\\n !insertmacro WriteRegDWORD2\\n-!insertmacro CreateRegKey\\n-!insertmacro CanWriteToInstallDir\\n-!insertmacro CheckDiskSpace\\n-!insertmacro CleanVirtualStore\\n-!insertmacro AddHandlerValues\\n-!insertmacro GetSingleInstallPath\\n \\n !include shared.nsh\\n \\ndiff --git a/browser/installer/windows/nsis/uninstaller.nsi b/browser/installer/windows/nsis/uninstaller.nsi\\nindex c2cab5c..94ca157 100755\\n--- a/browser/installer/windows/nsis/uninstaller.nsi\\n+++ b/browser/installer/windows/nsis/uninstaller.nsi\\n@@ -62,13 +62,9 @@ Var TmpVal\\n !include WordFunc.nsh\\n !include MUI.nsh\\n \\n-!insertmacro FileJoin\\n !insertmacro GetOptions\\n !insertmacro GetParameters\\n-!insertmacro LineFind\\n !insertmacro StrFilter\\n-!insertmacro TextCompare\\n-!insertmacro TrimNewLines\\n !insertmacro WordFind\\n !insertmacro WordReplace\\n \\ndiff --git a/toolkit/mozapps/installer/windows/nsis/common.nsh b/toolkit/mozapps/installer/windows/nsis/common.nsh\\nindex 218d35e..4b6b14b 100755\\n--- a/toolkit/mozapps/installer/windows/nsis/common.nsh\\n+++ b/toolkit/mozapps/installer/windows/nsis/common.nsh\\n@@ -67,6 +67,12 @@ Exch 1   ; exchange the top of the stack with 2 below the top of the stack\\n Exch $R9 ; exchange the new $R9 value with the top of the stack\\n */\\n \\n+!include TextFunc.nsh\\n+!include FileFunc.nsh\\n+\\n+; NSIS provided macros that we have overridden.\\n+!include overrides.nsh\\n+\\n ; Modified version of the following MUI macros to support Mozilla localization.\\n ; MUI_LANGUAGE\\n ; MUI_LANGUAGEFILE_BEGIN\\n@@ -645,6 +651,9 @@ Exch $R9 ; exchange the new $R9 value with the top of the stack\\n  */\\n !macro CheckDiskSpace\\n \\n+  !insertmacro ${_MOZFUNC_UN}GetRoot\\n+  !insertmacro ${_MOZFUNC_UN}DriveSpace\\n+\\n   !ifndef ${_MOZFUNC_UN}CheckDiskSpace\\n     !verbose push\\n     !verbose ${_MOZFUNC_VERBOSE}\\n@@ -674,8 +683,8 @@ Exch $R9 ; exchange the new $R9 value with the top of the stack\\n       SectionGetSize 2 $R5\\n       IntOp $R8 $R8 + $R5\\n \\n-      ${GetRoot} \\\"$INSTDIR\\\" $R4\\n-      ${DriveSpace} \\\"$R4\\\" \\\"/D=F /S=K\\\" $R3\\n+      ${${_MOZFUNC_UN}GetRoot} \\\"$INSTDIR\\\" $R4\\n+      ${${_MOZFUNC_UN}DriveSpace} \\\"$R4\\\" \\\"/D=F /S=K\\\" $R3\\n \\n       System::Int64Op $R3 > $R8\\n       Pop $R2\\n@@ -723,6 +732,8 @@ Exch $R9 ; exchange the new $R9 value with the top of the stack\\n     !undef _MOZFUNC_UN\\n     !define _MOZFUNC_UN \\\"un.\\\"\\n \\n+    !insertmacro GetRoot\\n+    !insertmacro DriveSpace\\n     !insertmacro CheckDiskSpace\\n \\n     !undef _MOZFUNC_UN\\n@@ -756,6 +767,8 @@ Exch $R9 ; exchange the new $R9 value with the top of the stack\\n  */\\n !macro RegCleanMain\\n \\n+  !insertmacro ${_MOZFUNC_UN}GetLongPath\\n+\\n   !ifndef ${_MOZFUNC_UN}RegCleanMain\\n     !verbose push\\n     !verbose ${_MOZFUNC_VERBOSE}\\n@@ -871,6 +884,7 @@ Exch $R9 ; exchange the new $R9 value with the top of the stack\\n     !undef _MOZFUNC_UN\\n     !define _MOZFUNC_UN \\\"un.\\\"\\n \\n+    !insertmacro GetLongPath\\n     !insertmacro RegCleanMain\\n \\n     !undef _MOZFUNC_UN\\n@@ -892,6 +906,8 @@ Exch $R9 ; exchange the new $R9 value with the top of the stack\\n  */\\n !macro RegCleanUninstall\\n \\n+  !insertmacro ${_MOZFUNC_UN}GetLongPath\\n+\\n   !ifndef ${_MOZFUNC_UN}RegCleanUninstall\\n     !verbose push\\n     !verbose ${_MOZFUNC_VERBOSE}\\n@@ -963,6 +979,7 @@ Exch $R9 ; exchange the new $R9 value with the top of the stack\\n     !undef _MOZFUNC_UN\\n     !define _MOZFUNC_UN \\\"un.\\\"\\n \\n+    !insertmacro GetLongPath\\n     !insertmacro RegCleanUninstall\\n \\n     !undef _MOZFUNC_UN\\n@@ -1658,6 +1675,8 @@ Exch $R9 ; exchange the new $R9 value with the top of the stack\\n  */\\n !macro GetSingleInstallPath\\n \\n+  !insertmacro ${_MOZFUNC_UN}GetParent\\n+\\n   !ifndef ${_MOZFUNC_UN}GetSingleInstallPath\\n     !verbose push\\n     !verbose ${_MOZFUNC_VERBOSE}\\n@@ -1737,6 +1756,7 @@ Exch $R9 ; exchange the new $R9 value with the top of the stack\\n     !undef _MOZFUNC_UN\\n     !define _MOZFUNC_UN \\\"un.\\\"\\n \\n+    !insertmacro GetParent\\n     !insertmacro GetSingleInstallPath\\n \\n     !undef _MOZFUNC_UN\\n@@ -2100,14 +2120,17 @@ Exch $R9 ; exchange the new $R9 value with the top of the stack\\n /**\\n  * Updates the uninstall.log with new files added by software update.\\n  *\\n- * Requires FileJoin, LineFind, TextCompare, and TrimNewLines.\\n- *\\n  * IMPORTANT! The LineFind docs claim that it uses all registers except $R0-$R3.\\n  *            Though it appears that this is not true all registers besides\\n  *            $R0-$R3 may be overwritten so protect yourself!\\n  */\\n !macro UpdateUninstallLog\\n \\n+  !insertmacro ${_MOZFUNC_UN}FileJoin\\n+  !insertmacro ${_MOZFUNC_UN}LineFind\\n+  !insertmacro ${_MOZFUNC_UN}TextCompareNoDetails\\n+  !insertmacro ${_MOZFUNC_UN}TrimNewLines\\n+\\n   !ifndef ${_MOZFUNC_UN}UpdateUninstallLog\\n     !verbose push\\n     !verbose ${_MOZFUNC_VERBOSE}\\n@@ -2129,7 +2152,7 @@ Exch $R9 ; exchange the new $R9 value with the top of the stack\\n \\n       GetTempFileName $R2 \\\"$R3\\\"\\n       FileOpen $R1 $R2 w\\n-      ${${_MOZFUNC_UN}TextCompare} \\\"$R3\\\\uninstall.update\\\" \\\"$R3\\\\uninstall.log\\\" \\\"SlowDiff\\\" \\\"${_MOZFUNC_UN}CreateUpdateDiff\\\"\\n+      ${${_MOZFUNC_UN}TextCompareNoDetails} \\\"$R3\\\\uninstall.update\\\" \\\"$R3\\\\uninstall.log\\\" \\\"SlowDiff\\\" \\\"${_MOZFUNC_UN}CreateUpdateDiff\\\"\\n       FileClose $R1\\n \\n       IfErrors +2 0\\n@@ -2214,6 +2237,10 @@ Exch $R9 ; exchange the new $R9 value with the top of the stack\\n     !undef _MOZFUNC_UN\\n     !define _MOZFUNC_UN \\\"un.\\\"\\n \\n+    !insertmacro FileJoin\\n+    !insertmacro LineFind\\n+    !insertmacro TextCompareNoDetails\\n+    !insertmacro TrimNewLines\\n     !insertmacro UpdateUninstallLog\\n \\n     !undef _MOZFUNC_UN\\ndiff --git a/toolkit/mozapps/installer/windows/nsis/overrides.nsh b/toolkit/mozapps/installer/windows/nsis/overrides.nsh\\nindex 9613844..fcf564f 100755\\n--- a/toolkit/mozapps/installer/windows/nsis/overrides.nsh\\n+++ b/toolkit/mozapps/installer/windows/nsis/overrides.nsh\\n@@ -1,6 +1,9 @@\\n ################################################################################\\n # Modified versions of macros provided by NSIS\\n \\n+!ifndef OVERRIDES_INCLUDED\\n+!define OVERRIDES_INCLUDED\\n+\\n ; Modified version of Locate from the NSIS File Functions Header v3.2\\n ; This version has the calls to SetDetailsPrint and DetailsPrint commented out.\\n ; See <NSIS App Dir>/include/FileFunc.nsh for more information\\n@@ -566,3 +569,5 @@\\n     !verbose pop\\n   !endif\\n !macroend\\n+\\n+!endif\\n\""}