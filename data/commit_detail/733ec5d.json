{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas733ec5d\""},"diff":"\"733ec5d Make sure layout is up to date before moving the caret.  Bug 375436 followup to fix orange, pending reviews from roc.\\ndiff --git a/layout/generic/nsSelection.cpp b/layout/generic/nsSelection.cpp\\nindex 8e07299..675a40a 100644\\n--- a/layout/generic/nsSelection.cpp\\n+++ b/layout/generic/nsSelection.cpp\\n@@ -1222,6 +1222,20 @@ nsFrameSelection::MoveCaret(PRUint32          aKeycode,\\n                             PRBool            aContinueSelection,\\n                             nsSelectionAmount aAmount)\\n {\\n+  {\\n+    // Make sure that if our presshell gets Destroy() called when we\\n+    // flush we don't die.\\n+    nsRefPtr<nsFrameSelection> kungFuDeathGrip(this);\\n+\\n+    // Flush out layout, since we need it to be up to date to do caret\\n+    // positioning.\\n+    mShell->FlushPendingNotifications(Flush_Layout);\\n+\\n+    if (!mShell) {\\n+      return NS_OK;\\n+    }\\n+  }\\n+    \\n   nsPresContext *context = mShell->GetPresContext();\\n   if (!context)\\n     return NS_ERROR_FAILURE;\\n\""}