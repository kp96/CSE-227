{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas5e38c6d\""},"diff":"\"5e38c6d Bug 390549: IPv6 addresses in URLs have [] disappear in non-editing location bar state. p=Dao Gottwald <dao@design-noir.de>, r=gavin.sharp\\ndiff --git a/browser/base/content/urlbarBindings.xml b/browser/base/content/urlbarBindings.xml\\nindex 0775e35..2958278 100644\\n--- a/browser/base/content/urlbarBindings.xml\\n+++ b/browser/base/content/urlbarBindings.xml\\n@@ -221,14 +221,20 @@\\n \\n           this._protocol.setAttribute(\\\"value\\\", this._uri.scheme + \\\"://\\\");\\n           this._protocolHidden = this._hideProtocols.indexOf(this._uri.scheme) > -1;\\n-          this._subDomain.removeAttribute(\\\"value\\\");\\n-          this._port.removeAttribute(\\\"value\\\");\\n \\n           var host = this._uri.host;\\n           if (host) {\\n-            //XXX Bug 386727: Disabled for now due to perf/leak regressions\\n-            //XXX workaround for bug 364129\\n-            if (0 && !/^[.0-9]+$/.test(host)) {\\n+            var subdomain;\\n+            var port = (this._uri.port > -1) ? \\\":\\\" + this._uri.port : \\\"\\\";\\n+            if (this._uri.hostPort[0] == \\\"[\\\") {\\n+              // IPv6 address\\n+              subdomain = \\\"[\\\";\\n+              port = \\\"]\\\" + port;\\n+            }\\n+            else if (0 && !/^[.0-9]+$/.test(host)) {\\n+              //XXX subdomain detection disabled (bug 386727)\\n+              //XXX subdomain detection disabled for IP addresses (bug 364129)\\n+\\n               // getEffectiveTLDLength might convert our host and return a misleading length.\\n               // To avoid this, pass the ASCII host, count the dots of its effective TLD\\n               // and use that number to operate on our actual host.\\n@@ -241,16 +247,19 @@\\n                                         .split(\\\".\\\").length - 1;\\n               if (cSubdomain > 0) {\\n                 host = domainSegments;\\n-                var subdomain = host.splice(0, cSubdomain);\\n-                this._subDomain.setAttribute(\\\"value\\\", subdomain.join(\\\".\\\") + \\\".\\\");\\n+                subdomain = host.splice(0, cSubdomain).join(\\\".\\\") + \\\".\\\";\\n                 host = host.join(\\\".\\\");\\n               }\\n+            } else {\\n+              subdomain = \\\"\\\";\\n             }\\n+            this._subDomain.setAttribute(\\\"value\\\", subdomain);\\n             this._domain.setAttribute(\\\"value\\\", host);\\n-            if (this._uri.port > -1)\\n-              this._port.setAttribute(\\\"value\\\", \\\":\\\" + this._uri.port);\\n+            this._port.setAttribute(\\\"value\\\", port);\\n           } else {\\n+            this._subDomain.removeAttribute(\\\"value\\\");\\n             this._domain.removeAttribute(\\\"value\\\");\\n+            this._port.removeAttribute(\\\"value\\\");\\n           }\\n \\n           var path = this._uri.path;\\n\""}