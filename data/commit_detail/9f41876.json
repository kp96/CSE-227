{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas9f41876\""},"diff":"\"9f41876 allow full styling of comboboxes on Mac OS X. b=381647 r=cbarrett sr=roc\\ndiff --git a/widget/src/cocoa/nsNativeThemeCocoa.mm b/widget/src/cocoa/nsNativeThemeCocoa.mm\\nindex 6636496..a30a573 100644\\n--- a/widget/src/cocoa/nsNativeThemeCocoa.mm\\n+++ b/widget/src/cocoa/nsNativeThemeCocoa.mm\\n@@ -1376,9 +1376,18 @@ nsNativeThemeCocoa::ThemeSupportsWidget(nsPresContext* aPresContext, nsIFrame* a\\n   if (aPresContext && !aPresContext->PresShell()->IsThemeSupportEnabled())\\n     return PR_FALSE;\\n \\n-  PRBool retVal = PR_FALSE;\\n+  // if this is a dropdown button in a combobox the answer is always no\\n+  if (aWidgetType == NS_THEME_DROPDOWN_BUTTON) {\\n+    nsIFrame* parentFrame = aFrame->GetParent();\\n+    if (parentFrame && (parentFrame->GetType() == nsWidgetAtoms::comboboxControlFrame))\\n+      return PR_FALSE;\\n+  }\\n \\n   switch (aWidgetType) {\\n+    case NS_THEME_LISTBOX:\\n+      return PR_TRUE; // we always want listboxes themed, non-themed ones look wrong\\n+      break;\\n+\\n     case NS_THEME_DIALOG:\\n     case NS_THEME_WINDOW:\\n     case NS_THEME_MENUPOPUP:\\n@@ -1435,19 +1444,15 @@ nsNativeThemeCocoa::ThemeSupportsWidget(nsPresContext* aPresContext, nsIFrame* a\\n     case NS_THEME_SCROLLBAR_THUMB_VERTICAL:\\n     case NS_THEME_SCROLLBAR_TRACK_VERTICAL:\\n     case NS_THEME_SCROLLBAR_TRACK_HORIZONTAL:\\n-      retVal = PR_TRUE;\\n-      break;\\n \\n-    case NS_THEME_LISTBOX:\\n     case NS_THEME_DROPDOWN:\\n     case NS_THEME_DROPDOWN_BUTTON:\\n     case NS_THEME_DROPDOWN_TEXT:\\n-      // Support listboxes and dropdowns regardless of styling,\\n-      // since non-themed ones look totally wrong.\\n-      return PR_TRUE;\\n+      return !IsWidgetStyled(aPresContext, aFrame, aWidgetType);\\n+      break;\\n   }\\n \\n-  return retVal ? !IsWidgetStyled(aPresContext, aFrame, aWidgetType) : PR_FALSE;\\n+  return PR_FALSE;\\n }\\n \\n \\ndiff --git a/widget/src/xpwidgets/nsWidgetAtomList.h b/widget/src/xpwidgets/nsWidgetAtomList.h\\nindex 1697069..81ebe91 100644\\n--- a/widget/src/xpwidgets/nsWidgetAtomList.h\\n+++ b/widget/src/xpwidgets/nsWidgetAtomList.h\\n@@ -64,6 +64,7 @@ WIDGET_ATOM(checkbox, \\\"checkbox\\\")\\n WIDGET_ATOM(checked, \\\"checked\\\")\\n WIDGET_ATOM(_class, \\\"class\\\")\\n WIDGET_ATOM(collapsed, \\\"collapsed\\\")\\n+WIDGET_ATOM(comboboxControlFrame, \\\"ComboboxControlFrame\\\")\\n WIDGET_ATOM(command, \\\"command\\\")\\n WIDGET_ATOM(curpos, \\\"curpos\\\")\\n WIDGET_ATOM(_default, \\\"default\\\")\\n\""}