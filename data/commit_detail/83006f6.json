{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas83006f6\""},"diff":"\"83006f6 392428 always consider IP addresses valid hostnames r+sr+a=bz\\ndiff --git a/netwerk/base/src/nsURLHelper.cpp b/netwerk/base/src/nsURLHelper.cpp\\nindex a906eb5..6f962c4 100644\\n--- a/netwerk/base/src/nsURLHelper.cpp\\n+++ b/netwerk/base/src/nsURLHelper.cpp\\n@@ -50,6 +50,7 @@\\n #include \\\"nsNetCID.h\\\"\\n #include \\\"netCore.h\\\"\\n #include \\\"prprf.h\\\"\\n+#include \\\"prnetdb.h\\\"\\n \\n //----------------------------------------------------------------------------\\n // Init/Shutdown\\n@@ -887,12 +888,18 @@ net_IsValidHostName(const nsCSubstring &host)\\n     const char *end = host.EndReading();\\n     // ctrl-chars and  !\\\\\\\"#%&'()*,/;<=>?@\\\\\\\\^{|}\\\\x7f\\n     // if one of these chars is found return false\\n-    return net_FindCharInSet(host.BeginReading(), end, \\n-                             \\\"\\\\x01\\\\x02\\\\x03\\\\x04\\\\x05\\\\x06\\\\x07\\\\x08\\\"\\n-                             \\\"\\\\x09\\\\x0a\\\\x0b\\\\x0c\\\\x0d\\\\x0e\\\\x0f\\\\x10\\\"\\n-                             \\\"\\\\x11\\\\x12\\\\x13\\\\x14\\\\x15\\\\x16\\\\x17\\\\x18\\\"\\n-                             \\\"\\\\x19\\\\x1a\\\\x1b\\\\x1c\\\\x1d\\\\x1e\\\\x1f\\\\x20\\\"\\n-                             \\\"\\\\x21\\\\x22\\\\x23\\\\x25\\\\x26\\\\x27\\\\x28\\\\x29\\\"\\n-                             \\\"\\\\x2a\\\\x2c\\\\x2f\\\\x3b\\\\x3c\\\\x3d\\\\x3e\\\"\\n-                             \\\"\\\\x3f\\\\x40\\\\x5c\\\\x5e\\\\x7b\\\\x7c\\\\x7e\\\\x7f\\\") == end;\\n+    if (net_FindCharInSet(host.BeginReading(), end, \\n+                          \\\"\\\\x01\\\\x02\\\\x03\\\\x04\\\\x05\\\\x06\\\\x07\\\\x08\\\"\\n+                          \\\"\\\\x09\\\\x0a\\\\x0b\\\\x0c\\\\x0d\\\\x0e\\\\x0f\\\\x10\\\"\\n+                          \\\"\\\\x11\\\\x12\\\\x13\\\\x14\\\\x15\\\\x16\\\\x17\\\\x18\\\"\\n+                          \\\"\\\\x19\\\\x1a\\\\x1b\\\\x1c\\\\x1d\\\\x1e\\\\x1f\\\\x20\\\"\\n+                          \\\"\\\\x21\\\\x22\\\\x23\\\\x25\\\\x26\\\\x27\\\\x28\\\\x29\\\"\\n+                          \\\"\\\\x2a\\\\x2c\\\\x2f\\\\x3b\\\\x3c\\\\x3d\\\\x3e\\\"\\n+                          \\\"\\\\x3f\\\\x40\\\\x5c\\\\x5e\\\\x7b\\\\x7c\\\\x7e\\\\x7f\\\") == end)\\n+        return PR_TRUE;\\n+\\n+    // Might be a valid IPv6 link-local address containing a percent sign\\n+    nsCAutoString strhost(host);\\n+    PRNetAddr addr;\\n+    return PR_StringToNetAddr(strhost.get(), &addr) == PR_SUCCESS;\\n }\\n\""}