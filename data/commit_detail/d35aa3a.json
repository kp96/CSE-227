{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basd35aa3a\""},"diff":"\"d35aa3a Bug 321517: A text file in a frame is not properly saved (UI patch 2.0), p=sciguyryan, r=neil, sr/a=bzbarsky\\ndiff --git a/embedding/browser/cocoa/src/SaveHeaderSniffer.mm b/embedding/browser/cocoa/src/SaveHeaderSniffer.mm\\nindex 7322273..1433dc6 100644\\n--- a/embedding/browser/cocoa/src/SaveHeaderSniffer.mm\\n+++ b/embedding/browser/cocoa/src/SaveHeaderSniffer.mm\\n@@ -397,7 +397,7 @@ nsresult nsHeaderSniffer::InitiateDownload(nsISupports* inSourceData, nsString&\\n                         nsIWebBrowserPersist::ENCODE_FLAGS_ABSOLUTE_LINKS |\\n                         nsIWebBrowserPersist::ENCODE_FLAGS_NOFRAMES_CONTENT;\\n     }\\n-    rv = webPersist->SaveDocument(domDoc, destFile, filesFolder, mContentType.get(), encodingFlags, 80);\\n+    rv = webPersist->SaveDocument(domDoc, destFile, filesFolder, null, encodingFlags, 80);\\n   }\\n   \\n   return rv;\\ndiff --git a/toolkit/content/contentAreaUtils.js b/toolkit/content/contentAreaUtils.js\\nindex c3b5035..d767f97 100644\\n--- a/toolkit/content/contentAreaUtils.js\\n+++ b/toolkit/content/contentAreaUtils.js\\n@@ -303,7 +303,7 @@ function internalSave(aURL, aDocument, aDefaultFileName, aContentDisposition,\\n     source      : source,\\n     contentType : (!aChosenData && useSaveDocument &&\\n                    saveAsType == kSaveAsType_Text) ?\\n-                   \\\"text/plain\\\" : aContentType,\\n+                   \\\"text/plain\\\" : null,\\n     target      : fileURL,\\n     postData    : isDocument ? getPostData() : null,\\n     bypassCache : aShouldBypassCache\\ndiff --git a/xpfe/communicator/resources/content/contentAreaUtils.js b/xpfe/communicator/resources/content/contentAreaUtils.js\\nindex 0b6f27b..1a866229 100644\\n--- a/xpfe/communicator/resources/content/contentAreaUtils.js\\n+++ b/xpfe/communicator/resources/content/contentAreaUtils.js\\n@@ -396,7 +396,7 @@ function internalSave(aURL, aDocument, aDefaultFileName, aContentDisposition,\\n     source      : source,\\n     contentType : (!aChosenData && useSaveDocument &&\\n                    saveAsType == SAVETYPE_TEXT_ONLY) ?\\n-                  \\\"text/plain\\\" : aContentType,\\n+                  \\\"text/plain\\\" : null,\\n     target      : fileURL,\\n     postData    : isDocument ? getPostData() : null,\\n     bypassCache : aShouldBypassCache\\n\""}