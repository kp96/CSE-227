{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas6215d57\""},"diff":"\"6215d57 Make sure content is up to date before we start processing restyles.  Bug 393801, r+sr+a=roc\\ndiff --git a/layout/base/nsPresShell.cpp b/layout/base/nsPresShell.cpp\\nindex d76b95b..bc0baa2 100644\\n--- a/layout/base/nsPresShell.cpp\\n+++ b/layout/base/nsPresShell.cpp\\n@@ -4401,7 +4401,14 @@ PresShell::DoFlushPendingNotifications(mozFlushType aType,\\n     // batching if we only have style reresolve\\n     viewManager->BeginUpdateViewBatch();\\n \\n-    mFrameConstructor->ProcessPendingRestyles();\\n+    // Force flushing of any pending content notifications that might have\\n+    // queued up while our event was pending.  That will ensure that we don't\\n+    // construct frames for content right now that's still waiting to be\\n+    // notified on,\\n+    mDocument->FlushPendingNotifications(Flush_ContentAndNotify);\\n+    if (!mIsDestroying) {\\n+      mFrameConstructor->ProcessPendingRestyles();\\n+    }\\n \\n     if (aType >= Flush_Layout && !mIsDestroying) {\\n       mFrameConstructor->RecalcQuotesAndCounters();\\n\""}