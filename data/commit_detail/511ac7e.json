{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas511ac7e\""},"diff":"\"511ac7e Bug 391494: full page zoom causes scrollbars to be cut off. r+sr+a=roc\\ndiff --git a/layout/base/nsPresContext.cpp b/layout/base/nsPresContext.cpp\\nindex bde693e..158296b 100644\\n--- a/layout/base/nsPresContext.cpp\\n+++ b/layout/base/nsPresContext.cpp\\n@@ -798,6 +798,8 @@ nsPresContext::Init(nsIDeviceContext* aDeviceContext)\\n   mDeviceContext = aDeviceContext;\\n   NS_ADDREF(mDeviceContext);\\n \\n+  mCurAppUnitsPerDevPixel = AppUnitsPerDevPixel();\\n+\\n   if (!mImageLoaders.Init())\\n     return NS_ERROR_OUT_OF_MEMORY;\\n   \\n@@ -1145,8 +1147,8 @@ nsPresContext::GetDefaultFontExternal(PRUint8 aFontID) const\\n void\\n nsPresContext::SetFullZoom(float aZoom)\\n {\\n-  float oldWidth = mVisibleArea.width * mFullZoom;\\n-  float oldHeight = mVisibleArea.height * mFullZoom;\\n+  float oldWidth = mVisibleArea.width / float(mCurAppUnitsPerDevPixel);\\n+  float oldHeight = mVisibleArea.height / float(mCurAppUnitsPerDevPixel);\\n   if (!mShell) {\\n     return;\\n   }\\n@@ -1155,9 +1157,10 @@ nsPresContext::SetFullZoom(float aZoom)\\n   }\\n   if (mFullZoom != aZoom) {\\n     mFullZoom = aZoom;\\n-    GetViewManager()->SetWindowDimensions(oldWidth / aZoom, oldHeight / aZoom);\\n+    GetViewManager()->SetWindowDimensions(oldWidth * AppUnitsPerDevPixel(), oldHeight * AppUnitsPerDevPixel());\\n     ClearStyleDataAndReflow();\\n   }\\n+  mCurAppUnitsPerDevPixel = AppUnitsPerDevPixel();\\n }\\n \\n imgIRequest*\\ndiff --git a/layout/base/nsPresContext.h b/layout/base/nsPresContext.h\\nindex 93ec0f2..9930fa6 100644\\n--- a/layout/base/nsPresContext.h\\n+++ b/layout/base/nsPresContext.h\\n@@ -773,6 +773,7 @@ protected:\\n \\n   float                 mTextZoom;      // Text zoom, defaults to 1.0\\n   float                 mFullZoom;      // Page zoom, defaults to 1.0\\n+  PRInt32               mCurAppUnitsPerDevPixel;\\n   PRInt32               mAutoQualityMinFontSizePixelsPref;\\n \\n #ifdef IBMBIDI\\n\""}