{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas569784c\""},"diff":"\"569784c bug 321000 - search bar should replace newlines in pasted text with spaces.  r=gavin a=mconnor\\ndiff --git a/browser/base/content/browser.xul b/browser/base/content/browser.xul\\nindex 3959356..52497ba 100644\\n--- a/browser/base/content/browser.xul\\n+++ b/browser/base/content/browser.xul\\n@@ -283,7 +283,8 @@\\n       <toolbaritem id=\\\"search-container\\\" title=\\\"&searchItem.title;\\\" \\n                    align=\\\"center\\\" class=\\\"chromeclass-toolbar-additional\\\"\\n                    flex=\\\"100\\\" persist=\\\"width\\\">\\n-        <searchbar id=\\\"searchbar\\\" flex=\\\"1\\\" chromedir=\\\"&locale.dir;\\\"/>\\n+        <searchbar id=\\\"searchbar\\\" flex=\\\"1\\\" chromedir=\\\"&locale.dir;\\\"\\n+                   newlines=\\\"replacewithspaces\\\"/>\\n       </toolbaritem>\\n \\n       <toolbarbutton id=\\\"print-button\\\" class=\\\"toolbarbutton-1 chromeclass-toolbar-additional\\\"\\ndiff --git a/browser/components/search/content/search.xml b/browser/components/search/content/search.xml\\nindex ff5b665..639d35a0 100644\\n--- a/browser/components/search/content/search.xml\\n+++ b/browser/components/search/content/search.xml\\n@@ -98,7 +98,7 @@\\n                        completeselectedindex=\\\"true\\\"\\n                        showcommentcolumn=\\\"true\\\"\\n                        tabscrolling=\\\"true\\\"\\n-                       xbl:inherits=\\\"disabled,disableautocomplete,searchengine,src\\\">\\n+                       xbl:inherits=\\\"disabled,disableautocomplete,searchengine,src,newlines\\\">\\n           </xul:textbox>\\n         </xul:hbox>\\n \\ndiff --git a/toolkit/content/widgets/textbox.xml b/toolkit/content/widgets/textbox.xml\\nindex 3965ace..796a89b 100644\\n--- a/toolkit/content/widgets/textbox.xml\\n+++ b/toolkit/content/widgets/textbox.xml\\n@@ -113,29 +113,34 @@\\n         </body>\\n       </method>\\n \\n+      <method name=\\\"_setNewlineHandling\\\">\\n+        <body><![CDATA[\\n+          var str = this.getAttribute(\\\"newlines\\\");\\n+          if (str) {\\n+            const nsIPlaintextEditor = Components.interfaces.nsIPlaintextEditor;\\n+            for (var x in nsIPlaintextEditor) {\\n+              if (/^eNewlines/.test(x)) {\\n+                if (str == RegExp.rightContext.toLowerCase()) {\\n+                  this.editor.QueryInterface(nsIPlaintextEditor)\\n+                      .newlineHandling = nsIPlaintextEditor[x];\\n+                  break;\\n+                }\\n+              }\\n+            }\\n+          }\\n+        ]]></body>\\n+      </method>\\n+\\n       <constructor><![CDATA[\\n         var str = this.boxObject.getProperty(\\\"value\\\");\\n         if (str) {\\n           this.inputField.value = str;\\n           this.boxObject.removeProperty(\\\"value\\\");\\n         }\\n-#ifndef MOZILLA_1_8_BRANCH\\n-# bug 253481\\n-\\n-        str = this.getAttribute(\\\"newlines\\\");\\n-        if (str) {\\n-          const nsIPlaintextEditor = Components.interfaces.nsIPlaintextEditor;\\n-          for (var x in nsIPlaintextEditor) {\\n-            if (/^eNewlines/.test(x)) {\\n-              if (str == RegExp.rightContext.toLowerCase()) {\\n-                this.editor.QueryInterface(nsIPlaintextEditor)\\n-                    .newlineHandling = nsIPlaintextEditor[x];\\n-                break;\\n-              }\\n-            }\\n-          }\\n-        }\\n-#endif\\n+        // this.editor may not be initialized yet in\\n+        // bindings that inherit from xul:textbox, so\\n+        // do this after construction\\n+        setTimeout(function (a) { a._setNewlineHandling(); }, 0, this);\\n       ]]></constructor>\\n \\n       <destructor>\\n\""}