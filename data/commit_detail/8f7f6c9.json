{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas8f7f6c9\""},"diff":"\"8f7f6c9 remove menu listener usage from cocoa widget nsIWidgets. b=396820 r=cbarrett sr=roc a=roc\\ndiff --git a/widget/src/cocoa/nsChildView.mm b/widget/src/cocoa/nsChildView.mm\\nindex 548d9b0..5728fbc 100644\\n--- a/widget/src/cocoa/nsChildView.mm\\n+++ b/widget/src/cocoa/nsChildView.mm\\n@@ -1335,13 +1335,10 @@ NS_IMETHODIMP nsChildView::DispatchEvent(nsGUIEvent* event, nsEventStatus& aStat\\n       }\\n     }\\n   }\\n-  \\n-  if (mMenuListener && event->eventStructType == NS_MENU_EVENT)\\n-    aStatus = mMenuListener->MenuSelected(static_cast<nsMenuEvent&>(*event));\\n-  \\n+\\n   if (mEventCallback)\\n     aStatus = (*mEventCallback)(event);\\n-  \\n+\\n   // dispatch to event listener if event was not consumed\\n   if (mEventListener && aStatus != nsEventStatus_eConsumeNoDefault)\\n     aStatus = mEventListener->ProcessEvent(*event);\\ndiff --git a/widget/src/cocoa/nsCocoaWindow.h b/widget/src/cocoa/nsCocoaWindow.h\\nindex 8135011..fb15ec7 100644\\n--- a/widget/src/cocoa/nsCocoaWindow.h\\n+++ b/widget/src/cocoa/nsCocoaWindow.h\\n@@ -149,7 +149,6 @@ public:\\n     NS_IMETHOD              Show(PRBool aState);\\n     NS_IMETHOD              AddMouseListener(nsIMouseListener * aListener);\\n     NS_IMETHOD              AddEventListener(nsIEventListener * aListener);\\n-    NS_IMETHOD              AddMenuListener(nsIMenuListener * aListener);\\n     NS_IMETHOD              Enable(PRBool aState);\\n     NS_IMETHOD              IsEnabled(PRBool *aState);\\n     NS_IMETHOD              SetModal(PRBool aState);\\ndiff --git a/widget/src/cocoa/nsCocoaWindow.mm b/widget/src/cocoa/nsCocoaWindow.mm\\nindex 97ea31e..5514b47 100644\\n--- a/widget/src/cocoa/nsCocoaWindow.mm\\n+++ b/widget/src/cocoa/nsCocoaWindow.mm\\n@@ -652,17 +652,6 @@ NS_METHOD nsCocoaWindow::AddEventListener(nsIEventListener * aListener)\\n }\\n \\n \\n-NS_METHOD nsCocoaWindow::AddMenuListener(nsIMenuListener * aListener)\\n-{\\n-  nsBaseWidget::AddMenuListener(aListener);\\n-\\n-  if (mPopupContentView)\\n-    mPopupContentView->AddMenuListener(aListener);\\n-\\n-  return NS_OK;\\n-}\\n-\\n-\\n NS_IMETHODIMP nsCocoaWindow::Enable(PRBool aState)\\n {\\n   return NS_OK;\\n@@ -941,9 +930,6 @@ nsCocoaWindow::DispatchEvent(nsGUIEvent* event, nsEventStatus& aStatus)\\n   nsIWidget* aWidget = event->widget;\\n   NS_IF_ADDREF(aWidget);\\n \\n-  if (mMenuListener &&  event->eventStructType == NS_MENU_EVENT)\\n-    aStatus = mMenuListener->MenuSelected(static_cast<nsMenuEvent&>(*event));\\n-\\n   if (mEventCallback)\\n     aStatus = (*mEventCallback)(event);\\n \\ndiff --git a/widget/src/cocoa/nsMenuBarX.mm b/widget/src/cocoa/nsMenuBarX.mm\\nindex c86022c..68ff9e8 100644\\n--- a/widget/src/cocoa/nsMenuBarX.mm\\n+++ b/widget/src/cocoa/nsMenuBarX.mm\\n@@ -358,8 +358,6 @@ nsMenuBarX::MenuConstruct(const nsMenuEvent & aMenuEvent, nsIWidget* aParentWind\\n   doc->AddMutationObserver(this);\\n   mDocument = doc;\\n \\n-  aParentWindow->AddMenuListener((nsIMenuListener *)this);\\n-\\n   PRUint32 count = mMenuBarContent->GetChildCount();\\n   for (PRUint32 i = 0; i < count; i++) { \\n     nsIContent *menu = mMenuBarContent->GetChildAt(i);\\n\""}