{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas4117ae0\""},"diff":"\"4117ae0 Bug 394978 - Key off of name and description for grouping plugins.r=dtownsend, a1.9=mconnor\\ndiff --git a/toolkit/mozapps/extensions/content/extensions.js b/toolkit/mozapps/extensions/content/extensions.js\\nindex 829d53c..acfda0a 100644\\n--- a/toolkit/mozapps/extensions/content/extensions.js\\n+++ b/toolkit/mozapps/extensions/content/extensions.js\\n@@ -553,9 +553,12 @@ function initPluginsDS()\\n   for (var i = 0; i < plugins.length; i++) {\\n     var plugin = plugins[i];\\n     var name = plugin.name;\\n-    if (!(name in gPlugins)) {\\n-      // Removes all html markup in a plugin's description\\n-      var desc = plugin.description.replace(/<\\\\/?[a-z][^>]*>/gi, \\\" \\\");\\n+    if (!(name in gPlugins))\\n+      gPlugins[name] = { };\\n+\\n+    // Removes all html markup in a plugin's description\\n+    var desc = plugin.description.replace(/<\\\\/?[a-z][^>]*>/gi, \\\" \\\");\\n+    if (!(desc in gPlugins[name])) {\\n       var homepageURL = null;\\n       // Some plugins (e.g. QuickTime) add an anchor to their description to\\n       // provide a link to the plugin's homepage in about:plugins. This can be\\n@@ -563,60 +566,60 @@ function initPluginsDS()\\n       if (/<A\\\\s+HREF=[^>]*>/i.test(plugin.description))\\n         homepageURL = /<A\\\\s+HREF=[\\\"']?([^>\\\"'\\\\s]*)/i.exec(plugin.description)[1];\\n \\n-      gPlugins[name] = { name        : name,\\n-                         filename    : plugin.filename,\\n-                         description : desc,\\n-                         homepageURL : homepageURL,\\n-                         disabled    : plugin.disabled,\\n-                         blocklisted : plugin.blocklisted,\\n-                         plugins     : [] };\\n+      gPlugins[name][desc] = { filename    : plugin.filename,\\n+                               homepageURL : homepageURL,\\n+                               disabled    : plugin.disabled,\\n+                               blocklisted : plugin.blocklisted,\\n+                               plugins     : [] };\\n     }\\n-    gPlugins[name].plugins.push(plugin);\\n+    gPlugins[name][desc].plugins.push(plugin);\\n   }\\n \\n   for (var pluginName in gPlugins) {\\n-    plugin = gPlugins[pluginName];\\n-    var pluginNode = rdf.GetResource(PREFIX_ITEM_URI + plugin.filename);\\n-    rootctr.AppendElement(pluginNode);\\n-    gPluginsDS.Assert(pluginNode,\\n-                      rdf.GetResource(PREFIX_NS_EM + \\\"name\\\"),\\n-                      rdf.GetLiteral(plugin.name),\\n-                      true);\\n-    gPluginsDS.Assert(pluginNode,\\n-                      rdf.GetResource(PREFIX_NS_EM + \\\"addonID\\\"),\\n-                      rdf.GetLiteral(plugin.filename),\\n-                      true);\\n-    gPluginsDS.Assert(pluginNode,\\n-                      rdf.GetResource(PREFIX_NS_EM + \\\"description\\\"),\\n-                      rdf.GetLiteral(plugin.description),\\n-                      true);\\n-    if (plugin.homepageURL)\\n+    for (var pluginDesc in gPlugins[pluginName]) {\\n+      plugin = gPlugins[pluginName][pluginDesc];\\n+      var pluginNode = rdf.GetResource(PREFIX_ITEM_URI + plugin.filename);\\n+      rootctr.AppendElement(pluginNode);\\n+      gPluginsDS.Assert(pluginNode,\\n+                        rdf.GetResource(PREFIX_NS_EM + \\\"name\\\"),\\n+                        rdf.GetLiteral(pluginName),\\n+                        true);\\n+      gPluginsDS.Assert(pluginNode,\\n+                        rdf.GetResource(PREFIX_NS_EM + \\\"addonID\\\"),\\n+                        rdf.GetLiteral(plugin.filename),\\n+                        true);\\n+      gPluginsDS.Assert(pluginNode,\\n+                        rdf.GetResource(PREFIX_NS_EM + \\\"description\\\"),\\n+                        rdf.GetLiteral(pluginDesc),\\n+                        true);\\n+      if (plugin.homepageURL)\\n+        gPluginsDS.Assert(pluginNode,\\n+                          rdf.GetResource(PREFIX_NS_EM + \\\"homepageURL\\\"),\\n+                          rdf.GetLiteral(plugin.homepageURL),\\n+                          true);\\n+      gPluginsDS.Assert(pluginNode,\\n+                        rdf.GetResource(PREFIX_NS_EM + \\\"isDisabled\\\"),\\n+                        rdf.GetLiteral(plugin.disabled ? \\\"true\\\" : \\\"false\\\"),\\n+                        true);\\n       gPluginsDS.Assert(pluginNode,\\n-                        rdf.GetResource(PREFIX_NS_EM + \\\"homepageURL\\\"),\\n-                        rdf.GetLiteral(plugin.homepageURL),\\n+                        rdf.GetResource(PREFIX_NS_EM + \\\"blocklisted\\\"),\\n+                        rdf.GetLiteral(plugin.blocklisted ? \\\"true\\\" : \\\"false\\\"),\\n                         true);\\n-    gPluginsDS.Assert(pluginNode,\\n-                      rdf.GetResource(PREFIX_NS_EM + \\\"isDisabled\\\"),\\n-                      rdf.GetLiteral(plugin.disabled ? \\\"true\\\" : \\\"false\\\"),\\n-                      true);\\n-    gPluginsDS.Assert(pluginNode,\\n-                      rdf.GetResource(PREFIX_NS_EM + \\\"blocklisted\\\"),\\n-                      rdf.GetLiteral(plugin.blocklisted ? \\\"true\\\" : \\\"false\\\"),\\n-                      true);\\n-    gPluginsDS.Assert(pluginNode,\\n-                      rdf.GetResource(PREFIX_NS_EM + \\\"compatible\\\"),\\n-                      rdf.GetLiteral(\\\"true\\\"),\\n-                      true);\\n-    gPluginsDS.Assert(pluginNode,\\n-                      rdf.GetResource(PREFIX_NS_EM + \\\"plugin\\\"),\\n-                      rdf.GetLiteral(\\\"true\\\"),\\n-                      true);\\n+      gPluginsDS.Assert(pluginNode,\\n+                        rdf.GetResource(PREFIX_NS_EM + \\\"compatible\\\"),\\n+                        rdf.GetLiteral(\\\"true\\\"),\\n+                        true);\\n+      gPluginsDS.Assert(pluginNode,\\n+                        rdf.GetResource(PREFIX_NS_EM + \\\"plugin\\\"),\\n+                        rdf.GetLiteral(\\\"true\\\"),\\n+                        true);\\n+    }\\n   }\\n }\\n \\n-function togglePluginDisabled(aName)\\n+function togglePluginDisabled(aName, aDesc)\\n {\\n-  var plugin = gPlugins[aName];\\n+  var plugin = gPlugins[aName][aDesc];\\n   plugin.disabled = !plugin.disabled;\\n   for (var i = 0; i < plugin.plugins.length; ++i)\\n     plugin.plugins[i].disabled = plugin.disabled;\\n@@ -2089,7 +2092,9 @@ var gExtensionsViewController = {\\n     cmd_disable: function (aSelectedItem)\\n     {\\n       if (aSelectedItem.getAttribute(\\\"plugin\\\") == \\\"true\\\") {\\n-        togglePluginDisabled(aSelectedItem.getAttribute(\\\"name\\\"));\\n+        var name = aSelectedItem.getAttribute(\\\"name\\\");\\n+        var desc = aSelectedItem.getAttribute(\\\"description\\\");\\n+        togglePluginDisabled(name, desc);\\n         return;\\n       }\\n \\n@@ -2097,7 +2102,7 @@ var gExtensionsViewController = {\\n       var dependentItems = gExtensionManager.getDependentItemListForID(id, false, { });\\n \\n       if (dependentItems.length > 0) {\\n-        var name = aSelectedItem.getAttribute(\\\"name\\\");\\n+        name = aSelectedItem.getAttribute(\\\"name\\\");\\n         var result = confirmOperation(name, \\\"disableTitle\\\", \\\"disableQueryMessage\\\",\\n                                       \\\"disableButton\\\", \\\"cancelButton\\\",\\n                                       \\\"disableWarningDependMessage\\\", dependentItems);\\n@@ -2113,7 +2118,9 @@ var gExtensionsViewController = {\\n     cmd_enable: function (aSelectedItem)\\n     {\\n       if (aSelectedItem.getAttribute(\\\"plugin\\\") == \\\"true\\\") {\\n-        togglePluginDisabled(aSelectedItem.getAttribute(\\\"name\\\"));\\n+        var name = aSelectedItem.getAttribute(\\\"name\\\");\\n+        var desc = aSelectedItem.getAttribute(\\\"description\\\");\\n+        togglePluginDisabled(name, desc);\\n         return;\\n       }\\n \\n\""}