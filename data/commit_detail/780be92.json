{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas780be92\""},"diff":"\"780be92 Bug 382990 - Tree onkeypress should check for ctrl key (+ test to make sure this keeps working) r=mano@mozilla.com (Asaf Romano) a=bzbarsky@mit.edu (Boris Zbarsky)\\ndiff --git a/toolkit/content/tests/widgets/Makefile.in b/toolkit/content/tests/widgets/Makefile.in\\nindex 7483149..4ab4660 100644\\n--- a/toolkit/content/tests/widgets/Makefile.in\\n+++ b/toolkit/content/tests/widgets/Makefile.in\\n@@ -47,6 +47,7 @@ include $(topsrcdir)/config/rules.mk\\n _TEST_FILES = \\ttest_bug360220.xul \\\\\\n \\t\\ttest_bug359754.xul \\\\\\n \\t\\ttest_bug365773.xul \\\\\\n+\\t\\ttest_bug382990.xul \\\\\\n \\t\\ttest_closemenu_attribute.xul \\\\\\n \\t\\ttest_colorpicker_popup.xul \\\\\\n \\t\\ttest_deck.xul \\\\\\ndiff --git a/toolkit/content/tests/widgets/test_bug382990.xul b/toolkit/content/tests/widgets/test_bug382990.xul\\nnew file mode 100644\\nindex 0000000..35b5a03\\n--- /dev/null\\n+++ b/toolkit/content/tests/widgets/test_bug382990.xul\\n@@ -0,0 +1,45 @@\\n+<?xml version=\\\"1.0\\\"?>\\n+<?xml-stylesheet href=\\\"chrome://global/skin\\\" type=\\\"text/css\\\"?>\\n+<?xml-stylesheet href=\\\"/tests/SimpleTest/test.css\\\" type=\\\"text/css\\\"?>\\n+<!--\\n+https://bugzilla.mozilla.org/show_bug.cgi?id=382990\\n+-->\\n+<window title=\\\"Mozilla Bug 382990\\\"\\n+  xmlns=\\\"http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul\\\"\\n+        onload=\\\"startThisTest()\\\">\\n+  <script type=\\\"application/javascript\\\" src=\\\"/MochiKit/packed.js\\\" />\\n+  <script type=\\\"application/javascript\\\" src=\\\"/tests/SimpleTest/SimpleTest.js\\\"/>\\n+  <script type=\\\"application/javascript\\\" src=\\\"/tests/SimpleTest/EventUtils.js\\\"/>\\n+\\n+  <!-- test resuls are displayed in the html:body -->\\n+  <body xmlns=\\\"http://www.w3.org/1999/xhtml\\\">\\n+  <a href=\\\"https://bugzilla.mozilla.org/show_bug.cgi?id=382990\\\"\\n+     target=\\\"_blank\\\">Mozilla Bug 382990</a>\\n+  </body>\\n+\\n+    <tree id=\\\"testTree\\\" height=\\\"200px\\\">\\n+        <treecols>\\n+            <treecol flex=\\\"1\\\" label=\\\"Name\\\" id=\\\"name\\\"/>\\n+        </treecols>\\n+        <treechildren>\\n+            <treeitem><treerow><treecell label=\\\"a\\\"/></treerow></treeitem>\\n+            <treeitem><treerow><treecell label=\\\"b\\\"/></treerow></treeitem>\\n+        </treechildren>\\n+    </tree>\\n+    \\n+  <!-- test code goes here -->\\n+  <script type=\\\"application/javascript\\\"><![CDATA[\\n+    /** Test for Bug 382990 **/\\n+\\n+    SimpleTest.waitForExplicitFinish();\\n+    function startThisTest()\\n+    {\\n+        var treeElem = document.getElementById(\\\"testTree\\\");\\n+        treeElem.view.selection.select(0);\\n+        treeElem.focus();\\n+        synthesizeKey(\\\"b\\\", {ctrlKey: true});\\n+        ok(!treeElem.view.selection.isSelected(1), \\\"Tree selection should not change for key events with ctrl pressed.\\\");\\n+        SimpleTest.finish();\\n+    }\\n+  ]]></script>\\n+</window>\\ndiff --git a/toolkit/content/widgets/tree.xml b/toolkit/content/widgets/tree.xml\\nindex c405405..e8f1aba 100644\\n--- a/toolkit/content/widgets/tree.xml\\n+++ b/toolkit/content/widgets/tree.xml\\n@@ -820,7 +820,7 @@\\n          }\\n          else if (!this.disableKeyNavigation && event.charCode > 0 &&\\n                   !event.altKey && !this._isAccelPressed(event) &&\\n-                  !event.metaKey) {\\n+                  !event.metaKey && !event.ctrlKey) {\\n            var l = this.keyNavigate(event);\\n            if (l >= 0) {\\n              this.view.selection.timedSelect(l, this._selectDelay);\\n\""}