{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas13d0e99\""},"diff":"\"13d0e99 Bug 394301, bookmark menu shown too short, r+sr=bz, a=mconnor\\ndiff --git a/layout/xul/base/src/nsMenuFrame.cpp b/layout/xul/base/src/nsMenuFrame.cpp\\nindex 497a395..2e28ac6 100644\\n--- a/layout/xul/base/src/nsMenuFrame.cpp\\n+++ b/layout/xul/base/src/nsMenuFrame.cpp\\n@@ -196,8 +196,7 @@ nsMenuFrame::nsMenuFrame(nsIPresShell* aShell, nsStyleContext* aContext):\\n     mChecked(PR_FALSE),\\n     mType(eMenuType_Normal),\\n     mMenuParent(nsnull),\\n-    mPopupFrame(nsnull),\\n-    mLastPref(-1,-1)\\n+    mPopupFrame(nsnull)\\n {\\n \\n } // cntr\\n@@ -734,10 +733,9 @@ nsMenuFrame::DoLayout(nsBoxLayoutState& aState)\\n         prefSize.width = mRect.width;\\n \\n     // if the pref size changed then set bounds to be the pref size\\n-    PRBool sizeChanged = (mLastPref != prefSize);\\n+    PRBool sizeChanged = (mPopupFrame->GetRect().Size() != prefSize);\\n     if (sizeChanged) {\\n       mPopupFrame->SetBounds(aState, nsRect(0,0,prefSize.width, prefSize.height));\\n-      mLastPref = prefSize;\\n     }\\n \\n     // if the menu has just been opened, or its size changed, position\\n@@ -1166,7 +1164,6 @@ nsMenuFrame::RemoveFrame(nsIAtom*        aListName,\\n     // Go ahead and remove this frame.\\n     mPopupFrame->Destroy();\\n     mPopupFrame = nsnull;\\n-    mLastPref.SizeTo(-1, -1);\\n     PresContext()->PresShell()->\\n       FrameNeedsReflow(this, nsIPresShell::eTreeChange,\\n                        NS_FRAME_HAS_DIRTY_CHILDREN);\\n@@ -1187,7 +1184,6 @@ nsMenuFrame::InsertFrames(nsIAtom*        aListName,\\n \\n   if (!mPopupFrame && aFrameList->GetType() == nsGkAtoms::menuPopupFrame) {\\n     mPopupFrame = static_cast<nsMenuPopupFrame *>(aFrameList);\\n-    mLastPref.SizeTo(-1, -1);\\n \\n #ifdef DEBUG_LAYOUT\\n     nsBoxLayoutState state(PresContext());\\n@@ -1215,7 +1211,6 @@ nsMenuFrame::AppendFrames(nsIAtom*        aListName,\\n \\n   if (!mPopupFrame && aFrameList->GetType() == nsGkAtoms::menuPopupFrame) {\\n     mPopupFrame = static_cast<nsMenuPopupFrame *>(aFrameList);\\n-    mLastPref.SizeTo(-1, -1);\\n \\n #ifdef DEBUG_LAYOUT\\n     nsBoxLayoutState state(PresContext());\\ndiff --git a/layout/xul/base/src/nsMenuFrame.h b/layout/xul/base/src/nsMenuFrame.h\\nindex 08b0fed..e5cd6c5 100644\\n--- a/layout/xul/base/src/nsMenuFrame.h\\n+++ b/layout/xul/base/src/nsMenuFrame.h\\n@@ -270,8 +270,6 @@ protected:\\n   // the popup for this menu, owned\\n   nsMenuPopupFrame* mPopupFrame;\\n \\n-  nsSize mLastPref;\\n-\\n   // Reference to the mediator which wraps this frame.\\n   nsRefPtr<nsMenuTimerMediator> mTimerMediator;\\n \\n\""}