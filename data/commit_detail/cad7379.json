{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bascad7379\""},"diff":"\"cad7379 Bug 387749 - add an item detail pane to the organizer. r=dietrich (r=gavin for editable-menulist changes). a=mconnor.\\ndiff --git a/browser/base/content/browser-places.js b/browser/base/content/browser-places.js\\nindex 5f9200d..a8f0a0c 100644\\n--- a/browser/base/content/browser-places.js\\n+++ b/browser/base/content/browser-places.js\\n@@ -139,7 +139,8 @@ var PlacesCommandHook = {\\n     this.panel.openPopup(aAnchorElement, aPosition, -1, -1);\\n \\n     gEditItemOverlay.initPanel(aItemId,\\n-                               { hiddenRows: [\\\"description\\\", \\\"location\\\"] });\\n+                               { hiddenRows: [\\\"description\\\", \\\"location\\\",\\n+                                              \\\"loadInSidebar\\\"] });\\n     setTimeout(function() {\\n                  var namePicker = document.getElementById(\\\"editBMPanel_namePicker\\\");\\n                  namePicker.focus();\\ndiff --git a/browser/components/places/content/editBookmarkOverlay.js b/browser/components/places/content/editBookmarkOverlay.js\\nindex 6d1602d..3afb294 100644\\n--- a/browser/components/places/content/editBookmarkOverlay.js\\n+++ b/browser/components/places/content/editBookmarkOverlay.js\\n@@ -54,8 +54,8 @@ var gEditItemOverlay = {\\n   _uri: null,\\n   _itemId: -1,\\n   _itemType: -1,\\n+  _readOnly: false,\\n   _microsummaries: null,\\n-  _doneCallback: null,\\n   _hiddenRows: [],\\n   _observersAdded: false,\\n \\n@@ -76,46 +76,83 @@ var gEditItemOverlay = {\\n \\n   _showHideRows: function EIO__showHideRows() {\\n     var isBookmark = this._itemType == Ci.nsINavBookmarksService.TYPE_BOOKMARK;\\n-    this._element(\\\"nameRow\\\").hidden = this._hiddenRows.indexOf(\\\"name\\\") != -1;\\n-    this._element(\\\"folderRow\\\").hidden =\\n+\\n+    this._element(\\\"nameRow\\\").collapsed = this._hiddenRows.indexOf(\\\"name\\\") != -1;\\n+    this._element(\\\"folderRow\\\").collapsed =\\n       this._hiddenRows.indexOf(\\\"folderPicker\\\") != -1;\\n-    this._element(\\\"tagsRow\\\").hidden =\\n-      this._hiddenRows.indexOf(\\\"tags\\\") != -1 || !isBookmark;\\n-    this._element(\\\"descriptionRow\\\").hidden =\\n-      this._hiddenRows.indexOf(\\\"description\\\") != -1;\\n-    this._element(\\\"locationRow\\\").hidden =\\n-      this._hiddenRows.indexOf(\\\"location\\\") != -1 || !isBookmark;\\n+    this._element(\\\"tagsRow\\\").collapsed = !isBookmark ||\\n+      this._hiddenRows.indexOf(\\\"tags\\\") != -1;\\n+    this._element(\\\"descriptionRow\\\").collapsed =\\n+      this._hiddenRows.indexOf(\\\"description\\\") != -1 ||\\n+      this._readOnly;\\n+    this._element(\\\"keywordRow\\\").collapsed = !isBookmark || this._readOnly ||\\n+      this._hiddenRows.indexOf(\\\"keyword\\\") != -1;\\n+    this._element(\\\"locationRow\\\").collapsed = !isBookmark ||\\n+      this._hiddenRows.indexOf(\\\"location\\\") != -1;\\n+    this._element(\\\"loadInSidebarCheckbox\\\").collapsed = !isBookmark ||\\n+      this._readOnly || this._hiddenRows.indexOf(\\\"loadInSidebar\\\") != -1;\\n+    this._element(\\\"feedLocationRow\\\").collapsed = !this._isLivemark ||\\n+      this._hiddenRows.indexOf(\\\"feedLocation\\\") != -1;\\n+    this._element(\\\"siteLocationRow\\\").collapsed = !this._isLivemark ||\\n+      this._hiddenRows.indexOf(\\\"siteLocation\\\") != -1;\\n   },\\n \\n   /**\\n    * Initialize the panel\\n    */\\n   initPanel: function EIO_initPanel(aItemId, aInfo) {\\n+    const bms = PlacesUtils.bookmarks;\\n+\\n     this._folderMenuList = this._element(\\\"folderMenuList\\\");\\n     this._folderTree = this._element(\\\"folderTree\\\");\\n     this._itemId = aItemId;\\n-    this._itemType = PlacesUtils.bookmarks.getItemType(this._itemId);\\n+    this._itemType = bms.getItemType(this._itemId);\\n     this._determineInfo(aInfo);\\n \\n+    var container = bms.getFolderIdForItem(this._itemId);\\n     if (this._itemType == Ci.nsINavBookmarksService.TYPE_BOOKMARK) {\\n-      this._uri = PlacesUtils.bookmarks.getBookmarkURI(this._itemId);\\n-      // tags field\\n-      this._element(\\\"tagsField\\\").value =\\n-        PlacesUtils.tagging.getTagsForURI(this._uri).join(\\\", \\\");\\n+      this._uri = bms.getBookmarkURI(this._itemId);\\n+      this._isLivemark = false;\\n+      if (PlacesUtils.livemarks.isLivemark(container))\\n+        this._readOnly = true;\\n+      else\\n+        this._readOnly = false;\\n \\n-      this._element(\\\"locationField\\\").value = this._uri.spec;\\n+      this._initTextField(\\\"locationField\\\", this._uri.spec);\\n+      this._initTextField(\\\"tagsField\\\",\\n+                           PlacesUtils.tagging\\n+                                      .getTagsForURI(this._uri).join(\\\", \\\"),\\n+                          false);\\n+      this._initTextField(\\\"keywordField\\\",\\n+                          bms.getKeywordForBookmark(this._itemId));\\n+\\n+      // Load In Sidebar checkbox\\n+      this._element(\\\"loadInSidebarCheckbox\\\").checked =\\n+        PlacesUtils.annotations.itemHasAnnotation(this._itemId,\\n+                                                  LOAD_IN_SIDEBAR_ANNO);\\n+    }\\n+    else {\\n+      this._readOnly = false;\\n+      this._isLivemark = PlacesUtils.livemarks.isLivemark(this._itemId);\\n+      if (this._isLivemark) {\\n+        var feedURI = PlacesUtils.livemarks.getFeedURI(this._itemId);\\n+        var siteURI = PlacesUtils.livemarks.getSiteURI(this._itemId);\\n+        this._initTextField(\\\"feedLocationField\\\", feedURI.spec);\\n+        this._initTextField(\\\"siteLocationField\\\", siteURI ? siteURI.spec : \\\"\\\");\\n+      }\\n+      this._uri = null;\\n     }\\n \\n     // folder picker\\n-    this._initFolderMenuList();\\n+    this._initFolderMenuList(container);\\n \\n     // name picker\\n     this._initNamePicker();\\n \\n     // description field\\n-    this._element(\\\"descriptionField\\\").value =\\n-      PlacesUtils.getItemDescription(this._itemId);\\n-\\n+    this._initTextField(\\\"descriptionField\\\", \\n+                        PlacesUtils.getItemDescription(this._itemId));\\n+    \\n     this._showHideRows();\\n \\n     // observe changes\\n@@ -126,6 +163,20 @@ var gEditItemOverlay = {\\n     }\\n   },\\n \\n+  _initTextField: function(aTextFieldId, aValue, aReadOnly) {\\n+    var field = this._element(aTextFieldId);\\n+    field.readOnly = aReadOnly !== undefined ? aReadOnly : this._readOnly;\\n+\\n+    if (field.value != aValue) {\\n+      field.value = aValue;\\n+\\n+      // clear the undo stack\\n+      var editor = field.editor;\\n+      if (editor)\\n+        editor.transactionManager.clear();\\n+    }\\n+  },\\n+\\n   /**\\n    * Appends a menu-item representing a bookmarks folder to a menu-popup.\\n    * @param aMenupopup\\n@@ -148,16 +199,15 @@ var gEditItemOverlay = {\\n     return folderMenuItem;\\n   },\\n \\n-  _initFolderMenuList: function EIO__initFolderMenuList() {\\n+  _initFolderMenuList: function EIO__initFolderMenuList(aSelectedFolder) {\\n     // clean up first\\n     var menupopup = this._folderMenuList.menupopup;\\n     while (menupopup.childNodes.length > 4)\\n       menupopup.removeChild(menupopup.lastChild);\\n \\n-    var container = PlacesUtils.bookmarks.getFolderIdForItem(this._itemId);\\n-\\n     // only show \\\"All Bookmarks\\\" if the url isn't bookmarked somewhere else\\n-    this._element(\\\"unfiledRootItem\\\").hidden = container != PlacesUtils.unfiledRootId;\\n+    this._element(\\\"unfiledRootItem\\\").hidden =\\n+      aSelectedFolder != PlacesUtils.unfiledRootId;\\n \\n     // List of recently used folders:\\n     var annos = PlacesUtils.annotations;\\n@@ -189,11 +239,12 @@ var gEditItemOverlay = {\\n       this._appendFolderItemToMenupopup(menupopup, folders[i].folderId);\\n     }\\n \\n-    var defaultItem = this._getFolderMenuItem(container, true);\\n+    var defaultItem = this._getFolderMenuItem(aSelectedFolder, true);\\n     this._folderMenuList.selectedItem = defaultItem;\\n \\n     // Hide the folders-separator if no folder is annotated as recently-used\\n     this._element(\\\"foldersSeparator\\\").hidden = (menupopup.childNodes.length <= 4);\\n+    this._folderMenuList.disabled = this._readOnly;\\n   },\\n \\n   QueryInterface: function EIO_QueryInterface(aIID) {\\n@@ -265,7 +316,8 @@ var gEditItemOverlay = {\\n \\n     var itemToSelect = userEnteredNameField;\\n     try {\\n-      if (this._itemType == Ci.nsINavBookmarksService.TYPE_BOOKMARK)\\n+      if (this._itemType == Ci.nsINavBookmarksService.TYPE_BOOKMARK &&\\n+          !this._readOnly)\\n         this._microsummaries = this._mss.getMicrosummaries(this._uri, -1);\\n     }\\n     catch(ex) {\\n@@ -303,6 +355,12 @@ var gEditItemOverlay = {\\n       namePicker.selectedItem = itemToSelect;\\n \\n     namePicker.setAttribute(\\\"droppable\\\", droppable);\\n+    namePicker.readOnly = this._readOnly;\\n+\\n+    // clear the undo stack\\n+    var editor = namePicker.editor;\\n+    if (editor)\\n+      editor.transactionManager.clear();\\n   },\\n \\n   // nsIMicrosummaryObserver\\n@@ -455,6 +513,52 @@ var gEditItemOverlay = {\\n     }\\n   },\\n \\n+  onKeywordFieldBlur: function EIO_onKeywordFieldBlur() {\\n+    var keyword = this._element(\\\"keywordField\\\").value;\\n+    if (keyword != PlacesUtils.bookmarks.getKeywordForBookmark(this._itemId)) {\\n+      var txn = PlacesUtils.ptm.editBookmarkKeyword(this._itemId, keyword);\\n+      PlacesUtils.ptm.commitTransaction(txn);\\n+    }\\n+  },\\n+\\n+  onFeedLocationFieldBlur: function EIO_onFeedLocationFieldBlur() {\\n+    // XXXmano: uri fixup\\n+    var uri;\\n+    try {\\n+      uri = IO.newURI(this._element(\\\"feedLocationField\\\").value);\\n+    }\\n+    catch(ex) { return; }\\n+\\n+    var currentFeedURI = PlacesUtils.livemarks.getFeedURI(this._itemId);\\n+    if (!currentFeedURI.equals(uri)) {\\n+      var txn = PlacesUtils.ptm.editLivemarkFeedURI(this._itemId, uri);\\n+      PlacesUtils.ptm.commitTransaction(txn);\\n+    }\\n+  },\\n+\\n+  onSiteLocationFieldBlur: function EIO_onSiteLocationFieldBlur() {\\n+    // XXXmano: uri fixup\\n+    var uri = null;\\n+    try {\\n+      uri = IO.newURI(this._element(\\\"siteLocationField\\\").value);\\n+    }\\n+    catch(ex) {  }\\n+\\n+    var currentSiteURI = PlacesUtils.livemarks.getSiteURI(this._itemId);\\n+    if (!uri || !currentSiteURI.equals(uri)) {\\n+      var txn = PlacesUtils.ptm.editLivemarkSiteURI(this._itemId, uri);\\n+      PlacesUtils.ptm.commitTransaction(txn);\\n+    }\\n+  },\\n+\\n+  onLoadInSidebarCheckboxCommand:\\n+  function EIO_onLoadInSidebarCheckboxCommand() {\\n+    var loadInSidebarChecked = this._element(\\\"loadInSidebarCheckbox\\\").checked;\\n+    var txn = PlacesUtils.ptm.setLoadInSidebar(this._itemId,\\n+                                               loadInSidebarChecked);\\n+    PlacesUtils.ptm.commitTransaction(txn);\\n+  },\\n+\\n   toggleFolderTreeVisibility: function EIO_toggleFolderTreeVisibility() {\\n     var expander = this._element(\\\"foldersExpander\\\");\\n     if (!this._folderTree.collapsed) {\\n@@ -670,26 +774,53 @@ var gEditItemOverlay = {\\n \\n       var userEnteredNameField = this._element(\\\"userEnteredName\\\");\\n       if (userEnteredNameField.value != aValue) {\\n-          userEnteredNameField.value = aValue;\\n+        userEnteredNameField.value = aValue;\\n         var namePicker = this._element(\\\"namePicker\\\");\\n-        if (namePicker.selectedItem == userEnteredNameField)\\n+        if (namePicker.selectedItem == userEnteredNameField) {\\n           namePicker.label = aValue;\\n+\\n+          // clear undo stack\\n+          namePicker.editor.transactionManager.clear();\\n+        }\\n       }\\n       break;\\n     case \\\"uri\\\":\\n       var locationField = this._element(\\\"locationField\\\");\\n       if (locationField.value != aValue) {\\n-        locationField.value = aValue;\\n         this._uri = IO.newURI(aValue);\\n+        this._initTextField(\\\"locationField\\\", this._uri.spec);\\n         this._initNamePicker(); // for microsummaries\\n-        this._element(\\\"tagsField\\\").value =\\n-          PlacesUtils.tagging.getTagsForURI(this._uri).join(\\\", \\\");\\n+        this._initTextField(\\\"tagsField\\\",\\n+                             PlacesUtils.tagging\\n+                                        .getTagsForURI(this._uri).join(\\\", \\\"),\\n+                            false);\\n         this._rebuildTagsSelectorList();\\n       }\\n       break;\\n+    case \\\"keyword\\\":\\n+      this._initTextField(\\\"keywordField\\\",\\n+                          PlacesUtils.bookmarks\\n+                                     .getKeywordForBookmark(this._itemId));\\n+      break;\\n     case DESCRIPTION_ANNO:\\n-      this._element(\\\"descriptionField\\\").value =\\n-        PlacesUtils.annotations.getItemDescription(this._itemId);\\n+      this._initTextField(\\\"descriptionField\\\",\\n+                          PlacesUtils.getItemDescription(this._itemId));\\n+      break;\\n+    case LOAD_IN_SIDEBAR_ANNO:\\n+      this._element(\\\"loadInSidebarCheckbox\\\").checked =\\n+        PlacesUtils.annotations.itemHasAnnotation(this._itemId,\\n+                                                  LOAD_IN_SIDEBAR_ANNO);\\n+      break;\\n+    case LMANNO_FEEDURI:\\n+      var feedURISpec = PlacesUtils.livemarks.getFeedURI(this._itemId).spec;\\n+      this._initTextField(\\\"feedLocationField\\\", feedURISpec);\\n+      break;\\n+    case LMANNO_SITEURI:\\n+      var siteURISpec = \\\"\\\";\\n+      var siteURI = PlacesUtils.livemarks.getSiteURI(this._itemId);\\n+      if (siteURI)\\n+        siteURISpec = siteURI.spec;\\n+      this._initTextField(\\\"siteLocationField\\\", siteURISpec);\\n       break;\\n     }\\n   },\\ndiff --git a/browser/components/places/content/editBookmarkOverlay.xul b/browser/components/places/content/editBookmarkOverlay.xul\\nindex 4fe4a89..3c571bc 100644\\n--- a/browser/components/places/content/editBookmarkOverlay.xul\\n+++ b/browser/components/places/content/editBookmarkOverlay.xul\\n@@ -49,6 +49,8 @@\\n           src=\\\"chrome://browser/content/places/editBookmarkOverlay.js\\\"/>\\n \\n   <vbox id=\\\"editBookmarkPanelContent\\\">\\n+    <broadcaster id=\\\"paneElementsBroadcaster\\\"/>\\n+\\n     <grid id=\\\"editBookmarkPanelGrid\\\" flex=\\\"1\\\">\\n       <columns>\\n         <column/>\\n@@ -57,14 +59,16 @@\\n       <rows>\\n         <row align=\\\"center\\\" id=\\\"editBMPanel_nameRow\\\">\\n           <label value=\\\"&editBookmarkOverlay.name.label;\\\"\\n-                 contorl=\\\"editBMPanel_namePicker\\\"/>\\n+                 control=\\\"editBMPanel_namePicker\\\"\\n+                 observes=\\\"paneElementsBroadcaster\\\"/>\\n           <menulist id=\\\"editBMPanel_namePicker\\\"\\n                     flex=\\\"1\\\"\\n                     editable=\\\"true\\\"\\n                     droppable=\\\"false\\\"\\n                     oninput=\\\"gEditItemOverlay.onNamePickerInput();\\\"\\n                     onblur=\\\"gEditItemOverlay.onNamePickerChange();\\\"\\n-                    oncommand=\\\"gEditItemOverlay.onNamePickerChange();\\\">\\n+                    oncommand=\\\"gEditItemOverlay.onNamePickerChange();\\\"\\n+                    observes=\\\"paneElementsBroadcaster\\\">\\n             <menupopup>\\n               <menuitem id=\\\"editBMPanel_userEnteredName\\\"/>\\n               <menuitem disabled=\\\"true\\\">\\n@@ -77,17 +81,39 @@\\n \\n         <row align=\\\"center\\\" id=\\\"editBMPanel_locationRow\\\">\\n           <label value=\\\"&editBookmarkOverlay.location.label;\\\"\\n-                 contorl=\\\"editBMPanel_locationField\\\"/>\\n+                 control=\\\"editBMPanel_locationField\\\"\\n+                 observes=\\\"paneElementsBroadcaster\\\"/>\\n           <textbox id=\\\"editBMPanel_locationField\\\"\\n-                   onblur=\\\"gEditItemOverlay.onLocationFieldBlur();\\\"/>\\n+                   onblur=\\\"gEditItemOverlay.onLocationFieldBlur();\\\"\\n+                   observes=\\\"paneElementsBroadcaster\\\"/>\\n+        </row>\\n+\\n+        <row align=\\\"center\\\" id=\\\"editBMPanel_feedLocationRow\\\">\\n+          <label value=\\\"&editBookmarkOverlay.feedLocation.label;\\\"\\n+                 control=\\\"editBMPanel_feedLocationField\\\"\\n+                 observes=\\\"paneElementsBroadcaster\\\"/>\\n+          <textbox id=\\\"editBMPanel_feedLocationField\\\"\\n+                   onblur=\\\"gEditItemOverlay.onFeedLocationFieldBlur();\\\"\\n+                   observes=\\\"paneElementsBroadcaster\\\"/>\\n+        </row>\\n+\\n+        <row align=\\\"center\\\" id=\\\"editBMPanel_siteLocationRow\\\">\\n+          <label value=\\\"&editBookmarkOverlay.siteLocation.label;\\\"\\n+                 control=\\\"editBMPanel_siteLocationField\\\"\\n+                 observes=\\\"paneElementsBroadcaster\\\"/>\\n+          <textbox id=\\\"editBMPanel_siteLocationField\\\"\\n+                   onblur=\\\"gEditItemOverlay.onSiteLocationFieldBlur();\\\"\\n+                   observes=\\\"paneElementsBroadcaster\\\"/>\\n         </row>\\n \\n         <row align=\\\"center\\\" id=\\\"editBMPanel_folderRow\\\">\\n           <label value=\\\"&editBookmarkOverlay.folder.label;\\\"\\n-                 control=\\\"editBMPanel_folderMenuList\\\"/>\\n+                 control=\\\"editBMPanel_folderMenuList\\\"\\n+                 observes=\\\"paneElementsBroadcaster\\\"/>\\n           <menulist id=\\\"editBMPanel_folderMenuList\\\"\\n                     class=\\\"folder-icon\\\"\\n-                    oncommand=\\\"gEditItemOverlay.onFolderMenuListCommand();\\\">\\n+                    oncommand=\\\"gEditItemOverlay.onFolderMenuListCommand();\\\"\\n+                    observes=\\\"paneElementsBroadcaster\\\">\\n             <menupopup>\\n               <!-- Static item for special folders -->\\n               <menuitem id=\\\"editBMPanel_unfiledRootItem\\\"\\n@@ -107,7 +133,8 @@\\n                   tooltiptext=\\\"&editBookmarkOverlay.foldersExpanderDown.tooltip;\\\"\\n                   tooltiptextdown=\\\"&editBookmarkOverlay.foldersExpanderDown.tooltip;\\\"\\n                   tooltiptextup=\\\"&editBookmarkOverlay.expanderUp.tooltip;\\\"\\n-                  oncommand=\\\"gEditItemOverlay.toggleFolderTreeVisibility();\\\"/>\\n+                  oncommand=\\\"gEditItemOverlay.toggleFolderTreeVisibility();\\\"\\n+                  observes=\\\"paneElementsBroadcaster\\\"/>\\n         </row>\\n \\n         <tree id=\\\"editBMPanel_folderTree\\\"\\n@@ -118,7 +145,8 @@\\n               onselect=\\\"gEditItemOverlay.onFolderTreeSelect();\\\"\\n               showRoot=\\\"true\\\"\\n               place=\\\"place:folder=2&amp;group=3&amp;excludeItems=1&amp;excludeQueries=1&amp;excludeReadOnlyFolders=1\\\"\\n-              hidecolumnpicker=\\\"true\\\">\\n+              hidecolumnpicker=\\\"true\\\"\\n+              observes=\\\"paneElementsBroadcaster\\\">\\n           <treecols>\\n             <treecol anonid=\\\"title\\\" flex=\\\"1\\\" primary=\\\"true\\\" hideheader=\\\"true\\\"/>\\n           </treecols>\\n@@ -127,25 +155,46 @@\\n \\n         <row align=\\\"center\\\" id=\\\"editBMPanel_tagsRow\\\">\\n           <label value=\\\"&editBookmarkOverlay.tags.label;\\\"\\n-                 control=\\\"tagsField\\\"/>\\n+                 control=\\\"tagsField\\\"\\n+                 observes=\\\"paneElementsBroadcaster\\\"/>\\n           <textbox id=\\\"editBMPanel_tagsField\\\"\\n-                   onblur=\\\"gEditItemOverlay.onTagsFieldBlur();\\\"/>\\n+                   onblur=\\\"gEditItemOverlay.onTagsFieldBlur();\\\"\\n+                   observes=\\\"paneElementsBroadcaster\\\"/>\\n           <button id=\\\"editBMPanel_tagsSelectorExpander\\\"\\n                   class=\\\"expander-down\\\"\\n                   tooltiptext=\\\"&editBookmarkOverlay.tagsExpanderDown.tooltip;\\\"\\n                   tooltiptextdown=\\\"&editBookmarkOverlay.tagsExpanderDown.tooltip;\\\"\\n                   tooltiptextup=\\\"&editBookmarkOverlay.expanderUp.tooltip;\\\"\\n-                  oncommand=\\\"gEditItemOverlay.toggleTagsSelector();\\\"/>\\n+                  oncommand=\\\"gEditItemOverlay.toggleTagsSelector();\\\"\\n+                  observes=\\\"paneElementsBroadcaster\\\"/>\\n         </row>\\n \\n-        <listbox id=\\\"editBMPanel_tagsSelector\\\" height=\\\"150\\\" collapsed=\\\"true\\\"/>\\n+        <listbox id=\\\"editBMPanel_tagsSelector\\\"\\n+                 height=\\\"150\\\" collapsed=\\\"true\\\"\\n+                 observes=\\\"paneElementsBroadcaster\\\"/>\\n+\\n+        <row id=\\\"editBMPanel_keywordRow\\\">\\n+          <label value=\\\"&editBookmarkOverlay.keyword.label;\\\"\\n+                 control=\\\"editBMPanel_keywordField\\\"\\n+                 observes=\\\"paneElementsBroadcaster\\\"/>\\n+          <textbox id=\\\"editBMPanel_keywordField\\\"\\n+                   onblur=\\\"gEditItemOverlay.onKeywordFieldBlur();\\\"\\n+                   observes=\\\"paneElementsBroadcaster\\\"/>\\n+        </row>\\n \\n-        <row id=\\\"editBMPanel_descriptionRow\\\" align=\\\"center\\\">\\n+        <row id=\\\"editBMPanel_descriptionRow\\\">\\n           <label value=\\\"&editBookmarkOverlay.description.label;\\\"\\n-                 control=\\\"editBMPanel_descriptionField\\\"/>\\n+                 control=\\\"editBMPanel_descriptionField\\\"\\n+                 observes=\\\"paneElementsBroadcaster\\\"/>\\n           <textbox id=\\\"editBMPanel_descriptionField\\\"\\n-                   onblur=\\\"gEditItemOverlay.onDescriptionFieldBlur();\\\"/>\\n+                   multiline=\\\"true\\\"\\n+                   onblur=\\\"gEditItemOverlay.onDescriptionFieldBlur();\\\"\\n+                   observes=\\\"paneElementsBroadcaster\\\"/>\\n         </row>\\n+        <checkbox id=\\\"editBMPanel_loadInSidebarCheckbox\\\"\\n+                  label=\\\"&editBookmarkOverlay.loadInSidebar.label;\\\"\\n+                  oncommand=\\\"gEditItemOverlay.onLoadInSidebarCheckboxCommand();\\\"\\n+                  observes=\\\"paneElementsBroadcaster\\\"/>\\n       </rows>\\n     </grid>\\n   </vbox>\\ndiff --git a/browser/components/places/content/organizer.css b/browser/components/places/content/organizer.css\\nindex 6a149fb..fbba801 100755\\n--- a/browser/components/places/content/organizer.css\\n+++ b/browser/components/places/content/organizer.css\\n@@ -27,3 +27,10 @@ button.commandButton {\\n   display: -moz-box;\\n }\\n \\n+/* Edit Item Panel */\\n+\\n+#infoScrollbox[minimal=\\\"true\\\"] #editBMPanel_descriptionRow,\\n+#infoScrollbox[minimal=\\\"true\\\"] #editBMPanel_loadInSidebarCheckbox,\\n+#infoScrollbox[minimal=\\\"true\\\"] #editBMPanel_keywordRow {\\n+  visibility: collapse;\\n+}\\ndiff --git a/browser/components/places/content/places.css b/browser/components/places/content/places.css\\nindex 32b405c..4c01a5a 100644\\n--- a/browser/components/places/content/places.css\\n+++ b/browser/components/places/content/places.css\\n@@ -10,4 +10,3 @@ hbox[type=\\\"places\\\"] {\\n menupopup[type=\\\"places\\\"] {\\n   -moz-binding: url(\\\"chrome://browser/content/places/menu.xml#places-menupopup\\\");\\n }\\n-\\ndiff --git a/browser/components/places/content/places.js b/browser/components/places/content/places.js\\nindex e1a7d27..700b9c5 100755\\n--- a/browser/components/places/content/places.js\\n+++ b/browser/components/places/content/places.js\\n@@ -40,8 +40,8 @@\\n const XUL_NS = \\\"http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul\\\";\\n \\n /**\\n- * Selects a place URI in the places list. \\n- * This function is global so it can be easily accessed by openers. \\n+ * Selects a place URI in the places list.\\n+ * This function is global so it can be easily accessed by openers.\\n  * @param   placeURI\\n  *          A place: URI string to select\\n  */\\n@@ -59,7 +59,7 @@ var PlacesOrganizer = {\\n     // in the places tree binding's constructor\\n     setTimeout(function() { self._init(); }, 0);\\n   },\\n-  \\n+\\n   _init: function PO__init() {\\n     this._places = document.getElementById(\\\"placesList\\\");\\n     this._content = document.getElementById(\\\"placeContent\\\");\\n@@ -106,6 +106,7 @@ var PlacesOrganizer = {\\n       this._backHistory.unshift(this.location);\\n \\n     this._content.place = this._location = aLocation;\\n+    this.onContentTreeSelect();\\n \\n     // update navigation commands\\n     if (this._backHistory.length == 0)\\n@@ -138,7 +139,7 @@ var PlacesOrganizer = {\\n   HEADER_TYPE_ADVANCED_SEARCH: 3,\\n \\n   /**\\n-   * Updates the text shown in the heading banner above the content view. \\n+   * Updates the text shown in the heading banner above the content view.\\n    * @param   type\\n    *          The type of information being shown - normal (built-in history or\\n    *          other query, bookmark folder), search results from the toolbar\\n@@ -155,7 +156,7 @@ var PlacesOrganizer = {\\n \\n     var contentTitle = document.getElementById(\\\"contentTitle\\\");\\n     contentTitle.setAttribute(\\\"value\\\", text);\\n-    \\n+\\n     // Hide the advanced search controls when the user hasn't searched\\n     var searchModifiers = document.getElementById(\\\"searchModifiers\\\");\\n     searchModifiers.hidden = type == this.HEADER_TYPE_SHOWING;\\n@@ -182,23 +183,22 @@ var PlacesOrganizer = {\\n   },\\n \\n   /**\\n-   * Loads the place URI entered in the debug \\n+   * Loads the place URI entered in the debug\\n    */\\n   loadPlaceURI: function PO_loadPlaceURI() {\\n-\\n     // clear forward history\\n     this._forwardHistory.splice(0);\\n \\n     var placeURI = document.getElementById(\\\"placeURI\\\");\\n \\n     var queriesRef = { }, optionsRef = { };\\n-    PlacesUtils.history.queryStringToQueries(placeURI.value, \\n+    PlacesUtils.history.queryStringToQueries(placeURI.value,\\n                                              queriesRef, { }, optionsRef);\\n-    \\n+\\n     // for debug panel\\n     var autoFilterResults = document.getElementById(\\\"autoFilterResults\\\");\\n     if (autoFilterResults.checked) {\\n-      var options = \\n+      var options =\\n         OptionsFilter.filter(queriesRef.value, optionsRef.value, null);\\n     }\\n     else\\n@@ -208,7 +208,7 @@ var PlacesOrganizer = {\\n       PlacesUtils.history.queriesToQueryString(queriesRef.value,\\n                                                queriesRef.value.length,\\n                                                options);\\n-    \\n+\\n     placeURI.value = this.location;\\n \\n     this.setHeaderText(this.HEADER_TYPE_SHOWING, \\\"Debug results for: \\\" + placeURI.value);\\n@@ -227,7 +227,7 @@ var PlacesOrganizer = {\\n     var options = queryNode.queryOptions;\\n     var loadedURI = document.getElementById(\\\"loadedURI\\\");\\n     loadedURI.value =\\n-      PlacesUtils.history.queriesToQueryString(queries, queries.length, \\n+      PlacesUtils.history.queriesToQueryString(queries, queries.length,\\n                                                options);\\n   },\\n \\n@@ -254,7 +254,7 @@ var PlacesOrganizer = {\\n \\n     // update location\\n     this.location = PlacesUtils.history.queriesToQueryString(queries, queries.length, options);\\n-   \\n+\\n     // Make sure the query builder is hidden.\\n     PlacesQueryBuilder.hide();\\n     if (resetSearchBox) {\\n@@ -277,9 +277,9 @@ var PlacesOrganizer = {\\n   },\\n \\n   /**\\n-   * Handle clicks on the tree. If the user middle clicks on a URL, load that \\n-   * URL according to rules. Single clicks or modified clicks do not result in \\n-   * any special action, since they're related to selection. \\n+   * Handle clicks on the tree. If the user middle clicks on a URL, load that\\n+   * URL according to rules. Single clicks or modified clicks do not result in\\n+   * any special action, since they're related to selection.\\n    * @param   aEvent\\n    *          The mouse event.\\n    */\\n@@ -287,7 +287,7 @@ var PlacesOrganizer = {\\n     var currentView = aEvent.currentTarget;\\n     var controller = currentView.controller;\\n \\n-    // If the user clicked on a tree column header, update the sorting \\n+    // If the user clicked on a tree column header, update the sorting\\n     // preferences to reflect their choices.\\n     // XXXmano: should be done in tree.xml\\n     if (aEvent.target.localName == \\\"treecol\\\") {\\n@@ -298,9 +298,9 @@ var PlacesOrganizer = {\\n       if (PlacesUtils.nodeIsURI(currentView.selectedNode))\\n         controller.openSelectedNodeWithEvent(aEvent);\\n       else if (PlacesUtils.nodeIsContainer(currentView.selectedNode)) {\\n-        // The command execution function will take care of seeing the \\n-        // selection is a folder/container and loading its contents in \\n-        // tabs for us. \\n+        // The command execution function will take care of seeing the\\n+        // selection is a folder/container and loading its contents in\\n+        // tabs for us.\\n         controller.openLinksInTabs();\\n       }\\n     }\\n@@ -313,7 +313,7 @@ var PlacesOrganizer = {\\n   getCurrentOptions: function PO_getCurrentOptions() {\\n     return asQuery(this._content.getResult().root).queryOptions;\\n   },\\n-  \\n+\\n   /**\\n    * Show the migration wizard for importing from a file.\\n    */\\n@@ -379,9 +379,9 @@ var PlacesOrganizer = {\\n \\n     // get bookmarks backup dir\\n     var dirSvc = Cc[\\\"@mozilla.org/file/directory_service;1\\\"].\\n-                     getService(Ci.nsIProperties);\\n+                 getService(Ci.nsIProperties);\\n     var bookmarksBackupDir = dirSvc.get(\\\"ProfD\\\", Ci.nsIFile);\\n-    bookmarksBackupDir.append(\\\"bookmarkbackups\\\"); \\n+    bookmarksBackupDir.append(\\\"bookmarkbackups\\\");\\n     if (!bookmarksBackupDir.exists())\\n       return; // no backup files\\n \\n@@ -424,22 +424,22 @@ var PlacesOrganizer = {\\n    */\\n   onRestoreMenuItemClick: function PO_onRestoreMenuItemClick(aMenuItem) {\\n     var dirSvc = Cc[\\\"@mozilla.org/file/directory_service;1\\\"].\\n-                     getService(Ci.nsIProperties);\\n+                 getService(Ci.nsIProperties);\\n     var bookmarksFile = dirSvc.get(\\\"ProfD\\\", Ci.nsIFile);\\n-    bookmarksFile.append(\\\"bookmarkbackups\\\"); \\n+    bookmarksFile.append(\\\"bookmarkbackups\\\");\\n     bookmarksFile.append(aMenuItem.getAttribute(\\\"value\\\"));\\n     if (!bookmarksFile.exists())\\n       return;\\n \\n     var prompts = Cc[\\\"@mozilla.org/embedcomp/prompt-service;1\\\"].\\n-      getService(Ci.nsIPromptService);\\n+                  getService(Ci.nsIPromptService);\\n     if (!prompts.confirm(null,\\n                          PlacesUtils.getString(\\\"bookmarksRestoreAlertTitle\\\"),\\n                          PlacesUtils.getString(\\\"bookmarksRestoreAlert\\\")))\\n       return;\\n \\n     var ieSvc = Cc[\\\"@mozilla.org/browser/places/import-export-service;1\\\"].\\n-      getService(Ci.nsIPlacesImportExportService);\\n+                getService(Ci.nsIPlacesImportExportService);\\n     ieSvc.importHTMLFromFile(bookmarksFile, true);\\n   },\\n \\n@@ -451,9 +451,9 @@ var PlacesOrganizer = {\\n     fp.init(window, PlacesUtils.getString(\\\"bookmarksBackupTitle\\\"),\\n             Ci.nsIFilePicker.modeSave);\\n     fp.appendFilters(Ci.nsIFilePicker.filterHTML);\\n-  \\n+\\n     var dirSvc = Cc[\\\"@mozilla.org/file/directory_service;1\\\"].\\n-      getService(Ci.nsIProperties);\\n+                 getService(Ci.nsIProperties);\\n     var backupsDir = dirSvc.get(\\\"Desk\\\", Ci.nsILocalFile);\\n     fp.displayDirectory = backupsDir;\\n \\n@@ -462,10 +462,10 @@ var PlacesOrganizer = {\\n     var date = (new Date).toLocaleFormat(\\\"%Y-%m-%d\\\");\\n     fp.defaultString = PlacesUtils.getFormattedString(\\\"bookmarksBackupFilename\\\",\\n                                                       [date]);\\n-  \\n+\\n     if (fp.show() != Ci.nsIFilePicker.returnCancel) {\\n       var ieSvc = Cc[\\\"@mozilla.org/browser/places/import-export-service;1\\\"].\\n-        getService(Ci.nsIPlacesImportExportService);\\n+                  getService(Ci.nsIPlacesImportExportService);\\n       ieSvc.exportHTMLToFile(fp.file);\\n     }\\n   },\\n@@ -476,50 +476,181 @@ var PlacesOrganizer = {\\n    */\\n   restoreFromFile: function PO_restoreFromFile() {\\n     var prompts = Cc[\\\"@mozilla.org/embedcomp/prompt-service;1\\\"].\\n-      getService(Ci.nsIPromptService);\\n+                  getService(Ci.nsIPromptService);\\n     if (!prompts.confirm(null, PlacesUtils.getString(\\\"bookmarksRestoreAlertTitle\\\"),\\n                          PlacesUtils.getString(\\\"bookmarksRestoreAlert\\\")))\\n       return;\\n-  \\n+\\n     var fp = Cc[\\\"@mozilla.org/filepicker;1\\\"].createInstance(Ci.nsIFilePicker);\\n     fp.init(window, PlacesUtils.getString(\\\"bookmarksRestoreTitle\\\"),\\n             Ci.nsIFilePicker.modeOpen);\\n     fp.appendFilters(Ci.nsIFilePicker.filterHTML);\\n-  \\n+\\n     var dirSvc = Cc[\\\"@mozilla.org/file/directory_service;1\\\"].\\n-      getService(Ci.nsIProperties);\\n+                 getService(Ci.nsIProperties);\\n     var backupsDir = dirSvc.get(\\\"Desk\\\", Ci.nsILocalFile);\\n     fp.displayDirectory = backupsDir;\\n-  \\n+\\n     if (fp.show() != Ci.nsIFilePicker.returnCancel) {\\n       var ieSvc = Cc[\\\"@mozilla.org/browser/places/import-export-service;1\\\"].\\n-                     getService(Ci.nsIPlacesImportExportService);\\n+                  getService(Ci.nsIPlacesImportExportService);\\n       ieSvc.importHTMLFromFile(fp.file, true);\\n     }\\n   },\\n \\n+  _paneDisabled: false,\\n+  _setDetailsFieldsDisabledState:\\n+  function PO__setDetailsFieldsDisabledState(aDisabled) {\\n+    if (aDisabled) {\\n+      document.getElementById(\\\"paneElementsBroadcaster\\\")\\n+              .setAttribute(\\\"disabled\\\", \\\"true\\\");\\n+    }\\n+    else {\\n+      document.getElementById(\\\"paneElementsBroadcaster\\\")\\n+              .removeAttribute(\\\"disabled\\\");\\n+    }\\n+  },\\n+\\n+  _detectAndSetDetailsPaneMinimalState:\\n+  function PO__detectAndSetDetailsPaneMinimalState(aNode) {\\n+    /**\\n+     * The details of simple folder-items (as opposed to livemarks) or the\\n+     * of livemark-children are not likely to fill the scrollbox anyway,\\n+     * thus we remove the \\\"More/Less\\\" button and show all details.\\n+     *\\n+     * the wasminimal attribute here is used to persist the \\\"more/less\\\"\\n+     * state in a bookmark->folder->bookmark scenario.\\n+     */\\n+    var infoScrollbox = document.getElementById(\\\"infoScrollbox\\\");\\n+    var scrollboxExpander = document.getElementById(\\\"infoScrollboxExpander\\\");\\n+    if ((PlacesUtils.nodeIsFolder(aNode) &&\\n+         !PlacesUtils.nodeIsLivemarkContainer(aNode)) ||\\n+        PlacesUtils.nodeIsLivemarkItem(aNode)) {\\n+      if (infoScrollbox.getAttribute(\\\"minimal\\\") == \\\"true\\\")\\n+        infoScrollbox.setAttribute(\\\"wasminimal\\\", \\\"true\\\");\\n+      infoScrollbox.removeAttribute(\\\"minimal\\\");\\n+      scrollboxExpander.hidden = true;\\n+    }\\n+    else {\\n+      if (infoScrollbox.getAttribute(\\\"wasminimal\\\") == \\\"true\\\")\\n+        infoScrollbox.setAttribute(\\\"minimal\\\", \\\"true\\\");\\n+      infoScrollbox.removeAttribute(\\\"wasminimal\\\");\\n+      scrollboxExpander.hidden = false;\\n+    }\\n+  },\\n+\\n+  updateThumbnailProportions: function PO_updateThumbnailProportions() {\\n+    var previewBox = document.getElementById(\\\"previewBox\\\");\\n+    var canvas = document.getElementById(\\\"itemThumbnail\\\");\\n+    var height = previewBox.boxObject.height;\\n+    var width = height * (screen.width / screen.height);\\n+    canvas.width = width;\\n+    canvas.height = height;\\n+  },\\n+\\n   onContentTreeSelect: function PO_onContentTreeSelect() {\\n+    // If a textbox within a panel is focused, force-blur it so its contents\\n+    // are saved\\n+    if (gEditItemOverlay.itemId != -1) {\\n+      var focusedElement = document.commandDispatcher.focusedElement;\\n+      if (focusedElement instanceof HTMLInputElement &&\\n+          /^editBMPanel.*/.test(focusedElement.parentNode.parentNode.id))\\n+        focusedElement.blur();\\n+    }\\n+\\n     var contentTree = document.getElementById(\\\"placeContent\\\");\\n-    var deck = document.getElementById(\\\"infoDeck\\\");\\n-    this.updateStatusBarForView(contentTree);\\n-    if (contentTree.hasSingleSelection) {\\n-      var selectedNode = contentTree.selectedNode;\\n-      if (selectedNode.itemId != -1 &&\\n-          !PlacesUtils.nodeIsSeparator(selectedNode)) {\\n-        gEditItemOverlay.initPanel(selectedNode.itemId,\\n-                                   { hiddenRows: [\\\"folderPicker\\\"] });\\n-        deck.selectedIndex = 1;\\n-        return;\\n+    var detailsDeck = document.getElementById(\\\"detailsDeck\\\");\\n+    if (contentTree.hasSelection) {\\n+      detailsDeck.selectedIndex = 1;\\n+      if (contentTree.hasSingleSelection) {\\n+        var selectedNode = contentTree.selectedNode;\\n+        if (selectedNode.itemId != -1 &&\\n+            !PlacesUtils.nodeIsSeparator(selectedNode)) {\\n+          if (this._paneDisabled) {\\n+            this._setDetailsFieldsDisabledState(false);\\n+            this._paneDisabled = false;\\n+          }\\n+\\n+          gEditItemOverlay.initPanel(selectedNode.itemId,\\n+                                     { hiddenRows: [\\\"folderPicker\\\"] });\\n+\\n+          this._detectAndSetDetailsPaneMinimalState(selectedNode);\\n+          this.updateThumbnailProportions();\\n+          this._updateThumbnail();\\n+          return;\\n+        }\\n       }\\n     }\\n-    gEditItemOverlay.uninitPanel();\\n-    deck.selectedIndex = 0;\\n+    else {\\n+      detailsDeck.selectedIndex = 0;\\n+      var selectItemDesc = document.getElementById(\\\"selectItemDescription\\\");\\n+      var itemsCountLabel = document.getElementById(\\\"itemsCountText\\\");\\n+      var rowCount = this._content.treeBoxObject.view.rowCount;\\n+      if (rowCount == 0) {\\n+        selectItemDesc.hidden = true;\\n+        itemsCountLabel.value = PlacesUtils.getString(\\\"detailsPane.noItems\\\");\\n+      }\\n+      else {\\n+        selectItemDesc.hidden = false;\\n+        if (rowCount == 1)\\n+          itemsCountLabel.value = PlacesUtils.getString(\\\"detailsPane.oneItem\\\");\\n+        else {\\n+          itemsCountLabel.value =\\n+            PlacesUtils.getFormattedString(\\\"detailsPane.multipleItems\\\",\\n+                                           [rowCount]);\\n+        }\\n+      }\\n+\\n+      this.updateThumbnailProportions();\\n+      this._updateThumbnail();\\n+    }\\n+\\n+    // Nothing to do if the pane was already disabled\\n+    if (!this._paneDisabled) {\\n+      gEditItemOverlay.uninitPanel();\\n+      this._setDetailsFieldsDisabledState(true);\\n+      this._paneDisabled = true;\\n+    }\\n+  },\\n+\\n+  _updateThumbnail: function PO__updateThumbnail() {\\n+    var bo = document.getElementById(\\\"previewBox\\\").boxObject;\\n+    var width  = bo.width;\\n+    var height = bo.height;\\n+\\n+    var canvas = document.getElementById(\\\"itemThumbnail\\\");\\n+    var ctx = canvas.getContext('2d');\\n+    var notAvailableText = canvas.getAttribute(\\\"notavailabletext\\\");\\n+    ctx.save();\\n+    ctx.fillStyle = \\\"-moz-Dialog\\\";\\n+    ctx.fillRect(0, 0, width, height);\\n+    ctx.translate(width/2, height/2);\\n+\\n+    ctx.fillStyle = \\\"GrayText\\\";\\n+    ctx.mozTextStyle = \\\"12pt sans serif\\\";\\n+    var len = ctx.mozMeasureText(notAvailableText);\\n+    ctx.translate(-len/2,0);\\n+    ctx.mozDrawText(notAvailableText);\\n+    ctx.restore();\\n+  },\\n+\\n+  toggleAdditionalInfoFields: function PO_toggleAdditionalInfoFields() {\\n+    var infoScrollbox = document.getElementById(\\\"infoScrollbox\\\");\\n+    var scrollboxExpander = document.getElementById(\\\"infoScrollboxExpander\\\");\\n+    if (infoScrollbox.getAttribute(\\\"minimal\\\") == \\\"true\\\") {\\n+      infoScrollbox.removeAttribute(\\\"minimal\\\");\\n+      scrollboxExpander.label = scrollboxExpander.getAttribute(\\\"lesslabel\\\");\\n+    }\\n+    else {\\n+      infoScrollbox.setAttribute(\\\"minimal\\\", \\\"true\\\");\\n+      scrollboxExpander.label = scrollboxExpander.getAttribute(\\\"morelabel\\\");\\n+    }\\n   },\\n \\n   /**\\n    * Save the current search (or advanced query) to the bookmarks root.\\n    */\\n-  saveSearch: function PP_saveSearch() {\\n+  saveSearch: function PO_saveSearch() {\\n     // Get the place: uri for the query.\\n     // If the advanced query builder is showing, use that.\\n     var queries = [];\\n@@ -553,7 +684,7 @@ var PlacesOrganizer = {\\n     var defaultText = PlacesUtils.getString(\\\"saveSearch.defaultText\\\");\\n \\n     var prompts = Cc[\\\"@mozilla.org/embedcomp/prompt-service;1\\\"].\\n-                    getService(Ci.nsIPromptService);\\n+                  getService(Ci.nsIPromptService);\\n     var check = {value: false};\\n     var input = {value: defaultText};\\n     var save = prompts.prompt(null, title, inputLabel, input, null, check);\\n@@ -562,14 +693,17 @@ var PlacesOrganizer = {\\n     if (!save || input.value == \\\"\\\")\\n      return;\\n \\n-    // Add the place: uri as a bookmark under the places root.\\n-    var txn = PlacesUtils.ptm.createItem(placeURI, PlacesUtils.bookmarks.bookmarksRoot, PlacesUtils.bookmarks.DEFAULT_INDEX, input.value);\\n+    // Add the place: uri as a bookmark under the bookmarks root.\\n+    var txn = PlacesUtils.ptm.createItem(placeURI,\\n+                                         PlacesUtils.bookmarksRootId,\\n+                                         PlacesUtils.bookmarks.DEFAULT_INDEX,\\n+                                         input.value);\\n     PlacesUtils.ptm.commitTransaction(txn);\\n   }\\n };\\n \\n /**\\n- * A set of utilities relating to search within Bookmarks and History. \\n+ * A set of utilities relating to search within Bookmarks and History.\\n  */\\n var PlacesSearchBox = {\\n \\n@@ -583,14 +717,14 @@ var PlacesSearchBox = {\\n   /**\\n    * Run a search for the specified text, over the collection specified by\\n    * the dropdown arrow. The default is all bookmarks, but can be\\n-   * localized to the active collection. \\n+   * localized to the active collection.\\n    * @param   filterString\\n-   *          The text to search for. \\n+   *          The text to search for.\\n    */\\n   search: function PSB_search(filterString) {\\n-    // for non-\\\"bookmarks\\\" collections, \\n+    // for non-\\\"bookmarks\\\" collections,\\n     // do not search for \\\"\\\" since it will match all history. Assume if the user\\n-    // deleted everything that they want to type something else and don't \\n+    // deleted everything that they want to type something else and don't\\n     // update the view.\\n     if (PlacesSearchBox.filterCollection != \\\"bookmarks\\\" &&\\n         (filterString == \\\"\\\" || this.searchFilter.hasAttribute(\\\"empty\\\")))\\n@@ -618,7 +752,7 @@ var PlacesSearchBox = {\\n       PO.setHeaderText(PO.HEADER_TYPE_SEARCH, filterString);\\n       break;\\n     }\\n-    \\n+\\n     this.searchFilter.setAttribute(\\\"filtered\\\", \\\"true\\\");\\n   },\\n \\n@@ -645,7 +779,7 @@ var PlacesSearchBox = {\\n    */\\n   updateCollectionTitle: function PSB_updateCollectionTitle(title) {\\n     if (title) {\\n-      this.searchFilter.grayText = \\n+      this.searchFilter.grayText =\\n         PlacesUtils.getFormattedString(\\\"searchCurrentDefault\\\", [title]);\\n     }\\n     else\\n@@ -685,17 +819,17 @@ var PlacesSearchBox = {\\n     this.searchFilter.focus();\\n   },\\n \\n-  /** \\n-   * Set up the gray text in the search bar as the Places View loads. \\n+  /**\\n+   * Set up the gray text in the search bar as the Places View loads.\\n    */\\n   init: function PSB_init() {\\n     var searchFilter = this.searchFilter;\\n     searchFilter.grayText = PlacesUtils.getString(\\\"searchByDefault\\\");\\n     searchFilter.reset();\\n   },\\n-  \\n+\\n   /**\\n-   * Gets or sets the text shown in the Places Search Box \\n+   * Gets or sets the text shown in the Places Search Box\\n    */\\n   get value() {\\n     return this.searchFilter.value;\\n@@ -716,8 +850,8 @@ var PlacesQueryBuilder = {\\n   _numRows: 0,\\n \\n   /**\\n-   * The maximum number of terms that can be added. \\n-   * XXXben - this should be generated dynamically based on the contents of a \\n+   * The maximum number of terms that can be added.\\n+   * XXXben - this should be generated dynamically based on the contents of a\\n    *          list of terms searchable through this widget, rather than being\\n    *          a hard coded number.\\n    */\\n@@ -765,7 +899,7 @@ var PlacesQueryBuilder = {\\n       \\\"visited\\\": this._locationSearch,\\n       \\\"location\\\": null\\n     };\\n-    \\n+\\n     this._queryBuilders = {\\n       \\\"keyword\\\": this.setKeywordQuery,\\n       \\\"visited\\\": this.setVisitedQuery,\\n@@ -787,7 +921,7 @@ var PlacesQueryBuilder = {\\n     var titleDeck = document.getElementById(\\\"titleDeck\\\");\\n     titleDeck.setAttribute(\\\"selectedIndex\\\", 0);\\n   },\\n-  \\n+\\n   /**\\n    * Shows the query builder\\n    */\\n@@ -797,7 +931,7 @@ var PlacesQueryBuilder = {\\n   },\\n \\n   /**\\n-   * Includes the rowId in the id attribute of an element in a row newly \\n+   * Includes the rowId in the id attribute of an element in a row newly\\n    * created from the template row.\\n    * @param   element\\n    *          The element whose id attribute needs to be updated.\\n@@ -832,7 +966,7 @@ var PlacesQueryBuilder = {\\n   },\\n \\n   /**\\n-   * Adds a row to the view, prefilled with the next query subject. If the \\n+   * Adds a row to the view, prefilled with the next query subject. If the\\n    * query builder is not visible, it will be shown.\\n    */\\n   addRow: function PQB_addRow() {\\n@@ -848,7 +982,7 @@ var PlacesQueryBuilder = {\\n \\n     // Determine what the search type is based on the last visible row. If this\\n     // is the first row, the type is \\\"keyword search\\\". Otherwise, it's the next\\n-    // in the sequence after the one defined by the previous visible row's \\n+    // in the sequence after the one defined by the previous visible row's\\n     // Subject selector, as defined in _nextSearch.\\n     var searchType = this._keywordSearch;\\n     var lastMenu = document.getElementById(\\\"advancedSearch\\\" +\\n@@ -857,15 +991,15 @@ var PlacesQueryBuilder = {\\n     if (this._numRows > 0 && lastMenu && lastMenu.selectedItem) {\\n       searchType = this._nextSearch[lastMenu.selectedItem.value];\\n     }\\n-    // There is no \\\"next\\\" search type. We are here in error. \\n+    // There is no \\\"next\\\" search type. We are here in error.\\n     if (!searchType)\\n       return;\\n-    // We don't insert into the document until _after_ the searchType is \\n+    // We don't insert into the document until _after_ the searchType is\\n     // determined, since this will interfere with the computation.\\n     gridRows.appendChild(newRow);\\n     this._setRowId(newRow, ++this._numRows);\\n \\n-    // Ensure the Advanced Search container is visible, if this is the first \\n+    // Ensure the Advanced Search container is visible, if this is the first\\n     // row being added.\\n     var advancedSearch = document.getElementById(\\\"advancedSearch\\\");\\n     if (advancedSearch.collapsed) {\\n@@ -874,10 +1008,10 @@ var PlacesQueryBuilder = {\\n       // Update the header.\\n       const asType = PlacesOrganizer.HEADER_TYPE_ADVANCED_SEARCH;\\n       PlacesOrganizer.setHeaderText(asType, \\\"\\\");\\n-      \\n-      // Pre-fill the search terms field with the value from the one on the \\n+\\n+      // Pre-fill the search terms field with the value from the one on the\\n       // toolbar.\\n-      // For some reason, setting.value here synchronously does not appear to \\n+      // For some reason, setting.value here synchronously does not appear to\\n       // work.\\n       var searchTermsField = document.getElementById(\\\"advancedSearch1Textbox\\\");\\n       if (searchTermsField)\\n@@ -888,7 +1022,7 @@ var PlacesQueryBuilder = {\\n       // the toolbar.\\n       this.addRow();\\n       return;\\n-    }      \\n+    }\\n \\n     this.showSearch(this._numRows, searchType);\\n     this._updateUIForRowChange();\\n@@ -930,7 +1064,7 @@ var PlacesQueryBuilder = {\\n     // there are.\\n     var d0 = null;\\n     var d1 = null;\\n-    // If there are an even number of elements in the date array, try to \\n+    // If there are an even number of elements in the date array, try to\\n     // parse it as a range of two dates.\\n     if ((dateArr.length & 1) == 0) {\\n       var mid = dateArr.length / 2;\\n@@ -971,11 +1105,11 @@ var PlacesQueryBuilder = {\\n     var calendar = document.getElementById(\\\"advancedSearch\\\" + row + \\\"Calendar\\\");\\n     var begin = calendar.beginrange;\\n     var end = calendar.endrange;\\n-    \\n+\\n     // If the calendar doesn't have a begin/end, don't change the textbox.\\n     if (begin == null || end == null)\\n       return true;\\n-      \\n+\\n     // If the begin and end are the same day, only fill that into the textbox.\\n     var textbox = document.getElementById(\\\"advancedSearch\\\" + row + \\\"TimePicker\\\");\\n     var beginDate = begin.getDate();\\n@@ -1007,10 +1141,10 @@ var PlacesQueryBuilder = {\\n                                                 endDate);\\n       textbox.value = beginStr + \\\" - \\\" + endStr;\\n     }\\n-    \\n+\\n     // Update the search.\\n     this.doSearch();\\n-    \\n+\\n     return true;\\n   },\\n \\n@@ -1058,7 +1192,7 @@ var PlacesQueryBuilder = {\\n         element.hidden = true;\\n       }\\n     }\\n-    \\n+\\n     this.doSearch();\\n   },\\n \\n@@ -1073,17 +1207,15 @@ var PlacesQueryBuilder = {\\n     }\\n     else {\\n       query.uriIsPrefix = (type == \\\"startswith\\\");\\n-      var ios = Cc[\\\"@mozilla.org/network/io-service;1\\\"].\\n-                  getService(Ci.nsIIOService);\\n       var spec = document.getElementById(prefix + \\\"Textbox\\\").value;\\n       try {\\n-        query.uri = ios.newURI(spec, null, null);\\n+        query.uri = IO.newURI(spec);\\n       }\\n       catch (e) {\\n-        // Invalid input can cause newURI to barf, that's OK, tack \\\"http://\\\" \\n+        // Invalid input can cause newURI to barf, that's OK, tack \\\"http://\\\"\\n         // onto the front and try again to see if the user omitted it\\n         try {\\n-          query.uri = ios.newURI(\\\"http://\\\" + spec, null, null);\\n+          query.uri = IO.newURI(\\\"http://\\\" + spec);\\n         }\\n         catch (e) {\\n           // OK, they have entered something which can never match. This should\\n@@ -1143,7 +1275,7 @@ var PlacesQueryBuilder = {\\n     for (var i = 1; updated < this._numRows; ++i) {\\n       var prefix = \\\"advancedSearch\\\" + i;\\n \\n-      // The user can remove rows from the middle and start of the list, not \\n+      // The user can remove rows from the middle and start of the list, not\\n       // just from the end, so we need to make sure that this row actually\\n       // exists before attempting to construct a query for it.\\n       var querySubjectElement = document.getElementById(prefix + \\\"Subject\\\");\\n@@ -1155,30 +1287,30 @@ var PlacesQueryBuilder = {\\n           query = this.queries[0];\\n         else\\n           query = PlacesUtils.history.getNewQuery();\\n-        \\n+\\n         var querySubject = querySubjectElement.value;\\n         this._queryBuilders[querySubject](query, prefix);\\n-        \\n+\\n         if (queryType == \\\"or\\\")\\n           this.queries.push(query);\\n-          \\n+\\n         ++updated;\\n       }\\n     }\\n-    \\n+\\n     // Make sure we're getting uri results, not visits\\n     this.options = PlacesOrganizer.getCurrentOptions();\\n     this.options.resultType = options.RESULT_TYPE_URI;\\n \\n     // XXXben - find some public way of doing this!\\n-    PlacesOrganizer._content.load(queries, \\n+    PlacesOrganizer._content.load(queries,\\n                                   OptionsFilter.filter(queries, options, null));\\n     PlacesOrganizer.updateLoadedURI();\\n   }\\n };\\n \\n /**\\n- * Population and commands for the View Menu. \\n+ * Population and commands for the View Menu.\\n  */\\n var ViewMenu = {\\n   /**\\n@@ -1186,36 +1318,36 @@ var ViewMenu = {\\n    * @param   popup\\n    *          The popup that contains the previously generated content.\\n    * @param   startID\\n-   *          The id attribute of an element that is the start of the \\n+   *          The id attribute of an element that is the start of the\\n    *          dynamically generated region - remove elements after this\\n-   *          item only. \\n+   *          item only.\\n    *          Must be contained by popup. Can be null (in which case the\\n-   *          contents of popup are removed). \\n+   *          contents of popup are removed).\\n    * @param   endID\\n    *          The id attribute of an element that is the end of the\\n    *          dynamically generated region - remove elements up to this\\n    *          item only.\\n    *          Must be contained by popup. Can be null (in which case all\\n    *          items until the end of the popup will be removed). Ignored\\n-   *          if startID is null. \\n-   * @returns The element for the caller to insert new items before, \\n+   *          if startID is null.\\n+   * @returns The element for the caller to insert new items before,\\n    *          null if the caller should just append to the popup.\\n    */\\n   _clean: function VM__clean(popup, startID, endID) {\\n-    if (endID) \\n+    if (endID)\\n       NS_ASSERT(startID, \\\"meaningless to have valid endID and null startID\\\");\\n     if (startID) {\\n       var startElement = document.getElementById(startID);\\n-      NS_ASSERT(startElement.parentNode == \\n+      NS_ASSERT(startElement.parentNode ==\\n                 popup, \\\"startElement is not in popup\\\");\\n-      NS_ASSERT(startElement, \\n+      NS_ASSERT(startElement,\\n                 \\\"startID does not correspond to an existing element\\\");\\n       var endElement = null;\\n       if (endID) {\\n         endElement = document.getElementById(endID);\\n-        NS_ASSERT(endElement.parentNode == popup, \\n+        NS_ASSERT(endElement.parentNode == popup,\\n                   \\\"endElement is not in popup\\\");\\n-        NS_ASSERT(endElement, \\n+        NS_ASSERT(endElement,\\n                   \\\"endID does not correspond to an existing element\\\");\\n       }\\n       while (startElement.nextSibling != endElement)\\n@@ -1224,7 +1356,7 @@ var ViewMenu = {\\n     }\\n     else {\\n       while(popup.hasChildNodes())\\n-        popup.removeChild(popup.firstChild);  \\n+        popup.removeChild(popup.firstChild);\\n     }\\n     return null;\\n   },\\n@@ -1238,8 +1370,8 @@ var ViewMenu = {\\n    * @param   endID\\n    *          see _clean\\n    * @param   type\\n-   *          the type of the menuitem, e.g. \\\"radio\\\" or \\\"checkbox\\\". \\n-   *          Can be null (no-type). \\n+   *          the type of the menuitem, e.g. \\\"radio\\\" or \\\"checkbox\\\".\\n+   *          Can be null (no-type).\\n    *          Checkboxes are checked if the column is visible.\\n    * @param   propertyPrefix\\n    *          If propertyPrefix is non-null:\\n@@ -1251,11 +1383,11 @@ var ViewMenu = {\\n    *          no accesskey is assigned.\\n    */\\n   fillWithColumns: function VM_fillWithColumns(event, startID, endID, type, propertyPrefix) {\\n-    var popup = event.target;  \\n+    var popup = event.target;\\n     var pivot = this._clean(popup, startID, endID);\\n \\n-    // If no column is \\\"sort-active\\\", the \\\"Unsorted\\\" item needs to be checked, \\n-    // so track whether or not we find a column that is sort-active. \\n+    // If no column is \\\"sort-active\\\", the \\\"Unsorted\\\" item needs to be checked,\\n+    // so track whether or not we find a column that is sort-active.\\n     var isSorted = false;\\n     var content = document.getElementById(\\\"placeContent\\\");\\n     var columns = content.columns;\\n@@ -1278,7 +1410,7 @@ var ViewMenu = {\\n       if (type == \\\"radio\\\") {\\n         menuitem.setAttribute(\\\"type\\\", \\\"radio\\\");\\n         menuitem.setAttribute(\\\"name\\\", \\\"columns\\\");\\n-        // This column is the sort key. Its item is checked. \\n+        // This column is the sort key. Its item is checked.\\n         if (column.getAttribute(\\\"sortDirection\\\") != \\\"\\\") {\\n           menuitem.setAttribute(\\\"checked\\\", \\\"true\\\");\\n           isSorted = true;\\n@@ -1289,18 +1421,18 @@ var ViewMenu = {\\n         // Cannot uncheck the primary column.\\n         if (column.getAttribute(\\\"primary\\\") == \\\"true\\\")\\n           menuitem.setAttribute(\\\"disabled\\\", \\\"true\\\");\\n-        // Items for visible columns are checked. \\n+        // Items for visible columns are checked.\\n         if (!column.hidden)\\n           menuitem.setAttribute(\\\"checked\\\", \\\"true\\\");\\n       }\\n       if (pivot)\\n         popup.insertBefore(menuitem, pivot);\\n       else\\n-        popup.appendChild(menuitem);      \\n+        popup.appendChild(menuitem);\\n     }\\n     event.stopPropagation();\\n   },\\n-  \\n+\\n   /**\\n    * Set up the content of the view menu.\\n    */\\n@@ -1310,7 +1442,7 @@ var ViewMenu = {\\n     var sortColumn = this._getSortColumn();\\n     var viewSortAscending = document.getElementById(\\\"viewSortAscending\\\");\\n     var viewSortDescending = document.getElementById(\\\"viewSortDescending\\\");\\n-    // We need to remove an existing checked attribute because the unsorted \\n+    // We need to remove an existing checked attribute because the unsorted\\n     // menu item is not rebuilt every time we open the menu like the others.\\n     var viewUnsorted = document.getElementById(\\\"viewUnsorted\\\");\\n     if (!sortColumn) {\\n@@ -1329,7 +1461,7 @@ var ViewMenu = {\\n       viewUnsorted.removeAttribute(\\\"checked\\\");\\n     }\\n   },\\n-  \\n+\\n   /**\\n    * Shows/Hides a tree column.\\n    * @param   element\\n@@ -1339,13 +1471,13 @@ var ViewMenu = {\\n     const PREFIX = \\\"menucol_\\\";\\n     var columnID = element.id.substr(PREFIX.length, element.id.length);\\n     var column = document.getElementById(columnID);\\n-    NS_ASSERT(column, \\n+    NS_ASSERT(column,\\n               \\\"menu item for column that doesn't exist?! id = \\\" + element.id);\\n \\n     var splitter = column.nextSibling;\\n     if (splitter && splitter.localName != \\\"splitter\\\")\\n       splitter = null;\\n-    \\n+\\n     if (element.getAttribute(\\\"checked\\\") == \\\"true\\\") {\\n       column.removeAttribute(\\\"hidden\\\");\\n       if (splitter)\\n@@ -1355,12 +1487,12 @@ var ViewMenu = {\\n       column.setAttribute(\\\"hidden\\\", \\\"true\\\");\\n       if (splitter)\\n         splitter.setAttribute(\\\"hidden\\\", \\\"true\\\");\\n-    }    \\n+    }\\n   },\\n \\n   /**\\n-   * Gets the last column that was sorted. \\n-   * @returns  the currently sorted column, null if there is no sorted column. \\n+   * Gets the last column that was sorted.\\n+   * @returns  the currently sorted column, null if there is no sorted column.\\n    */\\n   _getSortColumn: function VM__getSortColumn() {\\n     var content = document.getElementById(\\\"placeContent\\\");\\n@@ -1380,7 +1512,7 @@ var ViewMenu = {\\n    *          The ID of the colum that is the sort key. Can be null - the\\n    *          current sort column id or \\\"title\\\" will be used.\\n    * @param   aDirection\\n-   *          The direction to sort - \\\"ascending\\\" or \\\"descending\\\". \\n+   *          The direction to sort - \\\"ascending\\\" or \\\"descending\\\".\\n    *          Can be null - the last direction or descending will be used.\\n    *\\n    * If both aColumnID and aDirection are null, the view will be unsorted.\\n@@ -1416,7 +1548,7 @@ var ViewMenu = {\\n       case \\\"date\\\":\\n         sortingMode = aDirection == \\\"descending\\\" ?\\n           NHQO.SORT_BY_DATE_DESCENDING : NHQO.SORT_BY_DATE_ASCENDING;\\n-        break;      \\n+        break;\\n       case \\\"visitCount\\\":\\n         sortingMode = aDirection == \\\"descending\\\" ?\\n           NHQO.SORT_BY_VISITCOUNT_DESCENDING : NHQO.SORT_BY_VISITCOUNT_ASCENDING;\\n@@ -1448,12 +1580,12 @@ var ViewMenu = {\\n };\\n \\n /**\\n- * A \\\"Configuration\\\" set for a class of history query results. Some results \\n+ * A \\\"Configuration\\\" set for a class of history query results. Some results\\n  * will require that the grouping UI be labeled differently from the standard\\n  * so this object is provided to allow those results to configure the UI when\\n  * they are displayed.\\n  * @param   substr\\n- *          A prefix substring of an annotation that the result's query \\n+ *          A prefix substring of an annotation that the result's query\\n  *          matches.\\n  * @param   onLabel\\n  *          The label for the \\\"Grouping On\\\" command\\n@@ -1468,10 +1600,10 @@ var ViewMenu = {\\n  * @param   offOncommand\\n  *          The \\\"oncommand\\\" attribute of the \\\"Grouping Off\\\" command\\n  * @param   disabled\\n- *          Whether or not grouping is disabled for results that match this \\n+ *          Whether or not grouping is disabled for results that match this\\n  *          config.\\n  */\\n-function GroupingConfig(substr, onLabel, onAccesskey, offLabel, offAccesskey, \\n+function GroupingConfig(substr, onLabel, onAccesskey, offLabel, offAccesskey,\\n                         onOncommand, offOncommand, disabled) {\\n   this.substr = substr;\\n   this.onLabel = onLabel;\\n@@ -1484,24 +1616,24 @@ function GroupingConfig(substr, onLabel, onAccesskey, offLabel, offAccesskey,\\n }\\n \\n /**\\n- * Handles Grouping within the Content View, and the commands that support it. \\n+ * Handles Grouping within the Content View, and the commands that support it.\\n  */\\n var Groupers = {\\n   defaultGrouper: null,\\n   annotationGroupers: [],\\n \\n   /**\\n-   * Initializes groupings for various view types. \\n+   * Initializes groupings for various view types.\\n    */\\n   init: function G_init() {\\n-    this.defaultGrouper = \\n+    this.defaultGrouper =\\n       new GroupingConfig(null, PlacesUtils.getString(\\\"defaultGroupOnLabel\\\"),\\n                          PlacesUtils.getString(\\\"defaultGroupOnAccesskey\\\"),\\n                          PlacesUtils.getString(\\\"defaultGroupOffLabel\\\"),\\n                          PlacesUtils.getString(\\\"defaultGroupOffAccesskey\\\"),\\n                          \\\"Groupers.groupBySite()\\\",\\n                          \\\"Groupers.groupByPage()\\\", false);\\n-    var subscriptionConfig = \\n+    var subscriptionConfig =\\n       new GroupingConfig(\\\"livemark/\\\", PlacesUtils.getString(\\\"livemarkGroupOnLabel\\\"),\\n                          PlacesUtils.getString(\\\"livemarkGroupOnAccesskey\\\"),\\n                          PlacesUtils.getString(\\\"livemarkGroupOffLabel\\\"),\\n@@ -1512,10 +1644,10 @@ var Groupers = {\\n   },\\n \\n   /**\\n-   * Get the most appropriate GroupingConfig for the set of queries that are \\n+   * Get the most appropriate GroupingConfig for the set of queries that are\\n    * about to be executed.\\n    * @param   queries\\n-   *          An array of queries that are about to be executed. \\n+   *          An array of queries that are about to be executed.\\n    * @param   handler\\n    *          Optionally specify which handler to use to filter the options.\\n    *          If null, the default handler for the queries will be used.\\n@@ -1524,7 +1656,7 @@ var Groupers = {\\n     if (!handler)\\n       handler = OptionsFilter.getHandler(queries);\\n \\n-    // If the queries will generate a bookmarks folder, there is no \\\"grouper \\n+    // If the queries will generate a bookmarks folder, there is no \\\"grouper\\n     // config\\\" since all of the grouping UI should be hidden (there is only one\\n     // grouping mode - group by folder).\\n     if (handler == OptionsFilter.bookmarksHandler)\\n@@ -1542,16 +1674,16 @@ var Groupers = {\\n   },\\n \\n   /**\\n-   * Updates the grouping broadcasters for the given result. \\n+   * Updates the grouping broadcasters for the given result.\\n    * @param   queries\\n    *          An array of queries that are going to be executed.\\n    * @param   options\\n-   *          The options that are being used to generate the forthcoming \\n+   *          The options that are being used to generate the forthcoming\\n    *          result.\\n    * @param   handler\\n    *          Optionally specify which handler to use to filter the options.\\n    *          If null, the default handler for the queries will be used.\\n-   * @param   \\n+   * @param\\n    */\\n   updateGroupingUI: function G_updateGroupingUI(queries, options, handler) {\\n     var separator = document.getElementById(\\\"placesBC_grouping:separator\\\");\\n@@ -1560,9 +1692,9 @@ var Groupers = {\\n     separator.removeAttribute(\\\"hidden\\\");\\n     groupOff.removeAttribute(\\\"hidden\\\");\\n     groupOn.removeAttribute(\\\"hidden\\\");\\n-    \\n-    // Walk the list of registered annotationGroupers, determining what are \\n-    // available and notifying the broadcaster \\n+\\n+    // Walk the list of registered annotationGroupers, determining what are\\n+    // available and notifying the broadcaster\\n     var config = this._getConfig(queries, handler);\\n     if (!config) {\\n       // Generic Bookmarks Folder or custom container that disables grouping.\\n@@ -1577,8 +1709,8 @@ var Groupers = {\\n       groupOff.setAttribute(\\\"label\\\", config.offLabel);\\n       groupOff.setAttribute(\\\"accesskey\\\", config.offAccesskey);\\n       groupOff.setAttribute(\\\"oncommand\\\", config.offOncommand);\\n-      // Update the checked state of the UI: \\n-      // Grouping UI is \\\"enabled\\\" if there is at least one set of grouping \\n+      // Update the checked state of the UI:\\n+      // Grouping UI is \\\"enabled\\\" if there is at least one set of grouping\\n       // options.\\n       var groupingsCountRef = { };\\n       options.getGroupingMode(groupingsCountRef);\\n@@ -1587,12 +1719,12 @@ var Groupers = {\\n   },\\n \\n   /**\\n-   * Update the visual state of UI that controls grouping. \\n+   * Update the visual state of UI that controls grouping.\\n    */\\n   _updateBroadcasters: function G__updateGroupingBroadcasters(on) {\\n     var groupingOn = document.getElementById(\\\"placesBC_grouping:on\\\");\\n     var groupingOff = document.getElementById(\\\"placesBC_grouping:off\\\");\\n-    if (on) {    \\n+    if (on) {\\n       groupingOn.setAttribute(\\\"checked\\\", \\\"true\\\");\\n       groupingOff.removeAttribute(\\\"checked\\\");\\n     }\\n@@ -1603,7 +1735,7 @@ var Groupers = {\\n   },\\n \\n   /**\\n-   * Shows visited pages grouped by site. \\n+   * Shows visited pages grouped by site.\\n    */\\n   groupBySite: function G_groupBySite() {\\n     var query = asQuery(PlacesOrganizer._content.getResult().root);\\n@@ -1620,7 +1752,7 @@ var Groupers = {\\n   },\\n \\n   /**\\n-   * Shows visited pages without grouping. \\n+   * Shows visited pages without grouping.\\n    */\\n   groupByPage: function G_groupByPage() {\\n     var query = asQuery(PlacesOrganizer._content.getResult().root);\\n@@ -1636,7 +1768,7 @@ var Groupers = {\\n   },\\n \\n   /**\\n-   * Shows all subscribed feeds (Live Bookmarks) grouped under their parent \\n+   * Shows all subscribed feeds (Live Bookmarks) grouped under their parent\\n    * feed.\\n    */\\n   groupByFeed: function G_groupByFeed() {\\n@@ -1668,4 +1800,3 @@ var Groupers = {\\n     OptionsFilter.update(content.getResult());\\n   }\\n };\\n-\\ndiff --git a/browser/components/places/content/places.xul b/browser/components/places/content/places.xul\\nindex f9c95d7..aa8e38f 100755\\n--- a/browser/components/places/content/places.xul\\n+++ b/browser/components/places/content/places.xul\\n@@ -45,6 +45,8 @@\\n <?xml-stylesheet href=\\\"chrome://global/skin/\\\"?>\\n <?xml-stylesheet href=\\\"chrome://browser/skin/places/places.css\\\"?>\\n \\n+<?xul-overlay href=\\\"chrome://browser/content/places/editBookmarkOverlay.xul\\\"?>\\n+\\n #ifdef XP_MACOSX\\n <?xul-overlay href=\\\"chrome://browser/content/macBrowserOverlay.xul\\\"?>\\n #else\\n@@ -64,6 +66,7 @@\\n         title=\\\"&places.organizer.title;\\\" \\n         windowtype=\\\"Places:Organizer\\\" \\n         xmlns=\\\"http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul\\\"\\n+        xmlns:html=\\\"http://www.w3.org/1999/xhtml\\\"\\n         onload=\\\"PlacesOrganizer.init();\\\"\\n         onunload=\\\"PlacesOrganizer.destroy();\\\"\\n         width=\\\"700\\\" height=\\\"500\\\" screenX=\\\"10\\\" screenY=\\\"10\\\"\\n@@ -71,6 +74,8 @@\\n \\n   <script type=\\\"application/x-javascript\\\"\\n           src=\\\"chrome://browser/content/places/places.js\\\"/>\\n+  <script type=\\\"application/javascript\\\"\\n+          src=\\\"chrome://browser/content/utilityOverlay.js\\\"/>\\n \\n #ifdef XP_MACOSX\\n #include ../../../base/content/browserMountPoints.inc\\n@@ -240,22 +245,13 @@\\n                     accesskey=\\\"&selectAllCmd.accesskey;\\\"/>\\n \\n           <menuseparator id=\\\"orgMoveSeparator\\\"/>\\n-          \\n+\\n           <menuitem id=\\\"orgDelete\\\"\\n                     command=\\\"cmd_delete\\\"\\n                     label=\\\"&deleteCmd.label;\\\"\\n                     key=\\\"key_delete\\\"\\n                     accesskey=\\\"&deleteCmd.accesskey;\\\"/>\\n-          <menuitem id=\\\"orgRename\\\"\\n-                    command=\\\"placesCmd_rename\\\"\\n-                    label=\\\"&cmd.rename.label;\\\"\\n-                    accesskey=\\\"&cmd.rename.accesskey;\\\"/>\\n-          <menuitem id=\\\"orgProperties\\\"\\n-                    command=\\\"placesCmd_show:info\\\"\\n-                    label=\\\"&cmd.properties.label;\\\"\\n-                    key=\\\"placesKey_show:info\\\"\\n-                    accesskey=\\\"&cmd.properties.accesskey;\\\"/>\\n-          \\n+ \\n           <menuseparator id=\\\"orgCloseSeparator\\\"/>\\n \\n           <menuitem id=\\\"orgClose\\\"\\n@@ -270,6 +266,7 @@\\n                      label=\\\"&views.label;\\\"\\n                      accesskey=\\\"&view.accesskey;\\\">\\n         <menupopup id=\\\"viewMenuPopup\\\">\\n+<!--\\n           <menuitem id=\\\"viewDetails\\\"\\n                     type=\\\"radio\\\"\\n #ifdef MACOSX\\n@@ -282,18 +279,19 @@\\n \\n           <menuseparator id=\\\"addonsSeparator\\\"/>\\n \\n-          <!--\\n           <menuitem id=\\\"viewAddons\\\"\\n                     command=\\\"\\\"\\n                     label=\\\"&view.addons.label;\\\"\\n                     accesskey=\\\"&view.addons.label;\\\"/>\\n           <menuseparator id=\\\"sortingSeparator\\\"/>\\n-          -->\\n+-->\\n+\\n           <menu id=\\\"viewColumns\\\" \\n                 label=\\\"&view.columns.label;\\\" accesskey=\\\"&view.columns.accesskey;\\\">\\n             <menupopup onpopupshowing=\\\"ViewMenu.fillWithColumns(event, null, null, 'checkbox', null);\\\"\\n                        oncommand=\\\"ViewMenu.showHideColumn(event.target); event.stopPropagation();\\\"/>\\n           </menu>\\n+\\n           <menu id=\\\"viewSort\\\" label=\\\"&view.sort.label;\\\"\\n                 accesskey=\\\"&view.sort.accesskey;\\\">\\n             <menupopup onpopupshowing=\\\"ViewMenu.populateSortMenu(event);\\\"\\n@@ -310,14 +308,14 @@\\n                         oncommand=\\\"ViewMenu.setSortColumn(null, 'descending'); event.stopPropagation();\\\"/>\\n             </menupopup>\\n           </menu>\\n-          <!--\\n+<!--\\n           <menuseparator id=\\\"groupingSeparator\\\" observes=\\\"placesBC_grouping:separator\\\"/>\\n \\n           <menuitem id=\\\"viewGroupNone\\\" type=\\\"radio\\\" name=\\\"group\\\"\\n                     observes=\\\"placesBC_grouping:off\\\"/>\\n           <menuitem id=\\\"viewGroupGroup\\\" type=\\\"radio\\\" name=\\\"group\\\"\\n                     observes=\\\"placesBC_grouping:on\\\"/>\\n-          -->\\n+-->\\n         </menupopup>\\n       </toolbarbutton>\\n \\n@@ -408,41 +406,75 @@\\n                       command=\\\"OrganizerCommand_search:moreCriteria\\\"/>\\n             </hbox>\\n           </hbox>\\n-#include advancedSearch.inc          \\n-          <tree id=\\\"placeContent\\\" class=\\\"placesTree\\\" context=\\\"placesContext\\\" \\n-                flex=\\\"1\\\" type=\\\"places\\\" \\n-                ondblclick=\\\"this.controller.openSelectedNodeWithEvent(event);\\\"\\n-                onclick=\\\"PlacesOrganizer.onTreeClick(event);\\\">\\n-            <treecols id=\\\"placeContentColumns\\\">\\n-              <treecol label=\\\"&col.name.label;\\\" id=\\\"title\\\" flex=\\\"5\\\" primary=\\\"true\\\" \\n-                       persist=\\\"width hidden ordinal sortActive sortDirection\\\"/>\\n-              <splitter class=\\\"tree-splitter\\\"/>\\n-              <treecol label=\\\"&col.tags.label;\\\" id=\\\"tags\\\" flex=\\\"2\\\"\\n-                       persist=\\\"width hidden ordinal sortActive sortDirection\\\"/>\\n-              <splitter class=\\\"tree-splitter\\\"/>\\n-              <treecol label=\\\"&col.url.label;\\\" id=\\\"url\\\" flex=\\\"5\\\" \\n-                       persist=\\\"width hidden ordinal sortActive sortDirection\\\"/>\\n-              <splitter class=\\\"tree-splitter\\\"/>\\n-              <treecol label=\\\"&col.lastvisit.label;\\\" id=\\\"date\\\" flex=\\\"1\\\" hidden=\\\"true\\\"\\n-                       persist=\\\"width hidden ordinal sortActive sortDirection\\\"/>\\n-              <splitter class=\\\"tree-splitter\\\"/>\\n-              <treecol label=\\\"&col.visitcount.label;\\\" id=\\\"visitCount\\\" flex=\\\"1\\\" hidden=\\\"true\\\"\\n-                       persist=\\\"width hidden ordinal sortActive sortDirection\\\"/>\\n-              <splitter class=\\\"tree-splitter\\\"/>\\n-              <treecol label=\\\"&col.keyword.label;\\\" id=\\\"keyword\\\" flex=\\\"1\\\" hidden=\\\"true\\\"\\n-                       persist=\\\"width hidden ordinal sortActive sortDirection\\\"/>\\n-              <splitter class=\\\"tree-splitter\\\"/>\\n-              <treecol label=\\\"&col.description.label;\\\" id=\\\"description\\\" flex=\\\"1\\\" hidden=\\\"true\\\"\\n-                       persist=\\\"width hidden ordinal sortActive sortDirection\\\"/>\\n-              <splitter class=\\\"tree-splitter\\\"/>\\n-              <treecol label=\\\"&col.dateadded.label;\\\" id=\\\"dateAdded\\\" flex=\\\"1\\\" hidden=\\\"true\\\"\\n-                       persist=\\\"width hidden ordinal sortActive sortDirection\\\"/>\\n-              <splitter class=\\\"tree-splitter\\\"/>\\n-              <treecol label=\\\"&col.lastmodified.label;\\\" id=\\\"lastModified\\\" flex=\\\"1\\\" hidden=\\\"true\\\"\\n-                       persist=\\\"width hidden ordinal sortActive sortDirection\\\"/>\\n-            </treecols>\\n-            <treechildren id=\\\"placeContentChildren\\\" view=\\\"placeContent\\\" flex=\\\"1\\\"/>\\n-          </tree>\\n+#include advancedSearch.inc\\n+          <vbox flex=\\\"1\\\">\\n+            <tree id=\\\"placeContent\\\" class=\\\"placesTree\\\" context=\\\"placesContext\\\" \\n+                  flex=\\\"1\\\" type=\\\"places\\\" \\n+                  ondblclick=\\\"this.controller.openSelectedNodeWithEvent(event);\\\"\\n+                  onclick=\\\"PlacesOrganizer.onTreeClick(event);\\\"\\n+                  onselect=\\\"PlacesOrganizer.onContentTreeSelect();\\\">\\n+              <treecols id=\\\"placeContentColumns\\\">\\n+                <treecol label=\\\"&col.name.label;\\\" id=\\\"title\\\" flex=\\\"5\\\" primary=\\\"true\\\" \\n+                         persist=\\\"width hidden ordinal sortActive sortDirection\\\"/>\\n+                <splitter class=\\\"tree-splitter\\\"/>\\n+                <treecol label=\\\"&col.tags.label;\\\" id=\\\"tags\\\" flex=\\\"2\\\"\\n+                         persist=\\\"width hidden ordinal sortActive sortDirection\\\"/>\\n+                <splitter class=\\\"tree-splitter\\\"/>\\n+                <treecol label=\\\"&col.url.label;\\\" id=\\\"url\\\" flex=\\\"5\\\" \\n+                         persist=\\\"width hidden ordinal sortActive sortDirection\\\"/>\\n+                <splitter class=\\\"tree-splitter\\\"/>\\n+                <treecol label=\\\"&col.lastvisit.label;\\\" id=\\\"date\\\" flex=\\\"1\\\" hidden=\\\"true\\\"\\n+                         persist=\\\"width hidden ordinal sortActive sortDirection\\\"/>\\n+                <splitter class=\\\"tree-splitter\\\"/>\\n+                <treecol label=\\\"&col.visitcount.label;\\\" id=\\\"visitCount\\\" flex=\\\"1\\\" hidden=\\\"true\\\"\\n+                         persist=\\\"width hidden ordinal sortActive sortDirection\\\"/>\\n+                <splitter class=\\\"tree-splitter\\\"/>\\n+                <treecol label=\\\"&col.keyword.label;\\\" id=\\\"keyword\\\" flex=\\\"1\\\" hidden=\\\"true\\\"\\n+                         persist=\\\"width hidden ordinal sortActive sortDirection\\\"/>\\n+                <splitter class=\\\"tree-splitter\\\"/>\\n+                <treecol label=\\\"&col.description.label;\\\" id=\\\"description\\\" flex=\\\"1\\\" hidden=\\\"true\\\"\\n+                         persist=\\\"width hidden ordinal sortActive sortDirection\\\"/>\\n+                <splitter class=\\\"tree-splitter\\\"/>\\n+                <treecol label=\\\"&col.dateadded.label;\\\" id=\\\"dateAdded\\\" flex=\\\"1\\\" hidden=\\\"true\\\"\\n+                         persist=\\\"width hidden ordinal sortActive sortDirection\\\"/>\\n+                <splitter class=\\\"tree-splitter\\\"/>\\n+                <treecol label=\\\"&col.lastmodified.label;\\\" id=\\\"lastModified\\\" flex=\\\"1\\\" hidden=\\\"true\\\"\\n+                         persist=\\\"width hidden ordinal sortActive sortDirection\\\"/>\\n+              </treecols>\\n+              <treechildren id=\\\"placeContentChildren\\\" view=\\\"placeContent\\\" flex=\\\"1\\\"/>\\n+            </tree>\\n+            <splitter id=\\\"contentSplitter\\\" collapse=\\\"after\\\" persist=\\\"state\\\">\\n+              <grippy/>\\n+            </splitter>\\n+            <hbox persist=\\\"height\\\" id=\\\"infoPane\\\">\\n+              <hbox id=\\\"previewBox\\\" style=\\\"min-width: 60px; -moz-border-end: 1px solid GrayText;\\\">\\n+                <html:canvas id=\\\"itemThumbnail\\\" notavailabletext=\\\"&detailsPane.noPreviewAvailable.label;\\\"/>\\n+              </hbox>\\n+              <deck flex=\\\"1\\\" id=\\\"detailsDeck\\\">\\n+                <vbox align=\\\"center\\\">\\n+                  <spacer flex=\\\"3\\\"/>\\n+                  <label id=\\\"itemsCountText\\\"/>\\n+                  <spacer flex=\\\"1\\\"/>\\n+                  <description id=\\\"selectItemDescription\\\">\\n+                     &detailsPane.selectAnItemText.description;\\n+                  </description>\\n+                  <spacer flex=\\\"3\\\"/>\\n+                </vbox>\\n+                <scrollbox id=\\\"infoScrollbox\\\" minimal=\\\"true\\\" orient=\\\"vertical\\\" flex=\\\"1\\\" style='overflow: auto;'>\\n+                  <vbox id=\\\"editBookmarkPanelContent\\\"/>\\n+                  <hbox>\\n+                    <button type=\\\"image\\\" id=\\\"infoScrollboxExpander\\\"\\n+                            lesslabel=\\\"&detailsPane.less.label;\\\"\\n+                            morelabel=\\\"&detailsPane.more.label;\\\"\\n+                            label=\\\"&detailsPane.more.label;\\\"\\n+                            oncommand=\\\"PlacesOrganizer.toggleAdditionalInfoFields();\\\"\\n+                            observes=\\\"paneElementsBroadcaster\\\"/>\\n+                    <spacer flex=\\\"1\\\"/>\\n+                  </hbox>\\n+                </scrollbox>\\n+              </deck>\\n+            </hbox>\\n+          </vbox>\\n           <vbox id=\\\"debugPanel\\\" hidden=\\\"true\\\">\\n             <grid>\\n               <columns>\\ndiff --git a/browser/components/places/content/utils.js b/browser/components/places/content/utils.js\\nindex e42d662..2c8da3e 100644\\n--- a/browser/components/places/content/utils.js\\n+++ b/browser/components/places/content/utils.js\\n@@ -52,6 +52,7 @@ const LOAD_IN_SIDEBAR_ANNO = \\\"bookmarkProperties/loadInSidebar\\\";\\n const DESCRIPTION_ANNO = \\\"bookmarkProperties/description\\\";\\n const POST_DATA_ANNO = \\\"URIProperties/POSTData\\\";\\n const LMANNO_FEEDURI = \\\"livemark/feedURI\\\";\\n+const LMANNO_SITEURI = \\\"livemark/siteURI\\\";\\n \\n #ifdef XP_MACOSX\\n // On Mac OSX, the transferable system converts \\\"\\\\r\\\\n\\\" to \\\"\\\\n\\\\n\\\", where we\\n@@ -408,7 +409,7 @@ var PlacesUtils = {\\n   */\\n   nodeIsLivemarkContainer: function PU_nodeIsLivemarkContainer(aNode) {\\n     return this.nodeIsFolder(aNode) &&\\n-           this.annotations.itemHasAnnotation(aNode.itemId, LMANNO_FEEDURI);\\n+           this.livemarks.isLivemark(aNode.itemId);\\n   },\\n \\n  /**\\n@@ -457,7 +458,7 @@ var PlacesUtils = {\\n   },\\n \\n   /**\\n-   * String-wraps a NavHistoryResultNode according to the rules of the specified\\n+   * String-wraps a result node according to the rules of the specified\\n    * content type.\\n    * @param   aNode\\n    *          The Result node to wrap (serialize)\\ndiff --git a/browser/locales/en-US/chrome/browser/places/editBookmarkOverlay.dtd b/browser/locales/en-US/chrome/browser/places/editBookmarkOverlay.dtd\\nindex cea58bc..d4ca4bd 100644\\n--- a/browser/locales/en-US/chrome/browser/places/editBookmarkOverlay.dtd\\n+++ b/browser/locales/en-US/chrome/browser/places/editBookmarkOverlay.dtd\\n@@ -1,5 +1,7 @@\\n <!ENTITY editBookmarkOverlay.name.label                      \\\"Name:\\\">\\n <!ENTITY editBookmarkOverlay.location.label                  \\\"Location:\\\">\\n+<!ENTITY editBookmarkOverlay.feedLocation.label              \\\"Feed Location:\\\">\\n+<!ENTITY editBookmarkOverlay.siteLocation.label              \\\"Site Location:\\\">\\n <!ENTITY editBookmarkOverlay.liveTitlesSeparator.label       \\\"Live Titles\\\">\\n <!ENTITY editBookmarkOverlay.folder.label                    \\\"Folder:\\\">\\n <!ENTITY editBookmarkOverlay.allBookmarksFolderItem.label    \\\"All Bookmarks\\\">\\n@@ -9,4 +11,6 @@\\n <!ENTITY editBookmarkOverlay.expanderUp.tooltip              \\\"Hide\\\">\\n <!ENTITY editBookmarkOverlay.tags.label                      \\\"Tags:\\\">\\n <!ENTITY editBookmarkOverlay.description.label               \\\"Description:\\\">\\n+<!ENTITY editBookmarkOverlay.keyword.label                   \\\"Keyword:\\\">\\n <!ENTITY editBookmarkOverlay.tagsExpanderDown.tooltip        \\\"Show all tags\\\">\\n+<!ENTITY editBookmarkOverlay.loadInSidebar.label             \\\"Load this bookmark in the sidebar\\\">\\ndiff --git a/browser/locales/en-US/chrome/browser/places/places.dtd b/browser/locales/en-US/chrome/browser/places/places.dtd\\nindex 18f8c7c..f83650f 100644\\n--- a/browser/locales/en-US/chrome/browser/places/places.dtd\\n+++ b/browser/locales/en-US/chrome/browser/places/places.dtd\\n@@ -191,3 +191,12 @@\\n <!ENTITY forwardCmd.label       \\\"Forward\\\">\\n <!ENTITY forwardCmd.accesskey   \\\"F\\\">\\n <!ENTITY forwardButton.tooltip  \\\"Go forward\\\">\\n+\\n+<!ENTITY detailsPane.more.label\\n+         \\\"More\\\">\\n+<!ENTITY detailsPane.less.label\\n+         \\\"Less\\\">\\n+<!ENTITY detailsPane.noPreviewAvailable.label\\n+         \\\"Preview\\\">\\n+<!ENTITY detailsPane.selectAnItemText.description\\n+         \\\"Select an item to view and edit its properties\\\">\\ndiff --git a/browser/locales/en-US/chrome/browser/places/places.properties b/browser/locales/en-US/chrome/browser/places/places.properties\\nindex c8a0186..cfa37e1 100644\\n--- a/browser/locales/en-US/chrome/browser/places/places.properties\\n+++ b/browser/locales/en-US/chrome/browser/places/places.properties\\n@@ -93,3 +93,7 @@ EnterExport=Export Bookmarks File\\n saveSearch.title=Save Search\\n saveSearch.inputLabel=Name:\\n saveSearch.defaultText=New Query\\n+\\n+detailsPane.noItems=No items\\n+detailsPane.oneItem=One item\\n+detailsPane.multipleItems=%S items\\ndiff --git a/browser/themes/pinstripe/browser/jar.mn b/browser/themes/pinstripe/browser/jar.mn\\nindex d46c452..e6ba6c4 100644\\n--- a/browser/themes/pinstripe/browser/jar.mn\\n+++ b/browser/themes/pinstripe/browser/jar.mn\\n@@ -49,6 +49,8 @@ classic.jar:\\n   skin/classic/browser/places/editBookmarkOverlay.css       (places/editBookmarkOverlay.css)\\n   skin/classic/browser/places/starPage.png                  (places/starPage.png)\\n   skin/classic/browser/places/pageStarred.png               (places/pageStarred.png)\\n+  skin/classic/browser/places/twisty-open.gif               (places/twisty-open.gif)\\n+  skin/classic/browser/places/twisty-closed.gif             (places/twisty-closed.gif)\\n   skin/classic/browser/places/tag.png                       (places/tag.png)\\n   skin/classic/browser/places/organizer-toolbar.png         (bookmarks/Bookmarks-toolbar.png)\\n   skin/classic/browser/places/expander-closed-active.png    (bookmarks/expander-closed-active.png)\\ndiff --git a/browser/themes/pinstripe/browser/places/editBookmarkOverlay.css b/browser/themes/pinstripe/browser/places/editBookmarkOverlay.css\\nindex 4483154..10f6a9f 100644\\n--- a/browser/themes/pinstripe/browser/places/editBookmarkOverlay.css\\n+++ b/browser/themes/pinstripe/browser/places/editBookmarkOverlay.css\\n@@ -112,17 +112,28 @@\\n    */\\n   -moz-appearance: textfield;\\n   cursor: text;\\n-  margin: 2px 4px;\\n-  border: 2px solid;\\n-  -moz-border-top-colors: ThreeDShadow ThreeDDarkShadow;\\n-  -moz-border-right-colors: ThreeDHighlight ThreeDLightShadow;\\n-  -moz-border-bottom-colors: ThreeDHighlight ThreeDLightShadow;\\n-  -moz-border-left-colors: ThreeDShadow ThreeDDarkShadow;\\n-  padding: 2px 2px 3px 4px;\\n+  margin: 4px 4px;\\n+  border: 3px solid;\\n+  -moz-border-top-colors: transparent #888888 #000000;\\n+  -moz-border-right-colors: transparent #FFFFFF #000000;\\n+  -moz-border-bottom-colors: transparent #FFFFFF #000000;\\n+  -moz-border-left-colors: transparent #888888 #000000;\\n+  -moz-border-radius-topright: 2px;\\n+  -moz-border-radius-bottomleft: 2px;\\n+  padding: 0;\\n   background-color: -moz-Field;\\n   color: -moz-FieldText;\\n }\\n \\n+#editBMPanel_namePicker[droppable=\\\"false\\\"][disabled=\\\"true\\\"] > .menulist-editable-box {\\n+  cursor: default;\\n+  -moz-border-top-colors: transparent ThreeDShadow -moz-Dialog;\\n+  -moz-border-right-colors: transparent ThreeDShadow -moz-Dialog;\\n+  -moz-border-bottom-colors: transparent ThreeDShadow -moz-Dialog;\\n+  -moz-border-left-colors: transparent ThreeDShadow -moz-Dialog;\\n+  color: GrayText;\\n+}\\n+\\n #editBMPanel_namePicker[droppable=\\\"false\\\"] > .menulist-editable-box > html|*.textbox-input {\\n   margin: 0px !important;\\n   border: none !important;\\ndiff --git a/browser/themes/pinstripe/browser/places/places.css b/browser/themes/pinstripe/browser/places/places.css\\nindex 2605a04..72b6b86 100755\\n--- a/browser/themes/pinstripe/browser/places/places.css\\n+++ b/browser/themes/pinstripe/browser/places/places.css\\n@@ -272,3 +272,24 @@ treechildren::-moz-tree-twisty(title, separator) {\\n   min-width:0em;\\n }\\n \\n+/**\\n+ * info pane\\n+ */\\n+\\n+/* More/Less button */\\n+#infoScrollboxExpander {\\n+  list-style-image: url(\\\"chrome://browser/skin/places/twisty-open.gif\\\");\\n+  -moz-appearance: none;\\n+  margin: 0;\\n+  padding: 0;\\n+  max-width: 0;\\n+}\\n+\\n+#infoScrollbox[minimal=\\\"true\\\"] #infoScrollboxExpander {\\n+  list-style-image: url(\\\"chrome://browser/skin/places/twisty-closed.gif\\\");\\n+}\\n+\\n+#itemsCountText,\\n+#selectItemDescription {\\n+  color: GrayText;\\n+}\\ndiff --git a/browser/themes/pinstripe/browser/places/twisty-closed.gif b/browser/themes/pinstripe/browser/places/twisty-closed.gif\\nnew file mode 100644\\nindex 0000000..d87a58b\\nBinary files /dev/null and b/browser/themes/pinstripe/browser/places/twisty-closed.gif differ\\ndiff --git a/browser/themes/pinstripe/browser/places/twisty-open.gif b/browser/themes/pinstripe/browser/places/twisty-open.gif\\nnew file mode 100644\\nindex 0000000..c764cc4\\nBinary files /dev/null and b/browser/themes/pinstripe/browser/places/twisty-open.gif differ\\ndiff --git a/toolkit/content/widgets/menulist.xml b/toolkit/content/widgets/menulist.xml\\nindex 28e330d..a11c247 100644\\n--- a/toolkit/content/widgets/menulist.xml\\n+++ b/toolkit/content/widgets/menulist.xml\\n@@ -358,7 +358,7 @@\\n \\n   <binding id=\\\"menulist-editable\\\" extends=\\\"chrome://global/content/bindings/menulist.xml#menulist\\\">\\n     <content sizetopopup=\\\"pref\\\">\\n-      <xul:hbox class=\\\"menulist-editable-box textbox-input-box\\\" xbl:inherits=\\\"context\\\" flex=\\\"1\\\">\\n+      <xul:hbox class=\\\"menulist-editable-box textbox-input-box\\\" xbl:inherits=\\\"context,disabled,readonly\\\" flex=\\\"1\\\">\\n         <html:input class=\\\"menulist-editable-input\\\" flex=\\\"1\\\" anonid=\\\"input\\\" allowevents=\\\"true\\\"\\n                     xbl:inherits=\\\"value=label,value,disabled,tabindex,readonly\\\"/>\\n       </xul:hbox>\\n@@ -493,6 +493,11 @@\\n         ]]></getter>\\n       </property>\\n \\n+      <property name=\\\"readOnly\\\"   onset=\\\"this.inputField.readOnly = val;\\n+                                         if (val) this.setAttribute('readonly', 'true');\\n+                                         else this.removeAttribute('readonly'); return val;\\\"\\n+                                  onget=\\\"return this.inputField.readOnly;\\\"/>\\n+\\n       <method name=\\\"select\\\">\\n         <body>\\n           this.inputField.select();\\n\""}