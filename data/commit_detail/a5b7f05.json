{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basa5b7f05\""},"diff":"\"a5b7f05 Fixing bug 384796, Call to |nsIStringBundleOverride| always beats the embedding calls. r=mento, sr=roc, 1.9approval=dsicore. Trunk only.\\ndiff --git a/intl/strres/src/nsStringBundle.cpp b/intl/strres/src/nsStringBundle.cpp\\nindex 13da097..21c3d04 100644\\n--- a/intl/strres/src/nsStringBundle.cpp\\n+++ b/intl/strres/src/nsStringBundle.cpp\\n@@ -584,6 +584,7 @@ nsStringBundleService::Init()\\n     os->AddObserver(this, \\\"memory-pressure\\\", PR_TRUE);\\n     os->AddObserver(this, \\\"profile-do-change\\\", PR_TRUE);\\n     os->AddObserver(this, \\\"chrome-flush-caches\\\", PR_TRUE);\\n+    os->AddObserver(this, \\\"xpcom-category-entry-added\\\", PR_TRUE);\\n   }\\n \\n   // instantiate the override service, if there is any.\\n@@ -602,7 +603,15 @@ nsStringBundleService::Observe(nsISupports* aSubject,\\n   if (strcmp(\\\"memory-pressure\\\", aTopic) == 0 ||\\n       strcmp(\\\"profile-do-change\\\", aTopic) == 0 ||\\n       strcmp(\\\"chrome-flush-caches\\\", aTopic) == 0)\\n+  {\\n     flushBundleCache();\\n+  }\\n+  else if (strcmp(\\\"xpcom-category-entry-added\\\", aTopic) == 0 &&\\n+           NS_LITERAL_STRING(\\\"xpcom-autoregistration\\\").Equals(aSomeData)) \\n+  {\\n+    mOverrideStrings = do_GetService(NS_STRINGBUNDLETEXTOVERRIDE_CONTRACTID);\\n+  }\\n+  \\n   return NS_OK;\\n }\\n \\n\""}