{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas78ec4f0\""},"diff":"\"78ec4f0 Checking in patch for bug 248612 again, this causes 10% argo Ts regression, but other tinderboxes are not affected, see discussion in bug 248612\\ndiff --git a/browser/base/content/tabbrowser.xml b/browser/base/content/tabbrowser.xml\\nindex c381d49..45b7634 100644\\n--- a/browser/base/content/tabbrowser.xml\\n+++ b/browser/base/content/tabbrowser.xml\\n@@ -180,9 +180,6 @@\\n       <field name=\\\"mContextTab\\\">\\n         null\\n       </field>\\n-      <field name=\\\"mModalDialogShowing\\\">\\n-        false\\n-      </field>\\n       <field name=\\\"arrowKeysShouldWrap\\\" readonly=\\\"true\\\">\\n #ifdef XP_MACOSX\\n         true\\n@@ -1699,6 +1696,8 @@\\n         </body>\\n       </method>\\n \\n+      <field name=\\\"mDragTime\\\">0</field>\\n+      <field name=\\\"mDragOverDelay\\\">350</field>\\n       <method name=\\\"onDragOver\\\">\\n         <parameter name=\\\"aEvent\\\"/>\\n         <parameter name=\\\"aFlavour\\\"/>\\n@@ -1726,8 +1725,13 @@\\n               }\\n \\n               var isTabDrag = (aDragSession.sourceNode.parentNode == this.mTabContainer);\\n-              if (!isTabDrag)\\n+              if (!isTabDrag && aEvent.target.localName == \\\"tab\\\") {\\n+                if (!this.mDragTime) \\n+                  this.mDragTime = Date.now();\\n+                if (Date.now() >= this.mDragTime + this.mDragOverDelay)\\n+                  this.mTabContainer.selectedItem = aEvent.target;\\n                 return;\\n+              }\\n \\n               var newIndex = this.getNewIndex(aEvent);\\n \\n@@ -1886,6 +1890,8 @@\\n         <parameter name=\\\"aDragSession\\\"/>\\n         <body>\\n           <![CDATA[\\n+            this.mDragTime = 0;\\n+\\n             if (aDragSession.sourceNode &&\\n                 aDragSession.sourceNode.parentNode == this.mTabContainer &&\\n                 aDragSession.canDrop) {\\n@@ -2382,9 +2388,6 @@\\n                 onget=\\\"return this.mCurrentBrowser.userTypedValue;\\\"\\n                 onset=\\\"return this.mCurrentBrowser.userTypedValue = val;\\\"/>\\n \\n-      <property name=\\\"forceSyncURLBarUpdate\\\"\\n-                onget=\\\"return this.mModalDialogShowing;\\\"/>\\n-\\n       <method name=\\\"createTooltip\\\">\\n         <parameter name=\\\"event\\\"/>\\n         <body>\\n@@ -2478,7 +2481,6 @@\\n \\n           for (var i = 0; i < browsers.length; ++i) {\\n             if (this.getBrowserAtIndex(i).contentWindow == targetTop) {\\n-              this.mModalDialogShowing = true;\\n               this.selectedTab = this.mTabContainer.childNodes[i];\\n \\n               break;\\n@@ -2486,14 +2488,6 @@\\n           }\\n         ]]>\\n       </handler>\\n-      <handler event=\\\"DOMModalDialogClosed\\\" phase=\\\"capturing\\\">\\n-        <![CDATA[\\n-          if (!event.isTrusted)\\n-            return;\\n-\\n-          this.mModalDialogShowing = false;\\n-        ]]>\\n-      </handler>\\n     </handlers>\\n   </binding>\\n \\n\""}