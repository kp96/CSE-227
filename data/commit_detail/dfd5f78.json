{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basdfd5f78\""},"diff":"\"dfd5f78 Bug 268590, add notification widget, r=mconnor\\ndiff --git a/browser/base/content/tabbrowser.xml b/browser/base/content/tabbrowser.xml\\nindex 89c5b3c..62c54c5 100644\\n--- a/browser/base/content/tabbrowser.xml\\n+++ b/browser/base/content/tabbrowser.xml\\n@@ -111,11 +111,10 @@\\n           </xul:tabs>\\n         </xul:hbox>\\n         <xul:tabpanels flex=\\\"1\\\" class=\\\"plain\\\" selectedIndex=\\\"0\\\" anonid=\\\"panelcontainer\\\">\\n-          <xul:vbox flex=\\\"1\\\">\\n-            <xul:browsermessage hidden=\\\"true\\\" type=\\\"top\\\"/>\\n-            <xul:browser flex=\\\"1\\\" type=\\\"content-primary\\\" message=\\\"true\\\" disablehistory=\\\"true\\\" xbl:inherits=\\\"tooltip=contenttooltip,contextmenu=contentcontextmenu,autocompletepopup\\\"/>\\n-            <xul:browsermessage hidden=\\\"true\\\" type=\\\"bottom\\\"/>\\n-          </xul:vbox>\\n+          <xul:notificationbox flex=\\\"1\\\">\\n+            <xul:browser flex=\\\"1\\\" type=\\\"content-primary\\\" message=\\\"true\\\" disablehistory=\\\"true\\\"\\n+                         xbl:inherits=\\\"tooltip=contenttooltip,contextmenu=contentcontextmenu,autocompletepopup\\\"/>\\n+          </xul:notificationbox>\\n         </xul:tabpanels>\\n       </xul:tabbox>\\n       <children/>\\n@@ -215,68 +214,15 @@\\n         </body>\\n       </method>\\n \\n-      <method name=\\\"getMessageForBrowser\\\">\\n+      <method name=\\\"getNotificationBox\\\">\\n         <parameter name=\\\"aBrowser\\\"/>\\n-        <parameter name=\\\"aTopBottom\\\"/>\\n         <body>\\n           <![CDATA[\\n-            return aBrowser[aTopBottom == \\\"top\\\" ? \\\"previousSibling\\\" : \\\"nextSibling\\\"];\\n-          ]]>\\n-        </body>\\n-      </method>\\n-\\n-      <method name=\\\"showMessage\\\">\\n-        <parameter name=\\\"aBrowser\\\"/>\\n-        <parameter name=\\\"aIconURL\\\"/>\\n-        <parameter name=\\\"aMessage\\\"/>\\n-        <parameter name=\\\"aButtonLabel\\\"/>\\n-        <parameter name=\\\"aDocShell\\\"/>\\n-        <parameter name=\\\"aSource\\\"/>\\n-        <parameter name=\\\"aPopup\\\"/>\\n-        <parameter name=\\\"aTopBottom\\\"/>\\n-        <parameter name=\\\"aShowCloseButton\\\"/>\\n-        <parameter name=\\\"aButtonAccesskey\\\"/>\\n-        <body>\\n-          <![CDATA[\\n-            var message = this.getMessageForBrowser(aBrowser, aTopBottom);\\n-            message.image = aIconURL;\\n-            message.text = aMessage;\\n-            message.buttonText = aButtonLabel;\\n-            message.buttonAccesskey =\\n-              typeof(aButtonAccesskey) == \\\"undefined\\\" ? \\\"\\\"\\n-                : aButtonAccesskey;\\n-            message.hidden = false;\\n-            if (aSource) {\\n-              message.source = aSource;\\n-              message.popup = null;\\n-            }\\n-            else if (aPopup) {\\n-              message.popup = aPopup;\\n-              message.source = null;\\n-            }\\n-            message.docShell = aDocShell;\\n-            message.closeButton = aShowCloseButton;\\n-            aBrowser.isShowingMessage = true;\\n-            // Fire event for accessibility APIs\\n-            var event = document.createEvent(\\\"Events\\\");\\n-            event.initEvent(\\\"AlertActive\\\", true, true);\\n-            message.dispatchEvent(event);\\n-          ]]>\\n-        </body>\\n-      </method>\\n-\\n-      <method name=\\\"hideMessage\\\">\\n-        <parameter name=\\\"aBrowser\\\"/>\\n-        <parameter name=\\\"aTopBottom\\\"/>\\n-        <body>\\n-          <![CDATA[\\n-            var browser = aBrowser || this.mCurrentBrowser;\\n-            if (aTopBottom != \\\"both\\\")\\n-              this.getMessageForBrowser(browser, aTopBottom).hidden = true;\\n-            else {\\n-              this.getMessageForBrowser(browser, \\\"top\\\").hidden = true;\\n-              this.getMessageForBrowser(browser, \\\"bottom\\\").hidden = true;\\n-            }\\n+            if (aBrowser)\\n+              return aBrowser.parentNode;\\n+            else if (this.mCurrentBrowser)\\n+              return this.mCurrentBrowser.parentNode;\\n+            return null;\\n           ]]>\\n         </body>\\n       </method>\\n@@ -897,7 +843,7 @@\\n \\n             var i = 0;\\n             for ( ; i < this.parentNode.parentNode.childNodes.length; i++) {\\n-              if (this.parentNode.parentNode.childNodes[i].firstChild.nextSibling == this)\\n+              if (this.parentNode.parentNode.childNodes[i].firstChild == this)\\n                 break;\\n             }\\n \\n@@ -1037,19 +983,6 @@\\n         </body>\\n       </method>\\n \\n-      <method name=\\\"_createMessage\\\">\\n-        <parameter name=\\\"aType\\\"/>\\n-        <body>\\n-          <![CDATA[\\n-            var message = document.createElementNS(\\\"http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul\\\",\\n-                                                   \\\"browsermessage\\\");\\n-            message.hidden = true;\\n-            message.setAttribute(\\\"type\\\", aType);\\n-            return message;\\n-          ]]>\\n-        </body>\\n-      </method>\\n-\\n       <method name=\\\"loadOneTab\\\">\\n         <parameter name=\\\"aURI\\\"/>\\n         <parameter name=\\\"aReferrerURI\\\"/>\\n@@ -1172,14 +1105,13 @@\\n               b.setAttribute(\\\"autocompletepopup\\\", this.getAttribute(\\\"autocompletepopup\\\"));\\n \\n             // Add the Message and the Browser to the box\\n-            var vbox = document.createElementNS(\\\"http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul\\\",\\n-                                                \\\"vbox\\\");\\n-            vbox.setAttribute(\\\"flex\\\", \\\"1\\\");\\n-            vbox.appendChild(this._createMessage(\\\"top\\\"));\\n-            vbox.appendChild(b);\\n-            vbox.appendChild(this._createMessage(\\\"bottom\\\"));\\n+            var notificationbox = document.createElementNS(\\n+                                    \\\"http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul\\\",\\n+                                    \\\"notificationbox\\\");\\n+            notificationbox.setAttribute(\\\"flex\\\", \\\"1\\\");\\n+            notificationbox.appendChild(b);\\n             b.setAttribute(\\\"flex\\\", \\\"1\\\");\\n-            this.mPanelContainer.appendChild(vbox);\\n+            this.mPanelContainer.appendChild(notificationbox);\\n \\n             b.addEventListener(\\\"DOMTitleChanged\\\", this.onTitleChanged, false);\\n \\n@@ -2213,7 +2145,7 @@\\n \\n       <constructor>\\n         <![CDATA[\\n-          this.mCurrentBrowser = this.mPanelContainer.childNodes[0].firstChild.nextSibling;\\n+          this.mCurrentBrowser = this.mPanelContainer.childNodes[0].firstChild;\\n           this.mCurrentTab = this.mTabContainer.firstChild;\\n           document.addEventListener(\\\"keypress\\\", this._keyEventHandler, false);\\n \\n@@ -2221,7 +2153,7 @@\\n           this.mPanelContainer.childNodes[0].id = uniqueId;\\n           this.mTabContainer.childNodes[0].linkedPanel = uniqueId;\\n           this.mTabContainer.childNodes[0]._tPos = 0;\\n-          this.mTabContainer.childNodes[0].linkedBrowser = this.mPanelContainer.childNodes[0].firstChild.nextSibling;\\n+          this.mTabContainer.childNodes[0].linkedBrowser = this.mPanelContainer.childNodes[0].firstChild;\\n         ]]>\\n       </constructor>\\n \\n\""}