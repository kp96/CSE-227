{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas22f6392e\""},"diff":"\"22f6392e Landing fix for bug 394418. Notify on text changes before firing mutation events. Patch by bzbarsky@mit.edu, r+sr=jonas@sicking.cc, a=jst@mozilla.org/dsicore@mozilla.com\\ndiff --git a/content/base/src/nsGenericDOMDataNode.cpp b/content/base/src/nsGenericDOMDataNode.cpp\\nindex 5c8c04e..884bd15 100644\\n--- a/content/base/src/nsGenericDOMDataNode.cpp\\n+++ b/content/base/src/nsGenericDOMDataNode.cpp\\n@@ -470,6 +470,14 @@ nsGenericDOMDataNode::SetTextInternal(PRUint32 aOffset, PRUint32 aCount,\\n \\n   // Notify observers\\n   if (aNotify) {\\n+    CharacterDataChangeInfo info = {\\n+      aOffset == textLength,\\n+      aOffset,\\n+      endOffset,\\n+      aLength\\n+    };\\n+    nsNodeUtils::CharacterDataChanged(this, &info);\\n+\\n     if (haveMutationListeners) {\\n       nsMutationEvent mutation(PR_TRUE, NS_MUTATION_CHARACTERDATAMODIFIED);\\n \\n@@ -483,14 +491,6 @@ nsGenericDOMDataNode::SetTextInternal(PRUint32 aOffset, PRUint32 aCount,\\n       mozAutoSubtreeModified subtree(GetOwnerDoc(), this);\\n       nsEventDispatcher::Dispatch(this, nsnull, &mutation);\\n     }\\n-\\n-    CharacterDataChangeInfo info = {\\n-      aOffset == textLength,\\n-      aOffset,\\n-      endOffset,\\n-      aLength\\n-    };\\n-    nsNodeUtils::CharacterDataChanged(this, &info);\\n   }\\n \\n   return NS_OK;\\n\""}