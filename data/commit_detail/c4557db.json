{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basc4557db\""},"diff":"\"c4557db Bug 391123 - Crash [@ nsHTMLComboboxListAccessible::GetState] with moving option and setting display: none on select r=aaronleventhal a=dsicore\\ndiff --git a/accessible/src/html/nsHTMLSelectAccessible.cpp b/accessible/src/html/nsHTMLSelectAccessible.cpp\\nindex de8b061..e4edaa1 100644\\n--- a/accessible/src/html/nsHTMLSelectAccessible.cpp\\n+++ b/accessible/src/html/nsHTMLSelectAccessible.cpp\\n@@ -1034,7 +1034,9 @@ nsHTMLComboboxAccessible::GetState(PRUint32 *aState, PRUint32 *aExtraState)\\n \\n   nsIFrame *frame = GetBoundsFrame();\\n   nsIComboboxControlFrame *comboFrame = nsnull;\\n-  frame->QueryInterface(NS_GET_IID(nsIComboboxControlFrame), (void**)&comboFrame);\\n+  if (frame) {\\n+    frame->QueryInterface(NS_GET_IID(nsIComboboxControlFrame), (void**)&comboFrame);\\n+  }\\n \\n   if (comboFrame && comboFrame->IsDroppedDown()) {\\n     *aState |= nsIAccessibleStates::STATE_EXPANDED;\\n@@ -1339,6 +1341,7 @@ NS_IMETHODIMP nsHTMLComboboxButtonAccessible::GetName(nsAString& aName)\\n   *     STATE_PRESSED\\n   *     STATE_FOCUSED\\n   *     STATE_FOCUSABLE\\n+  *     STATE_INVISIBLE\\n   */\\n NS_IMETHODIMP\\n nsHTMLComboboxButtonAccessible::GetState(PRUint32 *aState, PRUint32 *aExtraState)\\n@@ -1348,16 +1351,20 @@ nsHTMLComboboxButtonAccessible::GetState(PRUint32 *aState, PRUint32 *aExtraState\\n   NS_ENSURE_SUCCESS(rv, rv);\\n \\n   nsIFrame *boundsFrame = GetBoundsFrame();\\n-  nsIComboboxControlFrame* comboFrame;\\n-  boundsFrame->QueryInterface(NS_GET_IID(nsIComboboxControlFrame), (void**)&comboFrame);\\n-  if (!comboFrame)\\n-    return NS_ERROR_FAILURE;\\n-\\n-  if (comboFrame->IsDroppedDown())\\n-    *aState |= nsIAccessibleStates::STATE_PRESSED;\\n-\\n-  *aState |= nsIAccessibleStates::STATE_FOCUSABLE;\\n+  nsIComboboxControlFrame* comboFrame = nsnull;\\n+  if (boundsFrame)\\n+    boundsFrame->QueryInterface(NS_GET_IID(nsIComboboxControlFrame), (void**)&comboFrame);\\n \\n+  if (!comboFrame) {\\n+    *aState |= nsIAccessibleStates::STATE_INVISIBLE;\\n+  }\\n+  else {\\n+    *aState |= nsIAccessibleStates::STATE_FOCUSABLE;\\n+    if (comboFrame->IsDroppedDown()) {\\n+      *aState |= nsIAccessibleStates::STATE_PRESSED;\\n+    }\\n+  }\\n+ \\n   return NS_OK;\\n }\\n #endif\\n@@ -1402,7 +1409,8 @@ nsHTMLComboboxListAccessible::GetState(PRUint32 *aState, PRUint32 *aExtraState)\\n \\n   nsIFrame *boundsFrame = GetBoundsFrame();\\n   nsIComboboxControlFrame* comboFrame = nsnull;\\n-  boundsFrame->QueryInterface(NS_GET_IID(nsIComboboxControlFrame), (void**)&comboFrame);\\n+  if (boundsFrame)\\n+    boundsFrame->QueryInterface(NS_GET_IID(nsIComboboxControlFrame), (void**)&comboFrame);\\n \\n   if (comboFrame && comboFrame->IsDroppedDown())\\n     *aState |= nsIAccessibleStates::STATE_FLOATING;\\n\""}