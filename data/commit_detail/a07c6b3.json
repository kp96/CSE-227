{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basa07c6b3\""},"diff":"\"a07c6b3 Bug 394700, update selectedIndex when mutation event listener modifies option list, r+sr+a=sicking\\ndiff --git a/content/html/content/src/nsHTMLSelectElement.cpp b/content/html/content/src/nsHTMLSelectElement.cpp\\nindex 1645757..56de0ea 100644\\n--- a/content/html/content/src/nsHTMLSelectElement.cpp\\n+++ b/content/html/content/src/nsHTMLSelectElement.cpp\\n@@ -1769,6 +1769,7 @@ nsHTMLSelectElement::RebuildOptionsArray()\\n {\\n   mOptions->Clear();\\n   AddOptionsRecurse(this, mOptions);\\n+  FindSelectedIndex(0);\\n }\\n \\n #ifdef DEBUG\\ndiff --git a/content/html/content/test/Makefile.in b/content/html/content/test/Makefile.in\\nindex 47f8be6..6c19dce 100644\\n--- a/content/html/content/test/Makefile.in\\n+++ b/content/html/content/test/Makefile.in\\n@@ -96,6 +96,7 @@ _TEST_FILES = \\ttest_bug589.html \\\\\\n \\t\\ttest_bug388746.html \\\\\\n \\t\\ttest_bug389797.html \\\\\\n \\t\\ttest_bug391994.html \\\\\\n+\\t\\ttest_bug394700.html \\\\\\n \\t\\t$(NULL)\\n \\n libs:: $(_TEST_FILES)\\ndiff --git a/content/html/content/test/test_bug394700.html b/content/html/content/test/test_bug394700.html\\nnew file mode 100644\\nindex 0000000..af87b97\\n--- /dev/null\\n+++ b/content/html/content/test/test_bug394700.html\\n@@ -0,0 +1,50 @@\\n+<!DOCTYPE HTML>\\n+<html>\\n+<!--\\n+https://bugzilla.mozilla.org/show_bug.cgi?id=394700\\n+-->\\n+<head>\\n+  <title>Test for Bug 394700</title>\\n+  <script type=\\\"text/javascript\\\" src=\\\"/MochiKit/MochiKit.js\\\"></script>\\n+  <script type=\\\"text/javascript\\\" src=\\\"/tests/SimpleTest/SimpleTest.js\\\"></script>\\n+  <link rel=\\\"stylesheet\\\" type=\\\"text/css\\\" href=\\\"/tests/SimpleTest/test.css\\\" />\\n+</head>\\n+<body>\\n+<a target=\\\"_blank\\\" href=\\\"https://bugzilla.mozilla.org/show_bug.cgi?id=394700\\\">Mozilla Bug 394700</a>\\n+<p id=\\\"display\\\"></p>\\n+<div id=\\\"content\\\">\\n+  <select><option id=\\\"A\\\">A</option><option id=\\\"B\\\">B</option></select>\\n+</div>\\n+<pre id=\\\"test\\\">\\n+<script class=\\\"testbody\\\" type=\\\"text/javascript\\\">\\n+\\n+/** Test for Bug 394700 **/\\n+\\n+function remove(q1) { q1.parentNode.removeChild(q1); }\\n+\\n+function testSelectedIndex()\\n+{\\n+  document.addEventListener(\\\"DOMNodeRemoved\\\", foo, false);\\n+  remove(document.getElementById(\\\"B\\\"));\\n+  document.removeEventListener(\\\"DOMNodeRemoved\\\", foo, false);\\n+\\n+  function foo()\\n+  {\\n+    document.removeEventListener(\\\"DOMNodeRemoved\\\", foo, false);\\n+    remove(document.getElementById(\\\"A\\\"));\\n+  }\\n+  var selectElement = document.getElementsByTagName(\\\"select\\\")[0];\\n+  ok(selectElement.selectedIndex == -1, \\\"Wrong selected index!\\\");\\n+  ok(selectElement.length == 0, \\\"Select shouldn't have any options!\\\")\\n+}\\n+\\n+SimpleTest.waitForExplicitFinish();\\n+addLoadEvent(testSelectedIndex);\\n+addLoadEvent(SimpleTest.finish);\\n+\\n+\\n+</script>\\n+</pre>\\n+</body>\\n+</html>\\n+\\n\""}