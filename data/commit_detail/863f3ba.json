{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas863f3ba\""},"diff":"\"863f3ba [OS/2] Bug 394837: saving files doesn't work when WPS not active, r=mkaply\\ndiff --git a/xpcom/io/SpecialSystemDirectory.cpp b/xpcom/io/SpecialSystemDirectory.cpp\\nindex 5fdd940..693ed67 100644\\n--- a/xpcom/io/SpecialSystemDirectory.cpp\\n+++ b/xpcom/io/SpecialSystemDirectory.cpp\\n@@ -676,6 +676,11 @@ GetSpecialSystemDirectory(SystemDirectories aSystemSystemDirectory,\\n             char szPath[CCHMAXPATH + 1];        \\n             BOOL fSuccess;\\n             fSuccess = WinQueryActiveDesktopPathname (szPath, sizeof(szPath));\\n+            if (!fSuccess) {\\n+                // this could happen if we are running without the WPS, return\\n+                // the Home directory instead\\n+                return GetSpecialSystemDirectory(OS2_HomeDirectory, aFile);\\n+            }\\n             int len = strlen (szPath);   \\n             if (len > CCHMAXPATH -1)\\n                 break;\\n\""}