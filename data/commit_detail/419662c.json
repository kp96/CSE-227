{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas419662c\""},"diff":"\"419662c Bug 391385 - Split PopupAutoComplete in three: UrlbarAutoComplete, SearchAutoComplete and ContentAutoComplete, patch by Simon BÃ¼nzli <zeniko@gmail.com>, r=gavin\\ndiff --git a/browser/base/content/browser.css b/browser/base/content/browser.css\\nindex bdb10ae..ddf022a 100644\\n--- a/browser/base/content/browser.css\\n+++ b/browser/base/content/browser.css\\n@@ -1,13 +1,18 @@\\n+/* ::::: search bar ::::: */\\n searchbar {\\n   -moz-binding: url(\\\"chrome://browser/content/search/search.xml#searchbar\\\");\\n }\\n \\n+#SearchAutoComplete {\\n+  -moz-binding: url(\\\"chrome://browser/content/search/search.xml#searchbar-result-popup\\\");\\n+}\\n+\\n /* ::::: location bar ::::: */\\n #urlbar {\\n   -moz-binding: url(chrome://browser/content/urlbarBindings.xml#urlbar);\\n }\\n \\n-#PopupAutoComplete {\\n+#UrlbarAutoComplete {\\n   -moz-binding: url(\\\"chrome://browser/content/urlbarBindings.xml#urlbar-result-popup\\\");\\n }\\n \\ndiff --git a/browser/base/content/browser.xul b/browser/base/content/browser.xul\\nindex 753fb91..5b144e8 100644\\n--- a/browser/base/content/browser.xul\\n+++ b/browser/base/content/browser.xul\\n@@ -98,7 +98,9 @@\\n            onclick=\\\"checkForMiddleClick(this, event);\\\"/>\\n     <tooltip id=\\\"aHTMLTooltip\\\" onpopupshowing=\\\"return FillInHTMLTooltip(document.tooltipNode);\\\"/>\\n \\n-    <panel type=\\\"autocomplete\\\" chromedir=\\\"&locale.dir;\\\" id=\\\"PopupAutoComplete\\\" noautofocus=\\\"true\\\"/>\\n+    <panel type=\\\"autocomplete\\\" chromedir=\\\"&locale.dir;\\\" id=\\\"UrlbarAutoComplete\\\" noautofocus=\\\"true\\\"/>\\n+    <panel type=\\\"autocomplete\\\" chromedir=\\\"&locale.dir;\\\" id=\\\"SearchAutoComplete\\\" noautofocus=\\\"true\\\"/>\\n+    <panel type=\\\"autocomplete\\\" chromedir=\\\"&locale.dir;\\\" id=\\\"ContentAutoComplete\\\" noautofocus=\\\"true\\\"/>\\n \\n     <panel id=\\\"editBookmarkPanel\\\" orient=\\\"vertical\\\">\\n       <vbox id=\\\"editBookmarkPanelContent\\\" flex=\\\"1\\\"/>\\n@@ -220,7 +222,7 @@\\n                      chromedir=\\\"&locale.dir;\\\"\\n                      type=\\\"autocomplete\\\"\\n                      autocompletesearch=\\\"history\\\" \\n-                     autocompletepopup=\\\"PopupAutoComplete\\\"\\n+                     autocompletepopup=\\\"UrlbarAutoComplete\\\"\\n                      completeselectedindex=\\\"true\\\"\\n                      tabscrolling=\\\"true\\\"\\n                      showcommentcolumn=\\\"true\\\"\\n@@ -300,7 +302,8 @@\\n       <toolbaritem id=\\\"search-container\\\" title=\\\"&searchItem.title;\\\" \\n                    align=\\\"center\\\" class=\\\"chromeclass-toolbar-additional\\\"\\n                    flex=\\\"100\\\" persist=\\\"width\\\">\\n-        <searchbar id=\\\"searchbar\\\" flex=\\\"1\\\" chromedir=\\\"&locale.dir;\\\"/>\\n+        <searchbar id=\\\"searchbar\\\" flex=\\\"1\\\" chromedir=\\\"&locale.dir;\\\"\\n+                   autocompletepopup=\\\"SearchAutoComplete\\\"/>\\n       </toolbaritem>\\n \\n       <toolbarbutton id=\\\"print-button\\\" class=\\\"toolbarbutton-1 chromeclass-toolbar-additional\\\"\\n@@ -430,7 +433,7 @@\\n                     flex=\\\"1\\\" contenttooltip=\\\"aHTMLTooltip\\\"\\n                     contentcontextmenu=\\\"contentAreaContextMenu\\\"\\n                     onnewtab=\\\"BrowserOpenTab();\\\"\\n-                    autocompletepopup=\\\"PopupAutoComplete\\\"\\n+                    autocompletepopup=\\\"ContentAutoComplete\\\"\\n                     ondragdrop=\\\"nsDragAndDrop.drop(event, contentAreaDNDObserver);\\\"\\n                     onclick=\\\"return contentAreaClick(event, false);\\\"/>\\n       </vbox>\\ndiff --git a/browser/base/content/urlbarBindings.xml b/browser/base/content/urlbarBindings.xml\\nindex 2958278..8e6215c 100644\\n--- a/browser/base/content/urlbarBindings.xml\\n+++ b/browser/base/content/urlbarBindings.xml\\n@@ -504,7 +504,8 @@\\n \\n   </binding>\\n \\n-  <binding id=\\\"urlbar-result-popup\\\" extends=\\\"chrome://global/content/bindings/autocomplete.xml#autocomplete-result-popup\\\">\\n+  <binding id=\\\"urlbar-result-popup\\\"\\n+           extends=\\\"chrome://global/content/bindings/autocomplete.xml#autocomplete-result-popup\\\">\\n     <implementation>\\n       <method name=\\\"onPopupClick\\\">\\n         <parameter name=\\\"aEvent\\\"/>\\ndiff --git a/browser/components/search/content/search.xml b/browser/components/search/content/search.xml\\nindex 2d28fdc..e28afa7 100644\\n--- a/browser/components/search/content/search.xml\\n+++ b/browser/components/search/content/search.xml\\n@@ -90,7 +90,6 @@\\n                        anonid=\\\"searchbar-textbox\\\"\\n                        type=\\\"autocomplete\\\"\\n                        flex=\\\"1\\\"\\n-                       autocompletepopup=\\\"PopupAutoComplete\\\"\\n                        autocompletesearch=\\\"search-autocomplete\\\"\\n                        autocompletesearchparam=\\\"searchbar-history\\\"\\n                        timeout=\\\"250\\\"\\n@@ -98,7 +97,7 @@\\n                        completeselectedindex=\\\"true\\\"\\n                        showcommentcolumn=\\\"true\\\"\\n                        tabscrolling=\\\"true\\\"\\n-                       xbl:inherits=\\\"disabled,disableautocomplete,searchengine,src\\\">\\n+                       xbl:inherits=\\\"disabled,disableautocomplete,autocompletepopup,searchengine,src\\\">\\n           </xul:textbox>\\n         </xul:hbox>\\n \\n@@ -839,4 +838,35 @@\\n       <children/>\\n     </content>\\n   </binding>\\n+\\n+  <binding id=\\\"searchbar-result-popup\\\"\\n+           extends=\\\"chrome://global/content/bindings/autocomplete.xml#autocomplete-result-popup\\\">\\n+    <implementation>\\n+      <method name=\\\"onPopupClick\\\">\\n+        <parameter name=\\\"aEvent\\\"/>\\n+        <body><![CDATA[\\n+          var controller = this.view.QueryInterface(Components.interfaces.nsIAutoCompleteController);\\n+\\n+          // default action on unmodified left-click\\n+          if (aEvent.button == 0 && !aEvent.shiftKey && !aEvent.ctrlKey &&\\n+              !aEvent.altKey && !aEvent.metaKey) {\\n+            controller.handleEnter();\\n+          }\\n+          // completely ignore right-clicks\\n+          else if (aEvent.button != 2) {\\n+            // handle search bar click\\n+            var search = controller.getValueAt(this.tree.view.selection.currentIndex);\\n+            var textbox = this.mInput;\\n+\\n+            // close the autocomplete popup and copy the selected value to the search box\\n+            this.closePopup();\\n+            textbox.value = search;\\n+            // open the search results according to the clicking subtlety\\n+            var where = whereToOpenLink(aEvent, false, true);\\n+            textbox._getParentSearchbar().doSearch(search, where);\\n+          }\\n+        ]]></body>\\n+      </method>\\n+    </implementation>\\n+  </binding>\\n </bindings>\\ndiff --git a/browser/themes/winstripe/browser/browser.css b/browser/themes/winstripe/browser/browser.css\\nindex 2ca9a55..3db6020 100644\\n--- a/browser/themes/winstripe/browser/browser.css\\n+++ b/browser/themes/winstripe/browser/browser.css\\n@@ -914,15 +914,15 @@ toolbar[iconsize=\\\"small\\\"] #paste-button:not([disabled=\\\"true\\\"]):hover:active {\\n   direction: ltr;\\n }\\n \\n-#PopupAutoComplete {\\n+#UrlbarAutoComplete {\\n   direction: ltr !important;\\n }\\n \\n-#PopupAutoComplete[chromedir=\\\"rtl\\\"] > tree > treerows {\\n+#UrlbarAutoComplete[chromedir=\\\"rtl\\\"] > tree > treerows {\\n   direction: rtl;\\n }\\n \\n-#PopupAutoComplete .autocomplete-treebody {\\n+#UrlbarAutoComplete .autocomplete-treebody {\\n   direction: ltr;\\n }\\n \\n\""}