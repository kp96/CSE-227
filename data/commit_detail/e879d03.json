{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Base879d03\""},"diff":"\"e879d03 Bug 337344: Disable location bar hiding by default, to make chrome spoofing harder. p=Johnathan Nightingale <johnath@mozilla.com>, r=mconnor\\ndiff --git a/browser/app/profile/firefox.js b/browser/app/profile/firefox.js\\nindex 0147721..41e2530 100644\\n--- a/browser/app/profile/firefox.js\\n+++ b/browser/app/profile/firefox.js\\n@@ -305,9 +305,10 @@ pref(\\\"javascript.options.showInConsole\\\",          false);\\n pref(\\\"dom.disable_window_open_feature.status\\\",    true);\\n // This is the pref to control the location bar, change this to true to \\n // force this instead of or in addition to the status bar - this makes \\n-// the origin of popup windows more obvious to avoid spoofing but we \\n-// cannot do it by default because it affects UE for web applications.\\n-pref(\\\"dom.disable_window_open_feature.location\\\",  false);\\n+// the origin of popup windows more obvious to avoid spoofing. We would \\n+// rather not do it by default because it affects UE for web applications, but\\n+// without it there isn't a really good way to prevent chrome spoofing, see bug 337344\\n+pref(\\\"dom.disable_window_open_feature.location\\\",  true);\\n pref(\\\"dom.disable_window_status_change\\\",          true);\\n // allow JS to move and resize existing windows\\n pref(\\\"dom.disable_window_move_resize\\\",            false);\\ndiff --git a/browser/components/nsBrowserContentHandler.js b/browser/components/nsBrowserContentHandler.js\\nindex 38c8b36..3cc8bea 100644\\n--- a/browser/components/nsBrowserContentHandler.js\\n+++ b/browser/components/nsBrowserContentHandler.js\\n@@ -221,12 +221,12 @@ function getMostRecentBrowserWindow() {\\n   var win = wm.getMostRecentWindow(\\\"navigator:browser\\\", true);\\n \\n   // if we're lucky, this isn't a popup, and we can just return this\\n-  if (win && !win.toolbar.visible) {\\n+  if (win && win.document.documentElement.getAttribute(\\\"chromehidden\\\")) {\\n     var windowList = wm.getEnumerator(\\\"navigator:browser\\\", true);\\n     // this is oldest to newest, so this gets a bit ugly\\n     while (windowList.hasMoreElements()) {\\n       var nextWin = windowList.getNext();\\n-      if (nextWin.toolbar.visible)\\n+      if (!nextWin.document.documentElement.getAttribute(\\\"chromehidden\\\"))\\n         win = nextWin;\\n     }\\n   }\\n@@ -236,7 +236,7 @@ function getMostRecentBrowserWindow() {\\n     return null;\\n \\n   var win = windowList.getNext();\\n-  while (!win.toolbar.visible) {\\n+  while (win.document.documentElement.getAttribute(\\\"chromehidden\\\")) {\\n     if (!windowList.hasMoreElements()) \\n       return null;\\n \\n\""}