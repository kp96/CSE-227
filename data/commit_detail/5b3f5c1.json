{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas5b3f5c1\""},"diff":"\"5b3f5c1 Bug 393524 - XPCOMUtilify nsTryToClose. r=benjamin\\ndiff --git a/toolkit/components/startup/src/nsTryToClose.js b/toolkit/components/startup/src/nsTryToClose.js\\nindex 0d68b86..f5ad0ee 100644\\n--- a/toolkit/components/startup/src/nsTryToClose.js\\n+++ b/toolkit/components/startup/src/nsTryToClose.js\\n@@ -39,12 +39,9 @@ const Cc = Components.classes;\\n const Ci = Components.interfaces;\\n const Cr = Components.results;\\n \\n-const CID = Components.ID(\\\"{b69155f4-a8bf-453d-8653-91d1456e1d3d}\\\");\\n-const CONTRACT_ID = \\\"@mozilla.org/appshell/trytoclose;1\\\"\\n-const CLASS_NAME = \\\"tryToClose Service\\\";\\n+Components.utils.import(\\\"resource://gre/modules/XPCOMUtils.jsm\\\");\\n \\n-function TryToClose() {\\n-}\\n+function TryToClose() {}\\n \\n TryToClose.prototype = {\\n   observe: function (aSubject, aTopic, aData) {\\n@@ -70,56 +67,14 @@ TryToClose.prototype = {\\n     }\\n   },\\n \\n-  QueryInterface: function(aIID) {\\n-    if (!aIID.equals(Ci.nsIObserver) &&\\n-        !aIID.equals(Ci.nsISupportsWeakReference) && \\n-        !aIID.equals(Ci.nsISupports))\\n-      throw Cr.NS_ERROR_NO_INTERFACE;\\n-    return this;\\n-  }\\n-};\\n-\\n-const TryToCloseFactory = {\\n-  createInstance: function(aOuter, aIID) {\\n-    if (aOuter != null)\\n-      throw Cr.NS_ERROR_NO_AGGREGATION;\\n-    \\n-    return (new TryToClose()).QueryInterface(aIID);\\n-  }\\n-};\\n-\\n-const TryToCloseModule = {\\n-  registerSelf: function(aCompMgr, aFileSpec, aLocation, aType) {\\n-    aCompMgr.QueryInterface(Ci.nsIComponentRegistrar);\\n-    aCompMgr.registerFactoryLocation(CID, CLASS_NAME, CONTRACT_ID,\\n-                                     aFileSpec, aLocation, aType);\\n-\\n-    var catMan = Cc[\\\"@mozilla.org/categorymanager;1\\\"].\\n-                 getService(Ci.nsICategoryManager);\\n-    catMan.addCategoryEntry(\\\"app-startup\\\", CLASS_NAME, \\\"service,\\\" + CONTRACT_ID, true, true);\\n-  },\\n-\\n-  unregisterSelf: function(aCompMgr, aLocation, aType) {\\n-    aCompMgr.QueryInterface(Ci.nsIComponentRegistrar);\\n-    aCompMgr.unregisterFactoryLocation(CID, aLocation);\\n-\\n-    var catMan = Cc[\\\"@mozilla.org/categorymanager;1\\\"].\\n-                 getService(Ci.nsICategoryManager);\\n-    catMan.deleteCategoryEntry( \\\"app-startup\\\", \\\"service,\\\" + CONTRACT_ID, true);\\n-  },\\n-\\n-  getClassObject: function(aCompMgr, aCID, aIID) {\\n-    if (aCID.equals(CID))\\n-      return TryToCloseFactory;\\n-    \\n-    throw Cr.NS_ERROR_NOT_REGISTERED;\\n-  },\\n-\\n-  canUnload: function(aCompMgr) {\\n-    return true;\\n-  }\\n+  classDescription: \\\"tryToClose Service\\\",\\n+  contractID: \\\"@mozilla.org/appshell/trytoclose;1\\\",\\n+  classID: Components.ID(\\\"{b69155f4-a8bf-453d-8653-91d1456e1d3d}\\\"),\\n+  QueryInterface: XPCOMUtils.generateQI([Ci.nsIObserver,\\n+                                         Ci.nsISupportsWeakReference]),\\n+  _xpcom_categories: [{ category: \\\"app-startup\\\", service: true }]\\n };\\n \\n function NSGetModule(aCompMgr, aFileSpec) {\\n-  return TryToCloseModule;\\n+  return XPCOMUtils.generateModule([TryToClose]);\\n }\\n\""}