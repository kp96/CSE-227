{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas8a64bc1\""},"diff":"\"8a64bc1 Bug 338441 Make tabbrowser's \\\".browsers\\\" property faster (Toolkit version) r+a=mconnor\\ndiff --git a/browser/base/content/tabbrowser.xml b/browser/base/content/tabbrowser.xml\\nindex bfd2258..a4a47fb 100644\\n--- a/browser/base/content/tabbrowser.xml\\n+++ b/browser/base/content/tabbrowser.xml\\n@@ -190,6 +190,9 @@\\n       <field name=\\\"mAddProgressListenerWasCalled\\\">\\n         false\\n       </field>\\n+      <field name=\\\"_browsers\\\">\\n+        null\\n+      </field>\\n \\n       <method name=\\\"getBrowserAtIndex\\\">\\n         <parameter name=\\\"aIndex\\\"/>\\n@@ -1072,6 +1075,8 @@\\n         <parameter name=\\\"aAllowThirdPartyFixup\\\"/>\\n         <body>\\n           <![CDATA[\\n+            this._browsers = null; // invalidate cache\\n+\\n             if (!this.mTabbedMode)\\n               this.enterTabbedMode();\\n \\n@@ -1267,6 +1272,7 @@\\n         <parameter name=\\\"aTab\\\"/>\\n         <body>\\n           <![CDATA[\\n+            this._browsers = null; // invalidate cache\\n             if (aTab.localName != \\\"tab\\\")\\n               aTab = this.mCurrentTab;\\n \\n@@ -1529,12 +1535,15 @@\\n       <property name=\\\"browsers\\\" readonly=\\\"true\\\">\\n        <getter>\\n           <![CDATA[\\n-            var browsers = [];\\n-            var i;\\n-            browsers.item = function(i) {return this[i];}\\n-            for (i = 0; i < this.mTabContainer.childNodes.length; i++)\\n-              browsers.push(this.mTabContainer.childNodes[i].linkedBrowser);\\n-            return browsers;\\n+            if (!this._browsers) {\\n+              var browsers = [];\\n+              var i;\\n+              browsers.item = function(i) {return this[i];}\\n+              for (i = 0; i < this.mTabContainer.childNodes.length; i++)\\n+                browsers.push(this.mTabContainer.childNodes[i].linkedBrowser);\\n+              this._browsers = browsers;\\n+            }\\n+            return this._browsers;\\n           ]]>\\n         </getter>\\n       </property>\\n@@ -1677,6 +1686,7 @@\\n         <parameter name=\\\"aIndex\\\"/>\\n         <body>\\n         <![CDATA[\\n+          this._browsers = null; // invalidate cache\\n           this.mTabFilters.splice(aIndex, 0, this.mTabFilters.splice(aTab._tPos, 1)[0]);\\n           this.mTabListeners.splice(aIndex, 0, this.mTabListeners.splice(aTab._tPos, 1)[0]);\\n \\n\""}