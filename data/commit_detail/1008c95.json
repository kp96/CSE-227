{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas1008c95\""},"diff":"\"1008c95 Backing out patch for bug 248612, since it may have caused 10% argo Ts regression\\ndiff --git a/browser/base/content/tabbrowser.xml b/browser/base/content/tabbrowser.xml\\nindex 579eda5..b75eb35 100644\\n--- a/browser/base/content/tabbrowser.xml\\n+++ b/browser/base/content/tabbrowser.xml\\n@@ -180,6 +180,9 @@\\n       <field name=\\\"mContextTab\\\">\\n         null\\n       </field>\\n+      <field name=\\\"mModalDialogShowing\\\">\\n+        false\\n+      </field>\\n       <field name=\\\"arrowKeysShouldWrap\\\" readonly=\\\"true\\\">\\n #ifdef XP_MACOSX\\n         true\\n@@ -1698,8 +1701,6 @@\\n         </body>\\n       </method>\\n \\n-      <field name=\\\"mDragTime\\\">0</field>\\n-      <field name=\\\"mDragOverDelay\\\">350</field>\\n       <method name=\\\"onDragOver\\\">\\n         <parameter name=\\\"aEvent\\\"/>\\n         <parameter name=\\\"aFlavour\\\"/>\\n@@ -1727,13 +1728,8 @@\\n               }\\n \\n               var isTabDrag = (aDragSession.sourceNode.parentNode == this.mTabContainer);\\n-              if (!isTabDrag && aEvent.target.localName == \\\"tab\\\") {\\n-                if (!this.mDragTime) \\n-                  this.mDragTime = Date.now();\\n-                if (Date.now() >= this.mDragTime + this.mDragOverDelay)\\n-                  this.mTabContainer.selectedItem = aEvent.target;\\n+              if (!isTabDrag)\\n                 return;\\n-              }\\n \\n               var newIndex = this.getNewIndex(aEvent);\\n \\n@@ -1892,8 +1888,6 @@\\n         <parameter name=\\\"aDragSession\\\"/>\\n         <body>\\n           <![CDATA[\\n-            this.mDragTime = 0;\\n-\\n             if (aDragSession.sourceNode &&\\n                 aDragSession.sourceNode.parentNode == this.mTabContainer &&\\n                 aDragSession.canDrop) {\\n@@ -2390,6 +2384,9 @@\\n                 onget=\\\"return this.mCurrentBrowser.userTypedValue;\\\"\\n                 onset=\\\"return this.mCurrentBrowser.userTypedValue = val;\\\"/>\\n \\n+      <property name=\\\"forceSyncURLBarUpdate\\\"\\n+                onget=\\\"return this.mModalDialogShowing;\\\"/>\\n+\\n       <method name=\\\"createTooltip\\\">\\n         <parameter name=\\\"event\\\"/>\\n         <body>\\n@@ -2483,6 +2480,7 @@\\n \\n           for (var i = 0; i < browsers.length; ++i) {\\n             if (this.getBrowserAtIndex(i).contentWindow == targetTop) {\\n+              this.mModalDialogShowing = true;\\n               this.selectedTab = this.mTabContainer.childNodes[i];\\n \\n               break;\\n@@ -2490,6 +2488,14 @@\\n           }\\n         ]]>\\n       </handler>\\n+      <handler event=\\\"DOMModalDialogClosed\\\" phase=\\\"capturing\\\">\\n+        <![CDATA[\\n+          if (!event.isTrusted)\\n+            return;\\n+\\n+          this.mModalDialogShowing = false;\\n+        ]]>\\n+      </handler>\\n     </handlers>\\n   </binding>\\n \\n\""}