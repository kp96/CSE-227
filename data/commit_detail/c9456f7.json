{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basc9456f7\""},"diff":"\"c9456f7 add tests for bug 390219 and bug 326337. r/sr=peterv a=me\\ndiff --git a/content/base/test/Makefile.in b/content/base/test/Makefile.in\\nindex c2b42f5..7d8c309 100644\\n--- a/content/base/test/Makefile.in\\n+++ b/content/base/test/Makefile.in\\n@@ -86,6 +86,7 @@ _TEST_FILES = \\ttest_bug5141.html \\\\\\n \\t\\ttest_bug373181.xhtml \\\\\\n \\t\\ttest_bug375314.html \\\\\\n \\t\\ttest_bug382113.html \\\\\\n+\\t\\ttest_bug390219.html \\\\\\n \\t\\ttest_bug390735.html \\\\\\n \\t\\ttest_bug392318.html \\\\\\n \\t\\ttest_bug392511.html \\\\\\n@@ -101,6 +102,11 @@ _TEST_FILES = \\ttest_bug5141.html \\\\\\n \\t\\tfile_CrossSiteXHR_pass1.xml^headers^ \\\\\\n \\t\\tfile_CrossSiteXHR_pass2.xml \\\\\\n \\t\\tfile_CrossSiteXHR_pass3.xml \\\\\\n+\\t\\ttest_bug326337.html \\\\\\n+\\t\\tfile_bug326337_inner.html \\\\\\n+\\t\\tfile_bug326337.xml \\\\\\n+\\t\\tfile_bug326337_multipart.txt \\\\\\n+\\t\\tfile_bug326337_multipart.txt^headers^ \\\\\\n \\t\\t$(NULL)\\n \\n libs:: $(_TEST_FILES)\\ndiff --git a/content/base/test/file_bug218236_multipart.txt b/content/base/test/file_bug218236_multipart.txt\\nindex ec2962e..001e3ad 100644\\n--- a/content/base/test/file_bug218236_multipart.txt\\n+++ b/content/base/test/file_bug218236_multipart.txt\\n@@ -12,4 +12,3 @@ Content-Type: text/html\\n Content-Type: text/plain\\n \\n File 3\\n---\\ndiff --git a/content/base/test/file_bug326337.xml b/content/base/test/file_bug326337.xml\\nnew file mode 100644\\nindex 0000000..d328051\\n--- /dev/null\\n+++ b/content/base/test/file_bug326337.xml\\n@@ -0,0 +1 @@\\n+<data root=\\\"yes\\\"/>\\r\\ndiff --git a/content/base/test/file_bug326337_inner.html b/content/base/test/file_bug326337_inner.html\\nnew file mode 100644\\nindex 0000000..1b70fc5\\n--- /dev/null\\n+++ b/content/base/test/file_bug326337_inner.html\\n@@ -0,0 +1,59 @@\\n+<!DOCTYPE HTML>\\r\\n+<html>\\r\\n+<!--\\r\\n+https://bugzilla.mozilla.org/show_bug.cgi?id=326337\\r\\n+-->\\r\\n+<head>\\r\\n+  <title>Inner file for Bug 326337</title>\\r\\n+</head>\\r\\n+<body>\\r\\n+<script>\\r\\n+\\r\\n+document.domain = \\\"example.com\\\";\\r\\n+\\r\\n+runTest1();\\r\\n+\\r\\n+var xhr;\\r\\n+\\r\\n+function runTest1() {\\r\\n+  xhr = new XMLHttpRequest();\\r\\n+  xhr.open(\\\"GET\\\", \\\"file_bug326337.xml\\\", true);\\r\\n+  xhr.onreadystatechange = function() {\\r\\n+    if (xhr.readyState == 4) {\\r\\n+      check(xhr.responseXML.documentElement.getAttribute(\\\"root\\\"));\\r\\n+      runTest2();\\r\\n+    }\\r\\n+  }\\r\\n+  xhr.send(null);\\r\\n+}\\r\\n+\\r\\n+function runTest2() {\\r\\n+  var secondDoc = false;\\r\\n+  xhr = new XMLHttpRequest();\\r\\n+  xhr.multipart = true;\\r\\n+  xhr.open(\\\"GET\\\", \\\"file_bug326337_multipart.txt\\\", true);\\r\\n+  xhr.onreadystatechange = function() {\\r\\n+    if (xhr.readyState == 4) {\\r\\n+      check(xhr.responseXML.documentElement.getAttribute(\\\"root\\\"));\\r\\n+      if (secondDoc) {\\r\\n+        parent.location.hash = \\\"#done\\\";\\r\\n+      }\\r\\n+      else {\\r\\n+        secondDoc = true;\\r\\n+      }\\r\\n+    }\\r\\n+  }\\r\\n+  xhr.send(null);\\r\\n+}\\r\\n+\\r\\n+function check(attr) {\\r\\n+  if (attr != \\\"yes\\\") {\\r\\n+    parent.location.hash = \\\"#fail\\\";\\r\\n+    throw 1;\\r\\n+  }\\r\\n+}\\r\\n+\\r\\n+</script>\\r\\n+</pre>\\r\\n+</body>\\r\\n+</html>\\r\\ndiff --git a/content/base/test/file_bug326337_multipart.txt b/content/base/test/file_bug326337_multipart.txt\\nnew file mode 100644\\nindex 0000000..4f8234f\\n--- /dev/null\\n+++ b/content/base/test/file_bug326337_multipart.txt\\n@@ -0,0 +1,9 @@\\n+----boundary\\n+Content-Type: text/xml\\n+\\n+<data root=\\\"yes\\\"><sub roo=\\\"no\\\">text</sub></data>\\n+\\n+------boundary\\n+Content-Type: text/xml\\n+\\n+<data root=\\\"yes\\\">text 2</data>\\ndiff --git a/content/base/test/file_bug326337_multipart.txt^headers^ b/content/base/test/file_bug326337_multipart.txt^headers^\\nnew file mode 100644\\nindex 0000000..8644505\\n--- /dev/null\\n+++ b/content/base/test/file_bug326337_multipart.txt^headers^\\n@@ -0,0 +1,2 @@\\n+HTTP 200 OK\\n+Content-Type: multipart/x-mixed-replace;boundary=\\\"----boundary\\\"\\ndiff --git a/content/base/test/test_bug326337.html b/content/base/test/test_bug326337.html\\nnew file mode 100644\\nindex 0000000..dfaf8c0\\n--- /dev/null\\n+++ b/content/base/test/test_bug326337.html\\n@@ -0,0 +1,38 @@\\n+<!DOCTYPE HTML>\\r\\n+<html>\\r\\n+<!--\\r\\n+https://bugzilla.mozilla.org/show_bug.cgi?id=326337\\r\\n+-->\\r\\n+<head>\\r\\n+  <title>Test for Bug 326337</title>\\r\\n+  <script type=\\\"text/javascript\\\" src=\\\"/MochiKit/MochiKit.js\\\"></script>\\r\\n+  <script type=\\\"text/javascript\\\" src=\\\"/tests/SimpleTest/SimpleTest.js\\\"></script>        \\r\\n+  <link rel=\\\"stylesheet\\\" type=\\\"text/css\\\" href=\\\"/tests/SimpleTest/test.css\\\" />\\r\\n+</head>\\r\\n+<body>\\r\\n+<a target=\\\"_blank\\\" href=\\\"https://bugzilla.mozilla.org/show_bug.cgi?id=326337\\\">Mozilla Bug 326337</a>\\r\\n+<p id=\\\"display\\\"></p>\\r\\n+<div id=\\\"content\\\" style=\\\"display: none\\\">\\r\\n+</div>\\r\\n+<iframe id=\\\"inner\\\" src=\\\"http://test1.example.com/tests/content/base/test/file_bug326337_inner.html\\\"></iframe>\\r\\n+<pre id=\\\"test\\\">\\r\\n+<script class=\\\"testbody\\\" type=\\\"text/javascript\\\">\\r\\n+\\r\\n+/** Test for Bug 326337 **/\\r\\n+\\r\\n+SimpleTest.waitForExplicitFinish();\\r\\n+\\r\\n+var t = setInterval(doCheck, 300);\\r\\n+function doCheck() {\\r\\n+  if (location.hash) {\\r\\n+    clearInterval(t);\\r\\n+    is(location.hash, \\\"#done\\\", \\\"failed to run\\\");\\r\\n+    SimpleTest.finish();\\r\\n+  }\\r\\n+}\\r\\n+\\r\\n+</script>\\r\\n+</pre>\\r\\n+</body>\\r\\n+</html>\\r\\n+\\r\\ndiff --git a/content/base/test/test_bug390219.html b/content/base/test/test_bug390219.html\\nnew file mode 100644\\nindex 0000000..05c08c2\\n--- /dev/null\\n+++ b/content/base/test/test_bug390219.html\\n@@ -0,0 +1,39 @@\\n+<!DOCTYPE HTML>\\n+<html>\\n+<!--\\n+https://bugzilla.mozilla.org/show_bug.cgi?id=390219\\n+-->\\n+<head>\\n+  <meta http-equiv=\\\"content-type\\\" content=\\\"text/html; charset=utf-8\\\">\\n+  <title>Test for Bug 390219</title>\\n+  <script type=\\\"text/javascript\\\" src=\\\"/MochiKit/MochiKit.js\\\"></script>\\n+  <script type=\\\"text/javascript\\\" src=\\\"/tests/SimpleTest/SimpleTest.js\\\"></script>        \\n+  <link rel=\\\"stylesheet\\\" type=\\\"text/css\\\" href=\\\"/tests/SimpleTest/test.css\\\" />\\n+</head>\\n+<body>\\n+<p id=\\\"display\\\"></p>\\n+<div id=\\\"content\\\" style=\\\"display: none\\\">\\n+  \\n+</div>\\n+<pre id=\\\"test\\\">\\n+<script class=\\\"testbody\\\" type=\\\"text/javascript\\\">\\n+/** Test for Bug 390219 **/\\n+\\n+SimpleTest.waitForExplicitFinish();\\n+xhr = new XMLHttpRequest();\\n+xhr.open(\\\"GET\\\", \\\"non-existing_url\\\", true);\\n+xhr.send(null);\\n+xhr.abort();\\n+xhr.open(\\\"GET\\\", \\\".\\\", true);\\n+xhr.onreadystatechange = function() {\\n+  if (xhr.readyState == 4) {\\n+    is(xhr.status, 200, \\\"wrong status\\\");\\n+    SimpleTest.finish();\\n+  }\\n+}\\n+xhr.send(null);\\n+\\n+</script>\\n+</pre>\\n+</body>\\n+</html>\\n\""}