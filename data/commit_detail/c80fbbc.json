{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basc80fbbc\""},"diff":"\"c80fbbc Fix for bug 393035 (nsNSElementTearoff should participate in cycle collection). r/sr=jst, a=sicking.\\ndiff --git a/content/base/src/nsGenericElement.cpp b/content/base/src/nsGenericElement.cpp\\nindex b7f8ec6..bba8b49 100644\\n--- a/content/base/src/nsGenericElement.cpp\\n+++ b/content/base/src/nsGenericElement.cpp\\n@@ -674,12 +674,15 @@ nsNode3Tearoff::IsDefaultNamespace(const nsAString& aNamespaceURI,\\n //----------------------------------------------------------------------\\n \\n \\n+NS_IMPL_CYCLE_COLLECTION_1(nsNSElementTearoff, mContent)\\n+\\n NS_INTERFACE_MAP_BEGIN(nsNSElementTearoff)\\n   NS_INTERFACE_MAP_ENTRY(nsIDOMNSElement)\\n+  NS_INTERFACE_MAP_ENTRIES_CYCLE_COLLECTION(nsNSElementTearoff)\\n NS_INTERFACE_MAP_END_AGGREGATED(mContent)\\n \\n-NS_IMPL_ADDREF(nsNSElementTearoff)\\n-NS_IMPL_RELEASE(nsNSElementTearoff)\\n+NS_IMPL_CYCLE_COLLECTING_ADDREF(nsNSElementTearoff)\\n+NS_IMPL_CYCLE_COLLECTING_RELEASE(nsNSElementTearoff)\\n \\n NS_IMETHODIMP\\n nsNSElementTearoff::GetElementsByClassName(const nsAString& aClasses,\\ndiff --git a/content/base/src/nsGenericElement.h b/content/base/src/nsGenericElement.h\\nindex 3b8c9b8..e61a2fd 100644\\n--- a/content/base/src/nsGenericElement.h\\n+++ b/content/base/src/nsGenericElement.h\\n@@ -1055,10 +1055,12 @@ _elementName::Clone(nsINodeInfo *aNodeInfo, nsINode **aResult) const        \\\\\\n class nsNSElementTearoff : public nsIDOMNSElement\\n {\\n public:\\n-  NS_DECL_ISUPPORTS\\n+  NS_DECL_CYCLE_COLLECTING_ISUPPORTS\\n \\n   NS_DECL_NSIDOMNSELEMENT\\n \\n+  NS_DECL_CYCLE_COLLECTION_CLASS(nsNSElementTearoff)\\n+\\n   nsNSElementTearoff(nsGenericElement *aContent) : mContent(aContent)\\n   {\\n   }\\n\""}