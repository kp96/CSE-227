{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas8038e7d\""},"diff":"\"8038e7d Bug 394384. Fix accounting error when tracking the number of times a textrun is referenced from the word cache. debug-only. r+a=pavlov\\ndiff --git a/gfx/thebes/src/gfxTextRunWordCache.cpp b/gfx/thebes/src/gfxTextRunWordCache.cpp\\nindex b5c49f0..86da336 100644\\n--- a/gfx/thebes/src/gfxTextRunWordCache.cpp\\n+++ b/gfx/thebes/src/gfxTextRunWordCache.cpp\\n@@ -243,9 +243,6 @@ TextRunWordCache::LookupWord(gfxTextRun *aTextRun, gfxFont *aFirstFont,\\n     if (fontEntry->mTextRun) {\\n         existingEntry = fontEntry;\\n     } else {\\n-#ifdef DEBUG\\n-        ++aTextRun->mCachedWords;\\n-#endif\\n         PR_LOG(gWordCacheLog, PR_LOG_DEBUG, (\\\"%p(%d-%d,%d): added using font\\\", aTextRun, aStart, aEnd - aStart, aHash));\\n         key.mFontOrGroup = aTextRun->GetFontGroup();\\n         CacheHashEntry *groupEntry = mCache.GetEntry(key);\\n@@ -273,6 +270,9 @@ TextRunWordCache::LookupWord(gfxTextRun *aTextRun, gfxFont *aFirstFont,\\n         return PR_TRUE;\\n     }\\n \\n+#ifdef DEBUG\\n+    ++aTextRun->mCachedWords;\\n+#endif\\n     // Set up the cache entry so that if later in this textrun we hit this\\n     // entry, we'll copy within our own textrun\\n     fontEntry->mTextRun = aTextRun;\\n\""}