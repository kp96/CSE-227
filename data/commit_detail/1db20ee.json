{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas1db20ee\""},"diff":"\"1db20ee Fixing last part of bug 68215, making FireFox play nicely with the onbeforeunload event too. r+sr=ben@bengoodger.com\\ndiff --git a/browser/base/content/tabbrowser.xml b/browser/base/content/tabbrowser.xml\\nindex 3c8d7e1..d3ba371 100644\\n--- a/browser/base/content/tabbrowser.xml\\n+++ b/browser/base/content/tabbrowser.xml\\n@@ -780,11 +780,11 @@\\n             else\\n               this.mTabContainer.selectedItem = aTab;\\n \\n-            while (this.mTabContainer.lastChild != aTab)\\n-              this.removeTab(this.mTabContainer.lastChild);\\n-\\n-            while (aTab.previousSibling)\\n-              this.removeTab(aTab.previousSibling);\\n+            var childNodes = this.mTabContainer.childNodes;\\n+            for (var i = childNodes.length - 1; i >= 0; --i) {\\n+              if (childNodes[i] != aTab)\\n+                this.removeTab(childNodes[i]);\\n+            }\\n           ]]>\\n         </body>\\n       </method>\\n@@ -812,6 +812,11 @@\\n               return;\\n             }\\n \\n+            var ds = this.getBrowserForTab(aTab).docShell;\\n+\\n+            if (ds.contentViewer && !ds.contentViewer.permitUnload())\\n+              return;\\n+\\n             if (l == 2) {\\n               var autohide = this.mPrefs.getBoolPref(\\\"browser.tabs.autoHide\\\");\\n               if (autohide)\\n@@ -971,6 +976,12 @@\\n         </body>\\n       </method>\\n \\n+      <property name=\\\"tabContainer\\\">\\n+        <getter>\\n+          return this.mTabContainer;\\n+        </getter>\\n+      </property>\\n+\\n       <property name=\\\"selectedTab\\\">\\n         <getter>\\n           return this.mTabBox.selectedTab;\\n\""}