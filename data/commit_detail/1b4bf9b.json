{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas1b4bf9b\""},"diff":"\"1b4bf9b Fix for bug 397386 (Large leak on grono.net front page), part 2. r/sr=sicking, a=dsicore.\\ndiff --git a/content/xslt/src/xpath/nsXPathExpression.cpp b/content/xslt/src/xpath/nsXPathExpression.cpp\\nindex ddc4cbc..21c39e7 100644\\n--- a/content/xslt/src/xpath/nsXPathExpression.cpp\\n+++ b/content/xslt/src/xpath/nsXPathExpression.cpp\\n@@ -49,9 +49,13 @@\\n #include \\\"txURIUtils.h\\\"\\n #include \\\"txXPathTreeWalker.h\\\"\\n \\n-NS_IMPL_ADDREF(nsXPathExpression)\\n-NS_IMPL_RELEASE(nsXPathExpression)\\n-NS_INTERFACE_MAP_BEGIN(nsXPathExpression)\\n+NS_IMPL_CYCLE_COLLECTION_1(nsXPathExpression, mDocument)\\n+\\n+NS_IMPL_CYCLE_COLLECTING_ADDREF_AMBIGUOUS(nsXPathExpression,\\n+                                          nsIDOMXPathExpression)\\n+NS_IMPL_CYCLE_COLLECTING_RELEASE_AMBIGUOUS(nsXPathExpression,\\n+                                           nsIDOMXPathExpression)\\n+NS_INTERFACE_MAP_BEGIN_CYCLE_COLLECTION(nsXPathExpression)\\n   NS_INTERFACE_MAP_ENTRY(nsIDOMXPathExpression)\\n   NS_INTERFACE_MAP_ENTRY(nsIDOMNSXPathExpression)\\n   NS_INTERFACE_MAP_ENTRY_AMBIGUOUS(nsISupports, nsIDOMXPathExpression)\\ndiff --git a/content/xslt/src/xpath/nsXPathExpression.h b/content/xslt/src/xpath/nsXPathExpression.h\\nindex e1b29ca..7eeef3e 100644\\n--- a/content/xslt/src/xpath/nsXPathExpression.h\\n+++ b/content/xslt/src/xpath/nsXPathExpression.h\\n@@ -44,6 +44,7 @@\\n #include \\\"txIXPathContext.h\\\"\\n #include \\\"txResultRecycler.h\\\"\\n #include \\\"nsAutoPtr.h\\\"\\n+#include \\\"nsCycleCollectionParticipant.h\\\"\\n \\n class Expr;\\n class txXPathNode;\\n@@ -59,7 +60,9 @@ public:\\n                       nsIDOMDocument *aDocument);\\n \\n     // nsISupports interface\\n-    NS_DECL_ISUPPORTS\\n+    NS_DECL_CYCLE_COLLECTING_ISUPPORTS\\n+    NS_DECL_CYCLE_COLLECTION_CLASS_AMBIGUOUS(nsXPathExpression,\\n+                                             nsIDOMXPathExpression)\\n \\n     // nsIDOMXPathExpression interface\\n     NS_DECL_NSIDOMXPATHEXPRESSION\\ndiff --git a/content/xslt/src/xpath/nsXPathNSResolver.cpp b/content/xslt/src/xpath/nsXPathNSResolver.cpp\\nindex 8fee8ae..a8740c4 100644\\n--- a/content/xslt/src/xpath/nsXPathNSResolver.cpp\\n+++ b/content/xslt/src/xpath/nsXPathNSResolver.cpp\\n@@ -41,9 +41,11 @@\\n #include \\\"nsDOMString.h\\\"\\n #include \\\"nsContentUtils.h\\\"\\n \\n-NS_IMPL_ADDREF(nsXPathNSResolver)\\n-NS_IMPL_RELEASE(nsXPathNSResolver)\\n-NS_INTERFACE_MAP_BEGIN(nsXPathNSResolver)\\n+NS_IMPL_CYCLE_COLLECTION_1(nsXPathNSResolver, mNode)\\n+\\n+NS_IMPL_CYCLE_COLLECTING_ADDREF(nsXPathNSResolver)\\n+NS_IMPL_CYCLE_COLLECTING_RELEASE(nsXPathNSResolver)\\n+NS_INTERFACE_MAP_BEGIN_CYCLE_COLLECTION(nsXPathNSResolver)\\n   NS_INTERFACE_MAP_ENTRY(nsIDOMXPathNSResolver)\\n   NS_INTERFACE_MAP_ENTRY_AMBIGUOUS(nsISupports, nsIDOMXPathNSResolver)\\n   NS_INTERFACE_MAP_ENTRY_CONTENT_CLASSINFO(XPathNSResolver)\\ndiff --git a/content/xslt/src/xpath/nsXPathNSResolver.h b/content/xslt/src/xpath/nsXPathNSResolver.h\\nindex 14004d8..6756643 100644\\n--- a/content/xslt/src/xpath/nsXPathNSResolver.h\\n+++ b/content/xslt/src/xpath/nsXPathNSResolver.h\\n@@ -43,6 +43,7 @@\\n #include \\\"nsIDOMNode.h\\\"\\n #include \\\"nsIDOM3Node.h\\\"\\n #include \\\"nsCOMPtr.h\\\"\\n+#include \\\"nsCycleCollectionParticipant.h\\\"\\n \\n /**\\n  * A class for evaluating an XPath expression string\\n@@ -53,7 +54,8 @@ public:\\n     nsXPathNSResolver(nsIDOMNode* aNode);\\n \\n     // nsISupports interface\\n-    NS_DECL_ISUPPORTS\\n+    NS_DECL_CYCLE_COLLECTING_ISUPPORTS\\n+    NS_DECL_CYCLE_COLLECTION_CLASS(nsXPathNSResolver)\\n \\n     // nsIDOMXPathNSResolver interface\\n     NS_DECL_NSIDOMXPATHNSRESOLVER\\n\""}