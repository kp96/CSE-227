{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas7eb9fb4\""},"diff":"\"7eb9fb4 Destroy the old rule tree *after* processing the change list, in case the change list has frame reconstructs in it.  Patch from Eli Friedman <sharparrow1@yahoo.com>.  r+sr+a1.9=dbaron  b=389744\\ndiff --git a/layout/base/nsPresContext.cpp b/layout/base/nsPresContext.cpp\\nindex 158296b..1debf7d 100644\\n--- a/layout/base/nsPresContext.cpp\\n+++ b/layout/base/nsPresContext.cpp\\n@@ -722,10 +722,14 @@ nsPresContext::ClearStyleDataAndReflow()\\n     nsStyleChangeList changeList;\\n     mShell->FrameManager()->ComputeStyleChangeFor(mShell->GetRootFrame(),\\n                                                   &changeList, nsChangeHint(0));\\n-    // Tell the style set it's safe to destroy the old rule tree\\n-    mShell->StyleSet()->EndReconstruct();\\n     // Tell the frame constructor to process the required changes\\n     mShell->FrameConstructor()->ProcessRestyledFrames(changeList);\\n+    // Tell the style set it's safe to destroy the old rule tree.  We\\n+    // must do this after the ProcessRestyledFrames call in case the\\n+    // change list has frame reconstructs in it (since frames to be\\n+    // reconstructed will still have their old style context pointers\\n+    // until they are destroyed).\\n+    mShell->StyleSet()->EndReconstruct();\\n   }\\n }\\n \\n\""}