{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basc835392\""},"diff":"\"c835392 Bug 356599: browser.tabs.closeButtons pref observer may cause ###!!! ASSERTION: XPConnect is being called on a scope without a 'Components' property, patch by Nickolay Ponomarev <asqueella@gmail.com>, r=me\\ndiff --git a/browser/base/content/tabbrowser.xml b/browser/base/content/tabbrowser.xml\\nindex ce3e6d1..c381d49 100644\\n--- a/browser/base/content/tabbrowser.xml\\n+++ b/browser/base/content/tabbrowser.xml\\n@@ -2653,7 +2653,7 @@\\n           this.adjustTabstrip();\\n \\n           pb2.addObserver(\\\"browser.tabs.closeButtons\\\", \\n-                          this._prefObserver, true);\\n+                          this._prefObserver, false);\\n \\n           var self = this;\\n           function onResize() {\\n@@ -2680,6 +2680,11 @@\\n \\n       <destructor>\\n         <![CDATA[\\n+          var pb2 =\\n+              Components.classes['@mozilla.org/preferences-service;1'].\\n+              getService(Components.interfaces.nsIPrefBranch2);\\n+          pb2.removeObserver(\\\"browser.tabs.closeButtons\\\", this._prefObserver);\\n+\\n           // Release timer to avoid reference cycles.\\n           if (this._animateTimer) {\\n             this._animateTimer.cancel();\\n@@ -2709,20 +2714,17 @@\\n           if (topic == \\\"nsPref:changed\\\") {\\n             switch (data) {\\n             case \\\"browser.tabs.closeButtons\\\":\\n-              var pb2 =\\n-                  Components.classes['@mozilla.org/preferences-service;1'].\\n-                  getService(Components.interfaces.nsIPrefBranch2);\\n-              this.tabbox.mCloseButtons = pb2.getIntPref(\\\"browser.tabs.closeButtons\\\");\\n+              subject.QueryInterface(Components.interfaces.nsIPrefBranch);\\n+              this.tabbox.mCloseButtons = subject.getIntPref(\\\"browser.tabs.closeButtons\\\");\\n               this.tabbox.adjustTabstrip();\\n               break;\\n             }\\n           }\\n         },\\n   \\n-        QueryInterface : function(aIID)\\n+        QueryInterface: function(aIID)\\n         {\\n           if (aIID.equals(Components.interfaces.nsIObserver) ||\\n-              aIID.equals(Components.interfaces.nsISupportsWeakReference) ||\\n               aIID.equals(Components.interfaces.nsISupports))\\n             return this;\\n           throw Components.results.NS_NOINTERFACE;\\n\""}