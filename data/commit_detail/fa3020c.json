{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basfa3020c\""},"diff":"\"fa3020c Bug 215068 - \\\"leading spaces are lost (HTML compose, plain-text send)\\\" [p=andrit@ukr.net (Andriy Tkachuk) r=mscott sr=bzbarsky a1.9=bzbarsky]\\ndiff --git a/content/base/src/nsPlainTextSerializer.cpp b/content/base/src/nsPlainTextSerializer.cpp\\nindex ef31465..577b453 100644\\n--- a/content/base/src/nsPlainTextSerializer.cpp\\n+++ b/content/base/src/nsPlainTextSerializer.cpp\\n@@ -74,6 +74,8 @@ static const  PRInt32 kIndentIncrementHeaders = 2;  /* If mHeaderStrategy = 1,\\n static const  PRInt32 kIndentSizeList = (kTabSize > kOLNumberWidth+3) ? kTabSize: kOLNumberWidth+3;\\n                                // Indention of non-first lines of ul and ol\\n static const  PRInt32 kIndentSizeDD = kTabSize;  // Indention of <dd>\\n+static const  PRUnichar  kNBSP = 160;\\n+static const  PRUnichar kSPACE = ' ';\\n \\n static PRInt32 HeaderLevel(eHTMLTags aTag);\\n static PRInt32 GetUnicharWidth(PRUnichar ucs);\\n@@ -1243,9 +1245,7 @@ nsPlainTextSerializer::Output(nsString& aString)\\n   if (!(mFlags & nsIDocumentEncoder::OutputPersistNBSP)) {\\n     // First, replace all nbsp characters with spaces,\\n     // which the unicode encoder won't do for us.\\n-    static PRUnichar nbsp = 160;\\n-    static PRUnichar space = ' ';\\n-    aString.ReplaceChar(nbsp, space);\\n+    aString.ReplaceChar(kNBSP, kSPACE);\\n   }\\n   mOutputString->Append(aString);\\n }\\n@@ -1277,6 +1277,7 @@ nsPlainTextSerializer::AddToLine(const PRUnichar * aLineFragment,\\n          (\\n           '>' == aLineFragment[0] ||\\n           ' ' == aLineFragment[0] ||\\n+        kNBSP == aLineFragment[0] ||  // bug 215068\\n           !nsCRT::strncmp(aLineFragment, NS_LITERAL_STRING(\\\"From \\\").get(), 5)\\n           )\\n          && mCiteQuoteLevel == 0  // We space-stuff quoted lines anyway\\n\""}