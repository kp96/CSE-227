{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basd1644b5\""},"diff":"\"d1644b5 Bug 395773 - \\\"Bookmarks backup suggests invalid file name\\\" [p=dao@design-noir.de (DÃ£o Gottwald) r=sspitzer a1.9=mconnor]\\ndiff --git a/browser/components/places/content/places.js b/browser/components/places/content/places.js\\nindex ff5a7f6..e042702 100755\\n--- a/browser/components/places/content/places.js\\n+++ b/browser/components/places/content/places.js\\n@@ -397,13 +397,10 @@ var PlacesOrganizer = {\\n       getService(Ci.nsIProperties);\\n     var backupsDir = dirSvc.get(\\\"Desk\\\", Ci.nsILocalFile);\\n     fp.displayDirectory = backupsDir;\\n-  \\n-    var dateService = Cc[\\\"@mozilla.org/intl/scriptabledateformat;1\\\"].\\n-      getService(Ci.nsIScriptableDateFormat);\\n \\n-    var d = new Date();\\n-    var date = dateService.FormatDate(\\\"\\\", dateService.dateFormatShort,\\n-                           d.getFullYear(), d.getMonth() + 1, d.getDate());\\n+    // Use YYYY-MM-DD (ISO 8601) as it doesn't contain illegal characters\\n+    // and makes the alphabetical order of multiple backup files more useful.\\n+    var date = (new Date).toLocaleFormat(\\\"%Y-%m-%d\\\");\\n     fp.defaultString = PlacesUtils.getFormattedString(\\\"bookmarksBackupFilename\\\",\\n                                                       [date]);\\n   \\ndiff --git a/browser/components/places/src/nsPlacesImportExportService.cpp b/browser/components/places/src/nsPlacesImportExportService.cpp\\nindex 163e222..b9e92d1 100644\\n--- a/browser/components/places/src/nsPlacesImportExportService.cpp\\n+++ b/browser/components/places/src/nsPlacesImportExportService.cpp\\n@@ -2537,7 +2537,9 @@ nsPlacesImportExportService::ArchiveBookmarksFile(PRInt32 numberOfBackups,\\n   PR_NormalizeTime(&nowInfo, PR_LocalTimeParameters);\\n \\n   char timeString[128];\\n-  \\n+\\n+  // Use YYYY-MM-DD (ISO 8601) as it doesn't contain illegal characters\\n+  // and makes the alphabetical order of multiple backup files more useful.\\n   PR_FormatTime(timeString, 128, \\\"bookmarks-%Y-%m-%d.html\\\", &nowInfo);\\n \\n   //nsCAutoString backupFilenameCString(timeString);\\ndiff --git a/browser/locales/en-US/chrome/browser/places/places.properties b/browser/locales/en-US/chrome/browser/places/places.properties\\nindex 52a7a5b..c8a0186 100644\\n--- a/browser/locales/en-US/chrome/browser/places/places.properties\\n+++ b/browser/locales/en-US/chrome/browser/places/places.properties\\n@@ -20,7 +20,12 @@ bookmarksMenuEmptyFolder=(Empty)\\n bookmarksLivemarkLoading=Live Bookmark loading...\\n bookmarksLivemarkFailed=Live Bookmark feed failed to load.\\n \\n-bookmarksBackupFilename=Bookmarks %1$S.html\\n+# LOCALIZATION NOTE (bookmarksBackupFilename) :\\n+# %S will be replaced by the current date in ISO 8601 format, YYYY-MM-DD.\\n+# The resulting string will be suggested as a filename, so make sure that you're\\n+# only using characters legal for file names. Consider falling back to the\\n+# en-US value if you have to use non-ascii characters.\\n+bookmarksBackupFilename=Bookmarks %S.html\\n bookmarksBackupTitle=Bookmarks backup filename\\n \\n bookmarksRestoreAlertTitle=Revert Bookmarks\\n\""}