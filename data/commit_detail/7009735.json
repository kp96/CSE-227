{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas7009735\""},"diff":"\"7009735 locationless windows need hostname in titlebar (match 1.0x -- bug 304388) r=mconnor/jruderman, sr=bzbarsky\\ndiff --git a/browser/base/content/tabbrowser.xml b/browser/base/content/tabbrowser.xml\\nindex a10afef..49daf6e 100644\\n--- a/browser/base/content/tabbrowser.xml\\n+++ b/browser/base/content/tabbrowser.xml\\n@@ -562,21 +562,36 @@\\n           <![CDATA[\\n             var newTitle = \\\"\\\";\\n             var docTitle;\\n+            var docElement = this.ownerDocument.documentElement;\\n+            var sep = docElement.getAttribute(\\\"titlemenuseparator\\\");\\n+\\n             if (this.docShell.contentViewer)\\n               docTitle = this.contentTitle;\\n             \\n             if (!docTitle)\\n-              docTitle = this.ownerDocument.documentElement.getAttribute(\\\"titledefault\\\");\\n+              docTitle = docElement.getAttribute(\\\"titledefault\\\");\\n \\n-            var modifier = this.ownerDocument.documentElement.getAttribute(\\\"titlemodifier\\\");\\n+            var modifier = docElement.getAttribute(\\\"titlemodifier\\\");\\n             if (docTitle) {\\n-              newTitle += this.ownerDocument.documentElement.getAttribute(\\\"titlepreface\\\");\\n+              newTitle += docElement.getAttribute(\\\"titlepreface\\\");\\n               newTitle += docTitle;\\n-              var sep = this.ownerDocument.documentElement.getAttribute(\\\"titlemenuseparator\\\");\\n               if (modifier)\\n                 newTitle += sep;\\n             }\\n             newTitle += modifier;\\n+            \\n+            // If location bar is hidden and the URL type supports a host,\\n+            // add the scheme and host to the title to prevent spoofing.\\n+            // XXX https://bugzilla.mozilla.org/show_bug.cgi?id=22183#c239\\n+            try {\\n+              if (docElement.getAttribute(\\\"chromehidden\\\").indexOf(\\\"location\\\") != -1) {\\n+                var host = this.mURIFixup.createExposableURI(\\n+                             this.mCurrentBrowser.currentURI).prePath;\\n+                if (host)\\n+                  newTitle = host + sep + newTitle;\\n+              }\\n+            } catch (e) {}\\n+                        \\n             this.ownerDocument.title = newTitle;\\n           ]]>\\n         </body>\\n\""}