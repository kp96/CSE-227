{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas3958b43\""},"diff":"\"3958b43 Bug 345261 - show status text when mousing over all tabs menu items, r=gavin, ui-r=beltzner.\\ndiff --git a/browser/base/content/tabbrowser.xml b/browser/base/content/tabbrowser.xml\\nindex 4c80e25..027c94b 100644\\n--- a/browser/base/content/tabbrowser.xml\\n+++ b/browser/base/content/tabbrowser.xml\\n@@ -1622,7 +1622,7 @@\\n         </body>\\n       </method>\\n \\n-      <property name=\\\"tabContainer\\\">\\n+      <property name=\\\"tabContainer\\\" readonly=\\\"true\\\">\\n         <getter>\\n           return this.mTabContainer;\\n         </getter>\\n@@ -2810,6 +2810,25 @@\\n   <binding id=\\\"tabbrowser-alltabs-popup\\\"\\n            extends=\\\"chrome://global/content/bindings/popup.xml#popup\\\">\\n     <implementation implements=\\\"nsIDOMEventListener\\\">\\n+      <field name=\\\"_xulWindow\\\">\\n+        null\\n+      </field>\\n+\\n+      <constructor><![CDATA[\\n+        // We cannot cache the XULBrowserWindow object itself since it might\\n+        // be set after this binding is constructed.\\n+        try {\\n+          this._xulWindow = \\n+            window.QueryInterface(Components.interfaces.nsIInterfaceRequestor)\\n+                  .getInterface(Components.interfaces.nsIWebNavigation)\\n+                  .QueryInterface(Components.interfaces.nsIDocShellTreeItem)\\n+                  .treeOwner\\n+                  .QueryInterface(Components.interfaces.nsIInterfaceRequestor)\\n+                  .getInterface(Components.interfaces.nsIXULWindow);\\n+        }\\n+        catch(ex) { }\\n+      ]]></constructor>\\n+\\n       <method name=\\\"_menuItemOnCommand\\\">\\n         <parameter name=\\\"aEvent\\\"/>\\n         <body><![CDATA[\\n@@ -2896,12 +2915,6 @@\\n             if (curTab.hasAttribute(\\\"busy\\\"))\\n               menuItem.setAttribute(\\\"busy\\\", curTab.getAttribute(\\\"busy\\\"));\\n \\n-            // XXX todo\\n-            // statustext not working yet, since I don't have a menubar\\n-            // reuse the menubar statustext logic\\n-            var URI = curTab.linkedBrowser.currentURI.spec;\\n-            menuItem.setAttribute(\\\"statustext\\\", URI);\\n-\\n             // Keep some attributes of the menuitem in sync with its\\n             // corresponding tab (e.g. the tab label)\\n             curTab.mCorrespondingMenuitem = menuItem;\\n@@ -2913,16 +2926,43 @@\\n           }\\n         ]]></body>\\n       </method>\\n+\\n+      <method name=\\\"_onMenuItemActive\\\">\\n+        <parameter name=\\\"aEvent\\\"/>\\n+        <body><![CDATA[\\n+          if (!this._xulWindow || !this._xulWindow.XULBrowserWindow)\\n+            return;\\n+\\n+          var tab = aEvent.target.tab;\\n+          if (tab) {\\n+            var statusText = tab.linkedBrowser.currentURI.spec;\\n+            if (statusText == \\\"about:blank\\\") {\\n+              // XXXhack: Passing a space here (and not \\\"\\\")\\n+              // to make sure the the browser implementation would\\n+              // still consider it a hovered link.\\n+              statusText = \\\" \\\";\\n+            }\\n+\\n+            this._xulWindow.XULBrowserWindow.setOverLink(statusText, null);\\n+          }\\n+        ]]></body>\\n+      </method>\\n+\\n+      <method name=\\\"_onMenuItemInactive\\\">\\n+        <parameter name=\\\"aEvent\\\"/>\\n+        <body><![CDATA[\\n+          if (!this._xulWindow || !this._xulWindow.XULBrowserWindow)\\n+            return;\\n+\\n+          this._xulWindow.XULBrowserWindow.setOverLink(\\\"\\\", null);\\n+        ]]></body>\\n+      </method>\\n     </implementation>\\n     <handlers>\\n-      <handler event=\\\"popupshowing\\\"><![CDATA[\\n-        if (event.target == this)\\n-          this._onShowingAllTabsPopup();\\n-      ]]></handler>\\n-      <handler event=\\\"popuphiding\\\"><![CDATA[\\n-        if (event.target == this)\\n-          this._onHidingAllTabsPopup();\\n-      ]]></handler>\\n+      <handler event=\\\"popupshowing\\\" action=\\\"this._onShowingAllTabsPopup();\\\"/>\\n+      <handler event=\\\"popuphiding\\\" action=\\\"this._onHidingAllTabsPopup();\\\"/>\\n+      <handler event=\\\"DOMMenuItemActive\\\" action=\\\"this._onMenuItemActive(event);\\\"/>\\n+      <handler event=\\\"DOMMenuItemInactive\\\" action=\\\"this._onMenuItemInactive(event);\\\"/>\\n     </handlers>\\n   </binding>\\n \\n\""}