{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basbe5de02\""},"diff":"\"be5de02 Bug 259688: Crash [@nsCOMPtr_base::~nsCOMPtr_base] [@ 0x003a0043] installing themes and extensions. r+sr=dveditz\\ndiff --git a/xpinstall/src/nsXPInstallManager.cpp b/xpinstall/src/nsXPInstallManager.cpp\\nindex 86744c6..3de44c5 100644\\n--- a/xpinstall/src/nsXPInstallManager.cpp\\n+++ b/xpinstall/src/nsXPInstallManager.cpp\\n@@ -121,10 +121,6 @@ nsXPInstallManager::nsXPInstallManager()\\n \\n     // initialize mLastUpdate to the current time\\n     mLastUpdate = PR_Now();\\n-\\n-    nsCOMPtr<nsIObserverService> os(do_GetService(\\\"@mozilla.org/observer-service;1\\\"));\\n-    if (os)\\n-        os->AddObserver(this, XPI_PROGRESS_TOPIC, PR_TRUE);\\n }\\n \\n \\n@@ -178,6 +174,10 @@ nsXPInstallManager::InitManagerWithHashes(const PRUnichar **aURLs,\\n \\n     mNeedsShutdown = PR_TRUE;\\n \\n+    nsCOMPtr<nsIObserverService> os(do_GetService(\\\"@mozilla.org/observer-service;1\\\"));\\n+    if (os)\\n+        os->AddObserver(this, XPI_PROGRESS_TOPIC, PR_TRUE);\\n+\\n     for (PRUint32 i = 0; i < aURLCount; ++i) \\n     {\\n         nsXPITriggerItem* item = new nsXPITriggerItem(0, aURLs[i], nsnull,\\n@@ -341,6 +341,10 @@ nsXPInstallManager::InitManagerInternal()\\n \\n         if (OKtoInstall)\\n         {\\n+            nsCOMPtr<nsIObserverService> os(do_GetService(\\\"@mozilla.org/observer-service;1\\\"));\\n+            if (os)\\n+                os->AddObserver(this, XPI_PROGRESS_TOPIC, PR_TRUE);\\n+\\n             //-----------------------------------------------------\\n             // Open the progress dialog\\n             //-----------------------------------------------------\\n\""}