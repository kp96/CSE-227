{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basf965cd24\""},"diff":"\"f965cd24 Bug 368445. Make nsDisplayBorder::OptimizeVisibility use accurate borders, r+sr=bzbarsky\\ndiff --git a/layout/base/nsDisplayList.cpp b/layout/base/nsDisplayList.cpp\\nindex 35b140f..45104f6 100644\\n--- a/layout/base/nsDisplayList.cpp\\n+++ b/layout/base/nsDisplayList.cpp\\n@@ -586,11 +586,10 @@ nsDisplayBorder::OptimizeVisibility(nsDisplayListBuilder* aBuilder,\\n   if (!nsDisplayItem::OptimizeVisibility(aBuilder, aVisibleRegion))\\n     return PR_FALSE;\\n \\n-  const nsStyleBorder* border = mFrame->GetStyleBorder();\\n-  nsRect contentRect = GetBounds(aBuilder);\\n-  contentRect.Deflate(border->GetBorder());\\n-  if (contentRect.Contains(aVisibleRegion->GetBounds()) &&\\n-      !nsLayoutUtils::HasNonZeroSide(border->mBorderRadius)) {\\n+  nsRect paddingRect = mFrame->GetPaddingRect() - mFrame->GetPosition() +\\n+    aBuilder->ToReferenceFrame(mFrame);\\n+  if (paddingRect.Contains(aVisibleRegion->GetBounds()) &&\\n+      !nsLayoutUtils::HasNonZeroSide(mFrame->GetStyleBorder()->mBorderRadius)) {\\n     // the visible region is entirely inside the content rect, and no part\\n     // of the border is rendered inside the content rect, so we are not\\n     // visible\\n\""}