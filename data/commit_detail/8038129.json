{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas8038129\""},"diff":"\"8038129 Popup whitelisting continues.\\ndiff --git a/browser/base/content/tabbrowser.xml b/browser/base/content/tabbrowser.xml\\nindex bfd0dbf..40879b8 100644\\n--- a/browser/base/content/tabbrowser.xml\\n+++ b/browser/base/content/tabbrowser.xml\\n@@ -515,6 +515,15 @@\\n         </body>\\n       </method>\\n \\n+      <method name=\\\"onPopupBlocked\\\">\\n+        <parameter name=\\\"evt\\\"/>\\n+        <body>\\n+          <![CDATA[\\n+            evt.preventBubble();\\n+          ]]> \\n+        </body>\\n+      </method>\\n+\\n       <method name=\\\"onTitleChanged\\\">\\n         <parameter name=\\\"evt\\\"/>\\n         <body>\\n@@ -595,8 +604,9 @@\\n           <![CDATA[\\n             this.mTabbedMode = true; // Welcome to multi-tabbed mode.\\n \\n-            // Get the first tab all hooked up with a title listener.\\n+            // Get the first tab all hooked up with a title listener and popup blocking listener.\\n             this.mCurrentBrowser.addEventListener(\\\"DOMTitleChanged\\\", this.onTitleChanged, false);\\n+            this.mCurrentBrowser.addEventListener(\\\"DOMPopupBlocked\\\", this.onPopupBlocked, false);\\n \\n             this.setTabTitle(this.mCurrentTab);\\n \\n@@ -670,7 +680,8 @@\\n             this.mPanelContainer.appendChild(b);\\n \\n             b.addEventListener(\\\"DOMTitleChanged\\\", this.onTitleChanged, false);\\n-            \\n+            b.addEventListener(\\\"DOMPopupBlocked\\\", this.onPopupBlocked, false);\\n+\\n             if (this.mStrip.collapsed)\\n               this.setStripVisibilityTo(true);\\n \\n@@ -765,9 +776,10 @@\\n             this.mTabFilters.splice(index, 1);\\n             this.mTabListeners.splice(index, 1);\\n \\n-            // Remove our title change listener\\n+            // Remove our title change and blocking listeners\\n             oldBrowser.removeEventListener(\\\"DOMTitleChanged\\\", this.onTitleChanged, false);\\n-            \\n+            oldBrowser.removeEventListener(\\\"DOMPopupBlocked\\\", this.onPopupBlocked, false);\\n+\\n             // We are no longer the primary content area.\\n             oldBrowser.setAttribute(\\\"type\\\", \\\"content\\\");\\n \\n@@ -1142,6 +1154,7 @@\\n \\n       <constructor>\\n         <![CDATA[\\n+        this.addEventListener(\\\"DOMPopupBlocked\\\", this.onPopupBlocked, false);\\n         this.mCurrentBrowser = this.mPanelContainer.firstChild;\\n         this.mCurrentTab = this.mTabContainer.firstChild;\\n         this.mTabBox.setAttribute(\\\"handleCtrlTab\\\", \\\"false\\\");\\n@@ -1156,6 +1169,7 @@\\n             this.mTabFilters[i] = null;\\n             this.mTabListeners[i] = null;\\n             this.mPanelContainer.childNodes[i].removeEventListener(\\\"DOMTitleChanged\\\", this.onTitleChanged, false);\\n+            this.mPanelContainer.childNodes[i].removeEventListener(\\\"DOMPopupBlocked\\\", this.onPopupBlocked, false);\\n           }\\n           this.mPanelContainer.removeEventListener(\\\"DOMLinkAdded\\\", this.onLinkAdded, false);\\n         ]]>\\n\""}