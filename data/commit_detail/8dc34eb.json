{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas8dc34eb\""},"diff":"\"8dc34eb fix for bug #340547.  error in tabbrowser.xml cause by a leak fix.  r=mconnor\\ndiff --git a/browser/base/content/tabbrowser.xml b/browser/base/content/tabbrowser.xml\\nindex ba6f55d..4ed57ef 100644\\n--- a/browser/base/content/tabbrowser.xml\\n+++ b/browser/base/content/tabbrowser.xml\\n@@ -2270,7 +2270,7 @@\\n         <xul:spacer class=\\\"tabs-right\\\" flex=\\\"1\\\"/>\\n       </xul:hbox>\\n     </content>\\n-    <implementation implements=\\\"nsIObserver\\\">\\n+    <implementation>\\n       <constructor>\\n         var pb2 =\\n             Components.classes['@mozilla.org/preferences-service;1'].\\n@@ -2282,7 +2282,7 @@\\n         }\\n \\n         this._updateDisableBackgroundClose();\\n-        pb2.addObserver(\\\"browser.tabs.disableBackgroundClose\\\", this, true);\\n+        pb2.addObserver(\\\"browser.tabs.disableBackgroundClose\\\", this._prefObserver, true);\\n \\n         var self = this;\\n         function onResize() {\\n@@ -2307,15 +2307,25 @@\\n           }\\n         ]]></body>\\n       </method>\\n-      <method name=\\\"observe\\\">\\n-        <parameter name=\\\"subject\\\"/>\\n-        <parameter name=\\\"topic\\\"/>\\n-        <parameter name=\\\"data\\\"/>\\n-        <body><![CDATA[\\n+      <field name=\\\"_prefObserver\\\">({\\n+        tabbox: this,\\n+  \\n+        observe: function(subject, topic, data)\\n+        {\\n           if (topic == \\\"nsPref:changed\\\")\\n-            this._updateDisableBackgroundClose();\\n-        ]]></body>\\n-      </method>\\n+            this.tabbox._updateDisableBackgroundClose();\\n+        },\\n+  \\n+        QueryInterface : function(aIID)\\n+        {\\n+          if (aIID.equals(Components.interfaces.nsIObserver) ||\\n+              aIID.equals(Components.interfaces.nsISupportsWeakReference) ||\\n+              aIID.equals(Components.interfaces.nsISupports))\\n+            return this;\\n+          throw Components.results.NS_NOINTERFACE;\\n+        }\\n+        });\\n+      </field>\\n       <field name=\\\"mTabClipWidth\\\">140</field>\\n       <method name=\\\"adjustCloseButtons\\\">\\n         <parameter name=\\\"aNumTabs\\\"/>\\n\""}