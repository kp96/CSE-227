{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basc8cae81\""},"diff":"\"c8cae81 Bug 397551 - <svg:use> reference loop makes a bunch of elements leak. r=longsonr, sr+a=roc\\ndiff --git a/content/svg/content/src/nsSVGUseElement.cpp b/content/svg/content/src/nsSVGUseElement.cpp\\nindex 70b8825..5a2e7d3 100644\\n--- a/content/svg/content/src/nsSVGUseElement.cpp\\n+++ b/content/svg/content/src/nsSVGUseElement.cpp\\n@@ -277,11 +277,11 @@ nsSVGUseElement::CreateAnonymousContent()\\n   if (!targetContent)\\n     return nsnull;\\n \\n+  PRBool needAddObserver = PR_FALSE;\\n   if (mSourceContent != targetContent) {\\n     RemoveListener();\\n-    targetContent->AddMutationObserver(this);\\n+    needAddObserver = PR_TRUE;\\n   }\\n-  mSourceContent = targetContent;\\n \\n   // make sure target is valid type for <use>\\n   // QIable nsSVGGraphicsElement would eliminate enumerating all elements\\n@@ -402,6 +402,10 @@ nsSVGUseElement::CreateAnonymousContent()\\n     }\\n   }\\n \\n+  if (needAddObserver) {\\n+    targetContent->AddMutationObserver(this);\\n+  }\\n+  mSourceContent = targetContent;\\n   mClone = newcontent;\\n   return mClone;\\n }\\n\""}