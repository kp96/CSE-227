{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basad925d2\""},"diff":"\"ad925d2 Bug 235825: \\\"I'm Feeling Lucky\\\" search from address bar doesn't activate Stop toolbar button, patch by Simon BÃ¼nzli <zeniko@gmail.com>, r=mconnor\\ndiff --git a/browser/base/content/tabbrowser.xml b/browser/base/content/tabbrowser.xml\\nindex d03568e..9405b98 100644\\n--- a/browser/base/content/tabbrowser.xml\\n+++ b/browser/base/content/tabbrowser.xml\\n@@ -301,6 +301,9 @@\\n             mMessage: \\\"\\\",\\n             mTotalProgress: 0,\\n \\n+            // count of open requests (should always be 0 or 1)\\n+            mRequestCount: 0,\\n+\\n             onProgressChange : function (aWebProgress, aRequest,\\n                                          aCurSelfProgress, aMaxSelfProgress,\\n                                          aCurTotalProgress, aMaxTotalProgress)\\n@@ -328,6 +331,21 @@\\n               const nsIWebProgressListener = Components.interfaces.nsIWebProgressListener;\\n               const nsIChannel = Components.interfaces.nsIChannel;\\n \\n+              if (aStateFlags & nsIWebProgressListener.STATE_START) {\\n+                this.mRequestCount++;\\n+              }\\n+              else if (aStateFlags & nsIWebProgressListener.STATE_STOP) {\\n+                const NS_ERROR_UNKNOWN_HOST = 2152398878;\\n+                if (--this.mRequestCount > 0 && aStatus == NS_ERROR_UNKNOWN_HOST) {\\n+                  // to prevent bug 235825: wait for the request handled\\n+                  // by the automatic keyword resolver\\n+                  return;\\n+                }\\n+                // since we (try to) only handle STATE_STOP of the last request,\\n+                // the count of open requests should now be 0\\n+                this.mRequestCount = 0;\\n+              }\\n+\\n               if (aStateFlags & nsIWebProgressListener.STATE_START &&\\n                   aStateFlags & nsIWebProgressListener.STATE_IS_NETWORK) {\\n                 // It's okay to clear what the user typed when we start\\n\""}