{"bug_id":286382,"commitHash":"2fdb64b","commit_info":{"sha":"2fdb64b72132e4f6ebb69e75843de8e00c37932d","commit":{"author":{"name":"Ehsan Akhgari","email":"ehsan@mozilla.com","date":"2010-09-29T00:33:43Z"},"committer":{"name":"Ehsan Akhgari","email":"ehsan@mozilla.com","date":"2010-09-29T00:33:43Z"},"message":"Bug 286382 - Don't load DLLs from the current directory; r=bsmedberg a=blocking-betaN+","tree":{"sha":"58e536e28a667b94bc6116cdea85b668b39a6c86","url":"https://api.github.com/repos/mozilla/gecko-dev/git/trees/58e536e28a667b94bc6116cdea85b668b39a6c86"},"url":"https://api.github.com/repos/mozilla/gecko-dev/git/commits/2fdb64b72132e4f6ebb69e75843de8e00c37932d","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/mozilla/gecko-dev/commits/2fdb64b72132e4f6ebb69e75843de8e00c37932d","html_url":"https://github.com/mozilla/gecko-dev/commit/2fdb64b72132e4f6ebb69e75843de8e00c37932d","comments_url":"https://api.github.com/repos/mozilla/gecko-dev/commits/2fdb64b72132e4f6ebb69e75843de8e00c37932d/comments","author":{"login":"ehsan","id":168508,"avatar_url":"https://avatars0.githubusercontent.com/u/168508?v=4","gravatar_id":"","url":"https://api.github.com/users/ehsan","html_url":"https://github.com/ehsan","followers_url":"https://api.github.com/users/ehsan/followers","following_url":"https://api.github.com/users/ehsan/following{/other_user}","gists_url":"https://api.github.com/users/ehsan/gists{/gist_id}","starred_url":"https://api.github.com/users/ehsan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ehsan/subscriptions","organizations_url":"https://api.github.com/users/ehsan/orgs","repos_url":"https://api.github.com/users/ehsan/repos","events_url":"https://api.github.com/users/ehsan/events{/privacy}","received_events_url":"https://api.github.com/users/ehsan/received_events","type":"User","site_admin":false},"committer":{"login":"ehsan","id":168508,"avatar_url":"https://avatars0.githubusercontent.com/u/168508?v=4","gravatar_id":"","url":"https://api.github.com/users/ehsan","html_url":"https://github.com/ehsan","followers_url":"https://api.github.com/users/ehsan/followers","following_url":"https://api.github.com/users/ehsan/following{/other_user}","gists_url":"https://api.github.com/users/ehsan/gists{/gist_id}","starred_url":"https://api.github.com/users/ehsan/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/ehsan/subscriptions","organizations_url":"https://api.github.com/users/ehsan/orgs","repos_url":"https://api.github.com/users/ehsan/repos","events_url":"https://api.github.com/users/ehsan/events{/privacy}","received_events_url":"https://api.github.com/users/ehsan/received_events","type":"User","site_admin":false},"parents":[{"sha":"d0803805a50b53b805c1df3471c4dc0726c471f8","url":"https://api.github.com/repos/mozilla/gecko-dev/commits/d0803805a50b53b805c1df3471c4dc0726c471f8","html_url":"https://github.com/mozilla/gecko-dev/commit/d0803805a50b53b805c1df3471c4dc0726c471f8"}],"stats":{"total":33,"additions":33,"deletions":0},"files":[{"sha":"c764af4bd01b70fb6bdddcb2aecc236414281aea","filename":"ipc/app/MozillaRuntimeMain.cpp","status":"modified","additions":11,"deletions":0,"changes":11,"blob_url":"https://github.com/mozilla/gecko-dev/blob/2fdb64b72132e4f6ebb69e75843de8e00c37932d/ipc/app/MozillaRuntimeMain.cpp","raw_url":"https://github.com/mozilla/gecko-dev/raw/2fdb64b72132e4f6ebb69e75843de8e00c37932d/ipc/app/MozillaRuntimeMain.cpp","contents_url":"https://api.github.com/repos/mozilla/gecko-dev/contents/ipc/app/MozillaRuntimeMain.cpp?ref=2fdb64b72132e4f6ebb69e75843de8e00c37932d","patch":"@@ -58,6 +58,17 @@ main(int argc, char* argv[])\n     MessageBox(NULL, L\"Hi\", L\"Hi\", MB_OK);\n #endif\n \n+#ifdef XP_WIN\n+    typedef BOOL\n+    (WINAPI *pfnSetDllDirectory) (LPCWSTR);\n+    pfnSetDllDirectory setDllDirectory =\n+        reinterpret_cast<pfnSetDllDirectory>\n+        (GetProcAddress(GetModuleHandleW(L\"kernel32.dll\"), \"SetDllDirectoryW\"));\n+    if (setDllDirectory) {\n+        setDllDirectory(L\"\");\n+    }\n+#endif\n+\n     // Check for the absolute minimum number of args we need to move\n     // forward here. We expect the last arg to be the child process type.\n     if (argc < 1)"},{"sha":"bb4d0ca9b1c8917b7ed110d68b693753553de6b8","filename":"modules/plugin/base/src/nsPluginsDirWin.cpp","status":"modified","additions":13,"deletions":0,"changes":13,"blob_url":"https://github.com/mozilla/gecko-dev/blob/2fdb64b72132e4f6ebb69e75843de8e00c37932d/modules/plugin/base/src/nsPluginsDirWin.cpp","raw_url":"https://github.com/mozilla/gecko-dev/raw/2fdb64b72132e4f6ebb69e75843de8e00c37932d/modules/plugin/base/src/nsPluginsDirWin.cpp","contents_url":"https://api.github.com/repos/mozilla/gecko-dev/contents/modules/plugin/base/src/nsPluginsDirWin.cpp?ref=2fdb64b72132e4f6ebb69e75843de8e00c37932d","patch":"@@ -287,10 +287,23 @@ nsresult nsPluginFile::LoadPlugin(PRLibrary **outLibrary)\n   }\n #endif\n \n+  typedef BOOL\n+  (WINAPI *pfnSetDllDirectory) (LPCWSTR);\n+  pfnSetDllDirectory setDllDirectory =\n+    reinterpret_cast<pfnSetDllDirectory>\n+    (GetProcAddress(GetModuleHandleW(L\"kernel32.dll\"), \"SetDllDirectoryW\"));\n+  if (setDllDirectory) {\n+    setDllDirectory(NULL);\n+  }\n+\n   nsresult rv = plugin->Load(outLibrary);\n   if (NS_FAILED(rv))\n       *outLibrary = NULL;\n \n+  if (setDllDirectory) {\n+    setDllDirectory(L\"\");\n+  }\n+\n #ifndef WINCE    \n   if (restoreOrigDir) {\n     BOOL bCheck = SetCurrentDirectoryW(aOrigDir);"},{"sha":"3cc5178df247dcdfd5e5f12cb0307bed33b518fe","filename":"toolkit/xre/nsWindowsWMain.cpp","status":"modified","additions":9,"deletions":0,"changes":9,"blob_url":"https://github.com/mozilla/gecko-dev/blob/2fdb64b72132e4f6ebb69e75843de8e00c37932d/toolkit/xre/nsWindowsWMain.cpp","raw_url":"https://github.com/mozilla/gecko-dev/raw/2fdb64b72132e4f6ebb69e75843de8e00c37932d/toolkit/xre/nsWindowsWMain.cpp","contents_url":"https://api.github.com/repos/mozilla/gecko-dev/contents/toolkit/xre/nsWindowsWMain.cpp?ref=2fdb64b72132e4f6ebb69e75843de8e00c37932d","patch":"@@ -90,6 +90,15 @@ void ExtractEnvironmentFromCL(int &argc, char **&argv)\n \n int wmain(int argc, WCHAR **argv)\n {\n+  typedef BOOL\n+  (WINAPI *pfnSetDllDirectory) (LPCWSTR);\n+  pfnSetDllDirectory setDllDirectory =\n+    reinterpret_cast<pfnSetDllDirectory>\n+    (GetProcAddress(GetModuleHandleW(L\"kernel32.dll\"), \"SetDllDirectoryW\"));\n+  if (setDllDirectory) {\n+    setDllDirectory(L\"\");\n+  }\n+\n #ifdef XRE_WANT_DLL_BLOCKLIST\n   SetupDllBlocklist();\n #endif"}]},"blames":["896d5d4e","55c13c87","bd75396c","5762c752","eaa8b5de","fd5b74bf"]}