{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas57e608e\""},"diff":[{"chunks":[{"content":"@@ -78,7 +78,7 @@ const OBSERVING = [","changes":[{"type":"normal","normal":true,"ln1":78,"ln2":78,"content":" "},{"type":"normal","normal":true,"ln1":79,"ln2":79,"content":" /*"},{"type":"normal","normal":true,"ln1":80,"ln2":80,"content":" XUL Window properties to (re)store"},{"type":"del","del":true,"ln":81,"content":"-Restored in restoreDimensions_proxy()"},{"type":"add","add":true,"ln":81,"content":"+Restored in restoreDimensions()"},{"type":"normal","normal":true,"ln1":82,"ln2":82,"content":" */"},{"type":"normal","normal":true,"ln1":83,"ln2":83,"content":" const WINDOW_ATTRIBUTES = [\"width\", \"height\", \"screenX\", \"screenY\", \"sizemode\"];"},{"type":"normal","normal":true,"ln1":84,"ln2":84,"content":" "}],"oldStart":78,"oldLines":7,"newStart":78,"newLines":7},{"content":"@@ -452,6 +452,10 @@ SessionStoreService.prototype = {","changes":[{"type":"normal","normal":true,"ln1":452,"ln2":452,"content":"       return;"},{"type":"normal","normal":true,"ln1":453,"ln2":453,"content":"     }"},{"type":"normal","normal":true,"ln1":454,"ln2":454,"content":"     "},{"type":"add","add":true,"ln":455,"content":"+    if (this.windowToFocus && this.windowToFocus == aWindow) {"},{"type":"add","add":true,"ln":456,"content":"+      delete this.windowToFocus;"},{"type":"add","add":true,"ln":457,"content":"+    }"},{"type":"add","add":true,"ln":458,"content":"+    "},{"type":"normal","normal":true,"ln1":455,"ln2":459,"content":"     var tabbrowser = aWindow.getBrowser();"},{"type":"normal","normal":true,"ln1":456,"ln2":460,"content":"     var tabpanels = tabbrowser.mPanelContainer;"},{"type":"normal","normal":true,"ln1":457,"ln2":461,"content":" "}],"oldStart":452,"oldLines":6,"newStart":452,"newLines":10},{"content":"@@ -1175,18 +1179,16 @@ SessionStoreService.prototype = {","changes":[{"type":"normal","normal":true,"ln1":1175,"ln2":1179,"content":"     }"},{"type":"normal","normal":true,"ln1":1176,"ln2":1180,"content":"     this._updateCookies(total);"},{"type":"normal","normal":true,"ln1":1177,"ln2":1181,"content":"     "},{"type":"del","del":true,"ln":1178,"content":"-    // make sure that the current window is restored first"},{"type":"del","del":true,"ln":1179,"content":"-    var ix = activeWindow ? windows.indexOf(activeWindow.__SSi || \"\") : -1;"},{"type":"del","del":true,"ln":1180,"content":"-    if (ix > 0) {"},{"type":"del","del":true,"ln":1181,"content":"-      total.unshift(total.splice(ix, 1)[0]);"},{"type":"del","del":true,"ln":1182,"content":"-    }"},{"type":"del","del":true,"ln":1183,"content":"-"},{"type":"normal","normal":true,"ln1":1184,"ln2":1182,"content":"     // if no browser window remains open, return the state of the last closed window"},{"type":"normal","normal":true,"ln1":1185,"ln2":1183,"content":"     if (total.length == 0 && this._lastWindowClosed) {"},{"type":"normal","normal":true,"ln1":1186,"ln2":1184,"content":"       total.push(this._lastWindowClosed);"},{"type":"normal","normal":true,"ln1":1187,"ln2":1185,"content":"     }"},{"type":"del","del":true,"ln":1188,"content":"-    "},{"type":"del","del":true,"ln":1189,"content":"-    return { windows: total };"},{"type":"add","add":true,"ln":1186,"content":"+    if (activeWindow) {"},{"type":"add","add":true,"ln":1187,"content":"+      this.activeWindowSSiCache = activeWindow.__SSi || \"\";"},{"type":"add","add":true,"ln":1188,"content":"+    }"},{"type":"add","add":true,"ln":1189,"content":"+    ix = this.activeWindowSSiCache ? windows.indexOf(this.activeWindowSSiCache) : -1;"},{"type":"add","add":true,"ln":1190,"content":"+"},{"type":"add","add":true,"ln":1191,"content":"+    return { windows: total, selectedWindow: ix + 1 };"},{"type":"normal","normal":true,"ln1":1190,"ln2":1192,"content":"   },"},{"type":"normal","normal":true,"ln1":1191,"ln2":1193,"content":" "},{"type":"normal","normal":true,"ln1":1192,"ln2":1194,"content":"   /**"}],"oldStart":1175,"oldLines":18,"newStart":1179,"newLines":16},{"content":"@@ -1226,8 +1228,13 @@ SessionStoreService.prototype = {","changes":[{"type":"normal","normal":true,"ln1":1226,"ln2":1228,"content":"    *        JS object or its eval'able source"},{"type":"normal","normal":true,"ln1":1227,"ln2":1229,"content":"    * @param aOverwriteTabs"},{"type":"normal","normal":true,"ln1":1228,"ln2":1230,"content":"    *        bool overwrite existing tabs w/ new ones"},{"type":"add","add":true,"ln":1231,"content":"+   * @param aFollowUp"},{"type":"add","add":true,"ln":1232,"content":"+   *        bool this isn't the restoration of the first window"},{"type":"normal","normal":true,"ln1":1229,"ln2":1233,"content":"    */"},{"type":"del","del":true,"ln":1230,"content":"-  restoreWindow: function sss_restoreWindow(aWindow, aState, aOverwriteTabs) {"},{"type":"add","add":true,"ln":1234,"content":"+  restoreWindow: function sss_restoreWindow(aWindow, aState, aOverwriteTabs, aFollowUp) {"},{"type":"add","add":true,"ln":1235,"content":"+    if (!aFollowUp) {"},{"type":"add","add":true,"ln":1236,"content":"+      this.windowToFocus = aWindow;"},{"type":"add","add":true,"ln":1237,"content":"+    }"},{"type":"normal","normal":true,"ln1":1231,"ln2":1238,"content":"     // initialize window if necessary"},{"type":"normal","normal":true,"ln1":1232,"ln2":1239,"content":"     if (aWindow && (!aWindow.__SSi || !this._windows[aWindow.__SSi]))"},{"type":"normal","normal":true,"ln1":1233,"ln2":1240,"content":"       this.onLoad(aWindow);"}],"oldStart":1226,"oldLines":8,"newStart":1228,"newLines":13},{"content":"@@ -1244,15 +1251,20 @@ SessionStoreService.prototype = {","changes":[{"type":"normal","normal":true,"ln1":1244,"ln2":1251,"content":"     }"},{"type":"normal","normal":true,"ln1":1245,"ln2":1252,"content":"     "},{"type":"normal","normal":true,"ln1":1246,"ln2":1253,"content":"     var winData;"},{"type":"add","add":true,"ln":1254,"content":"+    if (!aState.selectedWindow) {"},{"type":"add","add":true,"ln":1255,"content":"+      aState.selectedWindow = 0;"},{"type":"add","add":true,"ln":1256,"content":"+    }"},{"type":"normal","normal":true,"ln1":1247,"ln2":1257,"content":"     // open new windows for all further window entries of a multi-window session"},{"type":"normal","normal":true,"ln1":1248,"ln2":1258,"content":"     // (unless they don't contain any tab data)"},{"type":"normal","normal":true,"ln1":1249,"ln2":1259,"content":"     for (var w = 1; w < root.windows.length; w++) {"},{"type":"normal","normal":true,"ln1":1250,"ln2":1260,"content":"       winData = root.windows[w];"},{"type":"normal","normal":true,"ln1":1251,"ln2":1261,"content":"       if (winData && winData.tabs && winData.tabs[0]) {"},{"type":"del","del":true,"ln":1252,"content":"-        this._openWindowWithState({ windows: [winData], opener: aWindow });"},{"type":"add","add":true,"ln":1262,"content":"+        var window = this._openWindowWithState({ windows: [winData] });"},{"type":"add","add":true,"ln":1263,"content":"+        if (w == aState.selectedWindow - 1) {"},{"type":"add","add":true,"ln":1264,"content":"+          this.windowToFocus = window;"},{"type":"add","add":true,"ln":1265,"content":"+        }"},{"type":"normal","normal":true,"ln1":1253,"ln2":1266,"content":"       }"},{"type":"normal","normal":true,"ln1":1254,"ln2":1267,"content":"     }"},{"type":"del","del":true,"ln":1255,"content":"-    "},{"type":"normal","normal":true,"ln1":1256,"ln2":1268,"content":"     winData = root.windows[0];"},{"type":"normal","normal":true,"ln1":1257,"ln2":1269,"content":"     if (!winData.tabs) {"},{"type":"normal","normal":true,"ln1":1258,"ln2":1270,"content":"       winData.tabs = [];"}],"oldStart":1244,"oldLines":15,"newStart":1251,"newLines":20},{"content":"@@ -1276,7 +1288,7 @@ SessionStoreService.prototype = {","changes":[{"type":"normal","normal":true,"ln1":1276,"ln2":1288,"content":"     }"},{"type":"normal","normal":true,"ln1":1277,"ln2":1289,"content":"     "},{"type":"normal","normal":true,"ln1":1278,"ln2":1290,"content":"     if (aOverwriteTabs) {"},{"type":"del","del":true,"ln":1279,"content":"-      this.restoreWindowFeatures(aWindow, winData, root.opener || null);"},{"type":"add","add":true,"ln":1291,"content":"+      this.restoreWindowFeatures(aWindow, winData);"},{"type":"normal","normal":true,"ln1":1280,"ln2":1292,"content":"     }"},{"type":"normal","normal":true,"ln1":1281,"ln2":1293,"content":"     if (winData.cookies) {"},{"type":"normal","normal":true,"ln1":1282,"ln2":1294,"content":"       this.restoreCookies(winData.cookies);"}],"oldStart":1276,"oldLines":7,"newStart":1288,"newLines":7},{"content":"@@ -1590,10 +1602,8 @@ SessionStoreService.prototype = {","changes":[{"type":"normal","normal":true,"ln1":1590,"ln2":1602,"content":"    *        Window reference"},{"type":"normal","normal":true,"ln1":1591,"ln2":1603,"content":"    * @param aWinData"},{"type":"normal","normal":true,"ln1":1592,"ln2":1604,"content":"    *        Object containing session data for the window"},{"type":"del","del":true,"ln":1593,"content":"-   * @param aOpener"},{"type":"del","del":true,"ln":1594,"content":"-   *        Opening window, for refocusing"},{"type":"normal","normal":true,"ln1":1595,"ln2":1605,"content":"    */"},{"type":"del","del":true,"ln":1596,"content":"-  restoreWindowFeatures: function sss_restoreWindowFeatures(aWindow, aWinData, aOpener) {"},{"type":"add","add":true,"ln":1606,"content":"+  restoreWindowFeatures: function sss_restoreWindowFeatures(aWindow, aWinData) {"},{"type":"normal","normal":true,"ln1":1597,"ln2":1607,"content":"     var hidden = (aWinData.hidden)?aWinData.hidden.split(\",\"):[];"},{"type":"normal","normal":true,"ln1":1598,"ln2":1608,"content":"     WINDOW_HIDEABLE_FEATURES.forEach(function(aItem) {"},{"type":"normal","normal":true,"ln1":1599,"ln2":1609,"content":"       aWindow[aItem].visible = hidden.indexOf(aItem) == -1;"}],"oldStart":1590,"oldLines":10,"newStart":1602,"newLines":8},{"content":"@@ -1601,7 +1611,7 @@ SessionStoreService.prototype = {","changes":[{"type":"normal","normal":true,"ln1":1601,"ln2":1611,"content":"     "},{"type":"normal","normal":true,"ln1":1602,"ln2":1612,"content":"     var _this = this;"},{"type":"normal","normal":true,"ln1":1603,"ln2":1613,"content":"     aWindow.setTimeout(function() {"},{"type":"del","del":true,"ln":1604,"content":"-      _this.restoreDimensions_proxy.apply(_this, [aWindow, aOpener, aWinData.width || 0, "},{"type":"add","add":true,"ln":1614,"content":"+      _this.restoreDimensions.apply(_this, [aWindow, aWinData.width || 0, "},{"type":"normal","normal":true,"ln1":1605,"ln2":1615,"content":"         aWinData.height || 0, \"screenX\" in aWinData ? aWinData.screenX : NaN,"},{"type":"normal","normal":true,"ln1":1606,"ln2":1616,"content":"         \"screenY\" in aWinData ? aWinData.screenY : NaN,"},{"type":"normal","normal":true,"ln1":1607,"ln2":1617,"content":"         aWinData.sizemode || \"\", aWinData.sidebar || \"\"]);"}],"oldStart":1601,"oldLines":7,"newStart":1611,"newLines":7},{"content":"@@ -1610,8 +1620,6 @@ SessionStoreService.prototype = {","changes":[{"type":"normal","normal":true,"ln1":1610,"ln2":1620,"content":" "},{"type":"normal","normal":true,"ln1":1611,"ln2":1621,"content":"   /**"},{"type":"normal","normal":true,"ln1":1612,"ln2":1622,"content":"    * Restore a window's dimensions"},{"type":"del","del":true,"ln":1613,"content":"-   * @param aOpener"},{"type":"del","del":true,"ln":1614,"content":"-   *        Opening window, for refocusing"},{"type":"normal","normal":true,"ln1":1615,"ln2":1623,"content":"    * @param aWidth"},{"type":"normal","normal":true,"ln1":1616,"ln2":1624,"content":"    *        Window width"},{"type":"normal","normal":true,"ln1":1617,"ln2":1625,"content":"    * @param aHeight"}],"oldStart":1610,"oldLines":8,"newStart":1620,"newLines":6},{"content":"@@ -1625,7 +1633,7 @@ SessionStoreService.prototype = {","changes":[{"type":"normal","normal":true,"ln1":1625,"ln2":1633,"content":"    * @param aSidebar"},{"type":"normal","normal":true,"ln1":1626,"ln2":1634,"content":"    *        Sidebar command"},{"type":"normal","normal":true,"ln1":1627,"ln2":1635,"content":"    */"},{"type":"del","del":true,"ln":1628,"content":"-  restoreDimensions_proxy: function sss_restoreDimensions_proxy(aWindow, aOpener, aWidth, aHeight, aLeft, aTop, aSizeMode, aSidebar) {"},{"type":"add","add":true,"ln":1636,"content":"+  restoreDimensions: function sss_restoreDimensions(aWindow, aWidth, aHeight, aLeft, aTop, aSizeMode, aSidebar) {"},{"type":"normal","normal":true,"ln1":1629,"ln2":1637,"content":"     var win = aWindow;"},{"type":"normal","normal":true,"ln1":1630,"ln2":1638,"content":"     var _this = this;"},{"type":"normal","normal":true,"ln1":1631,"ln2":1639,"content":"     function win_(aName) { return _this._getWindowDimension(win, aName); }"}],"oldStart":1625,"oldLines":7,"newStart":1633,"newLines":7},{"content":"@@ -1648,9 +1656,9 @@ SessionStoreService.prototype = {","changes":[{"type":"normal","normal":true,"ln1":1648,"ln2":1656,"content":"       aWindow.toggleSidebar(aSidebar);"},{"type":"normal","normal":true,"ln1":1649,"ln2":1657,"content":"     }"},{"type":"normal","normal":true,"ln1":1650,"ln2":1658,"content":"     // since resizing/moving a window brings it to the foreground,"},{"type":"del","del":true,"ln":1651,"content":"-    // we might want to re-focus the window which created this one"},{"type":"del","del":true,"ln":1652,"content":"-    if (aOpener) {"},{"type":"del","del":true,"ln":1653,"content":"-      aOpener.focus();"},{"type":"add","add":true,"ln":1659,"content":"+    // we might want to re-focus the last focused window"},{"type":"add","add":true,"ln":1660,"content":"+    if (this.windowToFocus) {"},{"type":"add","add":true,"ln":1661,"content":"+      this.windowToFocus.focus();"},{"type":"normal","normal":true,"ln1":1654,"ln2":1662,"content":"     }"},{"type":"normal","normal":true,"ln1":1655,"ln2":1663,"content":"   },"},{"type":"normal","normal":true,"ln1":1656,"ln2":1664,"content":" "}],"oldStart":1648,"oldLines":9,"newStart":1656,"newLines":9},{"content":"@@ -1818,6 +1826,8 @@ SessionStoreService.prototype = {","changes":[{"type":"normal","normal":true,"ln1":1818,"ln2":1826,"content":"       _this.restoreWindow(aEvent.currentTarget, aEvent.currentTarget.__SS_state, true, true);"},{"type":"normal","normal":true,"ln1":1819,"ln2":1827,"content":"       delete aEvent.currentTarget.__SS_state;"},{"type":"normal","normal":true,"ln1":1820,"ln2":1828,"content":"     }, true);"},{"type":"add","add":true,"ln":1829,"content":"+    "},{"type":"add","add":true,"ln":1830,"content":"+    return window;"},{"type":"normal","normal":true,"ln1":1821,"ln2":1831,"content":"   },"},{"type":"normal","normal":true,"ln1":1822,"ln2":1832,"content":" "},{"type":"normal","normal":true,"ln1":1823,"ln2":1833,"content":"   /**"}],"oldStart":1818,"oldLines":6,"newStart":1826,"newLines":8}],"deletions":23,"additions":33,"from":"browser/components/sessionstore/src/nsSessionStore.js","to":"browser/components/sessionstore/src/nsSessionStore.js","index":["8ec4f77..8e1fefb","100644"]}]}