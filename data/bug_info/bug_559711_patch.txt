Bug 559711 - Disable NSS in the content process, r?honza

diff --git a/security/manager/ssl/src/nsNSSComponent.cpp b/security/manager/ssl/src/nsNSSComponent.cpp
--- a/security/manager/ssl/src/nsNSSComponent.cpp
+++ b/security/manager/ssl/src/nsNSSComponent.cpp
@@ -115,16 +115,18 @@
 #include "secmime.h"
 #include "ocsp.h"
 #include "cms.h"
 #include "nssckbi.h"
 #include "base64.h"
 #include "secerr.h"
 #include "sslerr.h"
 
+#include "nsXULAppAPI.h"
+
 #ifdef XP_WIN
 #include "nsILocalFileWin.h"
 #endif
 
 extern "C" {
 #include "pkcs12.h"
 #include "p12plcy.h"
 }
@@ -278,16 +280,21 @@ nsTokenEventRunnable::Run()
 
   return nssComponent->DispatchEvent(mType, mTokenName);
 }
 
 // We must ensure that the nsNSSComponent has been loaded before
 // creating any other components.
 PRBool EnsureNSSInitialized(EnsureNSSOperator op)
 {
+  if (GeckoProcessType_Default != XRE_GetProcessType()) {
+    NS_ERROR("Trying to initialize PSM/NSS in a non-chrome process!");
+    return PR_FALSE;
+  }
+
   static PRBool loading = PR_FALSE;
   static PRInt32 haveLoaded = 0;
 
   switch (op)
   {
     // In following 4 cases we are protected by monitor of XPCOM component
     // manager - we are inside of do_GetService call for nss component, so it is
     // safe to move with the flags here.
