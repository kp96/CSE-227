{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas4414a6a\""},"diff":[{"chunks":[{"content":"@@ -289,10 +289,26 @@ nsParser::~nsParser()","changes":[{"type":"normal","normal":true,"ln1":289,"ln2":289,"content":"   NS_ASSERTION(!(mFlags & NS_PARSER_FLAG_PENDING_CONTINUE_EVENT), \"bad\");"},{"type":"normal","normal":true,"ln1":290,"ln2":290,"content":" }"},{"type":"normal","normal":true,"ln1":291,"ln2":291,"content":" "},{"type":"del","del":true,"ln":292,"content":"-NS_IMPL_ISUPPORTS3(nsParser,"},{"type":"del","del":true,"ln":293,"content":"-                   nsIRequestObserver,"},{"type":"del","del":true,"ln":294,"content":"-                   nsIParser,"},{"type":"del","del":true,"ln":295,"content":"-                   nsIStreamListener)"},{"type":"add","add":true,"ln":292,"content":"+NS_IMPL_CYCLE_COLLECTION_CLASS(nsParser)"},{"type":"add","add":true,"ln":293,"content":"+"},{"type":"add","add":true,"ln":294,"content":"+NS_IMPL_CYCLE_COLLECTION_UNLINK_BEGIN(nsParser)"},{"type":"add","add":true,"ln":295,"content":"+ NS_IMPL_CYCLE_COLLECTION_UNLINK_NSCOMPTR(mSink)"},{"type":"add","add":true,"ln":296,"content":"+ NS_IMPL_CYCLE_COLLECTION_UNLINK_NSCOMPTR(mObserver)"},{"type":"add","add":true,"ln":297,"content":"+NS_IMPL_CYCLE_COLLECTION_UNLINK_END"},{"type":"add","add":true,"ln":298,"content":"+"},{"type":"add","add":true,"ln":299,"content":"+NS_IMPL_CYCLE_COLLECTION_TRAVERSE_BEGIN(nsParser)"},{"type":"add","add":true,"ln":300,"content":"+ NS_IMPL_CYCLE_COLLECTION_TRAVERSE_NSCOMPTR(mSink)"},{"type":"add","add":true,"ln":301,"content":"+ NS_IMPL_CYCLE_COLLECTION_TRAVERSE_NSCOMPTR(mObserver)"},{"type":"add","add":true,"ln":302,"content":"+NS_IMPL_CYCLE_COLLECTION_TRAVERSE_END"},{"type":"add","add":true,"ln":303,"content":"+"},{"type":"add","add":true,"ln":304,"content":"+NS_IMPL_CYCLE_COLLECTING_ADDREF_AMBIGUOUS(nsParser, nsIParser)"},{"type":"add","add":true,"ln":305,"content":"+NS_IMPL_CYCLE_COLLECTING_RELEASE_AMBIGUOUS(nsParser, nsIParser)"},{"type":"add","add":true,"ln":306,"content":"+NS_INTERFACE_MAP_BEGIN_CYCLE_COLLECTION(nsParser)"},{"type":"add","add":true,"ln":307,"content":"+ NS_INTERFACE_MAP_ENTRY(nsIStreamListener)"},{"type":"add","add":true,"ln":308,"content":"+ NS_INTERFACE_MAP_ENTRY(nsIParser)"},{"type":"add","add":true,"ln":309,"content":"+ NS_INTERFACE_MAP_ENTRY(nsIRequestObserver)"},{"type":"add","add":true,"ln":310,"content":"+ NS_INTERFACE_MAP_ENTRY_AMBIGUOUS(nsISupports, nsIParser)"},{"type":"add","add":true,"ln":311,"content":"+NS_INTERFACE_MAP_END"},{"type":"normal","normal":true,"ln1":296,"ln2":312,"content":" "},{"type":"normal","normal":true,"ln1":297,"ln2":313,"content":" // The parser continue event is posted only if"},{"type":"normal","normal":true,"ln1":298,"ln2":314,"content":" // all of the data to parse has been passed to ::OnDataAvailable"}],"oldStart":289,"oldLines":10,"newStart":289,"newLines":26}],"deletions":4,"additions":20,"from":"parser/htmlparser/src/nsParser.cpp","to":"parser/htmlparser/src/nsParser.cpp","index":["7cb84d4..cab3d05","100644"]},{"chunks":[{"content":"@@ -88,6 +88,7 @@","changes":[{"type":"normal","normal":true,"ln1":88,"ln2":88,"content":" #include \"nsIParserFilter.h\""},{"type":"normal","normal":true,"ln1":89,"ln2":89,"content":" #include \"nsCOMArray.h\""},{"type":"normal","normal":true,"ln1":90,"ln2":90,"content":" #include \"nsIUnicharStreamListener.h\""},{"type":"add","add":true,"ln":91,"content":"+#include \"nsCycleCollectionParticipant.h\""},{"type":"normal","normal":true,"ln1":91,"ln2":92,"content":" "},{"type":"normal","normal":true,"ln1":92,"ln2":93,"content":" class nsIDTD;"},{"type":"normal","normal":true,"ln1":93,"ln2":94,"content":" class nsScanner;"}],"oldStart":88,"oldLines":6,"newStart":88,"newLines":7},{"content":"@@ -114,8 +115,8 @@ class nsParser : public nsIParser,","changes":[{"type":"normal","normal":true,"ln1":114,"ln2":115,"content":"      */"},{"type":"normal","normal":true,"ln1":115,"ln2":116,"content":"     static void Shutdown();"},{"type":"normal","normal":true,"ln1":116,"ln2":117,"content":" "},{"type":"del","del":true,"ln":117,"content":"-    NS_DECL_ISUPPORTS"},{"type":"del","del":true,"ln":118,"content":"-"},{"type":"add","add":true,"ln":118,"content":"+    NS_DECL_CYCLE_COLLECTING_ISUPPORTS"},{"type":"add","add":true,"ln":119,"content":"+    NS_DECL_CYCLE_COLLECTION_CLASS_AMBIGUOUS(nsParser, nsIParser)"},{"type":"normal","normal":true,"ln1":119,"ln2":120,"content":" "},{"type":"normal","normal":true,"ln1":120,"ln2":121,"content":"     /**"},{"type":"normal","normal":true,"ln1":121,"ln2":122,"content":"      * default constructor"}],"oldStart":114,"oldLines":8,"newStart":115,"newLines":8}],"deletions":2,"additions":3,"from":"parser/htmlparser/src/nsParser.h","to":"parser/htmlparser/src/nsParser.h","index":["bfd2300..ef3497f","100644"]},{"chunks":[{"content":"@@ -52,10 +52,36 @@","changes":[{"type":"normal","normal":true,"ln1":52,"ln2":52,"content":" "},{"type":"normal","normal":true,"ln1":53,"ln2":53,"content":" static NS_DEFINE_CID(kParserCID, NS_PARSER_CID);"},{"type":"normal","normal":true,"ln1":54,"ln2":54,"content":" "},{"type":"del","del":true,"ln":55,"content":"-NS_IMPL_ISUPPORTS6(nsSAXXMLReader, nsISAXXMLReader,"},{"type":"del","del":true,"ln":56,"content":"-                   nsIExpatSink, nsIExtendedExpatSink,"},{"type":"del","del":true,"ln":57,"content":"-                   nsIContentSink,  nsIRequestObserver,"},{"type":"del","del":true,"ln":58,"content":"-                   nsIStreamListener)"},{"type":"add","add":true,"ln":55,"content":"+NS_IMPL_CYCLE_COLLECTION_CLASS(nsSAXXMLReader)"},{"type":"add","add":true,"ln":56,"content":"+NS_IMPL_CYCLE_COLLECTION_UNLINK_BEGIN(nsSAXXMLReader)"},{"type":"add","add":true,"ln":57,"content":"+  NS_IMPL_CYCLE_COLLECTION_UNLINK_NSCOMPTR(mContentHandler)"},{"type":"add","add":true,"ln":58,"content":"+  NS_IMPL_CYCLE_COLLECTION_UNLINK_NSCOMPTR(mDTDHandler)"},{"type":"add","add":true,"ln":59,"content":"+  NS_IMPL_CYCLE_COLLECTION_UNLINK_NSCOMPTR(mErrorHandler)"},{"type":"add","add":true,"ln":60,"content":"+  NS_IMPL_CYCLE_COLLECTION_UNLINK_NSCOMPTR(mLexicalHandler)"},{"type":"add","add":true,"ln":61,"content":"+  NS_IMPL_CYCLE_COLLECTION_UNLINK_NSCOMPTR(mBaseURI)"},{"type":"add","add":true,"ln":62,"content":"+  NS_IMPL_CYCLE_COLLECTION_UNLINK_NSCOMPTR(mListener)"},{"type":"add","add":true,"ln":63,"content":"+  NS_IMPL_CYCLE_COLLECTION_UNLINK_NSCOMPTR(mParserObserver)"},{"type":"add","add":true,"ln":64,"content":"+NS_IMPL_CYCLE_COLLECTION_UNLINK_END"},{"type":"add","add":true,"ln":65,"content":"+NS_IMPL_CYCLE_COLLECTION_TRAVERSE_BEGIN(nsSAXXMLReader)"},{"type":"add","add":true,"ln":66,"content":"+  NS_IMPL_CYCLE_COLLECTION_TRAVERSE_NSCOMPTR(mContentHandler)"},{"type":"add","add":true,"ln":67,"content":"+  NS_IMPL_CYCLE_COLLECTION_TRAVERSE_NSCOMPTR(mDTDHandler)"},{"type":"add","add":true,"ln":68,"content":"+  NS_IMPL_CYCLE_COLLECTION_TRAVERSE_NSCOMPTR(mErrorHandler)"},{"type":"add","add":true,"ln":69,"content":"+  NS_IMPL_CYCLE_COLLECTION_TRAVERSE_NSCOMPTR(mLexicalHandler)"},{"type":"add","add":true,"ln":70,"content":"+  NS_IMPL_CYCLE_COLLECTION_TRAVERSE_NSCOMPTR(mBaseURI)"},{"type":"add","add":true,"ln":71,"content":"+  NS_IMPL_CYCLE_COLLECTION_TRAVERSE_NSCOMPTR(mListener)"},{"type":"add","add":true,"ln":72,"content":"+  NS_IMPL_CYCLE_COLLECTION_TRAVERSE_NSCOMPTR(mParserObserver)"},{"type":"add","add":true,"ln":73,"content":"+NS_IMPL_CYCLE_COLLECTION_TRAVERSE_END"},{"type":"add","add":true,"ln":74,"content":"+NS_IMPL_CYCLE_COLLECTING_ADDREF_AMBIGUOUS(nsSAXXMLReader, nsISAXXMLReader)"},{"type":"add","add":true,"ln":75,"content":"+NS_IMPL_CYCLE_COLLECTING_RELEASE_AMBIGUOUS(nsSAXXMLReader, nsISAXXMLReader)"},{"type":"add","add":true,"ln":76,"content":"+NS_INTERFACE_MAP_BEGIN_CYCLE_COLLECTION(nsSAXXMLReader)"},{"type":"add","add":true,"ln":77,"content":"+  NS_INTERFACE_MAP_ENTRY(nsISAXXMLReader)"},{"type":"add","add":true,"ln":78,"content":"+  NS_INTERFACE_MAP_ENTRY(nsIExpatSink)"},{"type":"add","add":true,"ln":79,"content":"+  NS_INTERFACE_MAP_ENTRY(nsIExtendedExpatSink)"},{"type":"add","add":true,"ln":80,"content":"+  NS_INTERFACE_MAP_ENTRY(nsIContentSink)"},{"type":"add","add":true,"ln":81,"content":"+  NS_INTERFACE_MAP_ENTRY(nsIRequestObserver)"},{"type":"add","add":true,"ln":82,"content":"+  NS_INTERFACE_MAP_ENTRY(nsIStreamListener)"},{"type":"add","add":true,"ln":83,"content":"+  NS_INTERFACE_MAP_ENTRY_AMBIGUOUS(nsISupports, nsISAXXMLReader)"},{"type":"add","add":true,"ln":84,"content":"+NS_INTERFACE_MAP_END"},{"type":"normal","normal":true,"ln1":59,"ln2":85,"content":" "},{"type":"normal","normal":true,"ln1":60,"ln2":86,"content":" nsSAXXMLReader::nsSAXXMLReader() : mIsAsyncParse(PR_FALSE)"},{"type":"normal","normal":true,"ln1":61,"ln2":87,"content":" {"}],"oldStart":52,"oldLines":10,"newStart":52,"newLines":36}],"deletions":4,"additions":30,"from":"parser/xml/src/nsSAXXMLReader.cpp","to":"parser/xml/src/nsSAXXMLReader.cpp","index":["b40452d..0835e78","100644"]},{"chunks":[{"content":"@@ -48,6 +48,7 @@","changes":[{"type":"normal","normal":true,"ln1":48,"ln2":48,"content":" #include \"nsISAXDTDHandler.h\""},{"type":"normal","normal":true,"ln1":49,"ln2":49,"content":" #include \"nsISAXErrorHandler.h\""},{"type":"normal","normal":true,"ln1":50,"ln2":50,"content":" #include \"nsISAXLexicalHandler.h\""},{"type":"add","add":true,"ln":51,"content":"+#include \"nsCycleCollectionParticipant.h\""},{"type":"normal","normal":true,"ln1":51,"ln2":52,"content":" "},{"type":"normal","normal":true,"ln1":52,"ln2":53,"content":" #define NS_SAXXMLREADER_CONTRACTID \"@mozilla.org/saxparser/xmlreader;1\""},{"type":"normal","normal":true,"ln1":53,"ln2":54,"content":" #define NS_SAXXMLREADER_CLASSNAME \"SAX XML Reader\""}],"oldStart":48,"oldLines":6,"newStart":48,"newLines":7},{"content":"@@ -60,7 +61,8 @@ class nsSAXXMLReader : public nsISAXXMLReader,","changes":[{"type":"normal","normal":true,"ln1":60,"ln2":61,"content":"                        public nsIContentSink"},{"type":"normal","normal":true,"ln1":61,"ln2":62,"content":" {"},{"type":"normal","normal":true,"ln1":62,"ln2":63,"content":" public:"},{"type":"del","del":true,"ln":63,"content":"-  NS_DECL_ISUPPORTS"},{"type":"add","add":true,"ln":64,"content":"+  NS_DECL_CYCLE_COLLECTING_ISUPPORTS"},{"type":"add","add":true,"ln":65,"content":"+  NS_DECL_CYCLE_COLLECTION_CLASS_AMBIGUOUS(nsSAXXMLReader, nsISAXXMLReader)"},{"type":"normal","normal":true,"ln1":64,"ln2":66,"content":"   NS_DECL_NSIEXPATSINK"},{"type":"normal","normal":true,"ln1":65,"ln2":67,"content":"   NS_DECL_NSIEXTENDEDEXPATSINK"},{"type":"normal","normal":true,"ln1":66,"ln2":68,"content":"   NS_DECL_NSISAXXMLREADER"}],"oldStart":60,"oldLines":7,"newStart":61,"newLines":8}],"deletions":1,"additions":3,"from":"parser/xml/src/nsSAXXMLReader.h","to":"parser/xml/src/nsSAXXMLReader.h","index":["b0682ab..c42edc8","100644"]},{"chunks":[{"content":"@@ -1074,6 +1074,7 @@ function FeedProcessor() {","changes":[{"type":"normal","normal":true,"ln1":1074,"ln2":1074,"content":"   this._result = null;"},{"type":"normal","normal":true,"ln1":1075,"ln2":1075,"content":"   this._extensionHandler = null;"},{"type":"normal","normal":true,"ln1":1076,"ln2":1076,"content":"   this._xhtmlHandler = null;"},{"type":"add","add":true,"ln":1077,"content":"+  this._haveSentResult = false;"},{"type":"normal","normal":true,"ln1":1077,"ln2":1078,"content":"   "},{"type":"normal","normal":true,"ln1":1078,"ln2":1079,"content":"   // http://www.w3.org/WAI/PF/GUI/ uses QNames in content :("},{"type":"normal","normal":true,"ln1":1079,"ln2":1080,"content":"   this._waiPrefixes = {};"}],"oldStart":1074,"oldLines":6,"newStart":1074,"newLines":7},{"content":"@@ -1262,6 +1263,7 @@ FeedProcessor.prototype = {","changes":[{"type":"normal","normal":true,"ln1":1262,"ln2":1263,"content":"   // When we're done with the feed, let the listener know what"},{"type":"normal","normal":true,"ln1":1263,"ln2":1264,"content":"   // happened."},{"type":"normal","normal":true,"ln1":1264,"ln2":1265,"content":"   _sendResult: function FP_sendResult() {"},{"type":"add","add":true,"ln":1266,"content":"+    this._haveSentResult = true;"},{"type":"normal","normal":true,"ln1":1265,"ln2":1267,"content":"     try {"},{"type":"normal","normal":true,"ln1":1266,"ln2":1268,"content":"       // Can be null when a non-feed is fed to us"},{"type":"normal","normal":true,"ln1":1267,"ln2":1269,"content":"       if (this._result.doc)"}],"oldStart":1262,"oldLines":6,"newStart":1263,"newLines":7},{"content":"@@ -1331,7 +1333,8 @@ FeedProcessor.prototype = {","changes":[{"type":"normal","normal":true,"ln1":1331,"ln2":1333,"content":"   fatalError: function FP_reportError() {"},{"type":"normal","normal":true,"ln1":1332,"ln2":1334,"content":"     this._result.bozo = true;"},{"type":"normal","normal":true,"ln1":1333,"ln2":1335,"content":"     //XXX need to QI to FeedProgressListener"},{"type":"del","del":true,"ln":1334,"content":"-    this._sendResult();"},{"type":"add","add":true,"ln":1336,"content":"+    if (!this._haveSentResult)"},{"type":"add","add":true,"ln":1337,"content":"+      this._sendResult();"},{"type":"normal","normal":true,"ln1":1335,"ln2":1338,"content":"   },"},{"type":"normal","normal":true,"ln1":1336,"ln2":1339,"content":" "},{"type":"normal","normal":true,"ln1":1337,"ln2":1340,"content":"   // nsISAXContentHandler"}],"oldStart":1331,"oldLines":7,"newStart":1333,"newLines":8},{"content":"@@ -1341,7 +1344,8 @@ FeedProcessor.prototype = {","changes":[{"type":"normal","normal":true,"ln1":1341,"ln2":1344,"content":"   },"},{"type":"normal","normal":true,"ln1":1342,"ln2":1345,"content":" "},{"type":"normal","normal":true,"ln1":1343,"ln2":1346,"content":"   endDocument: function FP_endDocument() {"},{"type":"del","del":true,"ln":1344,"content":"-    this._sendResult();"},{"type":"add","add":true,"ln":1347,"content":"+    if (!this._haveSentResult)"},{"type":"add","add":true,"ln":1348,"content":"+      this._sendResult();"},{"type":"normal","normal":true,"ln1":1345,"ln2":1349,"content":"   },"},{"type":"normal","normal":true,"ln1":1346,"ln2":1350,"content":" "},{"type":"normal","normal":true,"ln1":1347,"ln2":1351,"content":"   // The transitions defined above identify elements that contain more"}],"oldStart":1341,"oldLines":7,"newStart":1344,"newLines":8}],"deletions":2,"additions":6,"from":"toolkit/components/feeds/src/FeedProcessor.js","to":"toolkit/components/feeds/src/FeedProcessor.js","index":["f9858a6..36a6a87","100644"]}]}