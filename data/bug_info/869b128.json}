{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas869b128\""},"diff":[{"chunks":[{"content":"@@ -49,6 +49,13 @@","changes":[{"type":"normal","normal":true,"ln1":49,"ln2":49,"content":"     function TestStart() {"},{"type":"normal","normal":true,"ln1":50,"ln2":50,"content":"       gConfig = readConfig();"},{"type":"normal","normal":true,"ln1":51,"ln2":51,"content":" "},{"type":"add","add":true,"ln":52,"content":"+      // If MochiTest was started with the --test-path flag specifying a subset"},{"type":"add","add":true,"ln":53,"content":"+      // of tests to run, put that path in the label of the \"Run Tests\" button"},{"type":"add","add":true,"ln":54,"content":"+      // so the tester knows which tests will run when they press that button."},{"type":"add","add":true,"ln":55,"content":"+      if (gConfig.testPath)"},{"type":"add","add":true,"ln":56,"content":"+        document.getElementById(\"runTestsButton\").label ="},{"type":"add","add":true,"ln":57,"content":"+          \"Run \" + gConfig.testPath + \" Tests\";"},{"type":"add","add":true,"ln":58,"content":"+"},{"type":"normal","normal":true,"ln1":52,"ln2":59,"content":"       if (gConfig.autoRun)"},{"type":"normal","normal":true,"ln1":53,"ln2":60,"content":"         setTimeout(runAllTests, 0);"},{"type":"normal","normal":true,"ln1":54,"ln2":61,"content":"     }"}],"oldStart":49,"oldLines":6,"newStart":49,"newLines":13},{"content":"@@ -129,8 +136,16 @@","changes":[{"type":"normal","normal":true,"ln1":129,"ln2":136,"content":"     function listTests() {"},{"type":"normal","normal":true,"ln1":130,"ln2":137,"content":"       const Cc = Components.classes; const Ci = Components.interfaces;"},{"type":"normal","normal":true,"ln1":131,"ln2":138,"content":" "},{"type":"add","add":true,"ln":139,"content":"+      var ioSvc = Cc[\"@mozilla.org/network/io-service;1\"]."},{"type":"add","add":true,"ln":140,"content":"+                  getService(Ci.nsIIOService);"},{"type":"add","add":true,"ln":141,"content":"+"},{"type":"normal","normal":true,"ln1":132,"ln2":142,"content":"       var testsDir = getChromeDir();"},{"type":"normal","normal":true,"ln1":133,"ln2":143,"content":"       testsDir.appendRelativePath(\"browser\");"},{"type":"add","add":true,"ln":144,"content":"+      if (gConfig.testPath) {"},{"type":"add","add":true,"ln":145,"content":"+        var testsDirURI = ioSvc.newFileURI(testsDir);"},{"type":"add","add":true,"ln":146,"content":"+        testsDir = ioSvc.newURI(gConfig.testPath, null, testsDirURI)"},{"type":"add","add":true,"ln":147,"content":"+                        .QueryInterface(Ci.nsIFileURL).file;"},{"type":"add","add":true,"ln":148,"content":"+      }"},{"type":"normal","normal":true,"ln1":134,"ln2":149,"content":" "},{"type":"normal","normal":true,"ln1":135,"ln2":150,"content":"       /** load server.js in so we can share template functions **/"},{"type":"normal","normal":true,"ln1":136,"ln2":151,"content":"       var scriptLoader = Cc[\"@mozilla.org/moz/jssubscript-loader;1\"]."}],"oldStart":129,"oldLines":8,"newStart":136,"newLines":16},{"content":"@@ -138,8 +153,11 @@","changes":[{"type":"normal","normal":true,"ln1":138,"ln2":153,"content":"       var srvScope = {};"},{"type":"normal","normal":true,"ln1":139,"ln2":154,"content":"       scriptLoader.loadSubScript(\"chrome://mochikit/content/server.js\", srvScope);"},{"type":"normal","normal":true,"ln1":140,"ln2":155,"content":" "},{"type":"del","del":true,"ln":141,"content":"-      var [links, count] = srvScope.list(\"chrome://mochikit/content/browser/\","},{"type":"del","del":true,"ln":142,"content":"-                                         testsDir, true);"},{"type":"add","add":true,"ln":156,"content":"+      var requestPath = \"chrome://mochikit/content/browser\";"},{"type":"add","add":true,"ln":157,"content":"+      if (gConfig.testPath)"},{"type":"add","add":true,"ln":158,"content":"+        requestPath += \"/\" + gConfig.testPath;"},{"type":"add","add":true,"ln":159,"content":"+"},{"type":"add","add":true,"ln":160,"content":"+      var [links, count] = srvScope.list(requestPath, testsDir, true);"},{"type":"normal","normal":true,"ln1":143,"ln2":161,"content":"       var fileNames = [];"},{"type":"normal","normal":true,"ln1":144,"ln2":162,"content":"       srvScope.arrayOfTestFiles(links, fileNames, /browser_.+\\.js$/);"},{"type":"normal","normal":true,"ln1":145,"ln2":163,"content":" "}],"oldStart":138,"oldLines":8,"newStart":153,"newLines":11},{"content":"@@ -210,7 +228,7 @@","changes":[{"type":"normal","normal":true,"ln1":210,"ln2":228,"content":"       setStatus(\"Done.\");"},{"type":"normal","normal":true,"ln1":211,"ln2":229,"content":"     }"},{"type":"normal","normal":true,"ln1":212,"ln2":230,"content":"   ]]></script>"},{"type":"del","del":true,"ln":213,"content":"-  <button onclick=\"runAllTests();\" label=\"Run All Tests\"/>"},{"type":"add","add":true,"ln":231,"content":"+  <button id=\"runTestsButton\" onclick=\"runAllTests();\" label=\"Run All Tests\"/>"},{"type":"normal","normal":true,"ln1":214,"ln2":232,"content":"   <label id=\"status\"/>"},{"type":"normal","normal":true,"ln1":215,"ln2":233,"content":"   <textbox flex=\"1\" multiline=\"true\" id=\"results\"/>"},{"type":"normal","normal":true,"ln1":216,"ln2":234,"content":" </window>"}],"oldStart":210,"oldLines":7,"newStart":228,"newLines":7}],"deletions":3,"additions":21,"from":"testing/mochitest/browser-harness.xul","to":"testing/mochitest/browser-harness.xul","index":["c7673a1..2e38230","100644"]},{"chunks":[{"content":"@@ -202,14 +202,15 @@ sub main {","changes":[{"type":"normal","normal":true,"ln1":202,"ln2":202,"content":"   if ($do_chrome) {"},{"type":"normal","normal":true,"ln1":203,"ln2":203,"content":"    $url = CHROMETESTS_URL . ($test_path ? $test_path : \"\") . \"?\";"},{"type":"normal","normal":true,"ln1":204,"ln2":204,"content":"   } elsif ($do_browser_chrome) {"},{"type":"del","del":true,"ln":205,"content":"-   # Tests will run from an overlay, no need to load any URL"},{"type":"add","add":true,"ln":205,"content":"+   # Tests will run from an overlay, no need to load any URL.  We'll include"},{"type":"add","add":true,"ln":206,"content":"+   # the test path in the config file so the browser chrome harness can use it."},{"type":"normal","normal":true,"ln1":206,"ln2":207,"content":"    $url = \"about:blank\";"},{"type":"normal","normal":true,"ln1":207,"ln2":208,"content":"   } else {"},{"type":"normal","normal":true,"ln1":208,"ln2":209,"content":"    $url = TESTS_URL . ($test_path ? $test_path : \"\") . \"?\";"},{"type":"normal","normal":true,"ln1":209,"ln2":210,"content":"   }"},{"type":"normal","normal":true,"ln1":210,"ln2":211,"content":" "},{"type":"normal","normal":true,"ln1":211,"ln2":212,"content":"   if ($do_browser_chrome) {"},{"type":"del","del":true,"ln":212,"content":"-    generate_test_config($autorun, $close_when_done, $log_path);"},{"type":"add","add":true,"ln":213,"content":"+    generate_test_config($autorun, $close_when_done, $log_path, $test_path);"},{"type":"normal","normal":true,"ln1":213,"ln2":214,"content":"   } else {"},{"type":"normal","normal":true,"ln1":214,"ln2":215,"content":"     if ($autorun) {"},{"type":"normal","normal":true,"ln1":215,"ln2":216,"content":"       $url .= \"&autorun=1\";"}],"oldStart":202,"oldLines":14,"newStart":202,"newLines":15},{"content":"@@ -367,17 +368,20 @@ sub startServer {","changes":[{"type":"normal","normal":true,"ln1":367,"ln2":368,"content":"  ##############"},{"type":"normal","normal":true,"ln1":368,"ln2":369,"content":" "},{"type":"normal","normal":true,"ln1":369,"ln2":370,"content":" sub generate_test_config {"},{"type":"del","del":true,"ln":370,"content":"-  my ($autorun, $close_when_done, $log_path) = @_;"},{"type":"add","add":true,"ln":371,"content":"+  my ($autorun, $close_when_done, $log_path, $test_path) = @_;"},{"type":"normal","normal":true,"ln1":371,"ln2":372,"content":"   $autorun = $autorun || 0;"},{"type":"normal","normal":true,"ln1":372,"ln2":373,"content":"   $close_when_done = $close_when_done || 0;"},{"type":"normal","normal":true,"ln1":373,"ln2":374,"content":"   $log_path = $log_path || \"\";"},{"type":"del","del":true,"ln":374,"content":"-  $log_path =~ s/\\\\/\\\\\\\\/;"},{"type":"add","add":true,"ln":375,"content":"+  $log_path =~ s/\\\\/\\\\\\\\/g;"},{"type":"add","add":true,"ln":376,"content":"+  $test_path = $test_path || \"\";"},{"type":"add","add":true,"ln":377,"content":"+  $test_path =~ s/\\\\/\\\\\\\\/g;"},{"type":"normal","normal":true,"ln1":375,"ln2":378,"content":" "},{"type":"normal","normal":true,"ln1":376,"ln2":379,"content":"   my $config_content = <<CONFIGEND;"},{"type":"normal","normal":true,"ln1":377,"ln2":380,"content":" ({"},{"type":"normal","normal":true,"ln1":378,"ln2":381,"content":"   autoRun: $autorun,"},{"type":"normal","normal":true,"ln1":379,"ln2":382,"content":"   closeWhenDone: $close_when_done,"},{"type":"del","del":true,"ln":380,"content":"-  logPath: \"$log_path\""},{"type":"add","add":true,"ln":383,"content":"+  logPath: \"$log_path\","},{"type":"add","add":true,"ln":384,"content":"+  testPath: \"$test_path\""},{"type":"normal","normal":true,"ln1":381,"ln2":385,"content":" })"},{"type":"normal","normal":true,"ln1":382,"ln2":386,"content":" CONFIGEND"},{"type":"normal","normal":true,"ln1":383,"ln2":387,"content":" "}],"oldStart":367,"oldLines":17,"newStart":368,"newLines":20}],"deletions":5,"additions":9,"from":"testing/mochitest/runtests.pl.in","to":"testing/mochitest/runtests.pl.in","index":["3f86bc1..2862212","100644"]}]}