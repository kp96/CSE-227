{"bug_id":309877,"commitHash":"a64f704","commit_info":{"sha":"a64f704309f133bacce67f320840bc48987f7fd3","commit":{"author":{"name":"timeless%mozdev.org","email":"timeless%mozdev.org","date":"2006-06-25T07:12:44Z"},"committer":{"name":"timeless%mozdev.org","email":"timeless%mozdev.org","date":"2006-06-25T07:12:44Z"},"message":"Bug 309877 PSM/NSS init (thus SSL/https) fails when no profile exists\noriginal patch by benb r=rrelyea moa=kaie","tree":{"sha":"ed3cdc6c872e9d9ea7ed4fe8a03205ab81e5db9a","url":"https://api.github.com/repos/mozilla/gecko-dev/git/trees/ed3cdc6c872e9d9ea7ed4fe8a03205ab81e5db9a"},"url":"https://api.github.com/repos/mozilla/gecko-dev/git/commits/a64f704309f133bacce67f320840bc48987f7fd3","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/mozilla/gecko-dev/commits/a64f704309f133bacce67f320840bc48987f7fd3","html_url":"https://github.com/mozilla/gecko-dev/commit/a64f704309f133bacce67f320840bc48987f7fd3","comments_url":"https://api.github.com/repos/mozilla/gecko-dev/commits/a64f704309f133bacce67f320840bc48987f7fd3/comments","author":null,"committer":null,"parents":[{"sha":"cd7fc3c66b88024cc447aff3df593d803bb0d574","url":"https://api.github.com/repos/mozilla/gecko-dev/commits/cd7fc3c66b88024cc447aff3df593d803bb0d574","html_url":"https://github.com/mozilla/gecko-dev/commit/cd7fc3c66b88024cc447aff3df593d803bb0d574"}],"stats":{"total":14,"additions":11,"deletions":3},"files":[{"sha":"8868160d04f973b1af6150e68a2a36fadd8bafbc","filename":"security/manager/ssl/src/nsNSSComponent.cpp","status":"modified","additions":11,"deletions":3,"changes":14,"blob_url":"https://github.com/mozilla/gecko-dev/blob/a64f704309f133bacce67f320840bc48987f7fd3/security/manager/ssl/src/nsNSSComponent.cpp","raw_url":"https://github.com/mozilla/gecko-dev/raw/a64f704309f133bacce67f320840bc48987f7fd3/security/manager/ssl/src/nsNSSComponent.cpp","contents_url":"https://api.github.com/repos/mozilla/gecko-dev/contents/security/manager/ssl/src/nsNSSComponent.cpp?ref=a64f704309f133bacce67f320840bc48987f7fd3","patch":"@@ -1346,8 +1346,13 @@ nsNSSComponent::InitializeNSS(PRBool showWarningBox)\n                                 getter_AddRefs(profilePath));\n     if (NS_FAILED(rv)) {\n       PR_LOG(gPIPNSSLog, PR_LOG_ERROR, (\"Unable to get profile directory\\n\"));\n-      return rv;\n+      ConfigureInternalPKCS11Token();\n+      SECStatus init_rv = NSS_NoDB_Init(NULL);\n+      if (init_rv != SECSuccess)\n+        return NS_ERROR_NOT_AVAILABLE;\n     }\n+    else\n+    {\n \n   // XP_MAC == CFM\n   // XP_MACOSX == MachO\n@@ -1425,9 +1430,12 @@ nsNSSComponent::InitializeNSS(PRBool showWarningBox)\n         PR_LOG(gPIPNSSLog, PR_LOG_DEBUG, (\"can not init in r/o either\\n\"));\n         which_nss_problem = problem_no_security_at_all;\n \n-        NSS_NoDB_Init(profileStr.get());\n+        init_rv = NSS_NoDB_Init(profileStr.get());\n+        if (init_rv != SECSuccess)\n+          return NS_ERROR_NOT_AVAILABLE;\n       }\n-    }\n+    } // have profile dir\n+    } // lock\n \n     // init phase 3, only if phase 2 was successful\n "}]},"blames":["4f540afa","d007c347","ff2bf929"]}