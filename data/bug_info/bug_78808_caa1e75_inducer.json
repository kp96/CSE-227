{"bug_id":78808,"commitHash":"caa1e75","commit_info":{"sha":"caa1e7521aa59328768edbe3e8633c69b900752c","commit":{"author":{"name":"Cykesiopka","email":"cykesiopka.bmo@gmail.com","date":"2015-01-31T13:20:00Z"},"committer":{"name":"Cykesiopka","email":"cykesiopka.bmo@gmail.com","date":"2015-01-31T13:20:00Z"},"message":"Bug 78808 - Enable Cert Manager buttons only when they would have an effect. Original patch by Scott Johnson. r=keeler","tree":{"sha":"4f0d784f5a157c07ec692e947069acb310b24994","url":"https://api.github.com/repos/mozilla/gecko-dev/git/trees/4f0d784f5a157c07ec692e947069acb310b24994"},"url":"https://api.github.com/repos/mozilla/gecko-dev/git/commits/caa1e7521aa59328768edbe3e8633c69b900752c","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/mozilla/gecko-dev/commits/caa1e7521aa59328768edbe3e8633c69b900752c","html_url":"https://github.com/mozilla/gecko-dev/commit/caa1e7521aa59328768edbe3e8633c69b900752c","comments_url":"https://api.github.com/repos/mozilla/gecko-dev/commits/caa1e7521aa59328768edbe3e8633c69b900752c/comments","author":null,"committer":null,"parents":[{"sha":"bcc2cfe8c44373dd914a92ce1cc215b1014f548a","url":"https://api.github.com/repos/mozilla/gecko-dev/commits/bcc2cfe8c44373dd914a92ce1cc215b1014f548a","html_url":"https://github.com/mozilla/gecko-dev/commit/bcc2cfe8c44373dd914a92ce1cc215b1014f548a"}],"stats":{"total":140,"additions":55,"deletions":85},"files":[{"sha":"e3e43ba9f7860fe4b274621f78cf744d24c48ce6","filename":"security/manager/pki/resources/content/certManager.js","status":"modified","additions":55,"deletions":85,"changes":140,"blob_url":"https://github.com/mozilla/gecko-dev/blob/caa1e7521aa59328768edbe3e8633c69b900752c/security/manager/pki/resources/content/certManager.js","raw_url":"https://github.com/mozilla/gecko-dev/raw/caa1e7521aa59328768edbe3e8633c69b900752c/security/manager/pki/resources/content/certManager.js","contents_url":"https://api.github.com/repos/mozilla/gecko-dev/contents/security/manager/pki/resources/content/certManager.js?ref=caa1e7521aa59328768edbe3e8633c69b900752c","patch":"@@ -197,130 +197,100 @@ function getSelectedTreeItems()\n   }\n }\n \n-function ca_enableButtons()\n+/**\n+ * Returns true if nothing in the given cert tree is selected or if the\n+ * selection includes a container. Returns false otherwise.\n+ *\n+ * @param {nsICertTree} certTree\n+ * @returns {Boolean}\n+ */\n+function nothingOrContainerSelected(certTree)\n {\n-  var items = caTreeView.selection;\n-  var nr = items.getRangeCount();\n-  var toggle=\"false\";\n-  if (nr == 0) {\n-    toggle=\"true\";\n+  var certTreeSelection = certTree.selection;\n+  var numSelectionRanges = certTreeSelection.getRangeCount();\n+\n+  if (numSelectionRanges == 0) {\n+    return true;\n   }\n-  var edit_toggle=toggle;\n-/*\n-  var edit_toggle=\"true\";\n-  if (nr > 0) {\n-    for (var i=0; i<nr; i++) {\n-      var o1 = {};\n-      var o2 = {};\n-      items.getRangeAt(i, o1, o2);\n-      var min = o1.value;\n-      var max = o2.value;\n-      var stop = false;\n-      for (var j=min; j<=max; j++) {\n-        var tokenName = items.tree.view.getCellText(j, \"tokencol\");\n-\tif (tokenName == \"Builtin Object Token\") { stop = true; } break;\n+\n+  for (var i = 0; i < numSelectionRanges; i++) {\n+    var o1 = {};\n+    var o2 = {};\n+    certTreeSelection.getRangeAt(i, o1, o2);\n+    var minIndex = o1.value;\n+    var maxIndex = o2.value;\n+    for (var j = minIndex; j <= maxIndex; j++) {\n+      if (certTree.isContainer(j)) {\n+        return true;\n       }\n-      if (stop) break;\n-    }\n-    if (i == nr) {\n-      edit_toggle=\"false\";\n     }\n   }\n-*/\n+\n+  return false;\n+}\n+\n+function ca_enableButtons()\n+{\n+  var disableButtons = nothingOrContainerSelected(caTreeView);\n+\n   var enableViewButton=document.getElementById('ca_viewButton');\n-  enableViewButton.setAttribute(\"disabled\",toggle);\n+  enableViewButton.setAttribute(\"disabled\", disableButtons);\n   var enableEditButton=document.getElementById('ca_editButton');\n-  enableEditButton.setAttribute(\"disabled\",edit_toggle);\n+  enableEditButton.setAttribute(\"disabled\", disableButtons);\n   var enableExportButton=document.getElementById('ca_exportButton');\n-  enableExportButton.setAttribute(\"disabled\",toggle);\n+  enableExportButton.setAttribute(\"disabled\", disableButtons);\n   var enableDeleteButton=document.getElementById('ca_deleteButton');\n-  enableDeleteButton.setAttribute(\"disabled\",toggle);\n+  enableDeleteButton.setAttribute(\"disabled\", disableButtons);\n }\n \n function mine_enableButtons()\n {\n-  var items = userTreeView.selection;\n-  var toggle=\"false\";\n-  if (items.getRangeCount() == 0) {\n-    toggle=\"true\";\n-  }\n+  var disableButtons = nothingOrContainerSelected(userTreeView);\n+\n   var enableViewButton=document.getElementById('mine_viewButton');\n-  enableViewButton.setAttribute(\"disabled\",toggle);\n+  enableViewButton.setAttribute(\"disabled\", disableButtons);\n   var enableBackupButton=document.getElementById('mine_backupButton');\n-  enableBackupButton.setAttribute(\"disabled\",toggle);\n+  enableBackupButton.setAttribute(\"disabled\", disableButtons);\n   var enableDeleteButton=document.getElementById('mine_deleteButton');\n-  enableDeleteButton.setAttribute(\"disabled\",toggle);\n+  enableDeleteButton.setAttribute(\"disabled\", disableButtons);\n }\n \n function websites_enableButtons()\n {\n-  var items = serverTreeView.selection;\n-  var count_ranges = items.getRangeCount();\n-\n-  var enable_delete = false;\n-  var enable_view = false;\n-\n-  if (count_ranges > 0) {\n-    enable_delete = true;\n-  }\n-\n-  if (count_ranges == 1) {\n-    var o1 = {};\n-    var o2 = {};\n-    items.getRangeAt(0, o1, o2); // the first range\n-    if (o1.value == o2.value) {\n-      // only a single item is selected\n-      try {\n-        var ti = serverTreeView.getTreeItem(o1.value);\n-        if (ti) {\n-          if (ti.cert) {\n-            enable_view = true;\n-          }\n-        }\n-      }\n-      catch (e) {\n-      }\n-    }\n-  }\n+  var disableButtons = nothingOrContainerSelected(serverTreeView);\n \n   var enableViewButton=document.getElementById('websites_viewButton');\n-  enableViewButton.setAttribute(\"disabled\", !enable_view);\n+  enableViewButton.setAttribute(\"disabled\", disableButtons);\n   var enableExportButton=document.getElementById('websites_exportButton');\n-  enableExportButton.setAttribute(\"disabled\", !enable_view);\n+  enableExportButton.setAttribute(\"disabled\", disableButtons);\n   var enableDeleteButton=document.getElementById('websites_deleteButton');\n-  enableDeleteButton.setAttribute(\"disabled\", !enable_delete);\n+  enableDeleteButton.setAttribute(\"disabled\", disableButtons);\n }\n \n function email_enableButtons()\n {\n-  var items = emailTreeView.selection;\n-  var toggle=\"false\";\n-  if (items.getRangeCount() == 0) {\n-    toggle=\"true\";\n-  }\n+  var disableButtons = nothingOrContainerSelected(emailTreeView);\n+\n   var enableViewButton=document.getElementById('email_viewButton');\n-  enableViewButton.setAttribute(\"disabled\",toggle);\n+  enableViewButton.setAttribute(\"disabled\", disableButtons);\n   var enableEditButton=document.getElementById('email_editButton');\n-  enableEditButton.setAttribute(\"disabled\",toggle);\n+  enableEditButton.setAttribute(\"disabled\", disableButtons);\n   var enableExportButton=document.getElementById('email_exportButton');\n-  enableExportButton.setAttribute(\"disabled\",toggle);\n+  enableExportButton.setAttribute(\"disabled\", disableButtons);\n   var enableDeleteButton=document.getElementById('email_deleteButton');\n-  enableDeleteButton.setAttribute(\"disabled\",toggle);\n+  enableDeleteButton.setAttribute(\"disabled\", disableButtons);\n }\n \n function orphan_enableButtons()\n {\n-  var items = orphanTreeView.selection;\n-  var toggle=\"false\";\n-  if (items.getRangeCount() == 0) {\n-    toggle=\"true\";\n-  }\n+  var disableButtons = nothingOrContainerSelected(orphanTreeView);\n+\n   var enableViewButton=document.getElementById('orphan_viewButton');\n-  enableViewButton.setAttribute(\"disabled\",toggle);\n+  enableViewButton.setAttribute(\"disabled\", disableButtons);\n   var enableExportButton=document.getElementById('orphan_exportButton');\n-  enableExportButton.setAttribute(\"disabled\",toggle);\n+  enableExportButton.setAttribute(\"disabled\", disableButtons);\n   var enableDeleteButton=document.getElementById('orphan_deleteButton');\n-  enableDeleteButton.setAttribute(\"disabled\",toggle);\n+  enableDeleteButton.setAttribute(\"disabled\", disableButtons);\n }\n \n function backupCerts()"}]},"blames":["07554215","33891979","1a8bd896","461525bb","6613df3b","ad2bb22a","1a64376d","e0682e5b","07ea6d51","2b5e9f73","1a9df62b","cf6c520d","5fd09f7d","d1493d11","26fcd4cf","c1e8db36","d38a0937"]}