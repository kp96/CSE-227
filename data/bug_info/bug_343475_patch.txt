Index: content/base/src/nsContentUtils.cpp
===================================================================
RCS file: /cvsroot/mozilla/content/base/src/nsContentUtils.cpp,v
retrieving revision 1.107.4.13
diff -u -p -6 -r1.107.4.13 nsContentUtils.cpp
--- content/base/src/nsContentUtils.cpp	6 Jul 2006 21:07:15 -0000	1.107.4.13
+++ content/base/src/nsContentUtils.cpp	6 Jul 2006 22:31:52 -0000
@@ -690,30 +690,33 @@ nsContentUtils::CanCallerAccess(nsIDOMNo
     // If we didn't allow access to nodes like this you wouldn't be able to
     // insert these nodes into a document.
 
     return PR_TRUE;
   }
 
+  PRBool enabled = PR_FALSE;
   if (principal == systemPrincipal) {
-      // we already know subjectPrincipal isn't the systemPrincipal so if
-      // the object principal is they cannot match. Bail out now to
+      // we know subjectPrincipal != systemPrincipal so we can only
+      // access the object if UniversalXPConnect is enabled. We can
       // avoid wasting time in CheckSameOriginPrincipal
 
-      return PR_FALSE;
+      rv = sSecurityManager->IsCapabilityEnabled("UniversalXPConnect",
+                                                 &enabled);
+      NS_ENSURE_SUCCESS(rv, PR_FALSE);
+      return enabled;
   }
 
   rv = sSecurityManager->CheckSameOriginPrincipal(subjectPrincipal,
                                                   principal);
   if (NS_SUCCEEDED(rv)) {
     return PR_TRUE;
   }
 
   // see if the caller has otherwise been given the ability to touch
   // input args to DOM methods
 
-  PRBool enabled = PR_FALSE;
   rv = sSecurityManager->IsCapabilityEnabled("UniversalBrowserRead",
                                              &enabled);
   NS_ENSURE_SUCCESS(rv, PR_FALSE);
   return enabled;
 }
 
