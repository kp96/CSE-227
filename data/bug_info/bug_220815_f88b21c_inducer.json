{"bug_id":220815,"commitHash":"f88b21c","commit_info":{"sha":"f88b21c0479be443e0dc0db6ecc257227b241493","commit":{"author":{"name":"kaie%kuix.de","email":"kaie%kuix.de","date":"2005-12-02T23:08:44Z"},"committer":{"name":"kaie%kuix.de","email":"kaie%kuix.de","date":"2005-12-02T23:08:44Z"},"message":"Bug 220815, Non localisable strings in nsCertPicker.cpp and nsNSSIOLayer.cpp\nr=jgmyers, sr=shaver","tree":{"sha":"fd1461cc3cb86bfee5d78b0f29268df6569ed176","url":"https://api.github.com/repos/mozilla/gecko-dev/git/trees/fd1461cc3cb86bfee5d78b0f29268df6569ed176"},"url":"https://api.github.com/repos/mozilla/gecko-dev/git/commits/f88b21c0479be443e0dc0db6ecc257227b241493","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/mozilla/gecko-dev/commits/f88b21c0479be443e0dc0db6ecc257227b241493","html_url":"https://github.com/mozilla/gecko-dev/commit/f88b21c0479be443e0dc0db6ecc257227b241493","comments_url":"https://api.github.com/repos/mozilla/gecko-dev/commits/f88b21c0479be443e0dc0db6ecc257227b241493/comments","author":null,"committer":null,"parents":[{"sha":"5ff0ab70abfbd7dd281e02f1f6960aa40654dfc7","url":"https://api.github.com/repos/mozilla/gecko-dev/commits/5ff0ab70abfbd7dd281e02f1f6960aa40654dfc7","html_url":"https://github.com/mozilla/gecko-dev/commit/5ff0ab70abfbd7dd281e02f1f6960aa40654dfc7"}],"stats":{"total":65,"additions":43,"deletions":22},"files":[{"sha":"b6ad3145d704aa8e553352c1a806bd302b368a5b","filename":"security/manager/locales/en-US/chrome/pipnss/pipnss.properties","status":"modified","additions":2,"deletions":0,"changes":2,"blob_url":"https://github.com/mozilla/gecko-dev/blob/f88b21c0479be443e0dc0db6ecc257227b241493/security/manager/locales/en-US/chrome/pipnss/pipnss.properties","raw_url":"https://github.com/mozilla/gecko-dev/raw/f88b21c0479be443e0dc0db6ecc257227b241493/security/manager/locales/en-US/chrome/pipnss/pipnss.properties","contents_url":"https://api.github.com/repos/mozilla/gecko-dev/contents/security/manager/locales/en-US/chrome/pipnss/pipnss.properties?ref=f88b21c0479be443e0dc0db6ecc257227b241493","patch":"@@ -324,3 +324,5 @@ VerifyInvalidCA=<Invalid CA>\n VerifyUnknown=<Unknown>\n CertNoNickname=(no nickname)\n CertNoEmailAddress=(no email address)\n+NicknameExpired=(expired)\n+NicknameNotYetValid=(not yet valid)"},{"sha":"31721674d7cef892a2c809b51154da5e109d47a8","filename":"security/manager/ssl/src/nsCertPicker.cpp","status":"modified","additions":3,"deletions":9,"changes":12,"blob_url":"https://github.com/mozilla/gecko-dev/blob/f88b21c0479be443e0dc0db6ecc257227b241493/security/manager/ssl/src/nsCertPicker.cpp","raw_url":"https://github.com/mozilla/gecko-dev/raw/f88b21c0479be443e0dc0db6ecc257227b241493/security/manager/ssl/src/nsCertPicker.cpp","contents_url":"https://api.github.com/repos/mozilla/gecko-dev/contents/security/manager/ssl/src/nsCertPicker.cpp?ref=f88b21c0479be443e0dc0db6ecc257227b241493","patch":"@@ -46,17 +46,13 @@\n #include \"nsNSSCleaner.h\"\n #include \"nsICertPickDialogs.h\"\n #include \"nsNSSShutDown.h\"\n+#include \"nsNSSCertHelper.h\"\n \n NSSCleanupAutoPtrClass(CERTCertNicknames, CERT_FreeNicknames)\n NSSCleanupAutoPtrClass(CERTCertList, CERT_DestroyCertList)\n \n #include \"cert.h\"\n \n-/* strings for marking invalid user cert nicknames */\n-#define NICKNAME_EXPIRED_STRING \" (expired)\"\n-#define NICKNAME_NOT_YET_VALID_STRING \" (not yet valid)\"\n-\n-\n NS_IMPL_ISUPPORTS1(nsCertPicker, nsIUserCertPicker)\n \n nsCertPicker::nsCertPicker()\n@@ -106,10 +102,8 @@ NS_IMETHODIMP nsCertPicker::PickByUsage(nsIInterfaceRequestor *ctx,\n     return NS_ERROR_NOT_AVAILABLE;\n   }\n \n-  CERTCertNicknames *nicknames = \n-    CERT_NicknameStringsFromCertList(certList,\n-                                     NICKNAME_EXPIRED_STRING,\n-                                     NICKNAME_NOT_YET_VALID_STRING);\n+  CERTCertNicknames *nicknames = getNSSCertNicknamesFromCertList(certList);\n+\n   CERTCertNicknamesCleaner cnc(nicknames);\n \n   if (!nicknames) {"},{"sha":"d8873fc64036864f8b70fdace6f014283b0ac2cd","filename":"security/manager/ssl/src/nsCrypto.cpp","status":"modified","additions":3,"deletions":6,"changes":9,"blob_url":"https://github.com/mozilla/gecko-dev/blob/f88b21c0479be443e0dc0db6ecc257227b241493/security/manager/ssl/src/nsCrypto.cpp","raw_url":"https://github.com/mozilla/gecko-dev/raw/f88b21c0479be443e0dc0db6ecc257227b241493/security/manager/ssl/src/nsCrypto.cpp","contents_url":"https://api.github.com/repos/mozilla/gecko-dev/contents/security/manager/ssl/src/nsCrypto.cpp?ref=f88b21c0479be443e0dc0db6ecc257227b241493","patch":"@@ -98,6 +98,7 @@ NSSCleanupAutoPtrClass(PK11SlotInfo, PK11_FreeSlot)\n NSSCleanupAutoPtrClass(CERTCertNicknames, CERT_FreeNicknames)\n \n #include \"nsNSSShutDown.h\"\n+#include \"nsNSSCertHelper.h\"\n \n /*\n  * These are the most common error strings that are returned\n@@ -2079,9 +2080,6 @@ void signTextOutputCallback(void *arg, const char *buf, unsigned long len)\n   ((nsCString*)arg)->Append(buf, len);\n }\n \n-#define NICKNAME_EXPIRED_STRING \" (expired)\"\n-#define NICKNAME_NOT_YET_VALID_STRING \" (not yet valid)\"\n-\n NS_IMETHODIMP\n nsCrypto::SignText(const nsAString& aStringToSign, const nsAString& aCaOption,\n                    nsAString& aResult)\n@@ -2236,9 +2234,8 @@ nsCrypto::SignText(const nsAString& aStringToSign, const nsAString& aCaOption,\n     ++numberOfCerts;\n   }\n \n-  CERTCertNicknames* nicknames =\n-    CERT_NicknameStringsFromCertList(certList, NICKNAME_EXPIRED_STRING,\n-                                     NICKNAME_NOT_YET_VALID_STRING);\n+  CERTCertNicknames* nicknames = getNSSCertNicknamesFromCertList(certList);\n+\n   if (!nicknames) {\n     aResult.Append(internalError);\n "},{"sha":"1ef278305dc98f51870ed49cb598b2e12970b0ef","filename":"security/manager/ssl/src/nsNSSCertHelper.cpp","status":"modified","additions":30,"deletions":0,"changes":30,"blob_url":"https://github.com/mozilla/gecko-dev/blob/f88b21c0479be443e0dc0db6ecc257227b241493/security/manager/ssl/src/nsNSSCertHelper.cpp","raw_url":"https://github.com/mozilla/gecko-dev/raw/f88b21c0479be443e0dc0db6ecc257227b241493/security/manager/ssl/src/nsNSSCertHelper.cpp","contents_url":"https://api.github.com/repos/mozilla/gecko-dev/contents/security/manager/ssl/src/nsNSSCertHelper.cpp?ref=f88b21c0479be443e0dc0db6ecc257227b241493","patch":"@@ -1836,3 +1836,33 @@ getCertType(CERTCertificate *cert)\n     return nsIX509Cert::EMAIL_CERT;\n   return nsIX509Cert::SERVER_CERT;\n }\n+\n+CERTCertNicknames *\n+getNSSCertNicknamesFromCertList(CERTCertList *certList)\n+{\n+  nsresult rv;\n+\n+  nsCOMPtr<nsINSSComponent> nssComponent(do_GetService(kNSSComponentCID, &rv));\n+  if (NS_FAILED(rv))\n+    return nsnull;\n+\n+  nsAutoString expiredString, notYetValidString;\n+  nsAutoString expiredStringLeadingSpace, notYetValidStringLeadingSpace;\n+\n+  nssComponent->GetPIPNSSBundleString(\"NicknameExpired\", expiredString);\n+  nssComponent->GetPIPNSSBundleString(\"NicknameNotYetValid\", notYetValidString);\n+\n+  expiredStringLeadingSpace.Append(NS_LITERAL_STRING(\" \"));\n+  expiredStringLeadingSpace.Append(expiredString);\n+\n+  notYetValidStringLeadingSpace.Append(NS_LITERAL_STRING(\" \"));\n+  notYetValidStringLeadingSpace.Append(notYetValidString);\n+\n+  NS_ConvertUCS2toUTF8 aUtf8ExpiredString(expiredStringLeadingSpace);\n+  NS_ConvertUCS2toUTF8 aUtf8NotYetValidString(notYetValidStringLeadingSpace);\n+\n+  return CERT_NicknameStringsFromCertList(certList,\n+                                          NS_CONST_CAST(char*, aUtf8ExpiredString.get()),\n+                                          NS_CONST_CAST(char*, aUtf8NotYetValidString.get()));\n+  \n+}"},{"sha":"b2f17dc9c7b02db13b13991334ed4ea72d6492bc","filename":"security/manager/ssl/src/nsNSSCertHelper.h","status":"modified","additions":3,"deletions":0,"changes":3,"blob_url":"https://github.com/mozilla/gecko-dev/blob/f88b21c0479be443e0dc0db6ecc257227b241493/security/manager/ssl/src/nsNSSCertHelper.h","raw_url":"https://github.com/mozilla/gecko-dev/raw/f88b21c0479be443e0dc0db6ecc257227b241493/security/manager/ssl/src/nsNSSCertHelper.h","contents_url":"https://api.github.com/repos/mozilla/gecko-dev/contents/security/manager/ssl/src/nsNSSCertHelper.h?ref=f88b21c0479be443e0dc0db6ecc257227b241493","patch":"@@ -44,4 +44,7 @@\n PRUint32\n getCertType(CERTCertificate *cert);\n \n+CERTCertNicknames *\n+getNSSCertNicknamesFromCertList(CERTCertList *certList);\n+\n #endif"},{"sha":"285c75aaf17a68c2a326101a939ca4da181491f9","filename":"security/manager/ssl/src/nsNSSIOLayer.cpp","status":"modified","additions":2,"deletions":7,"changes":9,"blob_url":"https://github.com/mozilla/gecko-dev/blob/f88b21c0479be443e0dc0db6ecc257227b241493/security/manager/ssl/src/nsNSSIOLayer.cpp","raw_url":"https://github.com/mozilla/gecko-dev/raw/f88b21c0479be443e0dc0db6ecc257227b241493/security/manager/ssl/src/nsNSSIOLayer.cpp","contents_url":"https://api.github.com/repos/mozilla/gecko-dev/contents/security/manager/ssl/src/nsNSSIOLayer.cpp?ref=f88b21c0479be443e0dc0db6ecc257227b241493","patch":"@@ -64,6 +64,7 @@\n #include \"nsCRT.h\"\n #include \"nsPrintfCString.h\"\n #include \"nsNSSShutDown.h\"\n+#include \"nsNSSCertHelper.h\"\n \n #include \"ssl.h\"\n #include \"secerr.h\"\n@@ -88,10 +89,6 @@\n typedef enum {ASK, AUTO} SSM_UserCertChoice;\n \n \n-/* strings for marking invalid user cert nicknames */\n-#define NICKNAME_EXPIRED_STRING \" (expired)\"\n-#define NICKNAME_NOT_YET_VALID_STRING \" (not yet valid)\"\n-\n static SECStatus PR_CALLBACK\n nsNSS_SSLGetClientAuthData(void *arg, PRFileDesc *socket,\n \t\t\t\t\t\t   CERTDistNames *caNames,\n@@ -2032,9 +2029,7 @@ SECStatus nsNSS_SSLGetClientAuthData(void* arg, PRFileDesc* socket,\n       goto noCert;\n     }\n \n-    nicknames = CERT_NicknameStringsFromCertList(certList,\n-                                                 NICKNAME_EXPIRED_STRING,\n-                                                 NICKNAME_NOT_YET_VALID_STRING);\n+    nicknames = getNSSCertNicknamesFromCertList(certList);\n \n     if (nicknames == NULL) {\n       goto loser;"}]},"blames":["8e6b891c","084d164f","4876fecd7","31db9b541","d007c347b","1a64376d9","545ad9d0","f1bf4f44","d007c347","e4a50bbe","31db9b54","c1e60067","31db9b54","c683a217","0d20ac0f","d007c347","315fde21","d3d24104","63ee83e2","3a1a52d2","6d1ce233"]}