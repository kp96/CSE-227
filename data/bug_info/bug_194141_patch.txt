Index: security/manager/ssl/src/nsCrypto.cpp
===================================================================
RCS file: /cvsroot/mozilla/security/manager/ssl/src/nsCrypto.cpp,v
retrieving revision 1.54
diff -u -p -8 -r1.54 nsCrypto.cpp
--- security/manager/ssl/src/nsCrypto.cpp	13 Jul 2005 16:53:06 -0000	1.54
+++ security/manager/ssl/src/nsCrypto.cpp	26 Jul 2005 11:16:24 -0000
@@ -85,16 +85,18 @@ extern "C" {
 }
 #include "cmmf.h"
 #include "nssb64.h"
 #include "base64.h"
 #include "certdb.h"
 #include "secmod.h"
 #include "nsISaveAsCharset.h"
 
+#include "ssl.h" // For SSL_ClearSessionCache
+
 #include "nsNSSCleaner.h"
 NSSCleanupAutoPtrClass(SECKEYPrivateKey, SECKEY_DestroyPrivateKey)
 NSSCleanupAutoPtrClass(PK11SlotInfo, PK11_FreeSlot)
 NSSCleanupAutoPtrClass(CERTCertNicknames, CERT_FreeNicknames)
 
 #include "nsNSSShutDown.h"
 
 /*
@@ -2463,16 +2465,17 @@ nsCrypto::Logout()
   nsresult rv;
   nsCOMPtr<nsINSSComponent> nssComponent(do_GetService(kNSSComponentCID, &rv));
   if (NS_FAILED(rv))
     return rv;
 
   {
     nsNSSShutDownPreventionLock locker;
     PK11_LogoutAll();
+    SSL_ClearSessionCache();
   }
 
   return nssComponent->LogoutAuthenticatedPK11();
 }
 
 NS_IMETHODIMP
 nsCrypto::DisableRightClick()
 {
Index: security/manager/ssl/src/nsNSSComponent.cpp
===================================================================
RCS file: /cvsroot/mozilla/security/manager/ssl/src/nsNSSComponent.cpp,v
retrieving revision 1.125
diff -u -p -8 -r1.125 nsNSSComponent.cpp
--- security/manager/ssl/src/nsNSSComponent.cpp	22 Jul 2005 19:05:41 -0000	1.125
+++ security/manager/ssl/src/nsNSSComponent.cpp	26 Jul 2005 11:16:25 -0000
@@ -1890,16 +1890,17 @@ nsNSSComponent::Observe(nsISupports *aSu
       if (bec) {
         bec->DontForward();
       }
     }
   }
   else if ((nsCRT::strcmp(aTopic, SESSION_LOGOUT_TOPIC) == 0) && mNSSInitialized) {
     nsNSSShutDownPreventionLock locker;
     PK11_LogoutAll();
+    SSL_ClearSessionCache();
     LogoutAuthenticatedPK11();
   }
   else if (nsCRT::strcmp(aTopic, NS_PREFBRANCH_PREFCHANGE_TOPIC_ID) == 0) { 
     nsNSSShutDownPreventionLock locker;
     PRBool enabled;
     NS_ConvertUCS2toUTF8  prefName(someData);
 
     if (prefName.Equals("security.enable_ssl2")) {
Index: security/manager/ssl/src/nsSDR.cpp
===================================================================
RCS file: /cvsroot/mozilla/security/manager/ssl/src/nsSDR.cpp,v
retrieving revision 1.19
diff -u -p -8 -r1.19 nsSDR.cpp
--- security/manager/ssl/src/nsSDR.cpp	25 Apr 2004 15:02:36 -0000	1.19
+++ security/manager/ssl/src/nsSDR.cpp	26 Jul 2005 11:16:25 -0000
@@ -56,16 +56,18 @@
 #include "nsISecretDecoderRing.h"
 #include "nsSDR.h"
 #include "nsNSSComponent.h"
 #include "nsNSSShutDown.h"
 
 #include "pk11func.h"
 #include "pk11sdr.h" // For PK11SDR_Encrypt, PK11SDR_Decrypt
 
+#include "ssl.h" // For SSL_ClearSessionCache
+
 #include "nsNSSCleaner.h"
 NSSCleanupAutoPtrClass(PK11SlotInfo, PK11_FreeSlot)
 
 //
 // Implementation of an nsIInterfaceRequestor for use
 // as context for NSS calls
 //
 class nsSDRContext : public nsIInterfaceRequestor
@@ -331,32 +333,34 @@ Logout()
   nsresult rv;
   nsCOMPtr<nsINSSComponent> nssComponent(do_GetService(kNSSComponentCID, &rv));
   if (NS_FAILED(rv))
     return rv;
 
   {
     nsNSSShutDownPreventionLock locker;
     PK11_LogoutAll();
+    SSL_ClearSessionCache();
   }
 
   return NS_OK;
 }
 
 NS_IMETHODIMP nsSecretDecoderRing::
 LogoutAndTeardown()
 {
   nsresult rv;
   nsCOMPtr<nsINSSComponent> nssComponent(do_GetService(kNSSComponentCID, &rv));
   if (NS_FAILED(rv))
     return rv;
 
   {
     nsNSSShutDownPreventionLock locker;
     PK11_LogoutAll();
+    SSL_ClearSessionCache();
   }
 
   return nssComponent->LogoutAuthenticatedPK11();
 }
 
 /* void setWindow(in nsISupports w); */
 nsresult nsSecretDecoderRing::
 SetWindow(nsISupports *w)
