{"bug_id":200691,"commitHash":"de71def","commit_info":{"sha":"de71defcdf0081915f70cc22ff244af473b01636","commit":{"author":{"name":"mstoltz%netscape.com","email":"mstoltz%netscape.com","date":"2003-05-01T02:41:45Z"},"committer":{"name":"mstoltz%netscape.com","email":"mstoltz%netscape.com","date":"2003-05-01T02:41:45Z"},"message":"Bug 200691 - Add CheckLoadURI call to XBL loader to prevent remote XUL pages loading XBL bindings from file URLs. r=bryner, sr=heikki, a=asa","tree":{"sha":"ec14cb4476833eb8096392a822a7e7e500b90688","url":"https://api.github.com/repos/mozilla/gecko-dev/git/trees/ec14cb4476833eb8096392a822a7e7e500b90688"},"url":"https://api.github.com/repos/mozilla/gecko-dev/git/commits/de71defcdf0081915f70cc22ff244af473b01636","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/mozilla/gecko-dev/commits/de71defcdf0081915f70cc22ff244af473b01636","html_url":"https://github.com/mozilla/gecko-dev/commit/de71defcdf0081915f70cc22ff244af473b01636","comments_url":"https://api.github.com/repos/mozilla/gecko-dev/commits/de71defcdf0081915f70cc22ff244af473b01636/comments","author":null,"committer":null,"parents":[{"sha":"c57ef3ac523c572c859216e0211293e46b2b7ce1","url":"https://api.github.com/repos/mozilla/gecko-dev/commits/c57ef3ac523c572c859216e0211293e46b2b7ce1","html_url":"https://github.com/mozilla/gecko-dev/commit/c57ef3ac523c572c859216e0211293e46b2b7ce1"}],"stats":{"total":22,"additions":22,"deletions":0},"files":[{"sha":"8c92ae4c9775ba2d522dd6e310c652f8d5c921ca","filename":"content/xbl/src/nsXBLService.cpp","status":"modified","additions":22,"deletions":0,"changes":22,"blob_url":"https://github.com/mozilla/gecko-dev/blob/de71defcdf0081915f70cc22ff244af473b01636/content/xbl/src/nsXBLService.cpp","raw_url":"https://github.com/mozilla/gecko-dev/raw/de71defcdf0081915f70cc22ff244af473b01636/content/xbl/src/nsXBLService.cpp","contents_url":"https://api.github.com/repos/mozilla/gecko-dev/contents/content/xbl/src/nsXBLService.cpp?ref=de71defcdf0081915f70cc22ff244af473b01636","patch":"@@ -86,6 +86,7 @@\n #include \"nsIDocumentObserver.h\"\n #include \"nsIFrameManager.h\"\n #include \"nsStyleContext.h\"\n+#include \"nsIScriptSecurityManager.h\"\n \n #ifdef MOZ_XUL\n #include \"nsIXULPrototypeCache.h\"\n@@ -579,6 +580,27 @@ nsXBLService::LoadBindings(nsIContent* aContent, const nsAString& aURL, PRBool a\n     }\n   }\n \n+  // Security check - remote pages can't load local bindings, except from chrome\n+  nsCOMPtr<nsIURI> docURI;\n+  rv = document->GetDocumentURL(getter_AddRefs(docURI));\n+  NS_ENSURE_SUCCESS(rv, rv); //XXX can a document have no URI here?\n+  PRBool isChrome = PR_FALSE;\n+  rv = docURI->SchemeIs(\"chrome\", &isChrome);\n+\n+  if (NS_FAILED(rv) || !isChrome) {\n+    nsCOMPtr<nsIURI> bindingURI;\n+    rv = NS_NewURI(getter_AddRefs(bindingURI), aURL);\n+    NS_ENSURE_SUCCESS(rv, rv);\n+\n+    nsCOMPtr<nsIScriptSecurityManager> secMan(\n+      do_GetService(NS_SCRIPTSECURITYMANAGER_CONTRACTID, &rv));\n+    NS_ENSURE_SUCCESS(rv, rv);\n+\n+    rv = secMan->CheckLoadURI(docURI, bindingURI,\n+                              nsIScriptSecurityManager::ALLOW_CHROME);\n+    if (NS_FAILED(rv))\n+      return rv;\n+  }\n   nsCOMPtr<nsIXBLBinding> newBinding;\n   nsCAutoString url; url.AssignWithConversion(aURL);\n   if (NS_FAILED(rv = GetBinding(aContent, url, getter_AddRefs(newBinding)))) {"}]},"blames":["a489c05fa","eb7778a44","e43f5a49f","3a3ec0cbd","88189bb26","b088efb50","6c9496d98","3aeb5cb79"]}