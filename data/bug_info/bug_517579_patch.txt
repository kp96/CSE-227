# HG changeset patch
# Parent 8d5d6a1c3914e701f12b115f0d0f388dde16bb6d
# User Ehsan Akhgari <ehsan@mozilla.com>
Bug 517579 - TEST-UNEXPECTED-FAIL | test_bug413909.html | Secure page did not load, adding exception failed?


diff --git a/security/manager/ssl/tests/mochitest/bugs/test_bug413909.html b/security/manager/ssl/tests/mochitest/bugs/test_bug413909.html
--- a/security/manager/ssl/tests/mochitest/bugs/test_bug413909.html
+++ b/security/manager/ssl/tests/mochitest/bugs/test_bug413909.html
@@ -9,17 +9,16 @@
 <body onload="onWindowLoad()">
 
 <script class="testbody" type="text/javascript">
 
 var certOverrideService = Components.classes["@mozilla.org/security/certoverride;1"]
   .getService(Components.interfaces.nsICertOverrideService);
 var cert = null;
 var certListener = null;
-var frameLoadTimeout = null;
 
 SimpleTest.waitForExplicitFinish();
 
 function badCertListener() 
 {
 }
 
 badCertListener.prototype = {
@@ -96,17 +95,16 @@ function onFrameLoad()
   if (!certListener.exceptionAdded)
     return;
   
   apiTest(true);
   certOverrideService.clearValidityOverride(
     "bug413909.xn--hxajbheg2az3al.xn--jxalpdlp", -1);
   apiTest(false);
 
-  clearTimeout(frameLoadTimeout);
   SimpleTest.finish();
 }
 
 function onWindowLoad()
 {
   var req = new XMLHttpRequest();
   try
   {
@@ -115,24 +113,16 @@ function onWindowLoad()
     req.open("GET", "https://bug413909.xn--hxajbheg2az3al.xn--jxalpdlp/", false);
     req.channel.notificationCallbacks = certListener;
     req.send(null);
   }
   catch(ex)
   {
     // ignore
   }
-  
-  // There is no error event indicating frame load error,
-  // simulate using timeout.
-  frameLoadTimeout = setTimeout(function() 
-  {
-    ok(false, "Secure page did not load, adding exception failed?");
-    SimpleTest.finish();
-  }, 5000);
 
   window.frame1.location.reload();
 }
 
 </script>
 <iframe name="frame1" src="https://bug413909.xn--hxajbheg2az3al.xn--jxalpdlp/" onload="onFrameLoad()"></iframe>
 </body>
 </html>
