{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basf854309\""},"diff":[{"chunks":[{"content":"@@ -2725,9 +2725,34 @@ XRE_main(int argc, char* argv[], const nsXREAppData* aAppData)","changes":[{"type":"normal","normal":true,"ln1":2725,"ln2":2725,"content":"     if (CheckArg(\"install\"))"},{"type":"normal","normal":true,"ln1":2726,"ln2":2726,"content":"       gdk_rgb_set_install(TRUE);"},{"type":"normal","normal":true,"ln1":2727,"ln2":2727,"content":" "},{"type":"del","del":true,"ln":2728,"content":"-    // Initialize GTK here for splash"},{"type":"del","del":true,"ln":2729,"content":"-    gtk_init(&gArgc, &gArgv);"},{"type":"add","add":true,"ln":2728,"content":"+    // Initialize GTK here for splash."},{"type":"normal","normal":true,"ln1":2730,"ln2":2729,"content":" "},{"type":"add","add":true,"ln":2730,"content":"+    // Open the display ourselves instead of using gtk_init, so that we can"},{"type":"add","add":true,"ln":2731,"content":"+    // close it without fear that one day gtk might clean up the display it"},{"type":"add","add":true,"ln":2732,"content":"+    // opens."},{"type":"add","add":true,"ln":2733,"content":"+    if (!gtk_parse_args(&gArgc, &gArgv))"},{"type":"add","add":true,"ln":2734,"content":"+      return 1;"},{"type":"add","add":true,"ln":2735,"content":"+"},{"type":"add","add":true,"ln":2736,"content":"+    GdkDisplay* display = nsnull;"},{"type":"add","add":true,"ln":2737,"content":"+    {"},{"type":"add","add":true,"ln":2738,"content":"+      // display_name is owned by gdk."},{"type":"add","add":true,"ln":2739,"content":"+      const char *display_name = gdk_get_display_arg_name();"},{"type":"add","add":true,"ln":2740,"content":"+      if (!display_name) {"},{"type":"add","add":true,"ln":2741,"content":"+        display_name = PR_GetEnv(\"DISPLAY\");"},{"type":"add","add":true,"ln":2742,"content":"+        if (!display_name) {"},{"type":"add","add":true,"ln":2743,"content":"+          PR_fprintf(PR_STDERR, \"Error: no display specified\\n\");"},{"type":"add","add":true,"ln":2744,"content":"+          return 1;"},{"type":"add","add":true,"ln":2745,"content":"+        }"},{"type":"add","add":true,"ln":2746,"content":"+      }"},{"type":"add","add":true,"ln":2747,"content":"+      display = gdk_display_open(display_name);"},{"type":"add","add":true,"ln":2748,"content":"+      if (!display) {"},{"type":"add","add":true,"ln":2749,"content":"+        PR_fprintf(PR_STDERR, \"Error: cannot open display: %s\\n\", display_name);"},{"type":"add","add":true,"ln":2750,"content":"+        return 1;"},{"type":"add","add":true,"ln":2751,"content":"+      }"},{"type":"add","add":true,"ln":2752,"content":"+    }"},{"type":"add","add":true,"ln":2753,"content":"+    gdk_display_manager_set_default_display (gdk_display_manager_get(),"},{"type":"add","add":true,"ln":2754,"content":"+                                             display);"},{"type":"add","add":true,"ln":2755,"content":"+    "},{"type":"normal","normal":true,"ln1":2731,"ln2":2756,"content":"     // g_set_application_name () is only defined in glib2.2 and higher."},{"type":"normal","normal":true,"ln1":2732,"ln2":2757,"content":"     _g_set_application_name_fn _g_set_application_name ="},{"type":"normal","normal":true,"ln1":2733,"ln2":2758,"content":"       (_g_set_application_name_fn)FindFunction(\"g_set_application_name\");"}],"oldStart":2725,"oldLines":9,"newStart":2725,"newLines":34},{"content":"@@ -3187,6 +3212,8 @@ XRE_main(int argc, char* argv[], const nsXREAppData* aAppData)","changes":[{"type":"normal","normal":true,"ln1":3187,"ln2":3212,"content":"       }"},{"type":"normal","normal":true,"ln1":3188,"ln2":3213,"content":" #endif"},{"type":"normal","normal":true,"ln1":3189,"ln2":3214,"content":" "},{"type":"add","add":true,"ln":3215,"content":"+// XXXkt s/MOZ_TOOLKIT_GTK2/MOZ_WIDGET_GTK2/?"},{"type":"add","add":true,"ln":3216,"content":"+// but the hidden window has been destroyed so toolkit is NULL anyway."},{"type":"normal","normal":true,"ln1":3190,"ln2":3217,"content":" #if defined(HAVE_DESKTOP_STARTUP_ID) && defined(MOZ_TOOLKIT_GTK2)"},{"type":"normal","normal":true,"ln1":3191,"ln2":3218,"content":"       nsGTKToolkit* toolkit = GetGTKToolkit();"},{"type":"normal","normal":true,"ln1":3192,"ln2":3219,"content":"       if (toolkit) {"}],"oldStart":3187,"oldLines":6,"newStart":3212,"newLines":8},{"content":"@@ -3202,6 +3229,10 @@ XRE_main(int argc, char* argv[], const nsXREAppData* aAppData)","changes":[{"type":"normal","normal":true,"ln1":3202,"ln2":3229,"content":"       }"},{"type":"normal","normal":true,"ln1":3203,"ln2":3230,"content":" #endif"},{"type":"normal","normal":true,"ln1":3204,"ln2":3231,"content":" "},{"type":"add","add":true,"ln":3232,"content":"+#ifdef MOZ_WIDGET_GTK2"},{"type":"add","add":true,"ln":3233,"content":"+      gdk_display_close(display);"},{"type":"add","add":true,"ln":3234,"content":"+#endif"},{"type":"add","add":true,"ln":3235,"content":"+"},{"type":"normal","normal":true,"ln1":3205,"ln2":3236,"content":"       rv = LaunchChild(nativeApp, appInitiatedRestart, upgraded ? -1 : 0);"},{"type":"normal","normal":true,"ln1":3206,"ln2":3237,"content":" "},{"type":"normal","normal":true,"ln1":3207,"ln2":3238,"content":" #ifdef MOZ_CRASHREPORTER"}],"oldStart":3202,"oldLines":6,"newStart":3229,"newLines":10},{"content":"@@ -3211,6 +3242,12 @@ XRE_main(int argc, char* argv[], const nsXREAppData* aAppData)","changes":[{"type":"normal","normal":true,"ln1":3211,"ln2":3242,"content":" "},{"type":"normal","normal":true,"ln1":3212,"ln2":3243,"content":"       return rv == NS_ERROR_LAUNCHED_CHILD_PROCESS ? 0 : 1;"},{"type":"normal","normal":true,"ln1":3213,"ln2":3244,"content":"     }"},{"type":"add","add":true,"ln":3245,"content":"+"},{"type":"add","add":true,"ln":3246,"content":"+#ifdef MOZ_WIDGET_GTK2"},{"type":"add","add":true,"ln":3247,"content":"+    // gdk_display_close also calls gdk_display_manager_set_default_display"},{"type":"add","add":true,"ln":3248,"content":"+    // appropriately when necessary."},{"type":"add","add":true,"ln":3249,"content":"+    gdk_display_close(display);"},{"type":"add","add":true,"ln":3250,"content":"+#endif"},{"type":"normal","normal":true,"ln1":3214,"ln2":3251,"content":"   }"},{"type":"normal","normal":true,"ln1":3215,"ln2":3252,"content":" "},{"type":"normal","normal":true,"ln1":3216,"ln2":3253,"content":" #ifdef MOZ_CRASHREPORTER"}],"oldStart":3211,"oldLines":6,"newStart":3242,"newLines":12}],"deletions":2,"additions":39,"from":"toolkit/xre/nsAppRunner.cpp","to":"toolkit/xre/nsAppRunner.cpp","index":["6cc0b24..64aa963","100644"]}]}