Index: resources/application/blockedSite.xhtml
===================================================================
RCS file: /cvsroot/mozilla/camino/resources/application/blockedSite.xhtml,v
retrieving revision 1.2
diff -u -8 -r1.2 blockedSite.xhtml
--- resources/application/blockedSite.xhtml	10 Aug 2009 18:08:39 -0000	1.2
+++ resources/application/blockedSite.xhtml	12 Aug 2009 14:49:55 -0000
@@ -207,17 +207,17 @@
           <p id="errorShortDescText_phishing">PhishingShortDescText</p>
           <p id="errorShortDescText_malware">MalwareShortDescText</p>
         </div>
 
         <!-- Long Description -->
         <div id="errorLongDesc">
           <p id="errorLongDescText_phishing">PhishingLongDescText</p>
           <p id="errorLongDescText_malware">MalwareLongDescText</p>
-          <p id="errorLongDescText_whyBlocked">MoreInformationText</p>
+          <p id="errorLongDescText_whyBlocked">MoreInformationFormat</p>
         </div>
         
         <!-- Action buttons -->
         <div id="buttons">
           <!-- Commands handled in BrowserWrapper -->
           <xul:button xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
                       id="ignoreWarningButton" label="IgnoreWarningButtonLabel"/>
           <xul:button xmlns:xul="http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul"
Index: resources/localized/English.lproj/Localizable.strings.in
===================================================================
RCS file: /cvsroot/mozilla/camino/resources/localized/English.lproj/Localizable.strings.in,v
retrieving revision 1.40
diff -u -8 -r1.40 Localizable.strings.in
--- resources/localized/English.lproj/Localizable.strings.in	10 Aug 2009 18:08:38 -0000	1.40
+++ resources/localized/English.lproj/Localizable.strings.in	12 Aug 2009 14:49:56 -0000
@@ -532,12 +532,11 @@
 "PhishingShortDescText" = "This web site at <span id='phishing_sitename'/> has been reported as a phishing site and has been blocked for your protection.";
 "MalwareShortDescText" = "This web site at <span id='malware_sitename'/> has been reported as a malware site and has been blocked for your protection.";
 /* To create paragraphs within the long description text, please wrap each 
    paragraph in <p></p> tags.  Because these strings appear in an XHTML page, 
    each LongDescText string must begin with a <p> and end with a </p> or the 
    safe browsing page will not display. */
 "PhishingLongDescText" = "<p>Phishing sites are designed to trick you into revealing personal or financial information by creating copies of trusted websites.</p><p>Entering any information on this web page may result in identity theft or other fraud.</p>";
 "MalwareLongDescText" = "<p>Malware sites try to install programs that steal private information, use your computer to attack others, or damage your system.</p><p>Some malware sites intentionally distribute harmful software, but many are compromised without the knowledge or permission of their owners.</p><p>Your computer can be infected just by proceeding to this site, without any further action on your part.</p>";
-/* Really would like to pull the URL for MoreInformationText from browser.safebrowsing.warning.infoURL in all-camino.js */
-"MoreInformationText" = "For more information about why this site was blocked, see Camino’s <a href='http://caminobrowser.org/documentation/security/#safebrowsing'>Safe Browsing Documentation</a>.";
+"MoreInformationFormat" = "For more information about why this site was blocked, see Camino’s <a href='%@'>Safe Browsing Documentation</a>.";
 "GetMeOutButtonLabel" = "Get me out of here!";
 "IgnoreWarningButtonLabel" = "Ignore this warning";
Index: src/safebrowsing/SafeBrowsingAboutModule.mm
===================================================================
RCS file: /cvsroot/mozilla/camino/src/safebrowsing/SafeBrowsingAboutModule.mm,v
retrieving revision 1.3
diff -u -8 -r1.3 SafeBrowsingAboutModule.mm
--- src/safebrowsing/SafeBrowsingAboutModule.mm	10 Aug 2009 18:08:39 -0000	1.3
+++ src/safebrowsing/SafeBrowsingAboutModule.mm	12 Aug 2009 14:49:57 -0000
@@ -33,16 +33,18 @@
  * the provisions above, a recipient may use your version of this file under
  * the terms of any one of the MPL, the GPL or the LGPL.
  *
  * ***** END LICENSE BLOCK ***** */
 
 #import <Cocoa/Cocoa.h>
 #import "NSString+Gecko.h"
 #include "SafeBrowsingAboutModule.h"
+#import "PreferenceManager.h"
+#import "GeckoPrefConstants.h"
 
 #include "nsCOMPtr.h"
 #include "nsIChannel.h"
 #include "nsIServiceManager.h"
 #include "nsNetCID.h"
 #include "nsString.h"
 #include "nsIScriptSecurityManager.h"
 #include "nsIPrincipal.h"
@@ -51,17 +53,17 @@
 
 // Placeholders in the blocked site HTML page to replace with localized strings.
 static NSString *const kPhishingTitleText = @"PhishingTitleText";
 static NSString *const kMalwareTitleText = @"MalwareTitleText";
 static NSString *const kPhishingShortDescText = @"PhishingShortDescText";
 static NSString *const kMalwareShortDescText = @"MalwareShortDescText";
 static NSString *const kPhishingLongDescText = @"PhishingLongDescText";
 static NSString *const kMalwareLongDescText = @"MalwareLongDescText";
-static NSString *const kMoreInformationText = @"MoreInformationText";
+static NSString *const kMoreInformationFormat = @"MoreInformationFormat";
 static NSString *const kGetMeOutButtonLabel = @"GetMeOutButtonLabel";
 static NSString *const kIgnoreWarningButtonLabel = @"IgnoreWarningButtonLabel";
 
 NS_IMPL_ISUPPORTS1(CHSafeBrowsingAboutModule, nsIAboutModule)
 
 NS_IMETHODIMP
 CHSafeBrowsingAboutModule::NewChannel(nsIURI *aURI, nsIChannel **result)
 {
@@ -138,26 +140,38 @@
 
   // Localize the blocked page by swapping out placeholder strings.
   NSArray *stringPlaceholdersInPage = [NSArray arrayWithObjects:kPhishingTitleText,
                                                                 kMalwareTitleText,
                                                                 kPhishingShortDescText,
                                                                 kMalwareShortDescText,
                                                                 kPhishingLongDescText,
                                                                 kMalwareLongDescText,
-                                                                kMoreInformationText,
                                                                 kGetMeOutButtonLabel,
                                                                 kIgnoreWarningButtonLabel,
                                                                 nil];
 
   NSEnumerator *placeholderEnum = [stringPlaceholdersInPage objectEnumerator];
   NSString *currentPlaceholder = nil;
   while ((currentPlaceholder = [placeholderEnum nextObject])) {
     [blockedSitePageSource replaceOccurrencesOfString:currentPlaceholder
                                            withString:NSLocalizedString(currentPlaceholder, nil)
                                               options:NULL
                                                 range:NSMakeRange(0, [blockedSitePageSource length])];    
   }
 
+  // Swap out the kMoreInformationText placeholder separately, since we need to
+  // insert the URL of the more information page.
+  NSString *moreInfoURL = [[PreferenceManager sharedInstance] getStringPref:kGeckoPrefSafeBrowsingInformationURL
+                                                                withSuccess:NULL];
+  if (moreInfoURL) {
+    NSString *moreInfoValue = [NSString stringWithFormat:NSLocalizedString(kMoreInformationFormat, nil),
+                                                         moreInfoURL];
+    [blockedSitePageSource replaceOccurrencesOfString:kMoreInformationFormat
+                                           withString:moreInfoValue
+                                              options:NULL
+                                                range:NSMakeRange(0, [blockedSitePageSource length])];
+  }
+
   result.Assign([blockedSitePageSource UTF8String]);
 
   return NS_OK;
 }
