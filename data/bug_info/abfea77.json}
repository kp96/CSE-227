{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basabfea77\""},"diff":[{"chunks":[{"content":"@@ -37,9 +37,10 @@","changes":[{"type":"normal","normal":true,"ln1":37,"ln2":37,"content":" "},{"type":"normal","normal":true,"ln1":38,"ln2":38,"content":" #include \"nsISupports.idl\""},{"type":"normal","normal":true,"ln1":39,"ln2":39,"content":" "},{"type":"add","add":true,"ln":40,"content":"+interface nsIDOMElement;"},{"type":"normal","normal":true,"ln1":40,"ln2":41,"content":" interface nsIAutoCompleteInput;"},{"type":"normal","normal":true,"ln1":41,"ln2":42,"content":" "},{"type":"del","del":true,"ln":42,"content":"-[scriptable, uuid(816668CC-6AC0-47C3-944E-9C2CF37F224A)]"},{"type":"add","add":true,"ln":43,"content":"+[scriptable, uuid(1b9d7d8a-6dd0-11dc-8314-0800200c9a66)]"},{"type":"normal","normal":true,"ln1":43,"ln2":44,"content":" interface nsIAutoCompletePopup : nsISupports"},{"type":"normal","normal":true,"ln1":44,"ln2":45,"content":" {"},{"type":"normal","normal":true,"ln1":45,"ln2":46,"content":"   /*"}],"oldStart":37,"oldLines":9,"newStart":37,"newLines":10},{"content":"@@ -67,12 +68,10 @@ interface nsIAutoCompletePopup : nsISupports","changes":[{"type":"normal","normal":true,"ln1":67,"ln2":68,"content":"    * Bind the popup to an input object and display it with the given coordinates"},{"type":"normal","normal":true,"ln1":68,"ln2":69,"content":"    *"},{"type":"normal","normal":true,"ln1":69,"ln2":70,"content":"    * @param input - The input object that the popup will be bound to"},{"type":"del","del":true,"ln":70,"content":"-   * @param x - The x coordinate to display the popup at"},{"type":"del","del":true,"ln":71,"content":"-   * @param y - The y coordinate to display the popup at"},{"type":"del","del":true,"ln":72,"content":"-   * @param width - The width that the popup should size itself to"},{"type":"add","add":true,"ln":71,"content":"+   * @param element - The element that the popup will be aligned with"},{"type":"normal","normal":true,"ln1":73,"ln2":72,"content":"    */"},{"type":"del","del":true,"ln":74,"content":"-  void openAutocompletePopup(in nsIAutoCompleteInput input, in long x, in long y, in long width);"},{"type":"del","del":true,"ln":75,"content":"-  "},{"type":"add","add":true,"ln":73,"content":"+  void openAutocompletePopup(in nsIAutoCompleteInput input, in nsIDOMElement element);"},{"type":"add","add":true,"ln":74,"content":"+"},{"type":"normal","normal":true,"ln1":76,"ln2":75,"content":"   /* "},{"type":"normal","normal":true,"ln1":77,"ln2":76,"content":"    * Close the popup and detach from the bound input"},{"type":"normal","normal":true,"ln1":78,"ln2":77,"content":"    */"}],"oldStart":67,"oldLines":12,"newStart":68,"newLines":10}],"deletions":6,"additions":5,"from":"toolkit/components/autocomplete/public/nsIAutoCompletePopup.idl","to":"toolkit/components/autocomplete/public/nsIAutoCompletePopup.idl","index":["38c7350..208e84d","100644"]},{"chunks":[{"content":"@@ -124,31 +124,6 @@ nsFormFillController::~nsFormFillController()","changes":[{"type":"normal","normal":true,"ln1":124,"ln2":124,"content":" }"},{"type":"normal","normal":true,"ln1":125,"ln2":125,"content":" "},{"type":"normal","normal":true,"ln1":126,"ln2":126,"content":" ////////////////////////////////////////////////////////////////////////"},{"type":"del","del":true,"ln":127,"content":"-"},{"type":"del","del":true,"ln":128,"content":"-nsRect"},{"type":"del","del":true,"ln":129,"content":"-GetScreenOrigin(nsIDOMElement* aElement)"},{"type":"del","del":true,"ln":130,"content":"-{"},{"type":"del","del":true,"ln":131,"content":"-  nsRect rect(0,0,0,0);"},{"type":"del","del":true,"ln":132,"content":"-"},{"type":"del","del":true,"ln":133,"content":"-  nsCOMPtr<nsIContent> content = do_QueryInterface(aElement);"},{"type":"del","del":true,"ln":134,"content":"-  nsCOMPtr<nsIDocument> doc = content->GetDocument();"},{"type":"del","del":true,"ln":135,"content":"-"},{"type":"del","del":true,"ln":136,"content":"-  if (doc) {"},{"type":"del","del":true,"ln":137,"content":"-    // Get Presentation shell 0"},{"type":"del","del":true,"ln":138,"content":"-    nsIPresShell* presShell = doc->GetPrimaryShell();"},{"type":"del","del":true,"ln":139,"content":"-"},{"type":"del","del":true,"ln":140,"content":"-    if (presShell) {"},{"type":"del","del":true,"ln":141,"content":"-      nsIFrame* frame = presShell->GetPrimaryFrameFor(content);"},{"type":"del","del":true,"ln":142,"content":"-      if (!frame)"},{"type":"del","del":true,"ln":143,"content":"-        return rect;"},{"type":"del","del":true,"ln":144,"content":"-      rect = frame->GetScreenRectExternal();"},{"type":"del","del":true,"ln":145,"content":"-    }"},{"type":"del","del":true,"ln":146,"content":"-  }"},{"type":"del","del":true,"ln":147,"content":"-  "},{"type":"del","del":true,"ln":148,"content":"-  return rect;"},{"type":"del","del":true,"ln":149,"content":"-}"},{"type":"del","del":true,"ln":150,"content":"-"},{"type":"del","del":true,"ln":151,"content":"-////////////////////////////////////////////////////////////////////////"},{"type":"normal","normal":true,"ln1":152,"ln2":127,"content":" //// nsIFormFillController"},{"type":"normal","normal":true,"ln1":153,"ln2":128,"content":" "},{"type":"normal","normal":true,"ln1":154,"ln2":129,"content":" NS_IMETHODIMP"}],"oldStart":124,"oldLines":31,"newStart":124,"newLines":6},{"content":"@@ -245,10 +220,7 @@ nsFormFillController::SetPopupOpen(PRBool aPopupOpen)","changes":[{"type":"normal","normal":true,"ln1":245,"ln2":220,"content":"                                        NS_PRESSHELL_SCROLL_IF_NOT_VISIBLE,"},{"type":"normal","normal":true,"ln1":246,"ln2":221,"content":"                                        NS_PRESSHELL_SCROLL_IF_NOT_VISIBLE);"},{"type":"normal","normal":true,"ln1":247,"ln2":222,"content":" "},{"type":"del","del":true,"ln":248,"content":"-      nsRect popupRect = GetScreenOrigin(mFocusedInput);"},{"type":"del","del":true,"ln":249,"content":"-      mFocusedPopup->OpenAutocompletePopup(this, popupRect.x,"},{"type":"del","del":true,"ln":250,"content":"-                                           popupRect.y+popupRect.height,"},{"type":"del","del":true,"ln":251,"content":"-                                           popupRect.width);"},{"type":"add","add":true,"ln":223,"content":"+      mFocusedPopup->OpenAutocompletePopup(this, mFocusedInput);"},{"type":"normal","normal":true,"ln1":252,"ln2":224,"content":"     } else"},{"type":"normal","normal":true,"ln1":253,"ln2":225,"content":"       mFocusedPopup->ClosePopup();"},{"type":"normal","normal":true,"ln1":254,"ln2":226,"content":"   }"}],"oldStart":245,"oldLines":10,"newStart":220,"newLines":7}],"deletions":29,"additions":1,"from":"toolkit/components/satchel/src/nsFormFillController.cpp","to":"toolkit/components/satchel/src/nsFormFillController.cpp","index":["348c8db..d97a93c","100644"]},{"chunks":[{"content":"@@ -324,7 +324,7 @@","changes":[{"type":"normal","normal":true,"ln1":324,"ln2":324,"content":" "},{"type":"normal","normal":true,"ln1":325,"ln2":325,"content":"       <method name=\"openPopup\">"},{"type":"normal","normal":true,"ln1":326,"ln2":326,"content":"         <body><![CDATA["},{"type":"del","del":true,"ln":327,"content":"-          this.popup.openAutocompletePopup(this, -1, -1, this.boxObject.width);"},{"type":"add","add":true,"ln":327,"content":"+          this.popup.openAutocompletePopup(this, this);"},{"type":"normal","normal":true,"ln1":328,"ln2":328,"content":"         ]]></body>"},{"type":"normal","normal":true,"ln1":329,"ln2":329,"content":"       </method>"},{"type":"normal","normal":true,"ln1":330,"ln2":330,"content":" "}],"oldStart":324,"oldLines":7,"newStart":324,"newLines":7},{"content":"@@ -524,7 +524,7 @@","changes":[{"type":"normal","normal":true,"ln1":524,"ln2":524,"content":"       <stylesheet src=\"chrome://global/skin/autocomplete.css\"/>"},{"type":"normal","normal":true,"ln1":525,"ln2":525,"content":"     </resources>"},{"type":"normal","normal":true,"ln1":526,"ln2":526,"content":" "},{"type":"del","del":true,"ln":527,"content":"-    <content>"},{"type":"add","add":true,"ln":527,"content":"+    <content minwidth=\"100\">"},{"type":"normal","normal":true,"ln1":528,"ln2":528,"content":"       <xul:tree anonid=\"tree\" class=\"autocomplete-tree plain\" hidecolumnpicker=\"true\" flex=\"1\">"},{"type":"normal","normal":true,"ln1":529,"ln2":529,"content":"         <xul:treecols anonid=\"treecols\">"},{"type":"normal","normal":true,"ln1":530,"ln2":530,"content":"           <xul:treecol id=\"treecolAutoCompleteValue\" class=\"autocomplete-treecol\" flex=\"1\" overflow=\"true\"/>"}],"oldStart":524,"oldLines":7,"newStart":524,"newLines":7},{"content":"@@ -571,9 +571,7 @@","changes":[{"type":"normal","normal":true,"ln1":571,"ln2":571,"content":" "},{"type":"normal","normal":true,"ln1":572,"ln2":572,"content":"       <method name=\"openAutocompletePopup\">"},{"type":"normal","normal":true,"ln1":573,"ln2":573,"content":"         <parameter name=\"aInput\"/>"},{"type":"del","del":true,"ln":574,"content":"-        <parameter name=\"aX\"/>"},{"type":"del","del":true,"ln":575,"content":"-        <parameter name=\"aY\"/>"},{"type":"del","del":true,"ln":576,"content":"-        <parameter name=\"aWidth\"/>"},{"type":"add","add":true,"ln":574,"content":"+        <parameter name=\"aElement\"/>"},{"type":"normal","normal":true,"ln1":577,"ln2":575,"content":"         <body><![CDATA["},{"type":"normal","normal":true,"ln1":578,"ln2":576,"content":"           if (!this.mPopupOpen) {"},{"type":"normal","normal":true,"ln1":579,"ln2":577,"content":"             this.mInput = aInput;"}],"oldStart":571,"oldLines":9,"newStart":571,"newLines":7},{"content":"@@ -583,15 +581,12 @@","changes":[{"type":"normal","normal":true,"ln1":583,"ln2":581,"content":"             this.showCommentColumn = this.mInput.showCommentColumn;"},{"type":"normal","normal":true,"ln1":584,"ln2":582,"content":"             this.showImageColumn = this.mInput.showImageColumn;"},{"type":"normal","normal":true,"ln1":585,"ln2":583,"content":" "},{"type":"del","del":true,"ln":586,"content":"-            this.setAttribute(\"width\", aWidth < 100 ? 100 : aWidth);"},{"type":"del","del":true,"ln":587,"content":"-"},{"type":"normal","normal":true,"ln1":588,"ln2":584,"content":"             document.popupNode = null;"},{"type":"del","del":true,"ln":589,"content":"-            if (aY == -1) {"},{"type":"del","del":true,"ln":590,"content":"-              this.showPopup(this.mInput, -1, -1, \"popup\", 'bottomleft', 'topleft');"},{"type":"del","del":true,"ln":591,"content":"-            }"},{"type":"del","del":true,"ln":592,"content":"-            else {"},{"type":"del","del":true,"ln":593,"content":"-              this.showPopup(document.documentElement, aX, aY, \"popup\", null, null);            "},{"type":"del","del":true,"ln":594,"content":"-            }"},{"type":"add","add":true,"ln":585,"content":"+"},{"type":"add","add":true,"ln":586,"content":"+            var rect = aElement.getBoundingClientRect();"},{"type":"add","add":true,"ln":587,"content":"+            this.setAttribute(\"width\", rect.right - rect.left);            "},{"type":"add","add":true,"ln":588,"content":"+            this.openPopup(aElement, \"after_start\", 0, 0, false, false);"},{"type":"add","add":true,"ln":589,"content":"+"},{"type":"normal","normal":true,"ln1":595,"ln2":590,"content":"             this.popupBoxObject.setConsumeRollupEvent(this.mInput.consumeRollupEvent);"},{"type":"normal","normal":true,"ln1":596,"ln2":591,"content":"           }"},{"type":"normal","normal":true,"ln1":597,"ln2":592,"content":"         ]]></body>"}],"oldStart":583,"oldLines":15,"newStart":581,"newLines":12}],"deletions":13,"additions":8,"from":"toolkit/content/widgets/autocomplete.xml","to":"toolkit/content/widgets/autocomplete.xml","index":["1792a05..ee456ad","100644"]},{"chunks":[{"content":"@@ -1405,7 +1405,7 @@","changes":[{"type":"normal","normal":true,"ln1":1405,"ln2":1405,"content":"       <stylesheet src=\"chrome://global/skin/autocomplete.css\"/>"},{"type":"normal","normal":true,"ln1":1406,"ln2":1406,"content":"     </resources>"},{"type":"normal","normal":true,"ln1":1407,"ln2":1407,"content":" "},{"type":"del","del":true,"ln":1408,"content":"-    <content>"},{"type":"add","add":true,"ln":1408,"content":"+    <content minwidth=\"100\">"},{"type":"normal","normal":true,"ln1":1409,"ln2":1409,"content":"       <xul:tree anonid=\"tree\" class=\"autocomplete-tree plain\" flex=\"1\">"},{"type":"normal","normal":true,"ln1":1410,"ln2":1410,"content":"         <xul:treecols anonid=\"treecols\">"},{"type":"normal","normal":true,"ln1":1411,"ln2":1411,"content":"           <xul:treecol class=\"autocomplete-treecol\" id=\"treecolAutoCompleteValue\" flex=\"2\"/>"}],"oldStart":1405,"oldLines":7,"newStart":1405,"newLines":7},{"content":"@@ -1560,21 +1560,22 @@","changes":[{"type":"normal","normal":true,"ln1":1560,"ln2":1560,"content":" "},{"type":"normal","normal":true,"ln1":1561,"ln2":1561,"content":"       <method name=\"openAutocompletePopup\">"},{"type":"normal","normal":true,"ln1":1562,"ln2":1562,"content":"         <parameter name=\"aInput\"/>"},{"type":"del","del":true,"ln":1563,"content":"-        <parameter name=\"aX\"/>"},{"type":"del","del":true,"ln":1564,"content":"-        <parameter name=\"aY\"/>"},{"type":"del","del":true,"ln":1565,"content":"-        <parameter name=\"aWidth\"/>"},{"type":"del","del":true,"ln":1566,"content":"-        <body>"},{"type":"add","add":true,"ln":1563,"content":"+        <parameter name=\"aElement\"/>"},{"type":"add","add":true,"ln":1564,"content":"+        <body><![CDATA["},{"type":"normal","normal":true,"ln1":1567,"ln2":1565,"content":"           if (!this.input) {"},{"type":"normal","normal":true,"ln1":1568,"ln2":1566,"content":"             this.tree.view = aInput.controller;"},{"type":"normal","normal":true,"ln1":1569,"ln2":1567,"content":"             this.view = this.tree.view;"},{"type":"normal","normal":true,"ln1":1570,"ln2":1568,"content":"             this.showCommentColumn = aInput.showCommentColumn;"},{"type":"normal","normal":true,"ln1":1571,"ln2":1569,"content":"             this.input = aInput;"},{"type":"del","del":true,"ln":1572,"content":"-            this.width = aWidth;"},{"type":"normal","normal":true,"ln1":1573,"ln2":1570,"content":"             this.invalidate();"},{"type":"del","del":true,"ln":1574,"content":"-            this.openPopupAtScreen(aX, aY, false);"},{"type":"add","add":true,"ln":1571,"content":"+"},{"type":"add","add":true,"ln":1572,"content":"+            var rect = aElement.getBoundingClientRect();"},{"type":"add","add":true,"ln":1573,"content":"+            this.setAttribute(\"width\", rect.right - rect.left);            "},{"type":"add","add":true,"ln":1574,"content":"+            this.openPopup(aElement, \"after_start\", 0, 0, false, false);"},{"type":"add","add":true,"ln":1575,"content":"+"},{"type":"normal","normal":true,"ln1":1575,"ln2":1576,"content":"             this.popupBoxObject.setConsumeRollupEvent(aInput.consumeRollupEvent);"},{"type":"normal","normal":true,"ln1":1576,"ln2":1577,"content":"           }"},{"type":"del","del":true,"ln":1577,"content":"-        </body>"},{"type":"add","add":true,"ln":1578,"content":"+        ]]></body>"},{"type":"normal","normal":true,"ln1":1578,"ln2":1579,"content":"       </method>"},{"type":"normal","normal":true,"ln1":1579,"ln2":1580,"content":" "},{"type":"normal","normal":true,"ln1":1580,"ln2":1581,"content":"       <method name=\"closePopup\">"}],"oldStart":1560,"oldLines":21,"newStart":1560,"newLines":22}],"deletions":8,"additions":9,"from":"xpfe/components/autocomplete/resources/content/autocomplete.xml","to":"xpfe/components/autocomplete/resources/content/autocomplete.xml","index":["d384c50..4b1bdb7","100644"]}]}