Index: nsScriptSecurityManager.cpp
===================================================================
RCS file: /cvsroot/mozilla/caps/src/nsScriptSecurityManager.cpp,v
retrieving revision 1.239
diff -up8 -r1.239 nsScriptSecurityManager.cpp
--- nsScriptSecurityManager.cpp
+++ nsScriptSecurityManager.cpp
@@ -913,26 +914,28 @@ nsScriptSecurityManager::LookupPolicy(ns
                                      const char* aClassName, jsval aProperty,
                                      PRUint32 aAction,
                                      ClassPolicy** aCachedClassPolicy,
                                      SecurityLevel* result)
 {
     nsresult rv;
     result->level = SCRIPT_SECURITY_UNDEFINED_ACCESS;
 
+    DomainPolicy* dpolicy = nsnull;
     //-- Initialize policies if necessary
     if (mPolicyPrefsChanged)
     {
         rv = InitPolicies();
         if (NS_FAILED(rv))
             return rv;
     }
-
-    DomainPolicy* dpolicy = nsnull;
-    aPrincipal->GetSecurityPolicy((void**)&dpolicy);
+    else
+    {
+        aPrincipal->GetSecurityPolicy((void**)&dpolicy);
+    }
 
     if (!dpolicy && mOriginToPolicyMap)
     {
         //-- Look up the relevant domain policy, if any
 #ifdef DEBUG_CAPS_LookupPolicy
         printf("DomainLookup ");
 #endif
 
