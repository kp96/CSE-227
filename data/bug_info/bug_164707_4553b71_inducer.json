{"bug_id":164707,"commitHash":"4553b71","commit_info":{"sha":"4553b718c8e0da824def0b97d7eef741daf92529","commit":{"author":{"name":"kaie%kuix.de","email":"kaie%kuix.de","date":"2007-01-06T16:36:19Z"},"committer":{"name":"kaie%kuix.de","email":"kaie%kuix.de","date":"2007-01-06T16:36:19Z"},"message":"Bug 164707, Provide a way to view/delete orphan certs\nSupplemental patch\nr=rrelyea","tree":{"sha":"cddbd833a794e8e81c7e7928718cbc482a6351b2","url":"https://api.github.com/repos/mozilla/gecko-dev/git/trees/cddbd833a794e8e81c7e7928718cbc482a6351b2"},"url":"https://api.github.com/repos/mozilla/gecko-dev/git/commits/4553b718c8e0da824def0b97d7eef741daf92529","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/mozilla/gecko-dev/commits/4553b718c8e0da824def0b97d7eef741daf92529","html_url":"https://github.com/mozilla/gecko-dev/commit/4553b718c8e0da824def0b97d7eef741daf92529","comments_url":"https://api.github.com/repos/mozilla/gecko-dev/commits/4553b718c8e0da824def0b97d7eef741daf92529/comments","author":null,"committer":null,"parents":[{"sha":"ec8a31f04947a69f5883bc74b00ce18e5a94c6dc","url":"https://api.github.com/repos/mozilla/gecko-dev/commits/ec8a31f04947a69f5883bc74b00ce18e5a94c6dc","html_url":"https://github.com/mozilla/gecko-dev/commit/ec8a31f04947a69f5883bc74b00ce18e5a94c6dc"}],"stats":{"total":20,"additions":15,"deletions":5},"files":[{"sha":"6006fa5959fee4ef7b8130bc43bd2c0015c41346","filename":"security/manager/locales/en-US/chrome/pippki/pippki.properties","status":"modified","additions":0,"deletions":2,"changes":2,"blob_url":"https://github.com/mozilla/gecko-dev/blob/4553b718c8e0da824def0b97d7eef741daf92529/security/manager/locales/en-US/chrome/pippki/pippki.properties","raw_url":"https://github.com/mozilla/gecko-dev/raw/4553b718c8e0da824def0b97d7eef741daf92529/security/manager/locales/en-US/chrome/pippki/pippki.properties","contents_url":"https://api.github.com/repos/mozilla/gecko-dev/contents/security/manager/locales/en-US/chrome/pippki/pippki.properties?ref=4553b718c8e0da824def0b97d7eef741daf92529","patch":"@@ -70,9 +70,7 @@ deleteEmailCertConfirm=Are you sure you want to delete these people's e-mail cer\n deleteEmailCertImpact=If you delete an e-mail certificate, your will no longer be able to send encrypted e-mail to those people.\n deleteEmailCertTitle=Delete E-Mail Certificates\n \n-deleteOrphanCertFlag=deleteOrphanFlag\n deleteOrphanCertConfirm=Are you sure you want to delete these certificates?\n-deleteOrphanCertImpact=\n deleteOrphanCertTitle=Delete Certificates\n \n "},{"sha":"65434d09cd05332385d4cefd50e99e114c429f42","filename":"security/manager/pki/resources/content/deletecert.js","status":"modified","additions":6,"deletions":0,"changes":6,"blob_url":"https://github.com/mozilla/gecko-dev/blob/4553b718c8e0da824def0b97d7eef741daf92529/security/manager/pki/resources/content/deletecert.js","raw_url":"https://github.com/mozilla/gecko-dev/raw/4553b718c8e0da824def0b97d7eef741daf92529/security/manager/pki/resources/content/deletecert.js","contents_url":"https://api.github.com/repos/mozilla/gecko-dev/contents/security/manager/pki/resources/content/deletecert.js?ref=4553b718c8e0da824def0b97d7eef741daf92529","patch":"@@ -90,6 +90,12 @@ function setWindowName()\n      confirm = bundle.GetStringFromName(\"deleteEmailCertConfirm\");\n      impact = bundle.GetStringFromName(\"deleteEmailCertImpact\");\n   }\n+  else if(typeFlag == \"orphan_tab\")\n+  {\n+     title = bundle.GetStringFromName(\"deleteOrphanCertTitle\");\n+     confirm = bundle.GetStringFromName(\"deleteOrphanCertConfirm\");\n+     impact = \"\";\n+  }\n   else\n   {\n      return;"},{"sha":"fa9a8d3348c326b486bbbde4d97f199779d0b994","filename":"security/manager/ssl/src/nsNSSCertHelper.cpp","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/mozilla/gecko-dev/blob/4553b718c8e0da824def0b97d7eef741daf92529/security/manager/ssl/src/nsNSSCertHelper.cpp","raw_url":"https://github.com/mozilla/gecko-dev/raw/4553b718c8e0da824def0b97d7eef741daf92529/security/manager/ssl/src/nsNSSCertHelper.cpp","contents_url":"https://api.github.com/repos/mozilla/gecko-dev/contents/security/manager/ssl/src/nsNSSCertHelper.cpp?ref=4553b718c8e0da824def0b97d7eef741daf92529","patch":"@@ -2142,7 +2142,7 @@ getCertType(CERTCertificate *cert)\n     return nsIX509Cert::CA_CERT;\n   if (cert->emailAddr)\n     return nsIX509Cert::EMAIL_CERT;\n-  return nsIX509Cert::SERVER_CERT;\n+  return nsIX509Cert::UNKNOWN_CERT;\n }\n \n CERTCertNicknames *"},{"sha":"93db52376eb0fbd81c2807d03bdd6a010d84db78","filename":"security/manager/ssl/src/nsNSSCertificate.cpp","status":"modified","additions":8,"deletions":2,"changes":10,"blob_url":"https://github.com/mozilla/gecko-dev/blob/4553b718c8e0da824def0b97d7eef741daf92529/security/manager/ssl/src/nsNSSCertificate.cpp","raw_url":"https://github.com/mozilla/gecko-dev/raw/4553b718c8e0da824def0b97d7eef741daf92529/security/manager/ssl/src/nsNSSCertificate.cpp","contents_url":"https://api.github.com/repos/mozilla/gecko-dev/contents/security/manager/ssl/src/nsNSSCertificate.cpp?ref=4553b718c8e0da824def0b97d7eef741daf92529","patch":"@@ -89,6 +89,11 @@ extern PRLogModuleInfo* gPIPNSSLog;\n \n static NS_DEFINE_CID(kNSSComponentCID, NS_NSSCOMPONENT_CID);\n \n+// This is being stored in an PRUint32 that can otherwise\n+// only take values from nsIX509Cert's list of cert types.\n+// As nsIX509Cert is frozen, we choose a value not contained\n+// in the list to mean not yet initialized.\n+#define CERT_TYPE_NOT_YET_INITIALIZED (1 << 30)\n \n /* nsNSSCertificate */\n \n@@ -123,7 +128,7 @@ nsNSSCertificate::ConstructFromDER(char *certDER, int derLen)\n nsNSSCertificate::nsNSSCertificate(CERTCertificate *cert) : \n                                            mCert(nsnull),\n                                            mPermDelete(PR_FALSE),\n-                                           mCertType(nsIX509Cert::UNKNOWN_CERT)\n+                                           mCertType(CERT_TYPE_NOT_YET_INITIALIZED)\n {\n   nsNSSShutDownPreventionLock locker;\n   if (isAlreadyShutDown())\n@@ -174,7 +179,8 @@ void nsNSSCertificate::destructorSafeDestroyNSSReference()\n nsresult\n nsNSSCertificate::GetCertType(PRUint32 *aCertType)\n {\n-  if (mCertType == nsIX509Cert::UNKNOWN_CERT) {\n+  if (mCertType == CERT_TYPE_NOT_YET_INITIALIZED) {\n+     // only determine cert type once and cache it\n      mCertType = getCertType(mCert);\n   }\n   *aCertType = mCertType;"}]},"blames":["1a64376d","c62fdba4","07ea6d51","02f6597d","d1493d11","1a64376d","50d65e5e","c1e60067","31db9b54","f88b21c0","fc9a8580","26d4eeb2","b6f99631","568e7076","fd5d0bca","fbda8078","d007c347"]}