{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basd6e8ce6\""},"diff":[{"chunks":[{"content":"@@ -8154,35 +8154,27 @@ nsHTMLDocumentSH::GetProperty(nsIXPConnectWrappedNative *wrapper,","changes":[{"type":"normal","normal":true,"ln1":8154,"ln2":8154,"content":"                               JSContext *cx, JSObject *obj, jsval id,"},{"type":"normal","normal":true,"ln1":8155,"ln2":8155,"content":"                               jsval *vp, PRBool *_retval)"},{"type":"normal","normal":true,"ln1":8156,"ln2":8156,"content":" {"},{"type":"del","del":true,"ln":8157,"content":"-  // nsDocumentSH::GetProperty() does a security check for us, call"},{"type":"del","del":true,"ln":8158,"content":"-  // that first..."},{"type":"del","del":true,"ln":8159,"content":"-  nsresult rv = nsDocumentSH::GetProperty(wrapper, cx, obj, id, vp, _retval);"},{"type":"del","del":true,"ln":8160,"content":"-  if (!*_retval) {"},{"type":"del","del":true,"ln":8161,"content":"-    return rv;"},{"type":"del","del":true,"ln":8162,"content":"-  }"},{"type":"del","del":true,"ln":8163,"content":"-"},{"type":"normal","normal":true,"ln1":8164,"ln2":8157,"content":"   // For native wrappers, do not get random names on document"},{"type":"del","del":true,"ln":8165,"content":"-  if (ObjectIsNativeWrapper(cx, obj)) {"},{"type":"del","del":true,"ln":8166,"content":"-    return rv;"},{"type":"del","del":true,"ln":8167,"content":"-  }"},{"type":"del","del":true,"ln":8168,"content":"-  "},{"type":"del","del":true,"ln":8169,"content":"-  nsCOMPtr<nsISupports> result;"},{"type":"add","add":true,"ln":8158,"content":"+  if (!ObjectIsNativeWrapper(cx, obj)) {"},{"type":"add","add":true,"ln":8159,"content":"+    nsCOMPtr<nsISupports> result;"},{"type":"normal","normal":true,"ln1":8170,"ln2":8160,"content":" "},{"type":"del","del":true,"ln":8171,"content":"-  JSAutoRequest ar(cx);"},{"type":"add","add":true,"ln":8161,"content":"+    JSAutoRequest ar(cx);"},{"type":"normal","normal":true,"ln1":8172,"ln2":8162,"content":" "},{"type":"del","del":true,"ln":8173,"content":"-  rv = ResolveImpl(cx, wrapper, id, getter_AddRefs(result));"},{"type":"del","del":true,"ln":8174,"content":"-  NS_ENSURE_SUCCESS(rv, rv);"},{"type":"add","add":true,"ln":8163,"content":"+    nsresult rv = ResolveImpl(cx, wrapper, id, getter_AddRefs(result));"},{"type":"add","add":true,"ln":8164,"content":"+    NS_ENSURE_SUCCESS(rv, rv);"},{"type":"normal","normal":true,"ln1":8175,"ln2":8165,"content":" "},{"type":"del","del":true,"ln":8176,"content":"-  if (result) {"},{"type":"del","del":true,"ln":8177,"content":"-    nsCOMPtr<nsIXPConnectJSObjectHolder> holder;"},{"type":"del","del":true,"ln":8178,"content":"-    rv = WrapNative(cx, obj, result, NS_GET_IID(nsISupports), vp,"},{"type":"del","del":true,"ln":8179,"content":"-                    getter_AddRefs(holder));"},{"type":"del","del":true,"ln":8180,"content":"-    if (NS_SUCCEEDED(rv)) {"},{"type":"del","del":true,"ln":8181,"content":"-      rv = NS_SUCCESS_I_DID_SOMETHING;"},{"type":"add","add":true,"ln":8166,"content":"+    if (result) {"},{"type":"add","add":true,"ln":8167,"content":"+      nsCOMPtr<nsIXPConnectJSObjectHolder> holder;"},{"type":"add","add":true,"ln":8168,"content":"+      rv = WrapNative(cx, obj, result, NS_GET_IID(nsISupports), vp,"},{"type":"add","add":true,"ln":8169,"content":"+                      getter_AddRefs(holder));"},{"type":"add","add":true,"ln":8170,"content":"+      if (NS_SUCCEEDED(rv)) {"},{"type":"add","add":true,"ln":8171,"content":"+        rv = NS_SUCCESS_I_DID_SOMETHING;"},{"type":"add","add":true,"ln":8172,"content":"+      }"},{"type":"add","add":true,"ln":8173,"content":"+      return rv;"},{"type":"normal","normal":true,"ln1":8182,"ln2":8174,"content":"     }"},{"type":"normal","normal":true,"ln1":8183,"ln2":8175,"content":"   }"},{"type":"normal","normal":true,"ln1":8184,"ln2":8176,"content":" "},{"type":"del","del":true,"ln":8185,"content":"-  return rv;"},{"type":"add","add":true,"ln":8177,"content":"+  return nsDocumentSH::GetProperty(wrapper, cx, obj, id, vp, _retval);"},{"type":"normal","normal":true,"ln1":8186,"ln2":8178,"content":" }"},{"type":"normal","normal":true,"ln1":8187,"ln2":8179,"content":" "},{"type":"normal","normal":true,"ln1":8188,"ln2":8180,"content":" // HTMLElement helper"}],"oldStart":8154,"oldLines":35,"newStart":8154,"newLines":27},{"content":"@@ -8322,25 +8314,23 @@ nsHTMLFormElementSH::GetProperty(nsIXPConnectWrappedNative *wrapper,","changes":[{"type":"normal","normal":true,"ln1":8322,"ln2":8314,"content":"         return NS_FAILED(rv) ? rv : NS_SUCCESS_I_DID_SOMETHING;"},{"type":"normal","normal":true,"ln1":8323,"ln2":8315,"content":"       }"},{"type":"normal","normal":true,"ln1":8324,"ln2":8316,"content":"     }"},{"type":"add","add":true,"ln":8317,"content":"+  } else {"},{"type":"add","add":true,"ln":8318,"content":"+    PRInt32 n = GetArrayIndexFromId(cx, id);"},{"type":"normal","normal":true,"ln1":8325,"ln2":8319,"content":" "},{"type":"del","del":true,"ln":8326,"content":"-    return NS_OK; // Don't fall through"},{"type":"del","del":true,"ln":8327,"content":"-  }"},{"type":"del","del":true,"ln":8328,"content":"-"},{"type":"del","del":true,"ln":8329,"content":"-  PRInt32 n = GetArrayIndexFromId(cx, id);"},{"type":"del","del":true,"ln":8330,"content":"-"},{"type":"del","del":true,"ln":8331,"content":"-  if (n >= 0) {"},{"type":"del","del":true,"ln":8332,"content":"-    nsCOMPtr<nsIFormControl> control;"},{"type":"del","del":true,"ln":8333,"content":"-    form->GetElementAt(n, getter_AddRefs(control));"},{"type":"add","add":true,"ln":8320,"content":"+    if (n >= 0) {"},{"type":"add","add":true,"ln":8321,"content":"+      nsCOMPtr<nsIFormControl> control;"},{"type":"add","add":true,"ln":8322,"content":"+      form->GetElementAt(n, getter_AddRefs(control));"},{"type":"normal","normal":true,"ln1":8334,"ln2":8323,"content":" "},{"type":"del","del":true,"ln":8335,"content":"-    if (control) {"},{"type":"del","del":true,"ln":8336,"content":"-      nsCOMPtr<nsIXPConnectJSObjectHolder> holder;"},{"type":"del","del":true,"ln":8337,"content":"-      nsresult rv = WrapNative(cx, obj, control, NS_GET_IID(nsISupports), vp,"},{"type":"del","del":true,"ln":8338,"content":"-                               getter_AddRefs(holder));"},{"type":"del","del":true,"ln":8339,"content":"-      return NS_FAILED(rv) ? rv : NS_SUCCESS_I_DID_SOMETHING;"},{"type":"add","add":true,"ln":8324,"content":"+      if (control) {"},{"type":"add","add":true,"ln":8325,"content":"+        nsCOMPtr<nsIXPConnectJSObjectHolder> holder;"},{"type":"add","add":true,"ln":8326,"content":"+        nsresult rv = WrapNative(cx, obj, control, NS_GET_IID(nsISupports), vp,"},{"type":"add","add":true,"ln":8327,"content":"+                                 getter_AddRefs(holder));"},{"type":"add","add":true,"ln":8328,"content":"+        return NS_FAILED(rv) ? rv : NS_SUCCESS_I_DID_SOMETHING;"},{"type":"add","add":true,"ln":8329,"content":"+      }"},{"type":"normal","normal":true,"ln1":8340,"ln2":8330,"content":"     }"},{"type":"normal","normal":true,"ln1":8341,"ln2":8331,"content":"   }"},{"type":"normal","normal":true,"ln1":8342,"ln2":8332,"content":" "},{"type":"del","del":true,"ln":8343,"content":"-  return NS_OK;"},{"type":"add","add":true,"ln":8333,"content":"+  return nsHTMLElementSH::GetProperty(wrapper, cx, obj, id, vp, _retval);;"},{"type":"normal","normal":true,"ln1":8344,"ln2":8334,"content":" }"},{"type":"normal","normal":true,"ln1":8345,"ln2":8335,"content":" "},{"type":"normal","normal":true,"ln1":8346,"ln2":8336,"content":" NS_IMETHODIMP"}],"oldStart":8322,"oldLines":25,"newStart":8314,"newLines":23},{"content":"@@ -8449,10 +8439,11 @@ nsHTMLSelectElementSH::GetProperty(nsIXPConnectWrappedNative *wrapper,","changes":[{"type":"normal","normal":true,"ln1":8449,"ln2":8439,"content":"       if (NS_SUCCEEDED(rv)) {"},{"type":"normal","normal":true,"ln1":8450,"ln2":8440,"content":"         rv = NS_SUCCESS_I_DID_SOMETHING;"},{"type":"normal","normal":true,"ln1":8451,"ln2":8441,"content":"       }"},{"type":"add","add":true,"ln":8442,"content":"+      return rv;"},{"type":"normal","normal":true,"ln1":8452,"ln2":8443,"content":"     }"},{"type":"normal","normal":true,"ln1":8453,"ln2":8444,"content":"   }"},{"type":"normal","normal":true,"ln1":8454,"ln2":8445,"content":" "},{"type":"del","del":true,"ln":8455,"content":"-  return rv;"},{"type":"add","add":true,"ln":8446,"content":"+  return nsHTMLElementSH::GetProperty(wrapper, cx, obj, id, vp, _retval);;"},{"type":"normal","normal":true,"ln1":8456,"ln2":8447,"content":" }"},{"type":"normal","normal":true,"ln1":8457,"ln2":8448,"content":" "},{"type":"normal","normal":true,"ln1":8458,"ln2":8449,"content":" // static"}],"oldStart":8449,"oldLines":10,"newStart":8439,"newLines":11},{"content":"@@ -8734,7 +8725,7 @@ nsHTMLPluginObjElementSH::GetProperty(nsIXPConnectWrappedNative *wrapper,","changes":[{"type":"normal","normal":true,"ln1":8734,"ln2":8725,"content":"     return *_retval ? NS_SUCCESS_I_DID_SOMETHING : NS_ERROR_FAILURE;"},{"type":"normal","normal":true,"ln1":8735,"ln2":8726,"content":"   }"},{"type":"normal","normal":true,"ln1":8736,"ln2":8727,"content":" "},{"type":"del","del":true,"ln":8737,"content":"-  return NS_OK;"},{"type":"add","add":true,"ln":8728,"content":"+  return nsHTMLElementSH::GetProperty(wrapper, cx, obj, id, vp, _retval);;"},{"type":"normal","normal":true,"ln1":8738,"ln2":8729,"content":" }"},{"type":"normal","normal":true,"ln1":8739,"ln2":8730,"content":" "},{"type":"normal","normal":true,"ln1":8740,"ln2":8731,"content":" NS_IMETHODIMP"}],"oldStart":8734,"oldLines":7,"newStart":8725,"newLines":7}],"deletions":38,"additions":29,"from":"dom/src/base/nsDOMClassInfo.cpp","to":"dom/src/base/nsDOMClassInfo.cpp","index":["0ff7b6a..85f9950","100644"]},{"chunks":[{"content":"@@ -57,6 +57,7 @@ _TEST_FILES\t= \\","changes":[{"type":"normal","normal":true,"ln1":57,"ln2":57,"content":" \t\ttest_bug377539.html \\"},{"type":"normal","normal":true,"ln1":58,"ln2":58,"content":" \t\ttest_bug384122.html \\"},{"type":"normal","normal":true,"ln1":59,"ln2":59,"content":" \t\ttest_bug393974.html \\"},{"type":"add","add":true,"ln":60,"content":"+\t\ttest_bug396843.html \\"},{"type":"normal","normal":true,"ln1":60,"ln2":61,"content":" \t\t$(NULL)"},{"type":"normal","normal":true,"ln1":61,"ln2":62,"content":" "},{"type":"normal","normal":true,"ln1":62,"ln2":63,"content":" libs:: \t$(_TEST_FILES)"}],"oldStart":57,"oldLines":6,"newStart":57,"newLines":7}],"deletions":0,"additions":1,"from":"dom/tests/mochitest/bugs/Makefile.in","to":"dom/tests/mochitest/bugs/Makefile.in","index":["e70aca2..ae72002","100644"]},{"chunks":[{"content":"@@ -0,0 +1,302 @@","changes":[{"type":"add","add":true,"ln":1,"content":"+<!DOCTYPE HTML>"},{"type":"add","add":true,"ln":2,"content":"+<html>"},{"type":"add","add":true,"ln":3,"content":"+<!--"},{"type":"add","add":true,"ln":4,"content":"+https://bugzilla.mozilla.org/show_bug.cgi?id=396843"},{"type":"add","add":true,"ln":5,"content":"+-->"},{"type":"add","add":true,"ln":6,"content":"+<head>"},{"type":"add","add":true,"ln":7,"content":"+  <title>Test for Bug 396843</title>"},{"type":"add","add":true,"ln":8,"content":"+  <script type=\"text/javascript\" src=\"/MochiKit/MochiKit.js\"></script>"},{"type":"add","add":true,"ln":9,"content":"+  <script type=\"text/javascript\" src=\"/tests/SimpleTest/SimpleTest.js\"></script>"},{"type":"add","add":true,"ln":10,"content":"+  <link rel=\"stylesheet\" type=\"text/css\" href=\"/tests/SimpleTest/test.css\" />"},{"type":"add","add":true,"ln":11,"content":"+</head>"},{"type":"add","add":true,"ln":12,"content":"+<body>"},{"type":"add","add":true,"ln":13,"content":"+<a target=\"_blank\" href=\"https://bugzilla.mozilla.org/show_bug.cgi?id=396843\">Mozilla Bug 396843</a>"},{"type":"add","add":true,"ln":14,"content":"+<p id=\"display\">"},{"type":"add","add":true,"ln":15,"content":"+  <iframe src=\"http://example.org:80/\" id=\"t\"></iframe>"},{"type":"add","add":true,"ln":16,"content":"+</p>"},{"type":"add","add":true,"ln":17,"content":"+<div id=\"content\" style=\"display: none\">"},{"type":"add","add":true,"ln":18,"content":"+  "},{"type":"add","add":true,"ln":19,"content":"+</div>"},{"type":"add","add":true,"ln":20,"content":"+<pre id=\"test\">"},{"type":"add","add":true,"ln":21,"content":"+<script class=\"testbody\" type=\"text/javascript\">"},{"type":"add","add":true,"ln":22,"content":"+"},{"type":"add","add":true,"ln":23,"content":"+/** Test for Bug 396843 **/"},{"type":"add","add":true,"ln":24,"content":"+SimpleTest.waitForExplicitFinish();"},{"type":"add","add":true,"ln":25,"content":"+"},{"type":"add","add":true,"ln":26,"content":"+var allNodes = [];"},{"type":"add","add":true,"ln":27,"content":"+var XMLNodes = [];"},{"type":"add","add":true,"ln":28,"content":"+var failNodes = [];"},{"type":"add","add":true,"ln":29,"content":"+"},{"type":"add","add":true,"ln":30,"content":"+// HTML"},{"type":"add","add":true,"ln":31,"content":"+function HTML_TAG(name) {"},{"type":"add","add":true,"ln":32,"content":"+  allNodes.push(document.createElement(name));"},{"type":"add","add":true,"ln":33,"content":"+}"},{"type":"add","add":true,"ln":34,"content":"+"},{"type":"add","add":true,"ln":35,"content":"+/* List copy/pasted from nsHTMLTagList.h */"},{"type":"add","add":true,"ln":36,"content":"+HTML_TAG(\"a\", \"Anchor\")"},{"type":"add","add":true,"ln":37,"content":"+HTML_TAG(\"abbr\", \"Span\")"},{"type":"add","add":true,"ln":38,"content":"+HTML_TAG(\"acronym\", \"Span\")"},{"type":"add","add":true,"ln":39,"content":"+HTML_TAG(\"address\", \"Span\")"},{"type":"add","add":true,"ln":40,"content":"+HTML_TAG(\"applet\", \"SharedObject\")"},{"type":"add","add":true,"ln":41,"content":"+HTML_TAG(\"area\", \"Area\")"},{"type":"add","add":true,"ln":42,"content":"+HTML_TAG(\"b\", \"Span\")"},{"type":"add","add":true,"ln":43,"content":"+HTML_TAG(\"base\", \"Shared\")"},{"type":"add","add":true,"ln":44,"content":"+HTML_TAG(\"basefont\", \"Shared\")"},{"type":"add","add":true,"ln":45,"content":"+HTML_TAG(\"bdo\", \"Span\")"},{"type":"add","add":true,"ln":46,"content":"+HTML_TAG(\"bgsound\", \"Span\")"},{"type":"add","add":true,"ln":47,"content":"+HTML_TAG(\"big\", \"Span\")"},{"type":"add","add":true,"ln":48,"content":"+HTML_TAG(\"blink\", \"Span\")"},{"type":"add","add":true,"ln":49,"content":"+HTML_TAG(\"blockquote\", \"Shared\")"},{"type":"add","add":true,"ln":50,"content":"+HTML_TAG(\"body\", \"Body\")"},{"type":"add","add":true,"ln":51,"content":"+HTML_TAG(\"br\", \"BR\")"},{"type":"add","add":true,"ln":52,"content":"+HTML_TAG(\"button\", \"Button\")"},{"type":"add","add":true,"ln":53,"content":"+HTML_TAG(\"canvas\", \"Canvas\")"},{"type":"add","add":true,"ln":54,"content":"+HTML_TAG(\"caption\", \"TableCaption\")"},{"type":"add","add":true,"ln":55,"content":"+HTML_TAG(\"center\", \"Span\")"},{"type":"add","add":true,"ln":56,"content":"+HTML_TAG(\"cite\", \"Span\")"},{"type":"add","add":true,"ln":57,"content":"+HTML_TAG(\"code\", \"Span\")"},{"type":"add","add":true,"ln":58,"content":"+HTML_TAG(\"col\", \"TableCol\")"},{"type":"add","add":true,"ln":59,"content":"+HTML_TAG(\"colgroup\", \"TableCol\")"},{"type":"add","add":true,"ln":60,"content":"+HTML_TAG(\"dd\", \"Span\")"},{"type":"add","add":true,"ln":61,"content":"+HTML_TAG(\"del\", \"Mod\")"},{"type":"add","add":true,"ln":62,"content":"+HTML_TAG(\"dfn\", \"Span\")"},{"type":"add","add":true,"ln":63,"content":"+HTML_TAG(\"dir\", \"Shared\")"},{"type":"add","add":true,"ln":64,"content":"+HTML_TAG(\"div\", \"Div\")"},{"type":"add","add":true,"ln":65,"content":"+HTML_TAG(\"dl\", \"SharedList\")"},{"type":"add","add":true,"ln":66,"content":"+HTML_TAG(\"dt\", \"Span\")"},{"type":"add","add":true,"ln":67,"content":"+HTML_TAG(\"em\", \"Span\")"},{"type":"add","add":true,"ln":68,"content":"+HTML_TAG(\"embed\", \"SharedObject\")"},{"type":"add","add":true,"ln":69,"content":"+HTML_TAG(\"fieldset\", \"FieldSet\")"},{"type":"add","add":true,"ln":70,"content":"+HTML_TAG(\"font\", \"Font\")"},{"type":"add","add":true,"ln":71,"content":"+HTML_TAG(\"form\", \"Form\")"},{"type":"add","add":true,"ln":72,"content":"+HTML_TAG(\"frame\", \"Frame\")"},{"type":"add","add":true,"ln":73,"content":"+HTML_TAG(\"frameset\", \"FrameSet\")"},{"type":"add","add":true,"ln":74,"content":"+HTML_TAG(\"h1\", \"Heading\")"},{"type":"add","add":true,"ln":75,"content":"+HTML_TAG(\"h2\", \"Heading\")"},{"type":"add","add":true,"ln":76,"content":"+HTML_TAG(\"h3\", \"Heading\")"},{"type":"add","add":true,"ln":77,"content":"+HTML_TAG(\"h4\", \"Heading\")"},{"type":"add","add":true,"ln":78,"content":"+HTML_TAG(\"h5\", \"Heading\")"},{"type":"add","add":true,"ln":79,"content":"+HTML_TAG(\"h6\", \"Heading\")"},{"type":"add","add":true,"ln":80,"content":"+HTML_TAG(\"head\", \"Head\")"},{"type":"add","add":true,"ln":81,"content":"+HTML_TAG(\"hr\", \"HR\")"},{"type":"add","add":true,"ln":82,"content":"+HTML_TAG(\"html\", \"Html\")"},{"type":"add","add":true,"ln":83,"content":"+HTML_TAG(\"i\", \"Span\")"},{"type":"add","add":true,"ln":84,"content":"+HTML_TAG(\"iframe\", \"IFrame\")"},{"type":"add","add":true,"ln":85,"content":"+HTML_TAG(\"image\", \"Span\")"},{"type":"add","add":true,"ln":86,"content":"+HTML_TAG(\"img\", \"Image\")"},{"type":"add","add":true,"ln":87,"content":"+HTML_TAG(\"input\", \"Input\")"},{"type":"add","add":true,"ln":88,"content":"+HTML_TAG(\"ins\", \"Mod\")"},{"type":"add","add":true,"ln":89,"content":"+HTML_TAG(\"isindex\", \"Shared\")"},{"type":"add","add":true,"ln":90,"content":"+HTML_TAG(\"kbd\", \"Span\")"},{"type":"add","add":true,"ln":91,"content":"+HTML_TAG(\"keygen\", \"Span\")"},{"type":"add","add":true,"ln":92,"content":"+HTML_TAG(\"label\", \"Label\")"},{"type":"add","add":true,"ln":93,"content":"+HTML_TAG(\"legend\", \"Legend\")"},{"type":"add","add":true,"ln":94,"content":"+HTML_TAG(\"li\", \"LI\")"},{"type":"add","add":true,"ln":95,"content":"+HTML_TAG(\"link\", \"Link\")"},{"type":"add","add":true,"ln":96,"content":"+HTML_TAG(\"listing\", \"Span\")"},{"type":"add","add":true,"ln":97,"content":"+HTML_TAG(\"map\", \"Map\")"},{"type":"add","add":true,"ln":98,"content":"+HTML_TAG(\"marquee\", \"Div\")"},{"type":"add","add":true,"ln":99,"content":"+HTML_TAG(\"menu\", \"Shared\")"},{"type":"add","add":true,"ln":100,"content":"+HTML_TAG(\"meta\", \"Meta\")"},{"type":"add","add":true,"ln":101,"content":"+HTML_TAG(\"multicol\", \"Span\")"},{"type":"add","add":true,"ln":102,"content":"+HTML_TAG(\"nobr\", \"Span\")"},{"type":"add","add":true,"ln":103,"content":"+HTML_TAG(\"noembed\", \"Div\")"},{"type":"add","add":true,"ln":104,"content":"+HTML_TAG(\"noframes\", \"Div\")"},{"type":"add","add":true,"ln":105,"content":"+HTML_TAG(\"noscript\", \"Div\")"},{"type":"add","add":true,"ln":106,"content":"+HTML_TAG(\"object\", \"Object\")"},{"type":"add","add":true,"ln":107,"content":"+HTML_TAG(\"ol\", \"SharedList\")"},{"type":"add","add":true,"ln":108,"content":"+HTML_TAG(\"optgroup\", \"OptGroup\")"},{"type":"add","add":true,"ln":109,"content":"+HTML_TAG(\"option\", \"Option\")"},{"type":"add","add":true,"ln":110,"content":"+HTML_TAG(\"p\", \"Paragraph\")"},{"type":"add","add":true,"ln":111,"content":"+HTML_TAG(\"param\", \"Shared\")"},{"type":"add","add":true,"ln":112,"content":"+HTML_TAG(\"plaintext\", \"Span\")"},{"type":"add","add":true,"ln":113,"content":"+HTML_TAG(\"pre\", \"Pre\")"},{"type":"add","add":true,"ln":114,"content":"+HTML_TAG(\"q\", \"Shared\")"},{"type":"add","add":true,"ln":115,"content":"+HTML_TAG(\"s\", \"Span\")"},{"type":"add","add":true,"ln":116,"content":"+HTML_TAG(\"samp\", \"Span\")"},{"type":"add","add":true,"ln":117,"content":"+HTML_TAG(\"script\", \"Script\")"},{"type":"add","add":true,"ln":118,"content":"+HTML_TAG(\"select\", \"Select\")"},{"type":"add","add":true,"ln":119,"content":"+HTML_TAG(\"small\", \"Span\")"},{"type":"add","add":true,"ln":120,"content":"+HTML_TAG(\"spacer\", \"Shared\")"},{"type":"add","add":true,"ln":121,"content":"+HTML_TAG(\"span\", \"Span\")"},{"type":"add","add":true,"ln":122,"content":"+HTML_TAG(\"strike\", \"Span\")"},{"type":"add","add":true,"ln":123,"content":"+HTML_TAG(\"strong\", \"Span\")"},{"type":"add","add":true,"ln":124,"content":"+HTML_TAG(\"style\", \"Style\")"},{"type":"add","add":true,"ln":125,"content":"+HTML_TAG(\"sub\", \"Span\")"},{"type":"add","add":true,"ln":126,"content":"+HTML_TAG(\"sup\", \"Span\")"},{"type":"add","add":true,"ln":127,"content":"+HTML_TAG(\"table\", \"Table\")"},{"type":"add","add":true,"ln":128,"content":"+HTML_TAG(\"tbody\", \"TableSection\")"},{"type":"add","add":true,"ln":129,"content":"+HTML_TAG(\"td\", \"TableCell\")"},{"type":"add","add":true,"ln":130,"content":"+HTML_TAG(\"textarea\", \"TextArea\")"},{"type":"add","add":true,"ln":131,"content":"+HTML_TAG(\"tfoot\", \"TableSection\")"},{"type":"add","add":true,"ln":132,"content":"+HTML_TAG(\"th\", \"TableCell\")"},{"type":"add","add":true,"ln":133,"content":"+HTML_TAG(\"thead\", \"TableSection\")"},{"type":"add","add":true,"ln":134,"content":"+HTML_TAG(\"title\", \"Title\")"},{"type":"add","add":true,"ln":135,"content":"+HTML_TAG(\"tr\", \"TableRow\")"},{"type":"add","add":true,"ln":136,"content":"+HTML_TAG(\"tt\", \"Span\")"},{"type":"add","add":true,"ln":137,"content":"+HTML_TAG(\"u\", \"Span\")"},{"type":"add","add":true,"ln":138,"content":"+HTML_TAG(\"ul\", \"SharedList\")"},{"type":"add","add":true,"ln":139,"content":"+HTML_TAG(\"var\", \"Span\")"},{"type":"add","add":true,"ln":140,"content":"+HTML_TAG(\"wbr\", \"Shared\")"},{"type":"add","add":true,"ln":141,"content":"+HTML_TAG(\"xmp\", \"Span\")"},{"type":"add","add":true,"ln":142,"content":"+"},{"type":"add","add":true,"ln":143,"content":"+function SVG_TAG(name) {"},{"type":"add","add":true,"ln":144,"content":"+  allNodes.push(document.createElementNS(\"http://www.w3.org/2000/svg\", \"svg\"));"},{"type":"add","add":true,"ln":145,"content":"+}"},{"type":"add","add":true,"ln":146,"content":"+"},{"type":"add","add":true,"ln":147,"content":"+// List sorta stolen from SVG element factory."},{"type":"add","add":true,"ln":148,"content":"+SVG_TAG(\"a\")"},{"type":"add","add":true,"ln":149,"content":"+SVG_TAG(\"polyline\")"},{"type":"add","add":true,"ln":150,"content":"+SVG_TAG(\"polygon\")"},{"type":"add","add":true,"ln":151,"content":"+SVG_TAG(\"circle\")"},{"type":"add","add":true,"ln":152,"content":"+SVG_TAG(\"ellipse\")"},{"type":"add","add":true,"ln":153,"content":"+SVG_TAG(\"line\")"},{"type":"add","add":true,"ln":154,"content":"+SVG_TAG(\"rect\")"},{"type":"add","add":true,"ln":155,"content":"+SVG_TAG(\"svg\")"},{"type":"add","add":true,"ln":156,"content":"+SVG_TAG(\"g\")"},{"type":"add","add":true,"ln":157,"content":"+SVG_TAG(\"foreignObject\")"},{"type":"add","add":true,"ln":158,"content":"+SVG_TAG(\"path\")"},{"type":"add","add":true,"ln":159,"content":"+SVG_TAG(\"text\")"},{"type":"add","add":true,"ln":160,"content":"+SVG_TAG(\"tspan\")"},{"type":"add","add":true,"ln":161,"content":"+SVG_TAG(\"image\")"},{"type":"add","add":true,"ln":162,"content":"+SVG_TAG(\"style\")"},{"type":"add","add":true,"ln":163,"content":"+SVG_TAG(\"linearGradient\")"},{"type":"add","add":true,"ln":164,"content":"+SVG_TAG(\"metadata\")"},{"type":"add","add":true,"ln":165,"content":"+SVG_TAG(\"radialGradient\")"},{"type":"add","add":true,"ln":166,"content":"+SVG_TAG(\"stop\")"},{"type":"add","add":true,"ln":167,"content":"+SVG_TAG(\"defs\")"},{"type":"add","add":true,"ln":168,"content":"+SVG_TAG(\"desc\")"},{"type":"add","add":true,"ln":169,"content":"+SVG_TAG(\"script\")"},{"type":"add","add":true,"ln":170,"content":"+SVG_TAG(\"use\")"},{"type":"add","add":true,"ln":171,"content":"+SVG_TAG(\"symbol\")"},{"type":"add","add":true,"ln":172,"content":"+SVG_TAG(\"marker\")"},{"type":"add","add":true,"ln":173,"content":"+SVG_TAG(\"title\")"},{"type":"add","add":true,"ln":174,"content":"+SVG_TAG(\"clipPath\")"},{"type":"add","add":true,"ln":175,"content":"+SVG_TAG(\"textPath\")"},{"type":"add","add":true,"ln":176,"content":"+SVG_TAG(\"filter\")"},{"type":"add","add":true,"ln":177,"content":"+SVG_TAG(\"feBlend\")"},{"type":"add","add":true,"ln":178,"content":"+SVG_TAG(\"feColorMatrix\")"},{"type":"add","add":true,"ln":179,"content":"+SVG_TAG(\"feComponentTransfer\")"},{"type":"add","add":true,"ln":180,"content":"+SVG_TAG(\"feComposite\")"},{"type":"add","add":true,"ln":181,"content":"+SVG_TAG(\"feFuncR\")"},{"type":"add","add":true,"ln":182,"content":"+SVG_TAG(\"feFuncG\")"},{"type":"add","add":true,"ln":183,"content":"+SVG_TAG(\"feFuncB\")"},{"type":"add","add":true,"ln":184,"content":"+SVG_TAG(\"feFuncA\")"},{"type":"add","add":true,"ln":185,"content":"+SVG_TAG(\"feGaussianBlur\")"},{"type":"add","add":true,"ln":186,"content":"+SVG_TAG(\"feMerge\")"},{"type":"add","add":true,"ln":187,"content":"+SVG_TAG(\"feMergeNode\")"},{"type":"add","add":true,"ln":188,"content":"+SVG_TAG(\"feMorphology\")"},{"type":"add","add":true,"ln":189,"content":"+SVG_TAG(\"feOffset\")"},{"type":"add","add":true,"ln":190,"content":"+SVG_TAG(\"feFlood\")"},{"type":"add","add":true,"ln":191,"content":"+SVG_TAG(\"feTile\")"},{"type":"add","add":true,"ln":192,"content":"+SVG_TAG(\"feTurbulence\")"},{"type":"add","add":true,"ln":193,"content":"+SVG_TAG(\"feConvolveMatrix\")"},{"type":"add","add":true,"ln":194,"content":"+SVG_TAG(\"feDistantLight\")"},{"type":"add","add":true,"ln":195,"content":"+SVG_TAG(\"fePointLight\")"},{"type":"add","add":true,"ln":196,"content":"+SVG_TAG(\"feSpotLight\")"},{"type":"add","add":true,"ln":197,"content":"+SVG_TAG(\"feDiffuseLighting\")"},{"type":"add","add":true,"ln":198,"content":"+SVG_TAG(\"feSpecularLighting\")"},{"type":"add","add":true,"ln":199,"content":"+SVG_TAG(\"feDisplacementMap\")"},{"type":"add","add":true,"ln":200,"content":"+SVG_TAG(\"feImage\")"},{"type":"add","add":true,"ln":201,"content":"+SVG_TAG(\"pattern\")"},{"type":"add","add":true,"ln":202,"content":"+SVG_TAG(\"mask\")"},{"type":"add","add":true,"ln":203,"content":"+SVG_TAG(\"svgSwitch\")"},{"type":"add","add":true,"ln":204,"content":"+"},{"type":"add","add":true,"ln":205,"content":"+// Toss in some other namespaced stuff too, for good measure"},{"type":"add","add":true,"ln":206,"content":"+allNodes.push(document.createElementNS("},{"type":"add","add":true,"ln":207,"content":"+               \"http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul\","},{"type":"add","add":true,"ln":208,"content":"+               \"window\"));"},{"type":"add","add":true,"ln":209,"content":"+allNodes.push(document.createElementNS(\"http://www.w3.org/1998/Math/MathML\","},{"type":"add","add":true,"ln":210,"content":"+                                       \"math\"));"},{"type":"add","add":true,"ln":211,"content":"+allNodes.push(document.createElementNS(\"http://www.w3.org/2001/xml-events\","},{"type":"add","add":true,"ln":212,"content":"+                                       \"testname\"));"},{"type":"add","add":true,"ln":213,"content":"+allNodes.push(document.createElementNS(\"bogus.namespace\", \"testname\"));"},{"type":"add","add":true,"ln":214,"content":"+"},{"type":"add","add":true,"ln":215,"content":"+var XMLDoc = document.implementation.createDocument(\"\", \"\", null);"},{"type":"add","add":true,"ln":216,"content":"+"},{"type":"add","add":true,"ln":217,"content":"+// And non-elements"},{"type":"add","add":true,"ln":218,"content":"+allNodes.push(document.createTextNode(\"some text\"));"},{"type":"add","add":true,"ln":219,"content":"+allNodes.push(document.createComment(\"some text\"));"},{"type":"add","add":true,"ln":220,"content":"+XMLNodes.push(XMLDoc.createCDATASection(\"some text\"));"},{"type":"add","add":true,"ln":221,"content":"+failNodes.push(document.createDocumentFragment());"},{"type":"add","add":true,"ln":222,"content":"+XMLNodes.push(XMLDoc.createProcessingInstruction(\"PI\", \"data\"));"},{"type":"add","add":true,"ln":223,"content":"+               "},{"type":"add","add":true,"ln":224,"content":"+function runTest() {"},{"type":"add","add":true,"ln":225,"content":"+  ok(document.nodePrincipal === undefined, \"Must not have document principal\");"},{"type":"add","add":true,"ln":226,"content":"+  ok(document.baseURIObject === undefined, \"Must not have document base URI\");"},{"type":"add","add":true,"ln":227,"content":"+  ok(document.documentURIObject === undefined, \"Must have document URI\");"},{"type":"add","add":true,"ln":228,"content":"+"},{"type":"add","add":true,"ln":229,"content":"+  for (var i = 0; i < allNodes.length; ++i) {"},{"type":"add","add":true,"ln":230,"content":"+    ok(allNodes[i].nodePrincipal === undefined,"},{"type":"add","add":true,"ln":231,"content":"+       \"Unexpected principal appears for \" + allNodes[i].nodeName);"},{"type":"add","add":true,"ln":232,"content":"+    ok(allNodes[i].baseURIObject === undefined,"},{"type":"add","add":true,"ln":233,"content":"+       \"Unexpected base URI appears for \" + allNodes[i].nodeName);"},{"type":"add","add":true,"ln":234,"content":"+  }"},{"type":"add","add":true,"ln":235,"content":"+}"},{"type":"add","add":true,"ln":236,"content":"+"},{"type":"add","add":true,"ln":237,"content":"+function runTest2() {"},{"type":"add","add":true,"ln":238,"content":"+  netscape.security.PrivilegeManager.enablePrivilege(\"UniversalXPConnect\");"},{"type":"add","add":true,"ln":239,"content":"+  isnot(document.nodePrincipal, null, \"Must have document principal\");"},{"type":"add","add":true,"ln":240,"content":"+  is(document.nodePrincipal instanceof Components.interfaces.nsIPrincipal,"},{"type":"add","add":true,"ln":241,"content":"+     true, \"document principal must be a principal\");"},{"type":"add","add":true,"ln":242,"content":"+  isnot(document.baseURIObject, null, \"Must have document base URI\");"},{"type":"add","add":true,"ln":243,"content":"+  is(document.baseURIObject instanceof Components.interfaces.nsIURI,"},{"type":"add","add":true,"ln":244,"content":"+     true, \"document base URI must be a URI\");"},{"type":"add","add":true,"ln":245,"content":"+  isnot(document.documentURIObject, null, \"Must have document URI\");"},{"type":"add","add":true,"ln":246,"content":"+  is(document.documentURIObject instanceof Components.interfaces.nsIURI,"},{"type":"add","add":true,"ln":247,"content":"+     true, \"document URI must be a URI\");"},{"type":"add","add":true,"ln":248,"content":"+  is(document.documentURIObject.spec, document.documentURI,"},{"type":"add","add":true,"ln":249,"content":"+     \"document URI must be the right URI\");"},{"type":"add","add":true,"ln":250,"content":"+     "},{"type":"add","add":true,"ln":251,"content":"+  for (var i = 0; i < allNodes.length; ++i) {"},{"type":"add","add":true,"ln":252,"content":"+    is(allNodes[i].nodePrincipal, document.nodePrincipal,"},{"type":"add","add":true,"ln":253,"content":"+       \"Unexpected principal for \" + allNodes[i].nodeName);"},{"type":"add","add":true,"ln":254,"content":"+    is(allNodes[i].baseURIObject, document.baseURIObject,"},{"type":"add","add":true,"ln":255,"content":"+       \"Unexpected base URI for \" + allNodes[i].nodeName);"},{"type":"add","add":true,"ln":256,"content":"+  }"},{"type":"add","add":true,"ln":257,"content":"+"},{"type":"add","add":true,"ln":258,"content":"+  for (i = 0; i < XMLNodes.length; ++i) {"},{"type":"add","add":true,"ln":259,"content":"+    is(XMLNodes[i].nodePrincipal, document.nodePrincipal,"},{"type":"add","add":true,"ln":260,"content":"+       \"Unexpected principal for \" + XMLNodes[i].nodeName);"},{"type":"add","add":true,"ln":261,"content":"+    is(XMLNodes[i].baseURIObject.spec, \"about:blank\","},{"type":"add","add":true,"ln":262,"content":"+       \"Unexpected base URI for \" + XMLNodes[i].nodeName);"},{"type":"add","add":true,"ln":263,"content":"+  }"},{"type":"add","add":true,"ln":264,"content":"+"},{"type":"add","add":true,"ln":265,"content":"+  for (i = 0; i < failNodes.length; ++i) {"},{"type":"add","add":true,"ln":266,"content":"+    todo(failNodes[i].nodePrincipal == document.nodePrincipal,"},{"type":"add","add":true,"ln":267,"content":"+       \"Unexpected principal for \" + failNodes[i].nodeName);"},{"type":"add","add":true,"ln":268,"content":"+    todo(failNodes[i].baseURIObject == document.baseURIObject,"},{"type":"add","add":true,"ln":269,"content":"+       \"Unexpected base URI for \" + failNodes[i].nodeName);"},{"type":"add","add":true,"ln":270,"content":"+  }"},{"type":"add","add":true,"ln":271,"content":"+"},{"type":"add","add":true,"ln":272,"content":"+  var doc = $(\"t\").contentDocument;"},{"type":"add","add":true,"ln":273,"content":"+  try {"},{"type":"add","add":true,"ln":274,"content":"+    is(doc instanceof $(\"t\").contentWindow.HTMLDocument, true,"},{"type":"add","add":true,"ln":275,"content":"+      \"Expected an HTMLDocument here\");"},{"type":"add","add":true,"ln":276,"content":"+    todo(1, \"Someone fixed bug 396849; need to update this code\");"},{"type":"add","add":true,"ln":277,"content":"+  } catch (e) {"},{"type":"add","add":true,"ln":278,"content":"+    todo(0, \"Running into bug 396849\");"},{"type":"add","add":true,"ln":279,"content":"+  }"},{"type":"add","add":true,"ln":280,"content":"+  isnot(doc.nodePrincipal, null, \"Must have doc principal\");"},{"type":"add","add":true,"ln":281,"content":"+  is(doc.nodePrincipal instanceof Components.interfaces.nsIPrincipal,"},{"type":"add","add":true,"ln":282,"content":"+     true, \"doc principal must be a principal\");"},{"type":"add","add":true,"ln":283,"content":"+  isnot(doc.baseURIObject, null, \"Must have doc base URI\");"},{"type":"add","add":true,"ln":284,"content":"+  is(doc.baseURIObject instanceof Components.interfaces.nsIURI,"},{"type":"add","add":true,"ln":285,"content":"+     true, \"doc base URI must be a URI\");"},{"type":"add","add":true,"ln":286,"content":"+  isnot(doc.documentURIObject, null, \"Must have doc URI\");"},{"type":"add","add":true,"ln":287,"content":"+  is(doc.documentURIObject instanceof Components.interfaces.nsIURI,"},{"type":"add","add":true,"ln":288,"content":"+     true, \"doc URI must be a URI\");"},{"type":"add","add":true,"ln":289,"content":"+  is(doc.documentURIObject.spec, doc.documentURI,"},{"type":"add","add":true,"ln":290,"content":"+     \"doc URI must be the right URI\");"},{"type":"add","add":true,"ln":291,"content":"+}"},{"type":"add","add":true,"ln":292,"content":"+"},{"type":"add","add":true,"ln":293,"content":"+addLoadEvent(runTest);"},{"type":"add","add":true,"ln":294,"content":"+addLoadEvent(runTest2);"},{"type":"add","add":true,"ln":295,"content":"+addLoadEvent(runTest);"},{"type":"add","add":true,"ln":296,"content":"+addLoadEvent(SimpleTest.finish);"},{"type":"add","add":true,"ln":297,"content":"+"},{"type":"add","add":true,"ln":298,"content":"+</script>"},{"type":"add","add":true,"ln":299,"content":"+</pre>"},{"type":"add","add":true,"ln":300,"content":"+</body>"},{"type":"add","add":true,"ln":301,"content":"+</html>"},{"type":"add","add":true,"ln":302,"content":"+"}],"oldStart":0,"oldLines":0,"newStart":1,"newLines":302}],"deletions":0,"additions":302,"from":"/dev/null","to":"dom/tests/mochitest/bugs/test_bug396843.html","new":true,"index":["0000000..98301c6"]}]}