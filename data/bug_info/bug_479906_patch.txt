diff --git a/mailnews/base/src/nsMsgContentPolicy.cpp b/mailnews/base/src/nsMsgContentPolicy.cpp
--- a/mailnews/base/src/nsMsgContentPolicy.cpp
+++ b/mailnews/base/src/nsMsgContentPolicy.cpp
@@ -742,20 +742,22 @@ nsMsgContentPolicy::OnLocationChange(nsI
   
   nsCOMPtr<nsIDocShell> docShell = do_QueryInterface(aWebProgress, &rv);
   if (NS_FAILED(rv)) {
     return NS_OK;
   }
 
 #ifdef DEBUG
   nsCOMPtr<nsIChannel> channel = do_QueryInterface(aRequest, &rv);
-  nsCOMPtr<nsIDocShell> docShell2;
-  NS_QueryNotificationCallbacks(channel, docShell2);
-  NS_ASSERTION(docShell == docShell2, "aWebProgress and channel callbacks"
-                                      " do not point to the same docshell");
+  if (NS_SUCCEEDED(rv)) {
+    nsCOMPtr<nsIDocShell> docShell2;
+    NS_QueryNotificationCallbacks(channel, docShell2);
+    NS_ASSERTION(docShell == docShell2, "aWebProgress and channel callbacks"
+                                        " do not point to the same docshell");
+  }
 #endif
   
   // If this is a mailnews url, turn off JavaScript, otherwise turn it on
   nsCOMPtr<nsIMsgMessageUrl> messageUrl = do_QueryInterface(aLocation, &rv);
   return docShell->SetAllowJavascript(NS_FAILED(rv));
 }
 
 NS_IMETHODIMP
