Index: netwerk/socket/base/nsISSLSocketControl.idl
===================================================================
RCS file: /cvsroot/mozilla/netwerk/socket/base/nsISSLSocketControl.idl,v
retrieving revision 1.7
diff -u -8 -p -r1.7 nsISSLSocketControl.idl
--- netwerk/socket/base/nsISSLSocketControl.idl	8 Nov 2004 03:13:21 -0000	1.7
+++ netwerk/socket/base/nsISSLSocketControl.idl	26 Nov 2007 21:54:44 -0000
@@ -37,17 +37,16 @@
  * the terms of any one of the MPL, the GPL or the LGPL.
  *
  * ***** END LICENSE BLOCK ***** */
 
 #include "nsISupports.idl"
 
 interface nsIInterfaceRequestor;
 
-[scriptable, uuid(8b3e8488-1dd2-11b2-b547-956290be347c)]
+[scriptable, uuid(a092097c-8386-4f1b-97b1-90eb70008c2d)]
 interface nsISSLSocketControl : nsISupports {
     attribute nsIInterfaceRequestor     notificationCallbacks;
-    attribute boolean                   forceHandshake; /* obsolete, unused */
 
     void proxyStartSSL();
     void StartTLS();
 };
 
Index: security/manager/ssl/src/nsNSSIOLayer.cpp
===================================================================
RCS file: /cvsroot/mozilla/security/manager/ssl/src/nsNSSIOLayer.cpp,v
retrieving revision 1.144
diff -u -8 -p -r1.144 nsNSSIOLayer.cpp
--- security/manager/ssl/src/nsNSSIOLayer.cpp	20 Nov 2007 17:56:04 -0000	1.144
+++ security/manager/ssl/src/nsNSSIOLayer.cpp	26 Nov 2007 21:54:47 -0000
@@ -198,48 +198,34 @@ nsNSSSocketInfo::nsNSSSocketInfo()
     mExternalErrorReporting(PR_FALSE),
     mForSTARTTLS(PR_FALSE),
     mHandshakePending(PR_TRUE),
     mCanceled(PR_FALSE),
     mHasCleartextPhase(PR_FALSE),
     mHandshakeInProgress(PR_FALSE),
     mAllowTLSIntoleranceTimeout(PR_TRUE),
     mHandshakeStartTime(0),
-    mPort(0),
-    mCAChain(nsnull)
+    mPort(0)
 {
   mThreadData = new nsSSLSocketThreadData;
 }
 
 nsNSSSocketInfo::~nsNSSSocketInfo()
 {
   delete mThreadData;
 
   nsNSSShutDownPreventionLock locker;
   if (isAlreadyShutDown())
     return;
 
-  destructorSafeDestroyNSSReference();
   shutdown(calledFromObject);
 }
 
 void nsNSSSocketInfo::virtualDestroyNSSReference()
 {
-  destructorSafeDestroyNSSReference();
-}
-
-void nsNSSSocketInfo::destructorSafeDestroyNSSReference()
-{
-  if (isAlreadyShutDown())
-    return;
-
-  if (mCAChain) {
-    CERT_DestroyCertList(mCAChain);
-    mCAChain = nsnull;
-  }
 }
 
 NS_IMPL_THREADSAFE_ISUPPORTS5(nsNSSSocketInfo,
                               nsITransportSecurityInfo,
                               nsISSLSocketControl,
                               nsIInterfaceRequestor,
                               nsISSLStatusProvider,
                               nsIIdentityInfo)
@@ -438,30 +424,16 @@ NS_IMETHODIMP nsNSSSocketInfo::GetInterf
     // Proxy of the channel callbacks should probably go here, rather
     // than in the password callback code
 
     rv = mCallbacks->GetInterface(uuid, result);
   }
   return rv;
 }
 
-NS_IMETHODIMP
-nsNSSSocketInfo::GetForceHandshake(PRBool* forceHandshake)
-{
-  *forceHandshake = PR_FALSE;
-  return NS_OK;
-}
-
-NS_IMETHODIMP
-nsNSSSocketInfo::SetForceHandshake(PRBool forceHandshake)
-{
-  (void)forceHandshake;
-  return NS_OK;
-}
-
 nsresult
 nsNSSSocketInfo::GetForSTARTTLS(PRBool* aForSTARTTLS)
 {
   *aForSTARTTLS = mForSTARTTLS;
   return NS_OK;
 }
 
 nsresult
@@ -533,29 +505,16 @@ nsresult nsNSSSocketInfo::GetSSLStatus(n
   NS_ENSURE_ARG_POINTER(_result);
 
   *_result = mSSLStatus;
   NS_IF_ADDREF(*_result);
 
   return NS_OK;
 }
 
-nsresult nsNSSSocketInfo::RememberCAChain(CERTCertList *aCertList)
-{
-  nsNSSShutDownPreventionLock locker;
-  if (isAlreadyShutDown())
-    return NS_ERROR_NOT_AVAILABLE;
-
-  if (mCAChain) {
-    CERT_DestroyCertList(mCAChain);
-  }
-  mCAChain = aCertList;
-  return NS_OK;
-}
-
 nsresult nsNSSSocketInfo::SetSSLStatus(nsISSLStatus *aSSLStatus)
 {
   mSSLStatus = aSSLStatus;
 
   return NS_OK;
 }
 
 void nsNSSSocketInfo::SetHandshakeInProgress(PRBool aIsIn)
Index: security/manager/ssl/src/nsNSSIOLayer.h
===================================================================
RCS file: /cvsroot/mozilla/security/manager/ssl/src/nsNSSIOLayer.h,v
retrieving revision 1.38
diff -u -8 -p -r1.38 nsNSSIOLayer.h
--- security/manager/ssl/src/nsNSSIOLayer.h	3 Oct 2007 11:49:55 -0000	1.38
+++ security/manager/ssl/src/nsNSSIOLayer.h	26 Nov 2007 21:54:47 -0000
@@ -200,17 +200,16 @@ protected:
   PRPackedBool mHandshakePending;
   PRPackedBool mCanceled;
   PRPackedBool mHasCleartextPhase;
   PRPackedBool mHandshakeInProgress;
   PRPackedBool mAllowTLSIntoleranceTimeout;
   PRIntervalTime mHandshakeStartTime;
   PRInt32 mPort;
   nsXPIDLCString mHostName;
-  CERTCertList *mCAChain;
 
   /* SSL Status */
   nsCOMPtr<nsISSLStatus> mSSLStatus;
 
   nsresult ActivateSSL();
 
   nsSSLSocketThreadData *mThreadData;
 
