{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Basd908138\""},"diff":[{"chunks":[{"content":"@@ -315,7 +315,7 @@ struct nsRadioGroupStruct","changes":[{"type":"normal","normal":true,"ln1":315,"ln2":315,"content":"    * A strong pointer to the currently selected radio button."},{"type":"normal","normal":true,"ln1":316,"ln2":316,"content":"    */"},{"type":"normal","normal":true,"ln1":317,"ln2":317,"content":"   nsCOMPtr<nsIDOMHTMLInputElement> mSelectedRadioButton;"},{"type":"del","del":true,"ln":318,"content":"-  nsSmallVoidArray mRadioButtons;"},{"type":"add","add":true,"ln":318,"content":"+  nsCOMArray<nsIFormControl> mRadioButtons;"},{"type":"normal","normal":true,"ln1":319,"ln2":319,"content":" };"},{"type":"normal","normal":true,"ln1":320,"ln2":320,"content":" "},{"type":"normal","normal":true,"ln1":321,"ln2":321,"content":" "}],"oldStart":315,"oldLines":7,"newStart":315,"newLines":7},{"content":"@@ -945,23 +945,20 @@ SubDocTraverser(PLDHashTable *table, PLDHashEntryHdr *hdr, PRUint32 number,","changes":[{"type":"normal","normal":true,"ln1":945,"ln2":945,"content":"   return PL_DHASH_NEXT;"},{"type":"normal","normal":true,"ln1":946,"ln2":946,"content":" }"},{"type":"normal","normal":true,"ln1":947,"ln2":947,"content":" "},{"type":"del","del":true,"ln":948,"content":"-PR_STATIC_CALLBACK(PRIntn)"},{"type":"del","del":true,"ln":949,"content":"-RadioGroupsTraverser(nsHashKey *aKey, void *aData, void* aClosure)"},{"type":"add","add":true,"ln":948,"content":"+PR_STATIC_CALLBACK(PLDHashOperator)"},{"type":"add","add":true,"ln":949,"content":"+RadioGroupsTraverser(const nsAString& aKey, nsAutoPtr<nsRadioGroupStruct>& aData, void* aClosure)"},{"type":"normal","normal":true,"ln1":950,"ln2":950,"content":" {"},{"type":"del","del":true,"ln":951,"content":"-  nsRadioGroupStruct *entry = static_cast<nsRadioGroupStruct*>(aData);"},{"type":"normal","normal":true,"ln1":952,"ln2":951,"content":"   nsCycleCollectionTraversalCallback *cb = "},{"type":"normal","normal":true,"ln1":953,"ln2":952,"content":"     static_cast<nsCycleCollectionTraversalCallback*>(aClosure);"},{"type":"normal","normal":true,"ln1":954,"ln2":953,"content":" "},{"type":"del","del":true,"ln":955,"content":"-  cb->NoteXPCOMChild(entry->mSelectedRadioButton);"},{"type":"add","add":true,"ln":954,"content":"+  cb->NoteXPCOMChild(aData->mSelectedRadioButton);"},{"type":"normal","normal":true,"ln1":956,"ln2":955,"content":" "},{"type":"del","del":true,"ln":957,"content":"-  nsSmallVoidArray &radioButtons = entry->mRadioButtons;"},{"type":"del","del":true,"ln":958,"content":"-  PRUint32 i, count = radioButtons.Count();"},{"type":"add","add":true,"ln":956,"content":"+  PRUint32 i, count = aData->mRadioButtons.Count();"},{"type":"normal","normal":true,"ln1":959,"ln2":957,"content":"   for (i = 0; i < count; ++i) {"},{"type":"del","del":true,"ln":960,"content":"-    cb->NoteXPCOMChild(static_cast<nsIFormControl*>(radioButtons[i]));"},{"type":"add","add":true,"ln":958,"content":"+    cb->NoteXPCOMChild(aData->mRadioButtons[i]);"},{"type":"normal","normal":true,"ln1":961,"ln2":959,"content":"   }"},{"type":"del","del":true,"ln":962,"content":"-  "},{"type":"normal","normal":true,"ln1":963,"ln2":960,"content":" "},{"type":"del","del":true,"ln":964,"content":"-  return kHashEnumerateNext;"},{"type":"add","add":true,"ln":961,"content":"+  return PL_DHASH_NEXT;"},{"type":"normal","normal":true,"ln1":965,"ln2":962,"content":" }"},{"type":"normal","normal":true,"ln1":966,"ln2":963,"content":" "},{"type":"normal","normal":true,"ln1":967,"ln2":964,"content":" PR_STATIC_CALLBACK(PLDHashOperator)"}],"oldStart":945,"oldLines":23,"newStart":945,"newLines":20},{"content":"@@ -1086,6 +1083,7 @@ nsDocument::Init()","changes":[{"type":"normal","normal":true,"ln1":1086,"ln2":1083,"content":"   }"},{"type":"normal","normal":true,"ln1":1087,"ln2":1084,"content":" "},{"type":"normal","normal":true,"ln1":1088,"ln2":1085,"content":"   mLinkMap.Init();"},{"type":"add","add":true,"ln":1086,"content":"+  mRadioGroups.Init();"},{"type":"normal","normal":true,"ln1":1089,"ln2":1087,"content":" "},{"type":"normal","normal":true,"ln1":1090,"ln2":1088,"content":"   // Force initialization."},{"type":"normal","normal":true,"ln1":1091,"ln2":1089,"content":"   nsBindingManager *bindingManager = new nsBindingManager();"}],"oldStart":1086,"oldLines":6,"newStart":1083,"newLines":7},{"content":"@@ -5041,17 +5039,15 @@ nsDocument::GetRadioGroup(const nsAString& aName,","changes":[{"type":"normal","normal":true,"ln1":5041,"ln2":5039,"content":"   nsAutoString tmKey(aName);"},{"type":"normal","normal":true,"ln1":5042,"ln2":5040,"content":"   if(!IsCaseSensitive())"},{"type":"normal","normal":true,"ln1":5043,"ln2":5041,"content":"      ToLowerCase(tmKey); //should case-insensitive."},{"type":"del","del":true,"ln":5044,"content":"-  nsStringKey key(tmKey);"},{"type":"del","del":true,"ln":5045,"content":"-  nsRadioGroupStruct *radioGroup ="},{"type":"del","del":true,"ln":5046,"content":"-    static_cast<nsRadioGroupStruct *>(mRadioGroups.Get(&key));"},{"type":"add","add":true,"ln":5042,"content":"+  if (mRadioGroups.Get(tmKey, aRadioGroup))"},{"type":"add","add":true,"ln":5043,"content":"+    return NS_OK;"},{"type":"normal","normal":true,"ln1":5047,"ln2":5044,"content":" "},{"type":"del","del":true,"ln":5048,"content":"-  if (!radioGroup) {"},{"type":"del","del":true,"ln":5049,"content":"-    radioGroup = new nsRadioGroupStruct();"},{"type":"del","del":true,"ln":5050,"content":"-    NS_ENSURE_TRUE(radioGroup, NS_ERROR_OUT_OF_MEMORY);"},{"type":"del","del":true,"ln":5051,"content":"-    mRadioGroups.Put(&key, radioGroup);"},{"type":"del","del":true,"ln":5052,"content":"-  }"},{"type":"add","add":true,"ln":5045,"content":"+  nsAutoPtr<nsRadioGroupStruct> radioGroup(new nsRadioGroupStruct());"},{"type":"add","add":true,"ln":5046,"content":"+  NS_ENSURE_TRUE(radioGroup, NS_ERROR_OUT_OF_MEMORY);"},{"type":"add","add":true,"ln":5047,"content":"+  NS_ENSURE_TRUE(mRadioGroups.Put(tmKey, radioGroup), NS_ERROR_OUT_OF_MEMORY);"},{"type":"normal","normal":true,"ln1":5053,"ln2":5048,"content":" "},{"type":"normal","normal":true,"ln1":5054,"ln2":5049,"content":"   *aRadioGroup = radioGroup;"},{"type":"add","add":true,"ln":5050,"content":"+  radioGroup.forget();"},{"type":"normal","normal":true,"ln1":5055,"ln2":5051,"content":" "},{"type":"normal","normal":true,"ln1":5056,"ln2":5052,"content":"   return NS_OK;"},{"type":"normal","normal":true,"ln1":5057,"ln2":5053,"content":" }"}],"oldStart":5041,"oldLines":17,"newStart":5039,"newLines":15},{"content":"@@ -5157,7 +5153,7 @@ nsDocument::GetNextRadioButton(const nsAString& aName,","changes":[{"type":"normal","normal":true,"ln1":5157,"ln2":5153,"content":"     else if (++index >= numRadios) {"},{"type":"normal","normal":true,"ln1":5158,"ln2":5154,"content":"       index = 0;"},{"type":"normal","normal":true,"ln1":5159,"ln2":5155,"content":"     }"},{"type":"del","del":true,"ln":5160,"content":"-    radio = do_QueryInterface(static_cast<nsIFormControl*>(radioGroup->mRadioButtons.ElementAt(index)));"},{"type":"add","add":true,"ln":5156,"content":"+    radio = do_QueryInterface(radioGroup->mRadioButtons[index]);"},{"type":"normal","normal":true,"ln1":5161,"ln2":5157,"content":"     NS_ASSERTION(radio, \"mRadioButtons holding a non-radio button\");"},{"type":"normal","normal":true,"ln1":5162,"ln2":5158,"content":"     radio->GetDisabled(&disabled);"},{"type":"normal","normal":true,"ln1":5163,"ln2":5159,"content":"   } while (disabled && radio != currentRadio);"}],"oldStart":5157,"oldLines":7,"newStart":5153,"newLines":7},{"content":"@@ -5173,8 +5169,7 @@ nsDocument::AddToRadioGroup(const nsAString& aName,","changes":[{"type":"normal","normal":true,"ln1":5173,"ln2":5169,"content":"   nsRadioGroupStruct* radioGroup = nsnull;"},{"type":"normal","normal":true,"ln1":5174,"ln2":5170,"content":"   GetRadioGroup(aName, &radioGroup);"},{"type":"normal","normal":true,"ln1":5175,"ln2":5171,"content":"   if (radioGroup) {"},{"type":"del","del":true,"ln":5176,"content":"-    radioGroup->mRadioButtons.AppendElement(aRadio);"},{"type":"del","del":true,"ln":5177,"content":"-    NS_IF_ADDREF(aRadio);"},{"type":"add","add":true,"ln":5172,"content":"+    radioGroup->mRadioButtons.AppendObject(aRadio);"},{"type":"normal","normal":true,"ln1":5178,"ln2":5173,"content":"   }"},{"type":"normal","normal":true,"ln1":5179,"ln2":5174,"content":" "},{"type":"normal","normal":true,"ln1":5180,"ln2":5175,"content":"   return NS_OK;"}],"oldStart":5173,"oldLines":8,"newStart":5169,"newLines":7},{"content":"@@ -5187,9 +5182,7 @@ nsDocument::RemoveFromRadioGroup(const nsAString& aName,","changes":[{"type":"normal","normal":true,"ln1":5187,"ln2":5182,"content":"   nsRadioGroupStruct* radioGroup = nsnull;"},{"type":"normal","normal":true,"ln1":5188,"ln2":5183,"content":"   GetRadioGroup(aName, &radioGroup);"},{"type":"normal","normal":true,"ln1":5189,"ln2":5184,"content":"   if (radioGroup) {"},{"type":"del","del":true,"ln":5190,"content":"-    if (radioGroup->mRadioButtons.RemoveElement(aRadio)) {"},{"type":"del","del":true,"ln":5191,"content":"-      NS_IF_RELEASE(aRadio);"},{"type":"del","del":true,"ln":5192,"content":"-    }"},{"type":"add","add":true,"ln":5185,"content":"+    radioGroup->mRadioButtons.RemoveObject(aRadio);"},{"type":"normal","normal":true,"ln1":5193,"ln2":5186,"content":"   }"},{"type":"normal","normal":true,"ln1":5194,"ln2":5187,"content":" "},{"type":"normal","normal":true,"ln1":5195,"ln2":5188,"content":"   return NS_OK;"}],"oldStart":5187,"oldLines":9,"newStart":5182,"newLines":7},{"content":"@@ -5208,9 +5201,7 @@ nsDocument::WalkRadioGroup(const nsAString& aName,","changes":[{"type":"normal","normal":true,"ln1":5208,"ln2":5201,"content":" "},{"type":"normal","normal":true,"ln1":5209,"ln2":5202,"content":"   PRBool stop = PR_FALSE;"},{"type":"normal","normal":true,"ln1":5210,"ln2":5203,"content":"   for (int i = 0; i < radioGroup->mRadioButtons.Count(); i++) {"},{"type":"del","del":true,"ln":5211,"content":"-    aVisitor->Visit(static_cast<nsIFormControl *>"},{"type":"del","del":true,"ln":5212,"content":"-                               (radioGroup->mRadioButtons.ElementAt(i)),"},{"type":"del","del":true,"ln":5213,"content":"-                    &stop);"},{"type":"add","add":true,"ln":5204,"content":"+    aVisitor->Visit(radioGroup->mRadioButtons[i], &stop);"},{"type":"normal","normal":true,"ln1":5214,"ln2":5205,"content":"     if (stop) {"},{"type":"normal","normal":true,"ln1":5215,"ln2":5206,"content":"       return NS_OK;"},{"type":"normal","normal":true,"ln1":5216,"ln2":5207,"content":"     }"}],"oldStart":5208,"oldLines":9,"newStart":5201,"newLines":7}],"deletions":27,"additions":18,"from":"content/base/src/nsDocument.cpp","to":"content/base/src/nsDocument.cpp","index":["09861f0..c5888a8","100644"]},{"chunks":[{"content":"@@ -755,7 +755,7 @@ protected:","changes":[{"type":"normal","normal":true,"ln1":755,"ln2":755,"content":"   nsRefPtr<nsScriptLoader> mScriptLoader;"},{"type":"normal","normal":true,"ln1":756,"ln2":756,"content":"   nsDocHeaderData* mHeaderData;"},{"type":"normal","normal":true,"ln1":757,"ln2":757,"content":" "},{"type":"del","del":true,"ln":758,"content":"-  nsHashtable mRadioGroups;"},{"type":"add","add":true,"ln":758,"content":"+  nsClassHashtable<nsStringHashKey, nsRadioGroupStruct> mRadioGroups;"},{"type":"normal","normal":true,"ln1":759,"ln2":759,"content":" "},{"type":"normal","normal":true,"ln1":760,"ln2":760,"content":"   // True if the document has been detached from its content viewer."},{"type":"normal","normal":true,"ln1":761,"ln2":761,"content":"   PRPackedBool mIsGoingAway:1;"}],"oldStart":755,"oldLines":7,"newStart":755,"newLines":7}],"deletions":1,"additions":1,"from":"content/base/src/nsDocument.h","to":"content/base/src/nsDocument.h","index":["849f108..350bea5","100644"]}]}