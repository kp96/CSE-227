From: Serge Gautherie <sgautherie.bz@free.fr>

Bug 431940 - Port |Bug 402207 – SSL error page "Add Exception" support should be pref-controlled| to SeaMonkey
(Av1a) Port bug 402207 + bug 407369 + bug 431826 (relevant part)

diff --git a/suite/browser/browser-prefs.js b/suite/browser/browser-prefs.js
--- a/suite/browser/browser-prefs.js
+++ b/suite/browser/browser-prefs.js
@@ -253,16 +253,22 @@ pref("keyword.enabled", true);
 //Internet Search
 pref("browser.search.defaultenginename", "chrome://communicator-region/locale/region.properties");
 
 // 0 goes back
 // 1 act like pgup
 // 2 and other values, nothing
 pref("browser.backspace_action", 0);
 
+// Controls behavior of the "Add Exception" dialog launched from SSL error pages:
+// 0 - don't pre-populate anything.
+// 1 - pre-populate site URL, but don't fetch certificate.
+// 2 - pre-populate site URL and pre-fetch certificate.
+pref("browser.ssl_override_behavior", 2);
+
 pref("browser.zoom.full", true);
 
 pref("javascript.options.showInConsole",    true);
 
 pref("offline.startup_state",            0);
 pref("offline.send.unsent_messages",            0);
 pref("offline.download.download_messages",  0);
 
diff --git a/suite/common/utilityOverlay.js b/suite/common/utilityOverlay.js
--- a/suite/common/utilityOverlay.js
+++ b/suite/common/utilityOverlay.js
@@ -913,23 +913,41 @@ function isElementVisible(aElement)
 function BrowserOnCommand(event)
 {
   // Don't trust synthetic events
   if (!event.isTrusted)
     return;
 
   const ot = event.originalTarget;
   const ownerDoc = ot.ownerDocument;
+
   // If the event came from an ssl error page, it is probably either the "Add
   // Exception" or "Get Me Out Of Here" button
   if (/^about:neterror\?e=nssBadCert/.test(ownerDoc.documentURI) ||
       /^about:certerror\?/.test(ownerDoc.documentURI)) {
     if (ot.id == 'exceptionDialogButton') {
-      var params = { location : ownerDoc.location.href,
-                     exceptionAdded : false };
+      var params = { exceptionAdded : false };
+      
+      try {
+        const prefBranch =
+          Components.classes["@mozilla.org/preferences-service;1"]
+                    .getService(Components.interfaces.nsIPrefService)
+                    .getBranch(null);
+
+        switch (prefBranch.getIntPref("browser.ssl_override_behavior")) {
+          case 2 : // Pre-fetch & pre-populate.
+            params.prefetchCert = true;
+            // Fall through.
+          case 1 : // Pre-populate.
+            params.location = ownerDoc.location.href;
+        }
+      } catch (e) {
+        Components.utils.reportError("Couldn't get ssl_override pref: " + e);
+      }
+
       window.openDialog('chrome://pippki/content/exceptionDialog.xul',
                         '', 'chrome,centerscreen,modal', params);
 
       // If the user added the exception cert, attempt to reload the page
       if (params.exceptionAdded)
         ownerDoc.location.reload();
     }
     else if (ot.id == 'getMeOutOfHereButton') {
