Index: xpcom/io/nsLocalFileWin.cpp
===================================================================
RCS file: /cvsroot/mozilla/xpcom/io/nsLocalFileWin.cpp,v
retrieving revision 1.170
diff -u -p -d -8 -r1.170 nsLocalFileWin.cpp
--- xpcom/io/nsLocalFileWin.cpp	25 Mar 2007 07:28:06 -0000	1.170
+++ xpcom/io/nsLocalFileWin.cpp	8 Jun 2007 17:42:03 -0000
@@ -2307,21 +2307,25 @@ nsLocalFile::IsExecutable(PRBool *_retva
         return NS_OK;
 
     //TODO: shouldn't we be checking mFollowSymlinks here?
     PRBool symLink;
     rv = IsSymlink(&symLink);
     if (NS_FAILED(rv))
         return rv;
 
-    nsAutoString path;
+    nsAutoString rawPath;
     if (symLink)
-        GetTarget(path);
+        GetTarget(rawPath);
     else
-        GetPath(path);
+        GetPath(rawPath);
+
+    // Now make sure that we're dealing with the same string that we pass to OS
+    // APIs.  This is needed in case rawPath contains null bytes.
+    nsDependentString path(rawPath.get());
 
     // kill trailing dots and spaces.
     PRInt32 filePathLen = path.Length() - 1;
     while(filePathLen > 0 && (path[filePathLen] == L' ' || path[filePathLen] == L'.'))
     {
         path.Truncate(filePathLen--);
     } 
 
