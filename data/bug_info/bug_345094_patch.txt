diff --git a/security/nss/crashtests/345094.html b/security/nss/crashtests/345094.html
new file mode 100644
--- /dev/null
+++ b/security/nss/crashtests/345094.html
@@ -0,0 +1,13 @@
+<html><head><script>
+function FUZZ(s) {
+  try { eval(s); } catch (e) {}
+}
+
+function boom() {
+  FUZZ("window.crypto.generateCRMFRequest(1048574, 1048578, 256, '', 2)")
+}
+</script>
+</head>
+<body onload="boom()">
+</body>
+</html>
diff --git a/security/nss/crashtests/crashtests.list b/security/nss/crashtests/crashtests.list
new file mode 100644
--- /dev/null
+++ b/security/nss/crashtests/crashtests.list
@@ -0,0 +1,1 @@
+load 345094.html
diff --git a/security/nss/lib/util/nssb64d.c b/security/nss/lib/util/nssb64d.c
--- a/security/nss/lib/util/nssb64d.c
+++ b/security/nss/lib/util/nssb64d.c
@@ -1,8 +1,9 @@
+/* -*- Mode: C; tab-width: 8; indent-tabs-mode: t; c-basic-offset: 4 -*- */
 /* ***** BEGIN LICENSE BLOCK *****
  * Version: MPL 1.1/GPL 2.0/LGPL 2.1
  *
  * The contents of this file are subject to the Mozilla Public License Version
  * 1.1 (the "License"); you may not use this file except in compliance with
  * the License. You may obtain a copy of the License at
  * http://www.mozilla.org/MPL/
  *
@@ -557,19 +558,24 @@ static unsigned char *
 PL_Base64DecodeBuffer (const char *src, PRUint32 srclen, unsigned char *dest,
 		       PRUint32 maxdestlen, PRUint32 *output_destlen)
 {
     PRUint32 need_length;
     unsigned char *output_buffer = NULL;
     PLBase64Decoder *data = NULL;
     PRStatus status;
 
-    PR_ASSERT(srclen > 0);
-    if (srclen == 0)
+    if (srclen == 0) {
+	*output_destlen = 0;
+	if (dest == NULL) {
+	    /* PR_Malloc(0) is undefined */
+	    return (unsigned char *) PR_Malloc(1);
+	}
 	return dest;
+    }
 
     /*
      * How much space could we possibly need for decoding this input?
      */
     need_length = PL_Base64MaxDecodedLength (srclen);
 
     /*
      * Make sure we have at least that much, if output buffer provided.
diff --git a/testing/crashtest/crashtests.list b/testing/crashtest/crashtests.list
--- a/testing/crashtest/crashtests.list
+++ b/testing/crashtest/crashtests.list
@@ -47,16 +47,17 @@ include ../../layout/xul/base/src/tree/s
 include ../../gfx/tests/crashtests/crashtests.list
 
 include ../../modules/libpr0n/test/crashtests/crashtests.list
 include ../../modules/plugin/test/crashtests/crashtests.list
 
 include ../../parser/htmlparser/tests/crashtests/crashtests.list
 
 include ../../security/manager/ssl/crashtests/crashtests.list
+include ../../security/nss/crashtests/crashtests.list
 
 include ../../view/crashtests/crashtests.list
 
 include ../../widget/src/cocoa/crashtests/crashtests.list
 include ../../widget/src/crashtests/crashtests.list
 
 include ../../modules/libimg/png/crashtests/crashtests.list
 
