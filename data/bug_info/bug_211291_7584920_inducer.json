{"bug_id":211291,"commitHash":"7584920","commit_info":{"sha":"7584920b891ffc0c55ec4ddec82cbf3cb2bebdff","commit":{"author":{"name":"timeless%mozdev.org","email":"timeless%mozdev.org","date":"2003-09-11T01:59:21Z"},"committer":{"name":"timeless%mozdev.org","email":"timeless%mozdev.org","date":"2003-09-11T01:59:21Z"},"message":"Bug 211291 void nsCertTree::InitCompareHash doesn't check the return value of PL_DHashTableInit\nr=kaie sr=bz","tree":{"sha":"fc8892b8c937250cd392f5053f11e21550667fa9","url":"https://api.github.com/repos/mozilla/gecko-dev/git/trees/fc8892b8c937250cd392f5053f11e21550667fa9"},"url":"https://api.github.com/repos/mozilla/gecko-dev/git/commits/7584920b891ffc0c55ec4ddec82cbf3cb2bebdff","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/mozilla/gecko-dev/commits/7584920b891ffc0c55ec4ddec82cbf3cb2bebdff","html_url":"https://github.com/mozilla/gecko-dev/commit/7584920b891ffc0c55ec4ddec82cbf3cb2bebdff","comments_url":"https://api.github.com/repos/mozilla/gecko-dev/commits/7584920b891ffc0c55ec4ddec82cbf3cb2bebdff/comments","author":null,"committer":null,"parents":[{"sha":"74241f4276fa5b56b20d97c0bcc0d3e749daf0bc","url":"https://api.github.com/repos/mozilla/gecko-dev/commits/74241f4276fa5b56b20d97c0bcc0d3e749daf0bc","html_url":"https://github.com/mozilla/gecko-dev/commit/74241f4276fa5b56b20d97c0bcc0d3e749daf0bc"}],"stats":{"total":22,"additions":14,"deletions":8},"files":[{"sha":"9fe44cddd4e75ff8fb152a17459438ce59000fe8","filename":"security/manager/ssl/src/nsCertTree.cpp","status":"modified","additions":13,"deletions":7,"changes":20,"blob_url":"https://github.com/mozilla/gecko-dev/blob/7584920b891ffc0c55ec4ddec82cbf3cb2bebdff/security/manager/ssl/src/nsCertTree.cpp","raw_url":"https://github.com/mozilla/gecko-dev/raw/7584920b891ffc0c55ec4ddec82cbf3cb2bebdff/security/manager/ssl/src/nsCertTree.cpp","contents_url":"https://api.github.com/repos/mozilla/gecko-dev/contents/security/manager/ssl/src/nsCertTree.cpp?ref=7584920b891ffc0c55ec4ddec82cbf3cb2bebdff","patch":"@@ -133,11 +133,15 @@ void nsCertTree::ClearCompareHash()\n   }\n }\n \n-void nsCertTree::InitCompareHash()\n+nsresult nsCertTree::InitCompareHash()\n {\n   ClearCompareHash();\n-  PL_DHashTableInit(&mCompareCache, &gMapOps, nsnull,\n-                    sizeof(CompareCacheHashEntry), 128);\n+  if (!PL_DHashTableInit(&mCompareCache, &gMapOps, nsnull,\n+                         sizeof(CompareCacheHashEntry), 128)) {\n+    mCompareCache.ops = nsnull;\n+    return NS_ERROR_OUT_OF_MEMORY;\n+  }\n+  return NS_OK;\n }\n \n nsCertTree::~nsCertTree()\n@@ -352,14 +356,15 @@ nsCertTree::GetCertsByTypeFromCache(nsINSSCertCache   *aCache,\n NS_IMETHODIMP \n nsCertTree::LoadCertsFromCache(nsINSSCertCache *aCache, PRUint32 aType)\n {\n-  nsresult rv;\n   if (mTreeArray) {\n     FreeCertArray();\n     delete [] mTreeArray;\n     mTreeArray = NULL;\n     mNumRows = 0;\n   }\n-  InitCompareHash();\n+  nsresult rv = InitCompareHash();\n+  if (NS_FAILED(rv)) return rv;\n+\n   rv = GetCertsByTypeFromCache(aCache, aType, \n                                GetCompareFuncFromCertType(aType), &mCompareCache,\n                                getter_AddRefs(mCertArray));\n@@ -370,14 +375,15 @@ nsCertTree::LoadCertsFromCache(nsINSSCertCache *aCache, PRUint32 aType)\n NS_IMETHODIMP \n nsCertTree::LoadCerts(PRUint32 aType)\n {\n-  nsresult rv;\n   if (mTreeArray) {\n     FreeCertArray();\n     delete [] mTreeArray;\n     mTreeArray = NULL;\n     mNumRows = 0;\n   }\n-  InitCompareHash();\n+  nsresult rv = InitCompareHash();\n+  if (NS_FAILED(rv)) return rv;\n+\n   rv = GetCertsByType(aType, \n                       GetCompareFuncFromCertType(aType), &mCompareCache,\n                       getter_AddRefs(mCertArray));"},{"sha":"52db30096e4c6bb48d5f2bed869a7f606706ea01","filename":"security/manager/ssl/src/nsCertTree.h","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/mozilla/gecko-dev/blob/7584920b891ffc0c55ec4ddec82cbf3cb2bebdff/security/manager/ssl/src/nsCertTree.h","raw_url":"https://github.com/mozilla/gecko-dev/raw/7584920b891ffc0c55ec4ddec82cbf3cb2bebdff/security/manager/ssl/src/nsCertTree.h","contents_url":"https://api.github.com/repos/mozilla/gecko-dev/contents/security/manager/ssl/src/nsCertTree.h?ref=7584920b891ffc0c55ec4ddec82cbf3cb2bebdff","patch":"@@ -72,7 +72,7 @@ class nsCertTree : public nsICertTree\n     sort_CommonName, sort_IssuedDateDescending, sort_Email, sort_None };\n \n protected:\n-  void InitCompareHash();\n+  nsresult InitCompareHash();\n   void ClearCompareHash();\n   void RemoveCacheEntry(void *key);\n "}]},"blames":["346ebd75","2b5e9f73","106f567a","31db9b54","d38a0937","64b2bc2d","2b5e9f73","346ebd75","31db9b54"]}