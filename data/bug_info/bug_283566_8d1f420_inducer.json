{"bug_id":283566,"commitHash":"8d1f420","commit_info":{"sha":"8d1f420a32d2aadad9e4ed82a5f32b1eb3e50618","commit":{"author":{"name":"timeless%mozdev.org","email":"timeless%mozdev.org","date":"2005-06-01T18:30:36Z"},"committer":{"name":"timeless%mozdev.org","email":"timeless%mozdev.org","date":"2005-06-01T18:30:36Z"},"message":"Bug 283566 OOM crash [@ nsNSSCertificate::GetDbKey][@ nsNSSCertificate::GetUsagesArray]\npatch by ajschult@verizon.net r=kaie sr=darin a=shaver","tree":{"sha":"be921269fad8c88bb8bf02af04df3c44ab6bec3e","url":"https://api.github.com/repos/mozilla/gecko-dev/git/trees/be921269fad8c88bb8bf02af04df3c44ab6bec3e"},"url":"https://api.github.com/repos/mozilla/gecko-dev/git/commits/8d1f420a32d2aadad9e4ed82a5f32b1eb3e50618","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/mozilla/gecko-dev/commits/8d1f420a32d2aadad9e4ed82a5f32b1eb3e50618","html_url":"https://github.com/mozilla/gecko-dev/commit/8d1f420a32d2aadad9e4ed82a5f32b1eb3e50618","comments_url":"https://api.github.com/repos/mozilla/gecko-dev/commits/8d1f420a32d2aadad9e4ed82a5f32b1eb3e50618/comments","author":null,"committer":null,"parents":[{"sha":"048e93260cca659277f53319f99b29a1a9306b86","url":"https://api.github.com/repos/mozilla/gecko-dev/commits/048e93260cca659277f53319f99b29a1a9306b86","html_url":"https://github.com/mozilla/gecko-dev/commit/048e93260cca659277f53319f99b29a1a9306b86"}],"stats":{"total":10,"additions":9,"deletions":1},"files":[{"sha":"ba6f6903c945cb99aa1ee7e99270dc4520e4aa4f","filename":"security/manager/ssl/src/nsNSSCertificate.cpp","status":"modified","additions":9,"deletions":1,"changes":10,"blob_url":"https://github.com/mozilla/gecko-dev/blob/8d1f420a32d2aadad9e4ed82a5f32b1eb3e50618/security/manager/ssl/src/nsNSSCertificate.cpp","raw_url":"https://github.com/mozilla/gecko-dev/raw/8d1f420a32d2aadad9e4ed82a5f32b1eb3e50618/security/manager/ssl/src/nsNSSCertificate.cpp","contents_url":"https://api.github.com/repos/mozilla/gecko-dev/contents/security/manager/ssl/src/nsNSSCertificate.cpp?ref=8d1f420a32d2aadad9e4ed82a5f32b1eb3e50618","patch":"@@ -364,6 +364,8 @@ nsNSSCertificate::GetDbKey(char * *aDbKey)\n   *aDbKey = nsnull;\n   key.len = NS_NSS_LONG*4+mCert->serialNumber.len+mCert->derIssuer.len;\n   key.data = (unsigned char *)nsMemory::Alloc(key.len);\n+  if (!key.data)\n+    return NS_ERROR_OUT_OF_MEMORY;\n   NS_NSS_PUT_LONG(0,key.data); // later put moduleID\n   NS_NSS_PUT_LONG(0,&key.data[NS_NSS_LONG]); // later put slotID\n   NS_NSS_PUT_LONG(mCert->serialNumber.len,&key.data[NS_NSS_LONG*2]);\n@@ -466,7 +468,7 @@ nsNSSCertificate::GetEmailAddresses(PRUint32 *aLength, PRUnichar*** aAddresses)\n   }\n \n   *aAddresses = (PRUnichar **)nsMemory::Alloc(sizeof(PRUnichar *) * (*aLength));\n-  if (!aAddresses)\n+  if (!*aAddresses)\n     return NS_ERROR_OUT_OF_MEMORY;\n \n   PRUint32 iAddr;\n@@ -1030,15 +1032,20 @@ nsNSSCertificate::GetUsagesArray(PRBool ignoreOcsp,\n   PRUint32 tmpCount;\n   nsUsageArrayHelper uah(mCert);\n   rv = uah.GetUsagesArray(suffix, ignoreOcsp, max_usages, _verified, &tmpCount, tmpUsages);\n+  NS_ENSURE_SUCCESS(rv,rv);\n   if (tmpCount > 0) {\n     *_usages = (PRUnichar **)nsMemory::Alloc(sizeof(PRUnichar *) * tmpCount);\n+    if (!*_usages)\n+      return NS_ERROR_OUT_OF_MEMORY;\n     for (PRUint32 i=0; i<tmpCount; i++) {\n       (*_usages)[i] = tmpUsages[i];\n     }\n     *_count = tmpCount;\n     return NS_OK;\n   }\n   *_usages = (PRUnichar **)nsMemory::Alloc(sizeof(PRUnichar *));\n+  if (!*_usages)\n+    return NS_ERROR_OUT_OF_MEMORY;\n   *_count = 0;\n   return NS_OK;\n }\n@@ -1059,6 +1066,7 @@ nsNSSCertificate::GetUsagesString(PRBool ignoreOcsp,\n   PRUint32 tmpCount;\n   nsUsageArrayHelper uah(mCert);\n   rv = uah.GetUsagesArray(suffix, ignoreOcsp, max_usages, _verified, &tmpCount, tmpUsages);\n+  NS_ENSURE_SUCCESS(rv,rv);\n   _usages.Truncate();\n   for (PRUint32 i=0; i<tmpCount; i++) {\n     if (i>0) _usages.AppendLiteral(\",\");"}]},"blames":["c7fa1cee","ff2bf929","5157ee46","a16a9521","2c3a905f","31db9b54","d47a8b3a","d007c347"]}