{"bug_id":244273,"commitHash":"a714da4","commit_info":{"sha":"a714da4a56957c826a7cafa381c4d8df832172f2","commit":{"author":{"name":"dolske@mozilla.com","email":"dolske@mozilla.com","date":"2008-01-29T19:33:26Z"},"committer":{"name":"dolske@mozilla.com","email":"dolske@mozilla.com","date":"2008-01-29T19:33:26Z"},"message":"Bug 244273 - improve current HTTP authentication prompt. r=neil,bsmedberg ui-r=johnath, a=blocking-1.9+, a-latel10n=damons","tree":{"sha":"3d68d4b2ea412348f254ac8adf636f1179cd2d26","url":"https://api.github.com/repos/mozilla/gecko-dev/git/trees/3d68d4b2ea412348f254ac8adf636f1179cd2d26"},"url":"https://api.github.com/repos/mozilla/gecko-dev/git/commits/a714da4a56957c826a7cafa381c4d8df832172f2","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/mozilla/gecko-dev/commits/a714da4a56957c826a7cafa381c4d8df832172f2","html_url":"https://github.com/mozilla/gecko-dev/commit/a714da4a56957c826a7cafa381c4d8df832172f2","comments_url":"https://api.github.com/repos/mozilla/gecko-dev/commits/a714da4a56957c826a7cafa381c4d8df832172f2/comments","author":{"login":"dolske","id":855140,"avatar_url":"https://avatars2.githubusercontent.com/u/855140?v=4","gravatar_id":"","url":"https://api.github.com/users/dolske","html_url":"https://github.com/dolske","followers_url":"https://api.github.com/users/dolske/followers","following_url":"https://api.github.com/users/dolske/following{/other_user}","gists_url":"https://api.github.com/users/dolske/gists{/gist_id}","starred_url":"https://api.github.com/users/dolske/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dolske/subscriptions","organizations_url":"https://api.github.com/users/dolske/orgs","repos_url":"https://api.github.com/users/dolske/repos","events_url":"https://api.github.com/users/dolske/events{/privacy}","received_events_url":"https://api.github.com/users/dolske/received_events","type":"User","site_admin":false},"committer":{"login":"dolske","id":855140,"avatar_url":"https://avatars2.githubusercontent.com/u/855140?v=4","gravatar_id":"","url":"https://api.github.com/users/dolske","html_url":"https://github.com/dolske","followers_url":"https://api.github.com/users/dolske/followers","following_url":"https://api.github.com/users/dolske/following{/other_user}","gists_url":"https://api.github.com/users/dolske/gists{/gist_id}","starred_url":"https://api.github.com/users/dolske/starred{/owner}{/repo}","subscriptions_url":"https://api.github.com/users/dolske/subscriptions","organizations_url":"https://api.github.com/users/dolske/orgs","repos_url":"https://api.github.com/users/dolske/repos","events_url":"https://api.github.com/users/dolske/events{/privacy}","received_events_url":"https://api.github.com/users/dolske/received_events","type":"User","site_admin":false},"parents":[{"sha":"0d3c713dd0d59175c50fa9e4d97b09f96566ca46","url":"https://api.github.com/repos/mozilla/gecko-dev/commits/0d3c713dd0d59175c50fa9e4d97b09f96566ca46","html_url":"https://github.com/mozilla/gecko-dev/commit/0d3c713dd0d59175c50fa9e4d97b09f96566ca46"}],"stats":{"total":123,"additions":80,"deletions":43},"files":[{"sha":"078807924dbfa347957aba19002200242347fdcc","filename":"dom/locales/en-US/chrome/prompts.properties","status":"modified","additions":7,"deletions":2,"changes":9,"blob_url":"https://github.com/mozilla/gecko-dev/blob/a714da4a56957c826a7cafa381c4d8df832172f2/dom/locales/en-US/chrome/prompts.properties","raw_url":"https://github.com/mozilla/gecko-dev/raw/a714da4a56957c826a7cafa381c4d8df832172f2/dom/locales/en-US/chrome/prompts.properties","contents_url":"https://api.github.com/repos/mozilla/gecko-dev/contents/dom/locales/en-US/chrome/prompts.properties?ref=a714da4a56957c826a7cafa381c4d8df832172f2","patch":"@@ -34,8 +34,13 @@\n #\n # ***** END LICENSE BLOCK *****\n \n-EnterUserPasswordForRealm=Enter username and password for \"%1$S\" at %2$S\n-EnterUserPasswordForProxy=Enter username and password for proxy \"%1$S\" at %2$S\n+# Localizer note: %1 is an untrusted string provided by a remote server. It\n+# could try to take advantage of sentence structure in order to mislead the\n+# user (see bug 244273). It should be integrated into the these property\n+# strings as little as possible.\n+EnterLoginForRealm=A username and password are being requested by %2$S. The site says: \"%1$S\"\n+EnterLoginForProxy=The proxy %2$S is requesting a username and password. The site says: \"%1$S\"\n+\n EnterUserPasswordFor=Enter username and password for %1$S\n EnterPasswordFor=Enter password for %1$S on %2$S\n "},{"sha":"a782689cc853b9efa9553b64deee125995dbb5ca","filename":"embedding/components/windowwatcher/src/nsPrompt.cpp","status":"modified","additions":25,"deletions":2,"changes":27,"blob_url":"https://github.com/mozilla/gecko-dev/blob/a714da4a56957c826a7cafa381c4d8df832172f2/embedding/components/windowwatcher/src/nsPrompt.cpp","raw_url":"https://github.com/mozilla/gecko-dev/raw/a714da4a56957c826a7cafa381c4d8df832172f2/embedding/components/windowwatcher/src/nsPrompt.cpp","contents_url":"https://api.github.com/repos/mozilla/gecko-dev/contents/embedding/components/windowwatcher/src/nsPrompt.cpp?ref=a714da4a56957c826a7cafa381c4d8df832172f2","patch":"@@ -55,6 +55,9 @@\n #include \"nsIIDNService.h\"\n #include \"nsNetUtil.h\"\n #include \"nsPromptUtils.h\"\n+#include \"nsIPrefService.h\"\n+#include \"nsIPrefLocalizedString.h\"\n+\n \n nsresult\n NS_NewPrompter(nsIPrompt **result, nsIDOMWindow *aParent)\n@@ -418,15 +421,35 @@ MakeDialogText(nsIChannel* aChannel, nsIAuthInformation* aAuthInfo,\n \n   nsAutoString realm;\n   aAuthInfo->GetRealm(realm);\n+  // Trim obnoxiously long realms.\n+  if (realm.Length() > 150) {\n+    realm.Truncate(150);\n+\n+    // Append \"...\" (or localized equivalent). Yay complexity.\n+    nsAutoString ellipsis;\n+    nsCOMPtr<nsIPrefBranch> prefs(do_GetService(NS_PREFSERVICE_CONTRACTID));\n+    if (prefs) {\n+      nsCOMPtr<nsIPrefLocalizedString> prefString;\n+      rv = prefs->GetComplexValue(\"intl.ellipsis\",\n+                                  NS_GET_IID(nsIPrefLocalizedString),\n+                                  getter_AddRefs(prefString));\n+      if (prefString)\n+        prefString->ToString(getter_Copies(ellipsis));\n+    }\n+    if (ellipsis.IsEmpty())\n+      ellipsis.AssignLiteral(\"...\");\n+\n+    realm.Append(ellipsis);\n+  }\n \n   // Append the port if it was specified\n   if (port != -1) {\n     displayHost.Append(PRUnichar(':'));\n     displayHost.AppendInt(port);\n   }\n \n-  NS_NAMED_LITERAL_STRING(proxyText, \"EnterUserPasswordForProxy\");\n-  NS_NAMED_LITERAL_STRING(originText, \"EnterUserPasswordForRealm\");\n+  NS_NAMED_LITERAL_STRING(proxyText, \"EnterLoginForProxy\");\n+  NS_NAMED_LITERAL_STRING(originText, \"EnterLoginForRealm\");\n   NS_NAMED_LITERAL_STRING(noRealmText, \"EnterUserPasswordFor\");\n   NS_NAMED_LITERAL_STRING(passwordText, \"EnterPasswordFor\");\n "},{"sha":"8732dc7c3ed96e4044506a4b59774a68e38bd2a3","filename":"toolkit/content/commonDialog.css","status":"modified","additions":10,"deletions":1,"changes":11,"blob_url":"https://github.com/mozilla/gecko-dev/blob/a714da4a56957c826a7cafa381c4d8df832172f2/toolkit/content/commonDialog.css","raw_url":"https://github.com/mozilla/gecko-dev/raw/a714da4a56957c826a7cafa381c4d8df832172f2/toolkit/content/commonDialog.css","contents_url":"https://api.github.com/repos/mozilla/gecko-dev/contents/toolkit/content/commonDialog.css?ref=a714da4a56957c826a7cafa381c4d8df832172f2","patch":"@@ -37,9 +37,18 @@\n \n @namespace url(\"http://www.mozilla.org/keymaster/gatekeeper/there.is.only.xul\"); /* set default namespace to XUL */\n \n-#info\\.box > description {\n+#infoContainer {\n+  max-width: 45em;\n+}\n+\n+#info\\.body {\n   -moz-user-focus: normal;\n   -moz-user-select: text;\n   cursor: text !important;\n   white-space: -moz-pre-wrap;\n }\n+\n+#loginLabel, #password1Label, #password2Label {\n+  text-align: right;\n+}\n+"},{"sha":"2f3cfa5304a0c89a89ed1c6f78cf225dcd80a7f6","filename":"toolkit/content/commonDialog.js","status":"modified","additions":3,"deletions":5,"changes":8,"blob_url":"https://github.com/mozilla/gecko-dev/blob/a714da4a56957c826a7cafa381c4d8df832172f2/toolkit/content/commonDialog.js","raw_url":"https://github.com/mozilla/gecko-dev/raw/a714da4a56957c826a7cafa381c4d8df832172f2/toolkit/content/commonDialog.js","contents_url":"https://api.github.com/repos/mozilla/gecko-dev/contents/toolkit/content/commonDialog.js?ref=a714da4a56957c826a7cafa381c4d8df832172f2","patch":"@@ -124,9 +124,9 @@ function commonDialogOnLoad()\n   }\n \n   // display the main text\n-  var messageParent = document.getElementById(\"info.box\").getElementsByTagName('description')[0];\n   // XXX the substr(0, 10000) part is a workaround for bug 317334\n-  messageParent.textContent = gCommonDialogParam.GetString(0).substr(0, 10000);\n+  var croppedMessage = gCommonDialogParam.GetString(0).substr(0, 10000);\n+  setElementText(\"info.body\", croppedMessage, true);\n \n   setElementText(\"info.header\", gCommonDialogParam.GetString(3), true);\n \n@@ -262,9 +262,7 @@ function setElementText(aElementID, aValue, aChildNodeFlag)\n function setCheckbox(aChkMsg, aChkValue)\n {\n   if (aChkMsg) {\n-    // XXX Would love to use hidden instead of collapsed, but the checkbox\n-    // fails to size itself properly when I do this.\n-    document.getElementById(\"checkboxContainer\").removeAttribute(\"collapsed\");\n+    unHideElementById(\"checkboxContainer\");\n     \n     var checkboxElement = document.getElementById(\"checkbox\");\n     setLabelForNode(checkboxElement, aChkMsg);"},{"sha":"df05687978af23af418a956f5b7e0b5eabded915","filename":"toolkit/content/commonDialog.xul","status":"modified","additions":31,"deletions":31,"changes":62,"blob_url":"https://github.com/mozilla/gecko-dev/blob/a714da4a56957c826a7cafa381c4d8df832172f2/toolkit/content/commonDialog.xul","raw_url":"https://github.com/mozilla/gecko-dev/raw/a714da4a56957c826a7cafa381c4d8df832172f2/toolkit/content/commonDialog.xul","contents_url":"https://api.github.com/repos/mozilla/gecko-dev/contents/toolkit/content/commonDialog.xul?ref=a714da4a56957c826a7cafa381c4d8df832172f2","patch":"@@ -38,46 +38,46 @@\n     </popup>\n   </popupset>\n \n-  <hbox flex=\"1\">\n-    <hbox align=\"start\">\n-      <image id=\"info.icon\" class=\"spaced\"/>\n-    </hbox>\n-    \n-    <vbox flex=\"1\" style=\"max-width: 45em;\">\n+\n+  <grid>\n+    <columns>\n+      <column/>\n+      <column flex=\"1\"/>\n+    </columns>\n+\n+    <rows>\n+      <row>\n+        <hbox align=\"start\">\n+          <image id=\"info.icon\" class=\"spaced\"/>\n+        </hbox>\n+        <vbox id=\"infoContainer\">\n #ifdef XP_MACOSX\n-# On mac, we're exposing the dialog title inside the dialog\n-      <!-- Dialog title -->\n-      <description id=\"info.title\" class=\"dialogTitle\"/>\n+          <!-- Dialog title is inside dialog for OS X -->\n+          <description id=\"info.title\" class=\"dialogTitle\"/>\n #endif\n-      <!-- text -->\n-      <description id=\"info.header\" class=\"header\"/>\n-      <vbox id=\"info.box\">\n-        <description context=\"contentAreaContextMenu\" tabindex=\"-1\"/>\n-      </vbox>\n-\n-      <!-- textboxes -->\n-      <vbox id=\"loginContainer\" hidden=\"true\">\n+          <description id=\"info.header\" class=\"header\"/>\n+          <description id=\"info.body\" context=\"contentAreaContextMenu\" tabindex=\"-1\"/>\n+        </vbox>\n+      </row>\n+      <row id=\"loginContainer\" hidden=\"true\" align=\"center\">\n         <label id=\"loginLabel\" value=\"&editfield0.label;\" control=\"loginTextbox\"/>\n         <textbox id=\"loginTextbox\"/>\n-        <separator class=\"thin\"/>\n-      </vbox>\n-      <vbox id =\"password1Container\" hidden=\"true\">\n+      </row>\n+      <row id =\"password1Container\" hidden=\"true\" align=\"center\">\n         <label id=\"password1Label\" value=\"&editfield1.label;\" control=\"password1Textbox\"/>\n         <textbox type=\"password\" id=\"password1Textbox\"/>\n-        <separator class=\"thin\"/>\n-      </vbox>\n-      <vbox id=\"password2Container\" hidden=\"true\">\n+      </row>\n+      <row id=\"password2Container\" hidden=\"true\" align=\"center\">\n         <label id=\"password2Label\" value=\"&editfield2.label;\" control=\"password2Textbox\"/>\n         <textbox type=\"password\" id=\"password2Textbox\"/>\n-        <separator class=\"thin\"/>\n-      </vbox>\n-  \n-      <!-- checkbox -->\n-      <vbox id=\"checkboxContainer\" align=\"start\" collapsed=\"true\">\n+      </row>\n+      <row id=\"checkboxContainer\" hidden=\"true\">\n+        <spacer/>\n         <checkbox id=\"checkbox\" oncommand=\"onCheckboxClick(this);\"/>\n-      </vbox>\n-    </vbox>\n-  </hbox>\n+      </row>\n+    </rows>\n+  </grid>\n+\n \n   <!-- This method is called inline because it may unset hidden=\"true\" on the\n        above boxes, causing their frames to be build and bindings to load.  "},{"sha":"b3b18b96d6a81e158afe0b9cce1fd8d66ae23292","filename":"toolkit/themes/pinstripe/global/formatting.css","status":"modified","additions":3,"deletions":1,"changes":4,"blob_url":"https://github.com/mozilla/gecko-dev/blob/a714da4a56957c826a7cafa381c4d8df832172f2/toolkit/themes/pinstripe/global/formatting.css","raw_url":"https://github.com/mozilla/gecko-dev/raw/a714da4a56957c826a7cafa381c4d8df832172f2/toolkit/themes/pinstripe/global/formatting.css","contents_url":"https://api.github.com/repos/mozilla/gecko-dev/contents/toolkit/themes/pinstripe/global/formatting.css?ref=a714da4a56957c826a7cafa381c4d8df832172f2","patch":"@@ -189,7 +189,9 @@\n       margin: 0px 2px 0px 1px !important;\n     }\n \n-#commonDialog > hbox > vbox > description, #commonDialog > hbox > vbox > vbox > description {\n+#commonDialog #info\\.title,\n+#commonDialog #info\\.header,\n+#commonDialog #info\\.body {\n   font: menu;\n   line-height: 16px;\n   margin-bottom: 6px;"},{"sha":"4cd23ec239ef5a99bbbb8586af7526a2ff22c40c","filename":"toolkit/themes/pinstripe/global/global.css","status":"modified","additions":1,"deletions":1,"changes":2,"blob_url":"https://github.com/mozilla/gecko-dev/blob/a714da4a56957c826a7cafa381c4d8df832172f2/toolkit/themes/pinstripe/global/global.css","raw_url":"https://github.com/mozilla/gecko-dev/raw/a714da4a56957c826a7cafa381c4d8df832172f2/toolkit/themes/pinstripe/global/global.css","contents_url":"https://api.github.com/repos/mozilla/gecko-dev/contents/toolkit/themes/pinstripe/global/global.css?ref=a714da4a56957c826a7cafa381c4d8df832172f2","patch":"@@ -186,7 +186,7 @@ statusbarpanel {\n \tline-height: 13px;\n }\n \n-#commonDialog > hbox > vbox {\n+#commonDialog #infoContainer {\n \tmax-width: 33em !important;\n }\n "}]},"blames":["efc58ce4","8c59aae7","f6360016","c493d6e2","08a739f6","1c89095d","7297106a","08a739f6","32940fb5","216a902c","32940fb5","216a902c","54dcf03a"]}