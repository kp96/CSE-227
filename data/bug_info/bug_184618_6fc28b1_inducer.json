{"bug_id":184618,"commitHash":"6fc28b1","commit_info":{"sha":"6fc28b1bacafe05e215dd753a4b5e06ad3108e0f","commit":{"author":{"name":"mstoltz%netscape.com","email":"mstoltz%netscape.com","date":"2003-06-20T22:44:33Z"},"committer":{"name":"mstoltz%netscape.com","email":"mstoltz%netscape.com","date":"2003-06-20T22:44:33Z"},"message":"Bug 184618 - allow scripts to close a script-generated window even if its opener has been set to null. r=heikki, sr=jst.","tree":{"sha":"3c23d29fa1c9702d59e05f265f0052b53343cb2a","url":"https://api.github.com/repos/mozilla/gecko-dev/git/trees/3c23d29fa1c9702d59e05f265f0052b53343cb2a"},"url":"https://api.github.com/repos/mozilla/gecko-dev/git/commits/6fc28b1bacafe05e215dd753a4b5e06ad3108e0f","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/mozilla/gecko-dev/commits/6fc28b1bacafe05e215dd753a4b5e06ad3108e0f","html_url":"https://github.com/mozilla/gecko-dev/commit/6fc28b1bacafe05e215dd753a4b5e06ad3108e0f","comments_url":"https://api.github.com/repos/mozilla/gecko-dev/commits/6fc28b1bacafe05e215dd753a4b5e06ad3108e0f/comments","author":null,"committer":null,"parents":[{"sha":"67329fdd10d18a5ebfb4d672193454ad84303403","url":"https://api.github.com/repos/mozilla/gecko-dev/commits/67329fdd10d18a5ebfb4d672193454ad84303403","html_url":"https://github.com/mozilla/gecko-dev/commit/67329fdd10d18a5ebfb4d672193454ad84303403"}],"stats":{"total":7,"additions":6,"deletions":1},"files":[{"sha":"3bd2d597aca78b6f9b424506af30e2d868d3cd9c","filename":"dom/src/base/nsGlobalWindow.cpp","status":"modified","additions":5,"deletions":1,"changes":6,"blob_url":"https://github.com/mozilla/gecko-dev/blob/6fc28b1bacafe05e215dd753a4b5e06ad3108e0f/dom/src/base/nsGlobalWindow.cpp","raw_url":"https://github.com/mozilla/gecko-dev/raw/6fc28b1bacafe05e215dd753a4b5e06ad3108e0f/dom/src/base/nsGlobalWindow.cpp","contents_url":"https://api.github.com/repos/mozilla/gecko-dev/contents/dom/src/base/nsGlobalWindow.cpp?ref=6fc28b1bacafe05e215dd753a4b5e06ad3108e0f","patch":"@@ -218,6 +218,7 @@ GlobalWindowImpl::GlobalWindowImpl()\n     mIsDocumentLoaded(PR_FALSE),\n     mFullScreen(PR_FALSE),\n     mIsClosed(PR_FALSE),\n+    mOpenerWasCleared(PR_FALSE),\n     mLastMouseButtonAction(LL_ZERO),\n     mGlobalObjectOwner(nsnull),\n     mDocShell(nsnull),\n@@ -1461,6 +1462,9 @@ GlobalWindowImpl::SetOpener(nsIDOMWindowInternal* aOpener)\n   if (aOpener && !IsCallerChrome()) {\n     return NS_OK;\n   }\n+  if (mOpener && !aOpener)\n+    mOpenerWasCleared = PR_TRUE;\n+\n   mOpener = aOpener;\n \n   return NS_OK;\n@@ -3294,7 +3298,7 @@ GlobalWindowImpl::Close()\n   // Don't allow scripts from content to close windows\n   // that were not opened by script\n   nsresult rv;\n-  if (!mOpener) {\n+  if (!mOpener && !mOpenerWasCleared) {\n     nsCOMPtr<nsIScriptSecurityManager> secMan(\n       do_GetService(NS_SCRIPTSECURITYMANAGER_CONTRACTID, &rv));\n     if (NS_SUCCEEDED(rv)) {"},{"sha":"fbc7add036770645013e76065b90395e6953b8b9","filename":"dom/src/base/nsGlobalWindow.h","status":"modified","additions":1,"deletions":0,"changes":1,"blob_url":"https://github.com/mozilla/gecko-dev/blob/6fc28b1bacafe05e215dd753a4b5e06ad3108e0f/dom/src/base/nsGlobalWindow.h","raw_url":"https://github.com/mozilla/gecko-dev/raw/6fc28b1bacafe05e215dd753a4b5e06ad3108e0f/dom/src/base/nsGlobalWindow.h","contents_url":"https://api.github.com/repos/mozilla/gecko-dev/contents/dom/src/base/nsGlobalWindow.h?ref=6fc28b1bacafe05e215dd753a4b5e06ad3108e0f","patch":"@@ -301,6 +301,7 @@ class GlobalWindowImpl : public nsIScriptGlobalObject,\n   PRPackedBool                  mIsDocumentLoaded; // true between onload and onunload events\n   PRPackedBool                  mFullScreen;\n   PRPackedBool                  mIsClosed;\n+  PRPackedBool                  mOpenerWasCleared;\n   PRTime                        mLastMouseButtonAction;\n   nsString                      mStatus;\n   nsString                      mDefaultStatus;"}]},"blames":["dfc3a21a","dd01342a","4ccdb6f4","75f6bd35","7e92fb61","c66a28d6","c6704e14","5c354e81","dd01342a","aa20bdfc","7be22b41"]}