{"bug_id":189799,"commitHash":"366a456","commit_info":{"sha":"366a456693e33437b590fb7935500f71ccbb54e2","commit":{"author":{"name":"mstoltz%netscape.com","email":"mstoltz%netscape.com","date":"2003-01-25T01:43:37Z"},"committer":{"name":"mstoltz%netscape.com","email":"mstoltz%netscape.com","date":"2003-01-25T01:43:37Z"},"message":"Bug 189799 - Ignore username:password portion of URL when making URL comparisons for security. r=heikki, sr=jst, a=asa","tree":{"sha":"f1b425265c1957d7d6b7950b6e18d82259e7f1f8","url":"https://api.github.com/repos/mozilla/gecko-dev/git/trees/f1b425265c1957d7d6b7950b6e18d82259e7f1f8"},"url":"https://api.github.com/repos/mozilla/gecko-dev/git/commits/366a456693e33437b590fb7935500f71ccbb54e2","comment_count":0,"verification":{"verified":false,"reason":"unsigned","signature":null,"payload":null}},"url":"https://api.github.com/repos/mozilla/gecko-dev/commits/366a456693e33437b590fb7935500f71ccbb54e2","html_url":"https://github.com/mozilla/gecko-dev/commit/366a456693e33437b590fb7935500f71ccbb54e2","comments_url":"https://api.github.com/repos/mozilla/gecko-dev/commits/366a456693e33437b590fb7935500f71ccbb54e2/comments","author":null,"committer":null,"parents":[{"sha":"19cacd066f6789c12eaebe978376097f828d3171","url":"https://api.github.com/repos/mozilla/gecko-dev/commits/19cacd066f6789c12eaebe978376097f828d3171","html_url":"https://github.com/mozilla/gecko-dev/commit/19cacd066f6789c12eaebe978376097f828d3171"}],"stats":{"total":23,"additions":15,"deletions":8},"files":[{"sha":"64efc81932b2011019f41445290125817a028250","filename":"caps/src/nsCodebasePrincipal.cpp","status":"modified","additions":15,"deletions":8,"changes":23,"blob_url":"https://github.com/mozilla/gecko-dev/blob/366a456693e33437b590fb7935500f71ccbb54e2/caps/src/nsCodebasePrincipal.cpp","raw_url":"https://github.com/mozilla/gecko-dev/raw/366a456693e33437b590fb7935500f71ccbb54e2/caps/src/nsCodebasePrincipal.cpp","contents_url":"https://api.github.com/repos/mozilla/gecko-dev/contents/caps/src/nsCodebasePrincipal.cpp?ref=366a456693e33437b590fb7935500f71ccbb54e2","patch":"@@ -153,17 +153,24 @@ NS_IMETHODIMP\n nsCodebasePrincipal::GetOrigin(char **origin) \n {\n     nsresult rv;\n-    nsCAutoString s;\n-    if (NS_SUCCEEDED(mURI->GetHost(s)))\n-        rv = mURI->GetPrePath(s);\n-    else {\n+    nsCAutoString hostPort;\n+    if (NS_SUCCEEDED(mURI->GetHostPort(hostPort)))\r\n+    {\r\n+        nsCAutoString scheme;\r\n+        rv = mURI->GetScheme(scheme);\r\n+        NS_ENSURE_SUCCESS(rv, rv);\r\n+        *origin = ToNewCString(scheme + NS_LITERAL_CSTRING(\"://\") + hostPort);\n+    }        \n+    else\r\n+    {\n         // Some URIs (e.g., nsSimpleURI) don't support host. Just\n-        // get the full spec.\n-        rv = mURI->GetSpec(s);\n+        // get the full spec.\r\n+        nsCAutoString spec;\n+        rv = mURI->GetSpec(spec);\r\n+        NS_ENSURE_SUCCESS(rv, rv);\r\n+        *origin = ToNewCString(spec);\n     }\n-    if (NS_FAILED(rv)) return rv;\n \n-    *origin = ToNewCString(s);\n     return *origin ? NS_OK : NS_ERROR_OUT_OF_MEMORY;\n }\n "}]},"blames":["5b4b0169","f1a6738b"]}