{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas33ffa17\""},"diff":[{"chunks":[{"content":"@@ -47,7 +47,7 @@","changes":[{"type":"normal","normal":true,"ln1":47,"ln2":47,"content":"       </handler>"},{"type":"normal","normal":true,"ln1":48,"ln2":48,"content":"     </handlers>"},{"type":"normal","normal":true,"ln1":49,"ln2":49,"content":" "},{"type":"del","del":true,"ln":50,"content":"-    <implementation implements=\"nsIDOMXULMenuListElement, nsIAccessibleProvider\">"},{"type":"add","add":true,"ln":50,"content":"+    <implementation implements=\"nsIDOMXULMenuListElement, nsIAccessibleProvider, nsIDOMEventListener\">"},{"type":"normal","normal":true,"ln1":51,"ln2":51,"content":"       <constructor>"},{"type":"normal","normal":true,"ln1":52,"ln2":52,"content":"         this.setInitialSelection()"},{"type":"normal","normal":true,"ln1":53,"ln2":53,"content":"       </constructor>"}],"oldStart":47,"oldLines":7,"newStart":47,"newLines":7},{"content":"@@ -189,10 +189,14 @@","changes":[{"type":"normal","normal":true,"ln1":189,"ln2":189,"content":" "},{"type":"normal","normal":true,"ln1":190,"ln2":190,"content":"             if (oldval) {"},{"type":"normal","normal":true,"ln1":191,"ln2":191,"content":"               oldval.removeAttribute('selected');"},{"type":"del","del":true,"ln":192,"content":"-              document.removeBroadcastListenerFor(oldval, this, \"value\");"},{"type":"del","del":true,"ln":193,"content":"-              document.removeBroadcastListenerFor(oldval, this, \"label\");"},{"type":"del","del":true,"ln":194,"content":"-              document.removeBroadcastListenerFor(oldval, this, \"image\");"},{"type":"del","del":true,"ln":195,"content":"-              document.removeBroadcastListenerFor(oldval, this, \"description\");"},{"type":"add","add":true,"ln":192,"content":"+              if (document instanceof Components.interfaces.nsIDOMXULDocument) {"},{"type":"add","add":true,"ln":193,"content":"+                document.removeBroadcastListenerFor(oldval, this, \"value\");"},{"type":"add","add":true,"ln":194,"content":"+                document.removeBroadcastListenerFor(oldval, this, \"label\");"},{"type":"add","add":true,"ln":195,"content":"+                document.removeBroadcastListenerFor(oldval, this, \"image\");"},{"type":"add","add":true,"ln":196,"content":"+                document.removeBroadcastListenerFor(oldval, this, \"description\");"},{"type":"add","add":true,"ln":197,"content":"+              }"},{"type":"add","add":true,"ln":198,"content":"+              else"},{"type":"add","add":true,"ln":199,"content":"+                oldval.removeEventListener(\"DOMAttrModified\", this, false);"},{"type":"normal","normal":true,"ln1":196,"ln2":200,"content":"             }"},{"type":"normal","normal":true,"ln1":197,"ln2":201,"content":" "},{"type":"normal","normal":true,"ln1":198,"ln2":202,"content":"             this.mSelectedInternal = val;"}],"oldStart":189,"oldLines":10,"newStart":189,"newLines":14},{"content":"@@ -202,10 +206,16 @@","changes":[{"type":"normal","normal":true,"ln1":202,"ln2":206,"content":"               this.setAttribute('image', val.getAttribute('image'));"},{"type":"normal","normal":true,"ln1":203,"ln2":207,"content":"               this.setAttribute('label', val.getAttribute('label'));"},{"type":"normal","normal":true,"ln1":204,"ln2":208,"content":"               this.setAttribute('description', val.getAttribute('description'));"},{"type":"del","del":true,"ln":205,"content":"-              document.addBroadcastListenerFor(val, this, \"value\");"},{"type":"del","del":true,"ln":206,"content":"-              document.addBroadcastListenerFor(val, this, \"label\");"},{"type":"del","del":true,"ln":207,"content":"-              document.addBroadcastListenerFor(val, this, \"image\");"},{"type":"del","del":true,"ln":208,"content":"-              document.addBroadcastListenerFor(val, this, \"description\");"},{"type":"add","add":true,"ln":209,"content":"+              // DOMAttrModified listeners slow down setAttribute calls within"},{"type":"add","add":true,"ln":210,"content":"+              // the document, see bug 395496"},{"type":"add","add":true,"ln":211,"content":"+              if (document instanceof Components.interfaces.nsIDOMXULDocument) {"},{"type":"add","add":true,"ln":212,"content":"+                document.addBroadcastListenerFor(val, this, \"value\");"},{"type":"add","add":true,"ln":213,"content":"+                document.addBroadcastListenerFor(val, this, \"label\");"},{"type":"add","add":true,"ln":214,"content":"+                document.addBroadcastListenerFor(val, this, \"image\");"},{"type":"add","add":true,"ln":215,"content":"+                document.addBroadcastListenerFor(val, this, \"description\");"},{"type":"add","add":true,"ln":216,"content":"+              }"},{"type":"add","add":true,"ln":217,"content":"+              else"},{"type":"add","add":true,"ln":218,"content":"+                val.addEventListener(\"DOMAttrModified\", this, false);"},{"type":"normal","normal":true,"ln1":209,"ln2":219,"content":"             }"},{"type":"normal","normal":true,"ln1":210,"ln2":220,"content":"             else {"},{"type":"normal","normal":true,"ln1":211,"ln2":221,"content":"               this.removeAttribute('value');"}],"oldStart":202,"oldLines":10,"newStart":206,"newLines":16},{"content":"@@ -227,6 +237,25 @@","changes":[{"type":"normal","normal":true,"ln1":227,"ln2":237,"content":"         </setter>"},{"type":"normal","normal":true,"ln1":228,"ln2":238,"content":"       </property>"},{"type":"normal","normal":true,"ln1":229,"ln2":239,"content":" "},{"type":"add","add":true,"ln":240,"content":"+      <method name=\"handleEvent\">"},{"type":"add","add":true,"ln":241,"content":"+        <parameter name=\"aEvent\"/>"},{"type":"add","add":true,"ln":242,"content":"+        <body>"},{"type":"add","add":true,"ln":243,"content":"+          <![CDATA["},{"type":"add","add":true,"ln":244,"content":"+            if (aEvent.type == \"DOMAttrModified\" &&"},{"type":"add","add":true,"ln":245,"content":"+                aEvent.target == this.mSelectedInternal) {"},{"type":"add","add":true,"ln":246,"content":"+              var attrName = aEvent.attrName;"},{"type":"add","add":true,"ln":247,"content":"+              switch (attrName) {"},{"type":"add","add":true,"ln":248,"content":"+                case \"value\":"},{"type":"add","add":true,"ln":249,"content":"+                case \"label\":"},{"type":"add","add":true,"ln":250,"content":"+                case \"image\":"},{"type":"add","add":true,"ln":251,"content":"+                case \"description\":"},{"type":"add","add":true,"ln":252,"content":"+                  this.setAttribute(attrName, aEvent.newValue);"},{"type":"add","add":true,"ln":253,"content":"+              }"},{"type":"add","add":true,"ln":254,"content":"+            }"},{"type":"add","add":true,"ln":255,"content":"+          ]]>"},{"type":"add","add":true,"ln":256,"content":"+        </body>"},{"type":"add","add":true,"ln":257,"content":"+      </method>"},{"type":"add","add":true,"ln":258,"content":"+"},{"type":"normal","normal":true,"ln1":230,"ln2":259,"content":"       <method name=\"getIndexOfItem\">"},{"type":"normal","normal":true,"ln1":231,"ln2":260,"content":"         <parameter name=\"item\"/>"},{"type":"normal","normal":true,"ln1":232,"ln2":261,"content":"         <body>"}],"oldStart":227,"oldLines":6,"newStart":237,"newLines":25},{"content":"@@ -345,11 +374,14 @@","changes":[{"type":"normal","normal":true,"ln1":345,"ln2":374,"content":"       <destructor>"},{"type":"normal","normal":true,"ln1":346,"ln2":375,"content":"         <![CDATA["},{"type":"normal","normal":true,"ln1":347,"ln2":376,"content":"           if (this.mSelectedInternal) {"},{"type":"del","del":true,"ln":348,"content":"-            document.removeBroadcastListenerFor(this.mSelectedInternal, this, \"value\");"},{"type":"del","del":true,"ln":349,"content":"-            document.removeBroadcastListenerFor(this.mSelectedInternal, this, \"label\");"},{"type":"del","del":true,"ln":350,"content":"-            document.removeBroadcastListenerFor(this.mSelectedInternal, this, \"image\");"},{"type":"del","del":true,"ln":351,"content":"-            document.removeBroadcastListenerFor(this.mSelectedInternal, this, \"description\");"},{"type":"del","del":true,"ln":352,"content":"-           "},{"type":"add","add":true,"ln":377,"content":"+            if (document instanceof Components.interfaces.nsIDOMXULDocument) {"},{"type":"add","add":true,"ln":378,"content":"+              document.removeBroadcastListenerFor(this.mSelectedInternal, this, \"value\");"},{"type":"add","add":true,"ln":379,"content":"+              document.removeBroadcastListenerFor(this.mSelectedInternal, this, \"label\");"},{"type":"add","add":true,"ln":380,"content":"+              document.removeBroadcastListenerFor(this.mSelectedInternal, this, \"image\");"},{"type":"add","add":true,"ln":381,"content":"+              document.removeBroadcastListenerFor(this.mSelectedInternal, this, \"description\");"},{"type":"add","add":true,"ln":382,"content":"+            }"},{"type":"add","add":true,"ln":383,"content":"+            else"},{"type":"add","add":true,"ln":384,"content":"+              this.mSelectedInternal.removeEventListener(\"DOMAttrModified\", this, false);"},{"type":"normal","normal":true,"ln1":353,"ln2":385,"content":"           }"},{"type":"normal","normal":true,"ln1":354,"ln2":386,"content":"         ]]>"},{"type":"normal","normal":true,"ln1":355,"ln2":387,"content":"       </destructor>"}],"oldStart":345,"oldLines":11,"newStart":374,"newLines":14}],"deletions":14,"additions":46,"from":"toolkit/content/widgets/menulist.xml","to":"toolkit/content/widgets/menulist.xml","index":["a11c247..5fd8a8f","100644"]}]}