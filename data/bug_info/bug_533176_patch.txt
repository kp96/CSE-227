From: Serge Gautherie <sgautherie.bz@free.fr>

Bug 533176 - Port |Bug 425001 - Tests for bug 400731, 431826 use timers, are fragile| to SeaMonkey;
(Av1) Port m-c browser_bug431826.js changes to c-c browser_bug463504.js.

diff --git a/suite/common/tests/browser/browser_bug463504.js b/suite/common/tests/browser/browser_bug463504.js
--- a/suite/common/tests/browser/browser_bug463504.js
+++ b/suite/common/tests/browser/browser_bug463504.js
@@ -3,41 +3,41 @@ var newBrowser
 function test() {
   waitForExplicitFinish();
 
   var newTab = gBrowser.addTab();
   gBrowser.selectedTab = newTab;
   newBrowser = gBrowser.getBrowserForTab(newTab);
 
   // Navigate to a site with a broken cert
+  window.addEventListener("DOMContentLoaded", testBrokenCert, true);
   newBrowser.contentWindow.location = 'https://nocert.example.com/';
-  // XXX - This timer and the next should be replaced with an event
-  // handler when bug 425001 is fixed.
-  window.setTimeout(testBrokenCert, 2000);
 }
 
 function testBrokenCert() {
+  window.removeEventListener("DOMContentLoaded", testBrokenCert, true);
 
   // Confirm that we are displaying the contributed error page, not the default
   ok(/^about:certerror/.test(gBrowser.contentWindow.document.documentURI), "Broken page should go to about:certerror, not about:neterror");
 
   // Confirm that the expert section is collapsed
   var expertDiv = gBrowser.contentWindow.document.getElementById("expertContent");
   ok(expertDiv, "Expert content div should exist");
   ok(expertDiv.hasAttribute("collapsed"), "Expert content should be collapsed by default");
 
   // Tweak the expert mode pref
   Cc["@mozilla.org/preferences-service;1"].getService(Ci.nsIPrefBranch)
                                           .setBoolPref("browser.xul.error_pages.expert_bad_cert", true);
 
+  window.addEventListener("DOMContentLoaded", testExpertPref, true);
   newBrowser.reload();
-  window.setTimeout(testExpertPref, 2000);
 }
 
 function testExpertPref() {
+  window.removeEventListener("DOMContentLoaded", testExpertPref, true);
 
   var expertDiv = gBrowser.contentWindow.document.getElementById("expertContent");
   var technicalDiv = gBrowser.contentWindow.document.getElementById("technicalContent");
   ok(!expertDiv.hasAttribute("collapsed"), "Expert content should not be collapsed with the expert mode pref set");
   ok(!technicalDiv.hasAttribute("collapsed"), "Technical content should not be collapsed with the expert mode pref set");
 
   // Clean up
   gBrowser.removeCurrentTab();
