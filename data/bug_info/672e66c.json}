{"sha":"\"47e7bc67f932866e4467f7ab8a23bb167405bebd\"","commit":{"author":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"committer":{"name":"\"Nicolas Silva\"","email":"\"nsilva@mozilla.com\"","date":"\"2016-09-01T15:51:09+02:00\""},"message":"\"Bug 1298345 - Refactor CanvasRenderingContext2D's texture allocation code. r=Bas672e66c\""},"diff":[{"chunks":[{"content":"@@ -160,6 +160,14 @@ nsSHEntry::~nsSHEntry()","changes":[{"type":"normal","normal":true,"ln1":160,"ln2":160,"content":"   if (viewer) {"},{"type":"normal","normal":true,"ln1":161,"ln2":161,"content":"     viewer->Destroy();"},{"type":"normal","normal":true,"ln1":162,"ln2":162,"content":"   }"},{"type":"add","add":true,"ln":163,"content":"+"},{"type":"add","add":true,"ln":164,"content":"+#ifdef DEBUG"},{"type":"add","add":true,"ln":165,"content":"+  nsExpirationTracker<nsSHEntry,3>::Iterator iterator(gHistoryTracker);"},{"type":"add","add":true,"ln":166,"content":"+  nsSHEntry* elem;"},{"type":"add","add":true,"ln":167,"content":"+  while ((elem = iterator.Next()) != nsnull) {"},{"type":"add","add":true,"ln":168,"content":"+    NS_ASSERTION(elem != this, \"Found dead entry still in the tracker!\");"},{"type":"add","add":true,"ln":169,"content":"+  }"},{"type":"add","add":true,"ln":170,"content":"+#endif"},{"type":"normal","normal":true,"ln1":163,"ln2":171,"content":" }"},{"type":"normal","normal":true,"ln1":164,"ln2":172,"content":" "},{"type":"normal","normal":true,"ln1":165,"ln2":173,"content":" //*****************************************************************************"}],"oldStart":160,"oldLines":6,"newStart":160,"newLines":14}],"deletions":0,"additions":8,"from":"docshell/shistory/src/nsSHEntry.cpp","to":"docshell/shistory/src/nsSHEntry.cpp","index":["32a8bc8..4e8b015","100644"]},{"chunks":[{"content":"@@ -234,6 +234,29 @@ template <class T, PRUint32 K> class nsExpirationTracker {","changes":[{"type":"normal","normal":true,"ln1":234,"ln2":234,"content":"         AgeOneGeneration();"},{"type":"normal","normal":true,"ln1":235,"ln2":235,"content":"       }"},{"type":"normal","normal":true,"ln1":236,"ln2":236,"content":"     }"},{"type":"add","add":true,"ln":237,"content":"+    "},{"type":"add","add":true,"ln":238,"content":"+    class Iterator {"},{"type":"add","add":true,"ln":239,"content":"+    private:"},{"type":"add","add":true,"ln":240,"content":"+      nsExpirationTracker<T,K>* mTracker;"},{"type":"add","add":true,"ln":241,"content":"+      PRUint32                  mGeneration;"},{"type":"add","add":true,"ln":242,"content":"+      PRUint32                  mIndex;"},{"type":"add","add":true,"ln":243,"content":"+    public:"},{"type":"add","add":true,"ln":244,"content":"+      Iterator(nsExpirationTracker<T,K>* aTracker)"},{"type":"add","add":true,"ln":245,"content":"+        : mTracker(aTracker), mGeneration(0), mIndex(0) {}"},{"type":"add","add":true,"ln":246,"content":"+      T* Next() {"},{"type":"add","add":true,"ln":247,"content":"+        while (mGeneration < K) {"},{"type":"add","add":true,"ln":248,"content":"+          nsTArray<T*>* generation = &mTracker->mGenerations[mGeneration];"},{"type":"add","add":true,"ln":249,"content":"+          if (mIndex < generation->Length()) {"},{"type":"add","add":true,"ln":250,"content":"+            ++mIndex;"},{"type":"add","add":true,"ln":251,"content":"+            return (*generation)[mIndex - 1];"},{"type":"add","add":true,"ln":252,"content":"+          }"},{"type":"add","add":true,"ln":253,"content":"+          ++mGeneration;"},{"type":"add","add":true,"ln":254,"content":"+        }"},{"type":"add","add":true,"ln":255,"content":"+        return nsnull;"},{"type":"add","add":true,"ln":256,"content":"+      }"},{"type":"add","add":true,"ln":257,"content":"+    };"},{"type":"add","add":true,"ln":258,"content":"+    "},{"type":"add","add":true,"ln":259,"content":"+    friend class Iterator;"},{"type":"normal","normal":true,"ln1":237,"ln2":260,"content":" "},{"type":"normal","normal":true,"ln1":238,"ln2":261,"content":"   protected:"},{"type":"normal","normal":true,"ln1":239,"ln2":262,"content":"     /**"}],"oldStart":234,"oldLines":6,"newStart":234,"newLines":29}],"deletions":0,"additions":23,"from":"xpcom/ds/nsExpirationTracker.h","to":"xpcom/ds/nsExpirationTracker.h","index":["0c88a39..c006fc4f4","100644"]}]}